\hypertarget{twolame_8c}{}\section{C\+:/\+\_\+dev/\+Open\+U/\+Audacity/audacity/lib-\/src/twolame/libtwolame/twolame.c File Reference}
\label{twolame_8c}\index{C\+:/\+\_\+dev/\+Open\+U/\+Audacity/audacity/lib-\/src/twolame/libtwolame/twolame.\+c@{C\+:/\+\_\+dev/\+Open\+U/\+Audacity/audacity/lib-\/src/twolame/libtwolame/twolame.\+c}}
{\ttfamily \#include $<$stdio.\+h$>$}\\*
{\ttfamily \#include $<$stdlib.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include $<$math.\+h$>$}\\*
{\ttfamily \#include $<$assert.\+h$>$}\\*
{\ttfamily \#include $<$limits.\+h$>$}\\*
{\ttfamily \#include \char`\"{}twolame.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}common.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}bitbuffer.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}mem.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}crc.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}dab.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}psycho\+\_\+n1.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}psycho\+\_\+0.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}psycho\+\_\+1.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}psycho\+\_\+2.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}psycho\+\_\+3.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}psycho\+\_\+4.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}availbits.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}subband.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}encode.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}energy.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}util.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}bitbuffer\+\_\+inline.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{twolame_8h_a429c5c35b47d5d7cc34a07e48a82866d}{twolame\+\_\+options} $\ast$ \hyperlink{twolame_8c_ac4cdab0d6542badab38bb4ddf96957fb}{twolame\+\_\+init} (\hyperlink{sound_8c_ae35f5844602719cf66324f4de2a658b3}{void})
\item 
\hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} \hyperlink{twolame_8c_a479229b288016a4b7b1dd696e4000257}{twolame\+\_\+init\+\_\+params} (\hyperlink{twolame_8h_a429c5c35b47d5d7cc34a07e48a82866d}{twolame\+\_\+options} $\ast$glopts)
\item 
\hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} \hyperlink{twolame_8c_a7656283020d9b131790bf5a99af055c4}{twolame\+\_\+encode\+\_\+buffer} (\hyperlink{twolame_8h_a429c5c35b47d5d7cc34a07e48a82866d}{twolame\+\_\+options} $\ast$glopts, \hyperlink{getopt1_8c_a2c212835823e3c54a8ab6d95c652660e}{const} short \hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} leftpcm\mbox{[}$\,$\mbox{]}, \hyperlink{getopt1_8c_a2c212835823e3c54a8ab6d95c652660e}{const} short \hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} rightpcm\mbox{[}$\,$\mbox{]}, \hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} num\+\_\+samples, unsigned char $\ast$mp2buffer, \hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} mp2buffer\+\_\+size)
\item 
\hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} \hyperlink{twolame_8c_a578b70ad7abfcc2bbed09ecf661fd66e}{twolame\+\_\+encode\+\_\+buffer\+\_\+interleaved} (\hyperlink{twolame_8h_a429c5c35b47d5d7cc34a07e48a82866d}{twolame\+\_\+options} $\ast$glopts, \hyperlink{getopt1_8c_a2c212835823e3c54a8ab6d95c652660e}{const} short \hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} pcm\mbox{[}$\,$\mbox{]}, \hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} num\+\_\+samples, unsigned char $\ast$mp2buffer, \hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} mp2buffer\+\_\+size)
\item 
\hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} \hyperlink{twolame_8c_a8e77eb0f22479f8ec1bd4f1b042f9cd9}{twolame\+\_\+encode\+\_\+buffer\+\_\+float32} (\hyperlink{twolame_8h_a429c5c35b47d5d7cc34a07e48a82866d}{twolame\+\_\+options} $\ast$glopts, \hyperlink{getopt1_8c_a2c212835823e3c54a8ab6d95c652660e}{const} float leftpcm\mbox{[}$\,$\mbox{]}, \hyperlink{getopt1_8c_a2c212835823e3c54a8ab6d95c652660e}{const} float rightpcm\mbox{[}$\,$\mbox{]}, \hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} num\+\_\+samples, unsigned char $\ast$mp2buffer, \hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} mp2buffer\+\_\+size)
\item 
\hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} \hyperlink{twolame_8c_aca716bf42f767e889c0505206c3f1160}{twolame\+\_\+encode\+\_\+buffer\+\_\+float32\+\_\+interleaved} (\hyperlink{twolame_8h_a429c5c35b47d5d7cc34a07e48a82866d}{twolame\+\_\+options} $\ast$glopts, \hyperlink{getopt1_8c_a2c212835823e3c54a8ab6d95c652660e}{const} float pcm\mbox{[}$\,$\mbox{]}, \hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} num\+\_\+samples, unsigned char $\ast$mp2buffer, \hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} mp2buffer\+\_\+size)
\item 
\hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} \hyperlink{twolame_8c_a3903ae20e7e99b7774c527e3e9ed3ab3}{twolame\+\_\+encode\+\_\+flush} (\hyperlink{twolame_8h_a429c5c35b47d5d7cc34a07e48a82866d}{twolame\+\_\+options} $\ast$glopts, unsigned char $\ast$mp2buffer, \hyperlink{xmltok_8h_a5a0d4a5641ce434f1d23533f2b2e6653}{int} mp2buffer\+\_\+size)
\item 
\hyperlink{sound_8c_ae35f5844602719cf66324f4de2a658b3}{void} \hyperlink{twolame_8c_a5a9adda3b79826aa841471dda5e87e34}{twolame\+\_\+close} (\hyperlink{twolame_8h_a429c5c35b47d5d7cc34a07e48a82866d}{twolame\+\_\+options} $\ast$$\ast$glopts)
\end{DoxyCompactItemize}


\subsection{Function Documentation}
\index{twolame.\+c@{twolame.\+c}!twolame\+\_\+close@{twolame\+\_\+close}}
\index{twolame\+\_\+close@{twolame\+\_\+close}!twolame.\+c@{twolame.\+c}}
\subsubsection[{\texorpdfstring{twolame\+\_\+close(twolame\+\_\+options $\ast$$\ast$glopts)}{twolame_close(twolame_options **glopts)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf void} twolame\+\_\+close (
\begin{DoxyParamCaption}
\item[{{\bf twolame\+\_\+options} $\ast$$\ast$}]{glopts}
\end{DoxyParamCaption}
)}\hypertarget{twolame_8c_a5a9adda3b79826aa841471dda5e87e34}{}\label{twolame_8c_a5a9adda3b79826aa841471dda5e87e34}
Shut down the twolame encoder.

Shuts down the twolame encoder and frees all memory that it previously allocated. You should call this once you have finished all your encoding. This function will set your glopts pointer to N\+U\+LL for you.


\begin{DoxyParams}{Parameters}
{\em glopts} & pointer to twolame options pointer \\
\hline
\end{DoxyParams}


Definition at line 908 of file twolame.\+c.

\index{twolame.\+c@{twolame.\+c}!twolame\+\_\+encode\+\_\+buffer@{twolame\+\_\+encode\+\_\+buffer}}
\index{twolame\+\_\+encode\+\_\+buffer@{twolame\+\_\+encode\+\_\+buffer}!twolame.\+c@{twolame.\+c}}
\subsubsection[{\texorpdfstring{twolame\+\_\+encode\+\_\+buffer(twolame\+\_\+options $\ast$glopts, const short int leftpcm[], const short int rightpcm[], int num\+\_\+samples, unsigned char $\ast$mp2buffer, int mp2buffer\+\_\+size)}{twolame_encode_buffer(twolame_options *glopts, const short int leftpcm[], const short int rightpcm[], int num_samples, unsigned char *mp2buffer, int mp2buffer_size)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} twolame\+\_\+encode\+\_\+buffer (
\begin{DoxyParamCaption}
\item[{{\bf twolame\+\_\+options} $\ast$}]{glopts, }
\item[{{\bf const} short {\bf int}}]{leftpcm\mbox{[}$\,$\mbox{]}, }
\item[{{\bf const} short {\bf int}}]{rightpcm\mbox{[}$\,$\mbox{]}, }
\item[{{\bf int}}]{num\+\_\+samples, }
\item[{unsigned char $\ast$}]{mp2buffer, }
\item[{{\bf int}}]{mp2buffer\+\_\+size}
\end{DoxyParamCaption}
)}\hypertarget{twolame_8c_a7656283020d9b131790bf5a99af055c4}{}\label{twolame_8c_a7656283020d9b131790bf5a99af055c4}
Encode some 16-\/bit P\+CM audio to M\+P2.

Takes 16-\/bit P\+CM audio samples from seperate left and right buffers and places encoded audio into mp2buffer.


\begin{DoxyParams}{Parameters}
{\em glopts} & twolame options pointer \\
\hline
{\em leftpcm} & Left channel audio samples \\
\hline
{\em rightpcm} & Right channel audio samples \\
\hline
{\em num\+\_\+samples} & Number of samples per channel \\
\hline
{\em mp2buffer} & Buffer to place encoded audio into \\
\hline
{\em mp2buffer\+\_\+size} & Size of the output buffer \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The number of bytes put in output buffer or a negative value on error 
\end{DoxyReturn}


Definition at line 618 of file twolame.\+c.

\index{twolame.\+c@{twolame.\+c}!twolame\+\_\+encode\+\_\+buffer\+\_\+float32@{twolame\+\_\+encode\+\_\+buffer\+\_\+float32}}
\index{twolame\+\_\+encode\+\_\+buffer\+\_\+float32@{twolame\+\_\+encode\+\_\+buffer\+\_\+float32}!twolame.\+c@{twolame.\+c}}
\subsubsection[{\texorpdfstring{twolame\+\_\+encode\+\_\+buffer\+\_\+float32(twolame\+\_\+options $\ast$glopts, const float leftpcm[], const float rightpcm[], int num\+\_\+samples, unsigned char $\ast$mp2buffer, int mp2buffer\+\_\+size)}{twolame_encode_buffer_float32(twolame_options *glopts, const float leftpcm[], const float rightpcm[], int num_samples, unsigned char *mp2buffer, int mp2buffer_size)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} twolame\+\_\+encode\+\_\+buffer\+\_\+float32 (
\begin{DoxyParamCaption}
\item[{{\bf twolame\+\_\+options} $\ast$}]{glopts, }
\item[{{\bf const} float}]{leftpcm\mbox{[}$\,$\mbox{]}, }
\item[{{\bf const} float}]{rightpcm\mbox{[}$\,$\mbox{]}, }
\item[{{\bf int}}]{num\+\_\+samples, }
\item[{unsigned char $\ast$}]{mp2buffer, }
\item[{{\bf int}}]{mp2buffer\+\_\+size}
\end{DoxyParamCaption}
)}\hypertarget{twolame_8c_a8e77eb0f22479f8ec1bd4f1b042f9cd9}{}\label{twolame_8c_a8e77eb0f22479f8ec1bd4f1b042f9cd9}
Encode some 32-\/bit P\+CM audio to M\+P2.

Takes 32-\/bit floating point P\+CM audio samples from seperate left and right buffers and places encoded audio into mp2buffer.

Note\+: the 32-\/bit samples are currently scaled down to 16-\/bit samples internally.


\begin{DoxyParams}{Parameters}
{\em glopts} & twolame options pointer \\
\hline
{\em leftpcm} & Left channel audio samples \\
\hline
{\em rightpcm} & Right channel audio samples \\
\hline
{\em num\+\_\+samples} & Number of samples per channel \\
\hline
{\em mp2buffer} & Buffer to place encoded audio into \\
\hline
{\em mp2buffer\+\_\+size} & Size of the output buffer \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The number of bytes put in output buffer or a negative value on error 
\end{DoxyReturn}


Definition at line 760 of file twolame.\+c.

\index{twolame.\+c@{twolame.\+c}!twolame\+\_\+encode\+\_\+buffer\+\_\+float32\+\_\+interleaved@{twolame\+\_\+encode\+\_\+buffer\+\_\+float32\+\_\+interleaved}}
\index{twolame\+\_\+encode\+\_\+buffer\+\_\+float32\+\_\+interleaved@{twolame\+\_\+encode\+\_\+buffer\+\_\+float32\+\_\+interleaved}!twolame.\+c@{twolame.\+c}}
\subsubsection[{\texorpdfstring{twolame\+\_\+encode\+\_\+buffer\+\_\+float32\+\_\+interleaved(twolame\+\_\+options $\ast$glopts, const float pcm[], int num\+\_\+samples, unsigned char $\ast$mp2buffer, int mp2buffer\+\_\+size)}{twolame_encode_buffer_float32_interleaved(twolame_options *glopts, const float pcm[], int num_samples, unsigned char *mp2buffer, int mp2buffer_size)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} twolame\+\_\+encode\+\_\+buffer\+\_\+float32\+\_\+interleaved (
\begin{DoxyParamCaption}
\item[{{\bf twolame\+\_\+options} $\ast$}]{glopts, }
\item[{{\bf const} float}]{pcm\mbox{[}$\,$\mbox{]}, }
\item[{{\bf int}}]{num\+\_\+samples, }
\item[{unsigned char $\ast$}]{mp2buffer, }
\item[{{\bf int}}]{mp2buffer\+\_\+size}
\end{DoxyParamCaption}
)}\hypertarget{twolame_8c_aca716bf42f767e889c0505206c3f1160}{}\label{twolame_8c_aca716bf42f767e889c0505206c3f1160}
Encode some 32-\/bit P\+CM audio to M\+P2.

Takes 32-\/bit floating point P\+CM audio samples from a single buffer and places encoded audio into mp2buffer.


\begin{DoxyParams}{Parameters}
{\em glopts} & twolame options pointer \\
\hline
{\em pcm} & Audio samples for left A\+ND right channels \\
\hline
{\em num\+\_\+samples} & Number of samples per channel \\
\hline
{\em mp2buffer} & Buffer to place encoded audio into \\
\hline
{\em mp2buffer\+\_\+size} & Size of the output buffer \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The number of bytes put in output buffer or a negative value on error 
\end{DoxyReturn}


Definition at line 818 of file twolame.\+c.

\index{twolame.\+c@{twolame.\+c}!twolame\+\_\+encode\+\_\+buffer\+\_\+interleaved@{twolame\+\_\+encode\+\_\+buffer\+\_\+interleaved}}
\index{twolame\+\_\+encode\+\_\+buffer\+\_\+interleaved@{twolame\+\_\+encode\+\_\+buffer\+\_\+interleaved}!twolame.\+c@{twolame.\+c}}
\subsubsection[{\texorpdfstring{twolame\+\_\+encode\+\_\+buffer\+\_\+interleaved(twolame\+\_\+options $\ast$glopts, const short int pcm[], int num\+\_\+samples, unsigned char $\ast$mp2buffer, int mp2buffer\+\_\+size)}{twolame_encode_buffer_interleaved(twolame_options *glopts, const short int pcm[], int num_samples, unsigned char *mp2buffer, int mp2buffer_size)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} twolame\+\_\+encode\+\_\+buffer\+\_\+interleaved (
\begin{DoxyParamCaption}
\item[{{\bf twolame\+\_\+options} $\ast$}]{glopts, }
\item[{{\bf const} short {\bf int}}]{pcm\mbox{[}$\,$\mbox{]}, }
\item[{{\bf int}}]{num\+\_\+samples, }
\item[{unsigned char $\ast$}]{mp2buffer, }
\item[{{\bf int}}]{mp2buffer\+\_\+size}
\end{DoxyParamCaption}
)}\hypertarget{twolame_8c_a578b70ad7abfcc2bbed09ecf661fd66e}{}\label{twolame_8c_a578b70ad7abfcc2bbed09ecf661fd66e}
Encode some 16-\/bit P\+CM audio to M\+P2.

Takes interleaved 16-\/bit P\+CM audio samples from a single buffer and places encoded audio into mp2buffer.


\begin{DoxyParams}{Parameters}
{\em glopts} & twolame options pointer \\
\hline
{\em pcm} & Audio samples for left A\+ND right channels \\
\hline
{\em num\+\_\+samples} & Number of samples per channel \\
\hline
{\em mp2buffer} & Buffer to place encoded audio into \\
\hline
{\em mp2buffer\+\_\+size} & Size of the output buffer \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The number of bytes put in output buffer or a negative value on error 
\end{DoxyReturn}


Definition at line 676 of file twolame.\+c.

\index{twolame.\+c@{twolame.\+c}!twolame\+\_\+encode\+\_\+flush@{twolame\+\_\+encode\+\_\+flush}}
\index{twolame\+\_\+encode\+\_\+flush@{twolame\+\_\+encode\+\_\+flush}!twolame.\+c@{twolame.\+c}}
\subsubsection[{\texorpdfstring{twolame\+\_\+encode\+\_\+flush(twolame\+\_\+options $\ast$glopts, unsigned char $\ast$mp2buffer, int mp2buffer\+\_\+size)}{twolame_encode_flush(twolame_options *glopts, unsigned char *mp2buffer, int mp2buffer_size)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} twolame\+\_\+encode\+\_\+flush (
\begin{DoxyParamCaption}
\item[{{\bf twolame\+\_\+options} $\ast$}]{glopts, }
\item[{unsigned char $\ast$}]{mp2buffer, }
\item[{{\bf int}}]{mp2buffer\+\_\+size}
\end{DoxyParamCaption}
)}\hypertarget{twolame_8c_a3903ae20e7e99b7774c527e3e9ed3ab3}{}\label{twolame_8c_a3903ae20e7e99b7774c527e3e9ed3ab3}
Encode any remains buffered P\+CM audio to M\+P2.

Encodes any remaining audio samples in the libtwolame internal sample buffer. This function will return at most a single frame of M\+P\+EG Audio, and at least 0 frames.


\begin{DoxyParams}{Parameters}
{\em glopts} & twolame options pointer \\
\hline
{\em mp2buffer} & Buffer to place encoded audio into \\
\hline
{\em mp2buffer\+\_\+size} & Size of the output buffer \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The number of bytes put in output buffer or a negative value on error 
\end{DoxyReturn}


Definition at line 877 of file twolame.\+c.

\index{twolame.\+c@{twolame.\+c}!twolame\+\_\+init@{twolame\+\_\+init}}
\index{twolame\+\_\+init@{twolame\+\_\+init}!twolame.\+c@{twolame.\+c}}
\subsubsection[{\texorpdfstring{twolame\+\_\+init(void)}{twolame_init(void)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf twolame\+\_\+options}$\ast$ twolame\+\_\+init (
\begin{DoxyParamCaption}
\item[{{\bf void}}]{}
\end{DoxyParamCaption}
)}\hypertarget{twolame_8c_ac4cdab0d6542badab38bb4ddf96957fb}{}\label{twolame_8c_ac4cdab0d6542badab38bb4ddf96957fb}
Initialise the twolame encoder.

Sets defaults for all parameters. Will return N\+U\+LL if malloc() failed, otherwise returns a pointer which you then need to pass to all future A\+PI calls.

\begin{DoxyReturn}{Returns}
a pointer to your new options data structure 
\end{DoxyReturn}


Definition at line 60 of file twolame.\+c.

\index{twolame.\+c@{twolame.\+c}!twolame\+\_\+init\+\_\+params@{twolame\+\_\+init\+\_\+params}}
\index{twolame\+\_\+init\+\_\+params@{twolame\+\_\+init\+\_\+params}!twolame.\+c@{twolame.\+c}}
\subsubsection[{\texorpdfstring{twolame\+\_\+init\+\_\+params(twolame\+\_\+options $\ast$glopts)}{twolame_init_params(twolame_options *glopts)}}]{\setlength{\rightskip}{0pt plus 5cm}{\bf int} twolame\+\_\+init\+\_\+params (
\begin{DoxyParamCaption}
\item[{{\bf twolame\+\_\+options} $\ast$}]{glopts}
\end{DoxyParamCaption}
)}\hypertarget{twolame_8c_a479229b288016a4b7b1dd696e4000257}{}\label{twolame_8c_a479229b288016a4b7b1dd696e4000257}
This function should actually {\itshape check} the parameters to see if they make sense. 

Definition at line 177 of file twolame.\+c.

