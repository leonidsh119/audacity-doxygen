<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.11">
  <compounddef id="_t_d_stretch_8cpp" kind="file" language="C++">
    <compoundname>TDStretch.cpp</compoundname>
    <includes local="no">string.h</includes>
    <includes local="no">limits.h</includes>
    <includes refid="assert_8h" local="no">assert.h</includes>
    <includes local="no">math.h</includes>
    <includes refid="float_8h" local="no">float.h</includes>
    <includes refid="_s_t_types_8h" local="yes">STTypes.h</includes>
    <includes refid="cpu__detect_8h" local="yes">cpu_detect.h</includes>
    <includes refid="_t_d_stretch_8h" local="yes">TDStretch.h</includes>
    <includes local="no">stdio.h</includes>
    <incdepgraph>
      <node id="32358">
        <label>AAFilter.h</label>
        <link refid="_a_a_filter_8h"/>
        <childnode refid="32352" relation="include">
        </childnode>
      </node>
      <node id="32350">
        <label>FLAC/ordinals.h</label>
        <link refid="ordinals_8h"/>
        <childnode refid="32351" relation="include">
        </childnode>
      </node>
      <node id="32354">
        <label>cpu_detect.h</label>
        <link refid="cpu__detect_8h"/>
        <childnode refid="32352" relation="include">
        </childnode>
      </node>
      <node id="32351">
        <label>stdint.h</label>
      </node>
      <node id="32360">
        <label>stdlib.h</label>
      </node>
      <node id="32353">
        <label>stdexcept</label>
      </node>
      <node id="32359">
        <label>FIFOSamplePipe.h</label>
        <link refid="_f_i_f_o_sample_pipe_8h"/>
        <childnode refid="32347" relation="include">
        </childnode>
        <childnode refid="32360" relation="include">
        </childnode>
        <childnode refid="32352" relation="include">
        </childnode>
      </node>
      <node id="32356">
        <label>stddef.h</label>
      </node>
      <node id="32347">
        <label>assert.h</label>
        <link refid="assert_8h"/>
      </node>
      <node id="32346">
        <label>limits.h</label>
      </node>
      <node id="32345">
        <label>string.h</label>
      </node>
      <node id="32349">
        <label>float.h</label>
        <link refid="float_8h"/>
        <childnode refid="32350" relation="include">
        </childnode>
      </node>
      <node id="32361">
        <label>FIFOSampleBuffer.h</label>
        <link refid="_f_i_f_o_sample_buffer_8h"/>
        <childnode refid="32359" relation="include">
        </childnode>
      </node>
      <node id="32355">
        <label>TDStretch.h</label>
        <link refid="_t_d_stretch_8h"/>
        <childnode refid="32356" relation="include">
        </childnode>
        <childnode refid="32352" relation="include">
        </childnode>
        <childnode refid="32357" relation="include">
        </childnode>
        <childnode refid="32359" relation="include">
        </childnode>
      </node>
      <node id="32344">
        <label>C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp</label>
        <link refid="TDStretch.cpp"/>
        <childnode refid="32345" relation="include">
        </childnode>
        <childnode refid="32346" relation="include">
        </childnode>
        <childnode refid="32347" relation="include">
        </childnode>
        <childnode refid="32348" relation="include">
        </childnode>
        <childnode refid="32349" relation="include">
        </childnode>
        <childnode refid="32352" relation="include">
        </childnode>
        <childnode refid="32354" relation="include">
        </childnode>
        <childnode refid="32355" relation="include">
        </childnode>
        <childnode refid="32362" relation="include">
        </childnode>
      </node>
      <node id="32348">
        <label>math.h</label>
      </node>
      <node id="32352">
        <label>STTypes.h</label>
        <link refid="_s_t_types_8h"/>
        <childnode refid="32353" relation="include">
        </childnode>
      </node>
      <node id="32357">
        <label>RateTransposer.h</label>
        <link refid="_rate_transposer_8h"/>
        <childnode refid="32356" relation="include">
        </childnode>
        <childnode refid="32358" relation="include">
        </childnode>
        <childnode refid="32359" relation="include">
        </childnode>
        <childnode refid="32361" relation="include">
        </childnode>
        <childnode refid="32352" relation="include">
        </childnode>
      </node>
      <node id="32362">
        <label>stdio.h</label>
      </node>
    </incdepgraph>
      <sectiondef kind="define">
      <memberdef kind="define" id="_t_d_stretch_8cpp_1ac39d9cef6a5e030ba8d9e11121054268" prot="public" static="no">
        <name>max</name>
        <param><defname>x</defname></param>
        <param><defname>y</defname></param>
        <initializer>(((x) &gt; (y)) ? (x) : (y))</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp" line="58" column="9" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp" bodystart="58" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="_t_d_stretch_8cpp_1a244bdbda25bac4a611f12ca64e7a554f" prot="public" static="no">
        <name>AUTOSEQ_TEMPO_LOW</name>
        <initializer>0.5</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp" line="389" column="13"/>
      </memberdef>
      <memberdef kind="define" id="_t_d_stretch_8cpp_1a59680f4bc9abd0a67332f36f758bac74" prot="public" static="no">
        <name>AUTOSEQ_TEMPO_TOP</name>
        <initializer>2.0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp" line="390" column="13"/>
      </memberdef>
      <memberdef kind="define" id="_t_d_stretch_8cpp_1a1aac876305d4e886dc3777f1d4bc083b" prot="public" static="no">
        <name>AUTOSEQ_AT_MIN</name>
        <initializer>125.0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp" line="393" column="13"/>
      </memberdef>
      <memberdef kind="define" id="_t_d_stretch_8cpp_1a3fff3b71de725723b5a9fcd9f3a49281" prot="public" static="no">
        <name>AUTOSEQ_AT_MAX</name>
        <initializer>50.0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp" line="394" column="13"/>
      </memberdef>
      <memberdef kind="define" id="_t_d_stretch_8cpp_1a69acd847203c6ed6b70a462308891b63" prot="public" static="no">
        <name>AUTOSEQ_K</name>
        <initializer>((<ref refid="_t_d_stretch_8cpp_1a3fff3b71de725723b5a9fcd9f3a49281" kindref="member">AUTOSEQ_AT_MAX</ref> - <ref refid="_t_d_stretch_8cpp_1a1aac876305d4e886dc3777f1d4bc083b" kindref="member">AUTOSEQ_AT_MIN</ref>) / (<ref refid="_t_d_stretch_8cpp_1a59680f4bc9abd0a67332f36f758bac74" kindref="member">AUTOSEQ_TEMPO_TOP</ref> - <ref refid="_t_d_stretch_8cpp_1a244bdbda25bac4a611f12ca64e7a554f" kindref="member">AUTOSEQ_TEMPO_LOW</ref>))</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp" line="395" column="13"/>
      </memberdef>
      <memberdef kind="define" id="_t_d_stretch_8cpp_1af22f84db886e280148d0e28a7a6459a6" prot="public" static="no">
        <name>AUTOSEQ_C</name>
        <initializer>(<ref refid="_t_d_stretch_8cpp_1a1aac876305d4e886dc3777f1d4bc083b" kindref="member">AUTOSEQ_AT_MIN</ref> - (<ref refid="_t_d_stretch_8cpp_1a69acd847203c6ed6b70a462308891b63" kindref="member">AUTOSEQ_K</ref>) * (<ref refid="_t_d_stretch_8cpp_1a244bdbda25bac4a611f12ca64e7a554f" kindref="member">AUTOSEQ_TEMPO_LOW</ref>))</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp" line="396" column="13"/>
      </memberdef>
      <memberdef kind="define" id="_t_d_stretch_8cpp_1a2b7d9673875482bac8699303af0eca1a" prot="public" static="no">
        <name>AUTOSEEK_AT_MIN</name>
        <initializer>25.0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp" line="399" column="13"/>
      </memberdef>
      <memberdef kind="define" id="_t_d_stretch_8cpp_1ab06c1b9aa25adf93fc9483156c8ebb80" prot="public" static="no">
        <name>AUTOSEEK_AT_MAX</name>
        <initializer>15.0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp" line="400" column="13"/>
      </memberdef>
      <memberdef kind="define" id="_t_d_stretch_8cpp_1aa6d2e2731d3778a7205673c85f3e1a85" prot="public" static="no">
        <name>AUTOSEEK_K</name>
        <initializer>((<ref refid="_t_d_stretch_8cpp_1ab06c1b9aa25adf93fc9483156c8ebb80" kindref="member">AUTOSEEK_AT_MAX</ref> - <ref refid="_t_d_stretch_8cpp_1a2b7d9673875482bac8699303af0eca1a" kindref="member">AUTOSEEK_AT_MIN</ref>) / (<ref refid="_t_d_stretch_8cpp_1a59680f4bc9abd0a67332f36f758bac74" kindref="member">AUTOSEQ_TEMPO_TOP</ref> - <ref refid="_t_d_stretch_8cpp_1a244bdbda25bac4a611f12ca64e7a554f" kindref="member">AUTOSEQ_TEMPO_LOW</ref>))</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp" line="401" column="13"/>
      </memberdef>
      <memberdef kind="define" id="_t_d_stretch_8cpp_1a553faa8e78c3934a66885ac05b0fac4b" prot="public" static="no">
        <name>AUTOSEEK_C</name>
        <initializer>(<ref refid="_t_d_stretch_8cpp_1a2b7d9673875482bac8699303af0eca1a" kindref="member">AUTOSEEK_AT_MIN</ref> - (<ref refid="_t_d_stretch_8cpp_1aa6d2e2731d3778a7205673c85f3e1a85" kindref="member">AUTOSEEK_K</ref>) * (<ref refid="_t_d_stretch_8cpp_1a244bdbda25bac4a611f12ca64e7a554f" kindref="member">AUTOSEQ_TEMPO_LOW</ref>))</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp" line="402" column="13"/>
      </memberdef>
      <memberdef kind="define" id="_t_d_stretch_8cpp_1a15b67d9aa264bcc4b9a99fc1d0c2bcaa" prot="public" static="no">
        <name>CHECK_LIMITS</name>
        <param><defname>x</defname></param>
        <param><defname>mi</defname></param>
        <param><defname>ma</defname></param>
        <initializer>(((x) &lt; (mi)) ? (mi) : (((x) &gt; (ma)) ? (ma) : (x)))</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp" line="404" column="13"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="var">
      <memberdef kind="variable" id="_t_d_stretch_8cpp_1a68f6fcad78e930b42c0396840600f23f" prot="public" static="yes" mutable="no">
        <type><ref refid="getopt1_8c_1a2c212835823e3c54a8ab6d95c652660e" kindref="member">const</ref> short</type>
        <definition>const short _scanOffsets[5][24]</definition>
        <argsstring>[5][24]</argsstring>
        <name>_scanOffsets</name>
        <initializer>={
    { 124,  186,  248,  310,  372,  434,  496,  558,  620,  682,  744, 806,
      868,  930,  992, 1054, 1116, 1178, 1240, 1302, 1364, 1426, 1488,   0},
    {-100,  -75,  -50,  -25,   25,   50,   75,  100,    0,    0,    0,   0,
        0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,   0},
    { -20,  -15,  -10,   -5,    5,   10,   15,   20,    0,    0,    0,   0,
        0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,   0},
    {  -4,   -3,   -2,   -1,    1,    2,    3,    4,    0,    0,    0,   0,
        0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,   0},
    { 121,  114,   97,  114,   98,  105,  108,   32,  104,   99,  117,  111,
      116,  100,  110,  117,  111,  115,    0,    0,    0,    0,    0,   0}}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp" line="68" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp" bodystart="68" bodyend="-1"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Last<sp/>changed<sp/><sp/>:<sp/>$Date:<sp/>2012-11-08<sp/>20:53:01<sp/>+0200<sp/>(Thu,<sp/>08<sp/>Nov<sp/>2012)<sp/>$</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="comment">//<sp/>File<sp/>revision<sp/>:<sp/>$Revision:<sp/>1.12<sp/>$</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="comment">//<sp/>$Id:<sp/>TDStretch.cpp<sp/>160<sp/>2012-11-08<sp/>18:53:01Z<sp/>oparviai<sp/>$</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="comment">//</highlight></codeline>
<codeline lineno="22"><highlight class="comment"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="comment">//<sp/>License<sp/>:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>SoundTouch<sp/>audio<sp/>processing<sp/>library</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>Copyright<sp/>(c)<sp/>Olli<sp/>Parviainen</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>This<sp/>library<sp/>is<sp/>free<sp/>software;<sp/>you<sp/>can<sp/>redistribute<sp/>it<sp/>and/or</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>modify<sp/>it<sp/>under<sp/>the<sp/>terms<sp/>of<sp/>the<sp/>GNU<sp/>Lesser<sp/>General<sp/>Public</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>License<sp/>as<sp/>published<sp/>by<sp/>the<sp/>Free<sp/>Software<sp/>Foundation;<sp/>either</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>version<sp/>2.1<sp/>of<sp/>the<sp/>License,<sp/>or<sp/>(at<sp/>your<sp/>option)<sp/>any<sp/>later<sp/>version.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>This<sp/>library<sp/>is<sp/>distributed<sp/>in<sp/>the<sp/>hope<sp/>that<sp/>it<sp/>will<sp/>be<sp/>useful,</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>but<sp/>WITHOUT<sp/>ANY<sp/>WARRANTY;<sp/>without<sp/>even<sp/>the<sp/>implied<sp/>warranty<sp/>of</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>MERCHANTABILITY<sp/>or<sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE.<sp/><sp/>See<sp/>the<sp/>GNU</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>Lesser<sp/>General<sp/>Public<sp/>License<sp/>for<sp/>more<sp/>details.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>You<sp/>should<sp/>have<sp/>received<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>GNU<sp/>Lesser<sp/>General<sp/>Public</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>License<sp/>along<sp/>with<sp/>this<sp/>library;<sp/>if<sp/>not,<sp/>write<sp/>to<sp/>the<sp/>Free<sp/>Software</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/>Foundation,<sp/>Inc.,<sp/>59<sp/>Temple<sp/>Place,<sp/>Suite<sp/>330,<sp/>Boston,<sp/>MA<sp/><sp/>02111-1307<sp/><sp/>USA</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="comment">//</highlight></codeline>
<codeline lineno="43"><highlight class="comment"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;limits.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="assert_8h" kindref="compound">assert.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;math.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;<ref refid="float_8h" kindref="compound">float.h</ref>&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="_s_t_types_8h" kindref="compound">STTypes.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="cpu__detect_8h" kindref="compound">cpu_detect.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="_t_d_stretch_8h" kindref="compound">TDStretch.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdio.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight><highlight class="keyword">using<sp/>namespace<sp/></highlight><highlight class="normal"><ref refid="namespacesoundtouch" kindref="compound">soundtouch</ref>;</highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight></codeline>
<codeline lineno="58" refid="_t_d_stretch_8cpp_1ac39d9cef6a5e030ba8d9e11121054268" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>max(x,<sp/>y)<sp/>(((x)<sp/>&gt;<sp/>(y))<sp/>?<sp/>(x)<sp/>:<sp/>(y))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight><highlight class="comment">/*****************************************************************************</highlight></codeline>
<codeline lineno="62"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="63"><highlight class="comment"><sp/>*<sp/>Constant<sp/>definitions</highlight></codeline>
<codeline lineno="64"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="65"><highlight class="comment"><sp/>*****************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Table<sp/>for<sp/>the<sp/>hierarchical<sp/>mixing<sp/>position<sp/>seeking<sp/>algorithm</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/>_scanOffsets[5][24]={</highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/>{<sp/>124,<sp/><sp/>186,<sp/><sp/>248,<sp/><sp/>310,<sp/><sp/>372,<sp/><sp/>434,<sp/><sp/>496,<sp/><sp/>558,<sp/><sp/>620,<sp/><sp/>682,<sp/><sp/>744,<sp/>806,</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>868,<sp/><sp/>930,<sp/><sp/>992,<sp/>1054,<sp/>1116,<sp/>1178,<sp/>1240,<sp/>1302,<sp/>1364,<sp/>1426,<sp/>1488,<sp/><sp/><sp/>0},</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/>{-100,<sp/><sp/>-75,<sp/><sp/>-50,<sp/><sp/>-25,<sp/><sp/><sp/>25,<sp/><sp/><sp/>50,<sp/><sp/><sp/>75,<sp/><sp/>100,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/>0,</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/>0},</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/>{<sp/>-20,<sp/><sp/>-15,<sp/><sp/>-10,<sp/><sp/><sp/>-5,<sp/><sp/><sp/><sp/>5,<sp/><sp/><sp/>10,<sp/><sp/><sp/>15,<sp/><sp/><sp/>20,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/>0,</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/>0},</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/>{<sp/><sp/>-4,<sp/><sp/><sp/>-3,<sp/><sp/><sp/>-2,<sp/><sp/><sp/>-1,<sp/><sp/><sp/><sp/>1,<sp/><sp/><sp/><sp/>2,<sp/><sp/><sp/><sp/>3,<sp/><sp/><sp/><sp/>4,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/>0,</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/>0},</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/>{<sp/>121,<sp/><sp/>114,<sp/><sp/><sp/>97,<sp/><sp/>114,<sp/><sp/><sp/>98,<sp/><sp/>105,<sp/><sp/>108,<sp/><sp/><sp/>32,<sp/><sp/>104,<sp/><sp/><sp/>99,<sp/><sp/>117,<sp/><sp/>111,</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>116,<sp/><sp/>100,<sp/><sp/>110,<sp/><sp/>117,<sp/><sp/>111,<sp/><sp/>115,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/><sp/>0,<sp/><sp/><sp/>0}};</highlight></codeline>
<codeline lineno="79"><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"></highlight><highlight class="comment">/*****************************************************************************</highlight></codeline>
<codeline lineno="81"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="82"><highlight class="comment"><sp/>*<sp/>Implementation<sp/>of<sp/>the<sp/>class<sp/>&apos;TDStretch&apos;</highlight></codeline>
<codeline lineno="83"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="84"><highlight class="comment"><sp/>*****************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87" refid="classsoundtouch_1_1_t_d_stretch_1a385b25e91ec29b1091092383268576b9" refkind="member"><highlight class="normal"><ref refid="classsoundtouch_1_1_t_d_stretch_1a385b25e91ec29b1091092383268576b9" kindref="member">TDStretch::TDStretch</ref>()<sp/>:<sp/><ref refid="classsoundtouch_1_1_f_i_f_o_processor" kindref="compound">FIFOProcessor</ref>(&amp;outputBuffer)</highlight></codeline>
<codeline lineno="88"><highlight class="normal">{</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aeb8664ce8d3bd7b625b25273a5032045" kindref="member">bQuickSeek</ref><sp/>=<sp/><ref refid="cext_8h_1aa93f0eb578d23995850d61f7d61c55c1" kindref="member">FALSE</ref>;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8a19ab5d68efd8f21fe88e6d2fc9e2c8" kindref="member">channels</ref><sp/>=<sp/>2;</highlight></codeline>
<codeline lineno="91"><highlight class="normal"></highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ae8ecce9c1a28ac0e281413ab2d1ffff8" kindref="member">pMidBuffer</ref><sp/>=<sp/><ref refid="getopt1_8c_1a070d2ce7b6bb7e5c05602aa8c308d0c4" kindref="member">NULL</ref>;</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a761455426dae783dd29b1a863ff92e32" kindref="member">pMidBufferUnaligned</ref><sp/>=<sp/><ref refid="getopt1_8c_1a070d2ce7b6bb7e5c05602aa8c308d0c4" kindref="member">NULL</ref>;</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="95"><highlight class="normal"></highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a9a52a469732c4f5e884d62b5eabebc6e" kindref="member">bAutoSeqSetting</ref><sp/>=<sp/><ref refid="cext_8h_1aa8cecfc5c5c054d2875c03e77b7be15d" kindref="member">TRUE</ref>;</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8b241cf654e8c29b7ff7af3f359866a7" kindref="member">bAutoSeekSetting</ref><sp/>=<sp/><ref refid="cext_8h_1aa8cecfc5c5c054d2875c03e77b7be15d" kindref="member">TRUE</ref>;</highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/>outDebt<sp/>=<sp/>0;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ac1e7943634556e4fa61224bb0d14a726" kindref="member">skipFract</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a97f816f5041ed44832049d51e6212cfa" kindref="member">tempo</ref><sp/>=<sp/>1.0f;</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a50379535209e1a2951711a69436426f0" kindref="member">setParameters</ref>(44100,<sp/><ref refid="_t_d_stretch_8h_1a461e52d678e12115e0f00d2fac31bc54" kindref="member">DEFAULT_SEQUENCE_MS</ref>,<sp/><ref refid="_t_d_stretch_8h_1a73effb8b59be52f7c60ebb6c3b5d7afa" kindref="member">DEFAULT_SEEKWINDOW_MS</ref>,<sp/><ref refid="_t_d_stretch_8h_1a5bf77e8ec283305cf3c7c54c7c23d181" kindref="member">DEFAULT_OVERLAP_MS</ref>);</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8f8439cea0bad6c675f74d05398a0346" kindref="member">setTempo</ref>(1.0<ref refid="rfft2d_test_m_l_8m_1aacd36fb6ac9ce14cec71f2ca852524d4" kindref="member">f</ref>);</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1afd5f24f010fea81989f65f4011b4e284" kindref="member">clear</ref>();</highlight></codeline>
<codeline lineno="107"><highlight class="normal">}</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"></highlight></codeline>
<codeline lineno="111" refid="classsoundtouch_1_1_t_d_stretch_1a87b72187ccaa195538fbb3ecebe69b9d" refkind="member"><highlight class="normal"><ref refid="classsoundtouch_1_1_t_d_stretch_1a87b72187ccaa195538fbb3ecebe69b9d" kindref="member">TDStretch::~TDStretch</ref>()</highlight></codeline>
<codeline lineno="112"><highlight class="normal">{</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal">[]<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a761455426dae783dd29b1a863ff92e32" kindref="member">pMidBufferUnaligned</ref>;</highlight></codeline>
<codeline lineno="114"><highlight class="normal">}</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"></highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Sets<sp/>routine<sp/>control<sp/>parameters.<sp/>These<sp/>control<sp/>are<sp/>certain<sp/>time<sp/>constants</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"></highlight><highlight class="comment">//<sp/>defining<sp/>how<sp/>the<sp/>sound<sp/>is<sp/>stretched<sp/>to<sp/>the<sp/>desired<sp/>duration.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight><highlight class="comment">//<sp/>&apos;sampleRate&apos;<sp/>=<sp/>sample<sp/>rate<sp/>of<sp/>the<sp/>sound</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight><highlight class="comment">//<sp/>&apos;sequenceMS&apos;<sp/>=<sp/>one<sp/>processing<sp/>sequence<sp/>length<sp/>in<sp/>milliseconds<sp/>(default<sp/>=<sp/>82<sp/>ms)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight><highlight class="comment">//<sp/>&apos;seekwindowMS&apos;<sp/>=<sp/>seeking<sp/>window<sp/>length<sp/>for<sp/>scanning<sp/>the<sp/>best<sp/>overlapping<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight><highlight class="comment">//<sp/><sp/><sp/><sp/><sp/><sp/>position<sp/>(default<sp/>=<sp/>28<sp/>ms)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"></highlight><highlight class="comment">//<sp/>&apos;overlapMS&apos;<sp/>=<sp/>overlapping<sp/>length<sp/>(default<sp/>=<sp/>12<sp/>ms)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight></codeline>
<codeline lineno="127" refid="classsoundtouch_1_1_t_d_stretch_1a50379535209e1a2951711a69436426f0" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a50379535209e1a2951711a69436426f0" kindref="member">TDStretch::setParameters</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>aSampleRate,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>aSequenceMS,<sp/></highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>aSeekWindowMS,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>aOverlapMS)</highlight></codeline>
<codeline lineno="129"><highlight class="normal">{</highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>accept<sp/>only<sp/>positive<sp/>parameter<sp/>values<sp/>-<sp/>if<sp/>zero<sp/>or<sp/>negative,<sp/>use<sp/>old<sp/>values<sp/>instead</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(aSampleRate<sp/>&gt;<sp/>0)<sp/><sp/><sp/>this-&gt;<ref refid="classsoundtouch_1_1_t_d_stretch_1a475226e8ef3d04ebcbb83e13ff8e78e0" kindref="member">sampleRate</ref><sp/>=<sp/>aSampleRate;</highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(aOverlapMS<sp/>&gt;<sp/>0)<sp/><sp/><sp/><sp/>this-&gt;<ref refid="classsoundtouch_1_1_t_d_stretch_1a8c3185aed01ad4714c68ef0f3947769d" kindref="member">overlapMs</ref><sp/>=<sp/>aOverlapMS;</highlight></codeline>
<codeline lineno="133"><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(aSequenceMS<sp/>&gt;<sp/>0)</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classsoundtouch_1_1_t_d_stretch_1ab6571642944948906bf5e2dd2b82a2a6" kindref="member">sequenceMs</ref><sp/>=<sp/>aSequenceMS;</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a9a52a469732c4f5e884d62b5eabebc6e" kindref="member">bAutoSeqSetting</ref><sp/>=<sp/><ref refid="cext_8h_1aa93f0eb578d23995850d61f7d61c55c1" kindref="member">FALSE</ref>;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(aSequenceMS<sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>zero,<sp/>use<sp/>automatic<sp/>setting</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a9a52a469732c4f5e884d62b5eabebc6e" kindref="member">bAutoSeqSetting</ref><sp/>=<sp/><ref refid="cext_8h_1aa8cecfc5c5c054d2875c03e77b7be15d" kindref="member">TRUE</ref>;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="144"><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(aSeekWindowMS<sp/>&gt;<sp/>0)<sp/></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>this-&gt;<ref refid="classsoundtouch_1_1_t_d_stretch_1aa1bd4510b56e3dcdcc68fd9cce930fec" kindref="member">seekWindowMs</ref><sp/>=<sp/>aSeekWindowMS;</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8b241cf654e8c29b7ff7af3f359866a7" kindref="member">bAutoSeekSetting</ref><sp/>=<sp/><ref refid="cext_8h_1aa93f0eb578d23995850d61f7d61c55c1" kindref="member">FALSE</ref>;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(aSeekWindowMS<sp/>==<sp/>0)<sp/></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>zero,<sp/>use<sp/>automatic<sp/>setting</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8b241cf654e8c29b7ff7af3f359866a7" kindref="member">bAutoSeekSetting</ref><sp/>=<sp/><ref refid="cext_8h_1aa8cecfc5c5c054d2875c03e77b7be15d" kindref="member">TRUE</ref>;</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a189b5f64b1955ad20b8cc11566b260d5" kindref="member">calcSeqParameters</ref>();</highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a4de2124e704948f2aff33ca1ee41072e" kindref="member">calculateOverlapLength</ref>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a8c3185aed01ad4714c68ef0f3947769d" kindref="member">overlapMs</ref>);</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>tempo<sp/>to<sp/>recalculate<sp/>&apos;sampleReq&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8f8439cea0bad6c675f74d05398a0346" kindref="member">setTempo</ref>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a97f816f5041ed44832049d51e6212cfa" kindref="member">tempo</ref>);</highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal">}</highlight></codeline>
<codeline lineno="164"><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"></highlight></codeline>
<codeline lineno="170" refid="classsoundtouch_1_1_t_d_stretch_1a1a8b0a1cb993ffbdfd9e6827b23bec0a" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a1a8b0a1cb993ffbdfd9e6827b23bec0a" kindref="member">TDStretch::getParameters</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*pSampleRate,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*pSequenceMs,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*pSeekWindowMs,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*pOverlapMs)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="171"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pSampleRate)</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*pSampleRate<sp/>=<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a475226e8ef3d04ebcbb83e13ff8e78e0" kindref="member">sampleRate</ref>;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="176"><highlight class="normal"></highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pSequenceMs)</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*pSequenceMs<sp/>=<sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a9a52a469732c4f5e884d62b5eabebc6e" kindref="member">bAutoSeqSetting</ref>)<sp/>?<sp/>(<ref refid="_t_d_stretch_8h_1ab6fba6b5397dff71cfc555225fba75ae" kindref="member">USE_AUTO_SEQUENCE_LEN</ref>)<sp/>:<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ab6571642944948906bf5e2dd2b82a2a6" kindref="member">sequenceMs</ref>;</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pSeekWindowMs)</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*pSeekWindowMs<sp/>=<sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a8b241cf654e8c29b7ff7af3f359866a7" kindref="member">bAutoSeekSetting</ref>)<sp/>?<sp/>(<ref refid="_t_d_stretch_8h_1a224896a0e257a2d5c05ccef6af83f091" kindref="member">USE_AUTO_SEEKWINDOW_LEN</ref>)<sp/>:<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aa1bd4510b56e3dcdcc68fd9cce930fec" kindref="member">seekWindowMs</ref>;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="186"><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pOverlapMs)</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*pOverlapMs<sp/>=<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8c3185aed01ad4714c68ef0f3947769d" kindref="member">overlapMs</ref>;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="191"><highlight class="normal">}</highlight></codeline>
<codeline lineno="192"><highlight class="normal"></highlight></codeline>
<codeline lineno="193"><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Overlaps<sp/>samples<sp/>in<sp/>&apos;midBuffer&apos;<sp/>with<sp/>the<sp/>samples<sp/>in<sp/>&apos;pInput&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="195" refid="classsoundtouch_1_1_t_d_stretch_1a963f7387f645b8ef8ad80b6c28a21ac4" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a963f7387f645b8ef8ad80b6c28a21ac4" kindref="member">TDStretch::overlapMono</ref>(<ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref><sp/>*pOutput,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref><sp/>*pInput)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="196"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref><sp/>m1,<sp/>m2;</highlight></codeline>
<codeline lineno="199"><highlight class="normal"></highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/>m1<sp/>=<sp/>(<ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref>)0;</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/>m2<sp/>=<sp/>(<ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref>)<ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref>;</highlight></codeline>
<codeline lineno="202"><highlight class="normal"></highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref><sp/>;<sp/>i<sp/>++)<sp/></highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pOutput[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/>(pInput[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>*<sp/>m1<sp/>+<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ae8ecce9c1a28ac0e281413ab2d1ffff8" kindref="member">pMidBuffer</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>*<sp/>m2<sp/>)<sp/>/<sp/>overlapLength;</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m1<sp/>+=<sp/>1;</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>m2<sp/>-=<sp/>1;</highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="209"><highlight class="normal">}</highlight></codeline>
<codeline lineno="210"><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213" refid="classsoundtouch_1_1_t_d_stretch_1afb63ac43d723ce6c8f27cbb5fa71917d" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1afb63ac43d723ce6c8f27cbb5fa71917d" kindref="member">TDStretch::clearMidBuffer</ref>()</highlight></codeline>
<codeline lineno="214"><highlight class="normal">{</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/>memset(<ref refid="classsoundtouch_1_1_t_d_stretch_1ae8ecce9c1a28ac0e281413ab2d1ffff8" kindref="member">pMidBuffer</ref>,<sp/>0,<sp/>2<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref>)<sp/>*<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref>);</highlight></codeline>
<codeline lineno="216"><highlight class="normal">}</highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="219" refid="classsoundtouch_1_1_t_d_stretch_1a98b24712eff48780ef4c74409d6bfcdf" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a98b24712eff48780ef4c74409d6bfcdf" kindref="member">TDStretch::clearInput</ref>()</highlight></codeline>
<codeline lineno="220"><highlight class="normal">{</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a97d5742c0d2f30248733168172d54d03" kindref="member">inputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1a2b211a51e213f86e2e5a03d0715da7b5" kindref="member">clear</ref>();</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1afb63ac43d723ce6c8f27cbb5fa71917d" kindref="member">clearMidBuffer</ref>();</highlight></codeline>
<codeline lineno="223"><highlight class="normal">}</highlight></codeline>
<codeline lineno="224"><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Clears<sp/>the<sp/>sample<sp/>buffers</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="227" refid="classsoundtouch_1_1_t_d_stretch_1afd5f24f010fea81989f65f4011b4e284" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1afd5f24f010fea81989f65f4011b4e284" kindref="member">TDStretch::clear</ref>()</highlight></codeline>
<codeline lineno="228"><highlight class="normal">{</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a75c79d3ba073ae7ebd2a3a2ba9f6a5e5" kindref="member">outputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1a2b211a51e213f86e2e5a03d0715da7b5" kindref="member">clear</ref>();</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a98b24712eff48780ef4c74409d6bfcdf" kindref="member">clearInput</ref>();</highlight></codeline>
<codeline lineno="231"><highlight class="normal">}</highlight></codeline>
<codeline lineno="232"><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Enables/disables<sp/>the<sp/>quick<sp/>position<sp/>seeking<sp/>algorithm.<sp/>Zero<sp/>to<sp/>disable,<sp/>nonzero</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"></highlight><highlight class="comment">//<sp/>to<sp/>enable</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="237" refid="classsoundtouch_1_1_t_d_stretch_1a4d781d62d334ac58a519043a8a30d321" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a4d781d62d334ac58a519043a8a30d321" kindref="member">TDStretch::enableQuickSeek</ref>(<ref refid="nfilterkit_8h_1a3be13892ae7076009afcf121347dd319" kindref="member">BOOL</ref><sp/>enable)</highlight></codeline>
<codeline lineno="238"><highlight class="normal">{</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aeb8664ce8d3bd7b625b25273a5032045" kindref="member">bQuickSeek</ref><sp/>=<sp/>enable;</highlight></codeline>
<codeline lineno="240"><highlight class="normal">}</highlight></codeline>
<codeline lineno="241"><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Returns<sp/>nonzero<sp/>if<sp/>the<sp/>quick<sp/>seeking<sp/>algorithm<sp/>is<sp/>enabled.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="244" refid="classsoundtouch_1_1_t_d_stretch_1abc6886a9671fb76f91fcd681ed442208" refkind="member"><highlight class="normal"><ref refid="nfilterkit_8h_1a3be13892ae7076009afcf121347dd319" kindref="member">BOOL</ref><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1abc6886a9671fb76f91fcd681ed442208" kindref="member">TDStretch::isQuickSeekEnabled</ref>()</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="245"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aeb8664ce8d3bd7b625b25273a5032045" kindref="member">bQuickSeek</ref>;</highlight></codeline>
<codeline lineno="247"><highlight class="normal">}</highlight></codeline>
<codeline lineno="248"><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Seeks<sp/>for<sp/>the<sp/>optimal<sp/>overlap-mixing<sp/>position.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="251" refid="classsoundtouch_1_1_t_d_stretch_1ad6aaa267e49a550bf405a604e6817482" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ad6aaa267e49a550bf405a604e6817482" kindref="member">TDStretch::seekBestOverlapPosition</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref><sp/>*refPos)</highlight></codeline>
<codeline lineno="252"><highlight class="normal">{</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1aeb8664ce8d3bd7b625b25273a5032045" kindref="member">bQuickSeek</ref>)<sp/></highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aa2a366757e634720c288682de6a11161" kindref="member">seekBestOverlapPositionQuick</ref>(refPos);</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1af61ae5e8d25325d603fdfda9ed5e5d6f" kindref="member">seekBestOverlapPositionFull</ref>(refPos);</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="261"><highlight class="normal">}</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Overlaps<sp/>samples<sp/>in<sp/>&apos;midBuffer&apos;<sp/>with<sp/>the<sp/>samples<sp/>in<sp/>&apos;pInputBuffer&apos;<sp/>at<sp/>position</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight><highlight class="comment">//<sp/>of<sp/>&apos;ovlPos&apos;.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="266" refid="classsoundtouch_1_1_t_d_stretch_1ac35cfcb4208903b14c946f6b24a74d75" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ac35cfcb4208903b14c946f6b24a74d75" kindref="member">TDStretch::overlap</ref>(<ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref><sp/>*pOutput,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref><sp/>*pInput,<sp/><ref refid="_s_t_types_8h_1a91ad9478d81a7aaf2593e8d9c3d06a14" kindref="member">uint</ref><sp/>ovlPos)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="267"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a8a19ab5d68efd8f21fe88e6d2fc9e2c8" kindref="member">channels</ref><sp/>==<sp/>2)<sp/></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>stereo<sp/>sound</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aba5ef0cb6619688ed4e8a7d1d8cd21dc" kindref="member">overlapStereo</ref>(pOutput,<sp/>pInput<sp/>+<sp/>2<sp/>*<sp/>ovlPos);</highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>mono<sp/>sound.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a963f7387f645b8ef8ad80b6c28a21ac4" kindref="member">overlapMono</ref>(pOutput,<sp/>pInput<sp/>+<sp/>ovlPos);</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="276"><highlight class="normal">}</highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Seeks<sp/>for<sp/>the<sp/>optimal<sp/>overlap-mixing<sp/>position.<sp/>The<sp/>&apos;stereo&apos;<sp/>version<sp/>of<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"></highlight><highlight class="comment">//<sp/>routine</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"></highlight><highlight class="comment">//<sp/>The<sp/>best<sp/>position<sp/>is<sp/>determined<sp/>as<sp/>the<sp/>position<sp/>where<sp/>the<sp/>two<sp/>overlapped</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"></highlight><highlight class="comment">//<sp/>sample<sp/>sequences<sp/>are<sp/>&apos;most<sp/>alike&apos;,<sp/>in<sp/>terms<sp/>of<sp/>the<sp/>highest<sp/>cross-correlation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"></highlight><highlight class="comment">//<sp/>value<sp/>over<sp/>the<sp/>overlapping<sp/>period</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="286" refid="classsoundtouch_1_1_t_d_stretch_1af61ae5e8d25325d603fdfda9ed5e5d6f" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1af61ae5e8d25325d603fdfda9ed5e5d6f" kindref="member">TDStretch::seekBestOverlapPositionFull</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref><sp/>*refPos)<sp/></highlight></codeline>
<codeline lineno="287"><highlight class="normal">{</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bestOffs;</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>bestCorr,<sp/>corr;</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="291"><highlight class="normal"></highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/>bestCorr<sp/>=<sp/>FLT_MIN;</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/>bestOffs<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Scans<sp/>for<sp/>the<sp/>best<sp/>correlation<sp/>value<sp/>by<sp/>testing<sp/>each<sp/>possible<sp/>position</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>over<sp/>the<sp/>permitted<sp/>range.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ae31979437a926f5814eb8a30a9f62210" kindref="member">seekLength</ref>;<sp/>i<sp/>++)<sp/></highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Calculates<sp/>correlation<sp/>value<sp/>for<sp/>the<sp/>mixing<sp/>position<sp/>corresponding</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>&apos;i&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>corr<sp/>=<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a6971fa06b13399662485bc382d6d3aa1" kindref="member">calcCrossCorr</ref>(refPos<sp/>+<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8a19ab5d68efd8f21fe88e6d2fc9e2c8" kindref="member">channels</ref><sp/>*<sp/>i,<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ae8ecce9c1a28ac0e281413ab2d1ffff8" kindref="member">pMidBuffer</ref>);</highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>heuristic<sp/>rule<sp/>to<sp/>slightly<sp/>favour<sp/>values<sp/>close<sp/>to<sp/>mid<sp/>of<sp/>the<sp/>range</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>tmp<sp/>=<sp/>(double)(2<sp/>*<sp/>i<sp/>-<sp/>seekLength)<sp/>/<sp/>(double)seekLength;</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>corr<sp/>=<sp/>((corr<sp/>+<sp/>0.1)<sp/>*<sp/>(1.0<sp/>-<sp/>0.25<sp/>*<sp/>tmp<sp/>*<sp/>tmp));</highlight></codeline>
<codeline lineno="305"><highlight class="normal"></highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Checks<sp/>for<sp/>the<sp/>highest<sp/>correlation<sp/>value</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(corr<sp/>&gt;<sp/>bestCorr)<sp/></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bestCorr<sp/>=<sp/>corr;</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bestOffs<sp/>=<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>clear<sp/>cross<sp/>correlation<sp/>routine<sp/>state<sp/>if<sp/>necessary<sp/>(is<sp/>so<sp/>e.g.<sp/>in<sp/>MMX<sp/>routines).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aba956f3b0bf74cc8a4b8f88f444b9161" kindref="member">clearCrossCorrState</ref>();</highlight></codeline>
<codeline lineno="315"><highlight class="normal"></highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>bestOffs;</highlight></codeline>
<codeline lineno="317"><highlight class="normal">}</highlight></codeline>
<codeline lineno="318"><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"></highlight></codeline>
<codeline lineno="320"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Seeks<sp/>for<sp/>the<sp/>optimal<sp/>overlap-mixing<sp/>position.<sp/>The<sp/>&apos;stereo&apos;<sp/>version<sp/>of<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"></highlight><highlight class="comment">//<sp/>routine</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="323"><highlight class="normal"></highlight><highlight class="comment">//<sp/>The<sp/>best<sp/>position<sp/>is<sp/>determined<sp/>as<sp/>the<sp/>position<sp/>where<sp/>the<sp/>two<sp/>overlapped</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"></highlight><highlight class="comment">//<sp/>sample<sp/>sequences<sp/>are<sp/>&apos;most<sp/>alike&apos;,<sp/>in<sp/>terms<sp/>of<sp/>the<sp/>highest<sp/>cross-correlation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="325"><highlight class="normal"></highlight><highlight class="comment">//<sp/>value<sp/>over<sp/>the<sp/>overlapping<sp/>period</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="326" refid="classsoundtouch_1_1_t_d_stretch_1aa2a366757e634720c288682de6a11161" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aa2a366757e634720c288682de6a11161" kindref="member">TDStretch::seekBestOverlapPositionQuick</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref><sp/>*refPos)<sp/></highlight></codeline>
<codeline lineno="327"><highlight class="normal">{</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j;</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bestOffs;</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>bestCorr,<sp/>corr;</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>scanCount,<sp/>corrOffset,<sp/>tempOffset;</highlight></codeline>
<codeline lineno="332"><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/>bestCorr<sp/>=<sp/>FLT_MIN;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/>bestOffs<sp/>=<sp/>_scanOffsets[0][0];</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/>corrOffset<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/>tempOffset<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="337"><highlight class="normal"></highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Scans<sp/>for<sp/>the<sp/>best<sp/>correlation<sp/>value<sp/>using<sp/>four-pass<sp/>hierarchical<sp/>search.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>The<sp/>look-up<sp/>table<sp/>&apos;scans&apos;<sp/>has<sp/>hierarchical<sp/>position<sp/>adjusting<sp/>steps.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>In<sp/>first<sp/>pass<sp/>the<sp/>routine<sp/>searhes<sp/>for<sp/>the<sp/>highest<sp/>correlation<sp/>with<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>relatively<sp/>coarse<sp/>steps,<sp/>then<sp/>rescans<sp/>the<sp/>neighbourhood<sp/>of<sp/>the<sp/>highest</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>correlation<sp/>with<sp/>better<sp/>resolution<sp/>and<sp/>so<sp/>on.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(scanCount<sp/>=<sp/>0;scanCount<sp/>&lt;<sp/>4;<sp/>scanCount<sp/>++)<sp/></highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>j<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(_scanOffsets[scanCount][j])<sp/></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tempOffset<sp/>=<sp/>corrOffset<sp/>+<sp/>_scanOffsets[scanCount][j];</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tempOffset<sp/>&gt;=<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ae31979437a926f5814eb8a30a9f62210" kindref="member">seekLength</ref>)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="351"><highlight class="normal"></highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Calculates<sp/>correlation<sp/>value<sp/>for<sp/>the<sp/>mixing<sp/>position<sp/>corresponding</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>&apos;tempOffset&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>corr<sp/>=<sp/>(double)<ref refid="classsoundtouch_1_1_t_d_stretch_1a6971fa06b13399662485bc382d6d3aa1" kindref="member">calcCrossCorr</ref>(refPos<sp/>+<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8a19ab5d68efd8f21fe88e6d2fc9e2c8" kindref="member">channels</ref><sp/>*<sp/>tempOffset,<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ae8ecce9c1a28ac0e281413ab2d1ffff8" kindref="member">pMidBuffer</ref>);</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>heuristic<sp/>rule<sp/>to<sp/>slightly<sp/>favour<sp/>values<sp/>close<sp/>to<sp/>mid<sp/>of<sp/>the<sp/>range</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>tmp<sp/>=<sp/>(double)(2<sp/>*<sp/>tempOffset<sp/>-<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ae31979437a926f5814eb8a30a9f62210" kindref="member">seekLength</ref>)<sp/>/<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ae31979437a926f5814eb8a30a9f62210" kindref="member">seekLength</ref>;</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>corr<sp/>=<sp/>((corr<sp/>+<sp/>0.1)<sp/>*<sp/>(1.0<sp/>-<sp/>0.25<sp/>*<sp/>tmp<sp/>*<sp/>tmp));</highlight></codeline>
<codeline lineno="358"><highlight class="normal"></highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Checks<sp/>for<sp/>the<sp/>highest<sp/>correlation<sp/>value</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(corr<sp/>&gt;<sp/>bestCorr)<sp/></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bestCorr<sp/>=<sp/>corr;</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bestOffs<sp/>=<sp/>tempOffset;</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="365"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>j<sp/>++;</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>corrOffset<sp/>=<sp/>bestOffs;</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>clear<sp/>cross<sp/>correlation<sp/>routine<sp/>state<sp/>if<sp/>necessary<sp/>(is<sp/>so<sp/>e.g.<sp/>in<sp/>MMX<sp/>routines).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aba956f3b0bf74cc8a4b8f88f444b9161" kindref="member">clearCrossCorrState</ref>();</highlight></codeline>
<codeline lineno="371"><highlight class="normal"></highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>bestOffs;</highlight></codeline>
<codeline lineno="373"><highlight class="normal">}</highlight></codeline>
<codeline lineno="374"><highlight class="normal"></highlight></codeline>
<codeline lineno="375"><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"></highlight></codeline>
<codeline lineno="378" refid="classsoundtouch_1_1_t_d_stretch_1aba956f3b0bf74cc8a4b8f88f444b9161" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aba956f3b0bf74cc8a4b8f88f444b9161" kindref="member">TDStretch::clearCrossCorrState</ref>()</highlight></codeline>
<codeline lineno="379"><highlight class="normal">{</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>default<sp/>implementation<sp/>is<sp/>empty.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal">}</highlight></codeline>
<codeline lineno="382"><highlight class="normal"></highlight></codeline>
<codeline lineno="383"><highlight class="normal"></highlight></codeline>
<codeline lineno="385" refid="classsoundtouch_1_1_t_d_stretch_1a189b5f64b1955ad20b8cc11566b260d5" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a189b5f64b1955ad20b8cc11566b260d5" kindref="member">TDStretch::calcSeqParameters</ref>()</highlight></codeline>
<codeline lineno="386"><highlight class="normal">{</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Adjust<sp/>tempo<sp/>param<sp/>according<sp/>to<sp/>tempo,<sp/>so<sp/>that<sp/>variating<sp/>processing<sp/>sequence<sp/>length<sp/>is<sp/>used</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>at<sp/>varius<sp/>tempo<sp/>settings,<sp/>between<sp/>the<sp/>given<sp/>low...top<sp/>limits</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="389"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/>#define<sp/>AUTOSEQ_TEMPO_LOW<sp/><sp/><sp/>0.5<sp/><sp/><sp/><sp/><sp/>//<sp/>auto<sp/>setting<sp/>low<sp/>tempo<sp/>range<sp/>(-50%)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="390"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/>#define<sp/>AUTOSEQ_TEMPO_TOP<sp/><sp/><sp/>2.0<sp/><sp/><sp/><sp/><sp/>//<sp/>auto<sp/>setting<sp/>top<sp/>tempo<sp/>range<sp/>(+100%)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="391"><highlight class="normal"></highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>sequence-ms<sp/>setting<sp/>values<sp/>at<sp/>above<sp/>low<sp/>&amp;<sp/>top<sp/>tempo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="393"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/>#define<sp/>AUTOSEQ_AT_MIN<sp/><sp/><sp/><sp/><sp/><sp/>125.0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="394"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/>#define<sp/>AUTOSEQ_AT_MAX<sp/><sp/><sp/><sp/><sp/><sp/>50.0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/>#define<sp/>AUTOSEQ_K<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>((AUTOSEQ_AT_MAX<sp/>-<sp/>AUTOSEQ_AT_MIN)<sp/>/<sp/>(AUTOSEQ_TEMPO_TOP<sp/>-<sp/>AUTOSEQ_TEMPO_LOW))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="396"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/>#define<sp/>AUTOSEQ_C<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(AUTOSEQ_AT_MIN<sp/>-<sp/>(AUTOSEQ_K)<sp/>*<sp/>(AUTOSEQ_TEMPO_LOW))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="397"><highlight class="normal"></highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>seek-window-ms<sp/>setting<sp/>values<sp/>at<sp/>above<sp/>low<sp/>&amp;<sp/>top<sp/>tempo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="399"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/>#define<sp/>AUTOSEEK_AT_MIN<sp/><sp/><sp/><sp/><sp/>25.0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="400"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/>#define<sp/>AUTOSEEK_AT_MAX<sp/><sp/><sp/><sp/><sp/>15.0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="401"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/>#define<sp/>AUTOSEEK_K<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>((AUTOSEEK_AT_MAX<sp/>-<sp/>AUTOSEEK_AT_MIN)<sp/>/<sp/>(AUTOSEQ_TEMPO_TOP<sp/>-<sp/>AUTOSEQ_TEMPO_LOW))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="402"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/>#define<sp/>AUTOSEEK_C<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(AUTOSEEK_AT_MIN<sp/>-<sp/>(AUTOSEEK_K)<sp/>*<sp/>(AUTOSEQ_TEMPO_LOW))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="403"><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/><sp/><sp/>#define<sp/>CHECK_LIMITS(x,<sp/>mi,<sp/>ma)<sp/>(((x)<sp/>&lt;<sp/>(mi))<sp/>?<sp/>(mi)<sp/>:<sp/>(((x)<sp/>&gt;<sp/>(ma))<sp/>?<sp/>(ma)<sp/>:<sp/>(x)))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>seq,<sp/>seek;</highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a9a52a469732c4f5e884d62b5eabebc6e" kindref="member">bAutoSeqSetting</ref>)</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>seq<sp/>=<sp/><ref refid="_t_d_stretch_8cpp_1af22f84db886e280148d0e28a7a6459a6" kindref="member">AUTOSEQ_C</ref><sp/>+<sp/><ref refid="_t_d_stretch_8cpp_1a69acd847203c6ed6b70a462308891b63" kindref="member">AUTOSEQ_K</ref><sp/>*<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a97f816f5041ed44832049d51e6212cfa" kindref="member">tempo</ref>;</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>seq<sp/>=<sp/><ref refid="_t_d_stretch_8cpp_1a15b67d9aa264bcc4b9a99fc1d0c2bcaa" kindref="member">CHECK_LIMITS</ref>(seq,<sp/><ref refid="_t_d_stretch_8cpp_1a3fff3b71de725723b5a9fcd9f3a49281" kindref="member">AUTOSEQ_AT_MAX</ref>,<sp/><ref refid="_t_d_stretch_8cpp_1a1aac876305d4e886dc3777f1d4bc083b" kindref="member">AUTOSEQ_AT_MIN</ref>);</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ab6571642944948906bf5e2dd2b82a2a6" kindref="member">sequenceMs</ref><sp/>=<sp/>(<ref refid="lib_2expat_8h_1a14bb8924daea0b48c7803f281f66e390" kindref="member">int</ref>)(seq<sp/>+<sp/>0.5);</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="414"><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a8b241cf654e8c29b7ff7af3f359866a7" kindref="member">bAutoSeekSetting</ref>)</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>seek<sp/>=<sp/><ref refid="_t_d_stretch_8cpp_1a553faa8e78c3934a66885ac05b0fac4b" kindref="member">AUTOSEEK_C</ref><sp/>+<sp/><ref refid="_t_d_stretch_8cpp_1aa6d2e2731d3778a7205673c85f3e1a85" kindref="member">AUTOSEEK_K</ref><sp/>*<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a97f816f5041ed44832049d51e6212cfa" kindref="member">tempo</ref>;</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>seek<sp/>=<sp/><ref refid="_t_d_stretch_8cpp_1a15b67d9aa264bcc4b9a99fc1d0c2bcaa" kindref="member">CHECK_LIMITS</ref>(seek,<sp/><ref refid="_t_d_stretch_8cpp_1ab06c1b9aa25adf93fc9483156c8ebb80" kindref="member">AUTOSEEK_AT_MAX</ref>,<sp/><ref refid="_t_d_stretch_8cpp_1a2b7d9673875482bac8699303af0eca1a" kindref="member">AUTOSEEK_AT_MIN</ref>);</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aa1bd4510b56e3dcdcc68fd9cce930fec" kindref="member">seekWindowMs</ref><sp/>=<sp/>(<ref refid="lib_2expat_8h_1a14bb8924daea0b48c7803f281f66e390" kindref="member">int</ref>)(seek<sp/>+<sp/>0.5);</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="421"><highlight class="normal"></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Update<sp/>seek<sp/>window<sp/>lengths</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a760e50b9c59ab6ec44946bc186acf541" kindref="member">seekWindowLength</ref><sp/>=<sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a475226e8ef3d04ebcbb83e13ff8e78e0" kindref="member">sampleRate</ref><sp/>*<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ab6571642944948906bf5e2dd2b82a2a6" kindref="member">sequenceMs</ref>)<sp/>/<sp/>1000;</highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a760e50b9c59ab6ec44946bc186acf541" kindref="member">seekWindowLength</ref><sp/>&lt;<sp/>2<sp/>*<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref>)<sp/></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a760e50b9c59ab6ec44946bc186acf541" kindref="member">seekWindowLength</ref><sp/>=<sp/>2<sp/>*<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref>;</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ae31979437a926f5814eb8a30a9f62210" kindref="member">seekLength</ref><sp/>=<sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a475226e8ef3d04ebcbb83e13ff8e78e0" kindref="member">sampleRate</ref><sp/>*<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aa1bd4510b56e3dcdcc68fd9cce930fec" kindref="member">seekWindowMs</ref>)<sp/>/<sp/>1000;</highlight></codeline>
<codeline lineno="429"><highlight class="normal">}</highlight></codeline>
<codeline lineno="430"><highlight class="normal"></highlight></codeline>
<codeline lineno="431"><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"></highlight></codeline>
<codeline lineno="433"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Sets<sp/>new<sp/>target<sp/>tempo.<sp/>Normal<sp/>tempo<sp/>=<sp/>&apos;SCALE&apos;,<sp/>smaller<sp/>values<sp/>represent<sp/>slower<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="434"><highlight class="normal"></highlight><highlight class="comment">//<sp/>tempo,<sp/>larger<sp/>faster<sp/>tempo.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="435" refid="classsoundtouch_1_1_t_d_stretch_1a8f8439cea0bad6c675f74d05398a0346" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8f8439cea0bad6c675f74d05398a0346" kindref="member">TDStretch::setTempo</ref>(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>newTempo)</highlight></codeline>
<codeline lineno="436"><highlight class="normal">{</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>intskip;</highlight></codeline>
<codeline lineno="438"><highlight class="normal"></highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a97f816f5041ed44832049d51e6212cfa" kindref="member">tempo</ref><sp/>=<sp/>newTempo;</highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Calculate<sp/>new<sp/>sequence<sp/>duration</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a189b5f64b1955ad20b8cc11566b260d5" kindref="member">calcSeqParameters</ref>();</highlight></codeline>
<codeline lineno="443"><highlight class="normal"></highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Calculate<sp/>ideal<sp/>skip<sp/>length<sp/>(according<sp/>to<sp/>tempo<sp/>value)<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a53b938868679a0ce730946f53f843403" kindref="member">nominalSkip</ref><sp/>=<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a97f816f5041ed44832049d51e6212cfa" kindref="member">tempo</ref><sp/>*<sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a760e50b9c59ab6ec44946bc186acf541" kindref="member">seekWindowLength</ref><sp/>-<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref>);</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/>intskip<sp/>=<sp/>(<ref refid="lib_2expat_8h_1a14bb8924daea0b48c7803f281f66e390" kindref="member">int</ref>)(<ref refid="classsoundtouch_1_1_t_d_stretch_1a53b938868679a0ce730946f53f843403" kindref="member">nominalSkip</ref><sp/>+<sp/>0.5<ref refid="rfft2d_test_m_l_8m_1aacd36fb6ac9ce14cec71f2ca852524d4" kindref="member">f</ref>);</highlight></codeline>
<codeline lineno="447"><highlight class="normal"></highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Calculate<sp/>how<sp/>many<sp/>samples<sp/>are<sp/>needed<sp/>in<sp/>the<sp/>&apos;inputBuffer&apos;<sp/>to<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>process<sp/>another<sp/>batch<sp/>of<sp/>samples</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//sampleReq<sp/>=<sp/>max(intskip<sp/>+<sp/>overlapLength,<sp/>seekWindowLength)<sp/>+<sp/>seekLength<sp/>/<sp/>2;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a2d7623288d40efe1381fc86ca8dee9cf" kindref="member">sampleReq</ref><sp/>=<sp/><ref refid="_t_d_stretch_8cpp_1ac39d9cef6a5e030ba8d9e11121054268" kindref="member">max</ref>(intskip<sp/>+<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref>,<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a760e50b9c59ab6ec44946bc186acf541" kindref="member">seekWindowLength</ref>)<sp/>+<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ae31979437a926f5814eb8a30a9f62210" kindref="member">seekLength</ref>;</highlight></codeline>
<codeline lineno="452"><highlight class="normal">}</highlight></codeline>
<codeline lineno="453"><highlight class="normal"></highlight></codeline>
<codeline lineno="454"><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"></highlight></codeline>
<codeline lineno="456"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Sets<sp/>the<sp/>number<sp/>of<sp/>channels,<sp/>1<sp/>=<sp/>mono,<sp/>2<sp/>=<sp/>stereo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="457" refid="classsoundtouch_1_1_t_d_stretch_1a91016a1d252028131b70de4d7d82a076" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a91016a1d252028131b70de4d7d82a076" kindref="member">TDStretch::setChannels</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>numChannels)</highlight></codeline>
<codeline lineno="458"><highlight class="normal">{</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="libid3tag_2global_8h_1af576bf8ffa22a44e53018c67095ffbf0" kindref="member">assert</ref>(numChannels<sp/>&gt;<sp/>0);</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a8a19ab5d68efd8f21fe88e6d2fc9e2c8" kindref="member">channels</ref><sp/>==<sp/>numChannels)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="libid3tag_2global_8h_1af576bf8ffa22a44e53018c67095ffbf0" kindref="member">assert</ref>(numChannels<sp/>==<sp/>1<sp/>||<sp/>numChannels<sp/>==<sp/>2);</highlight></codeline>
<codeline lineno="462"><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8a19ab5d68efd8f21fe88e6d2fc9e2c8" kindref="member">channels</ref><sp/>=<sp/>numChannels;</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a97d5742c0d2f30248733168172d54d03" kindref="member">inputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1a8e9630f4f9c41ef1be3f44d546be0e87" kindref="member">setChannels</ref>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a8a19ab5d68efd8f21fe88e6d2fc9e2c8" kindref="member">channels</ref>);</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a75c79d3ba073ae7ebd2a3a2ba9f6a5e5" kindref="member">outputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1a8e9630f4f9c41ef1be3f44d546be0e87" kindref="member">setChannels</ref>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a8a19ab5d68efd8f21fe88e6d2fc9e2c8" kindref="member">channels</ref>);</highlight></codeline>
<codeline lineno="466"><highlight class="normal">}</highlight></codeline>
<codeline lineno="467"><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"></highlight><highlight class="comment">//<sp/>nominal<sp/>tempo,<sp/>no<sp/>need<sp/>for<sp/>processing,<sp/>just<sp/>pass<sp/>the<sp/>samples<sp/>through</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="470"><highlight class="normal"></highlight><highlight class="comment">//<sp/>to<sp/>outputBuffer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="472"><highlight class="comment">void<sp/>TDStretch::processNominalTempo()</highlight></codeline>
<codeline lineno="473"><highlight class="comment">{</highlight></codeline>
<codeline lineno="474"><highlight class="comment"><sp/><sp/><sp/><sp/>assert(tempo<sp/>==<sp/>1.0f);</highlight></codeline>
<codeline lineno="475"><highlight class="comment"></highlight></codeline>
<codeline lineno="476"><highlight class="comment"><sp/><sp/><sp/><sp/>if<sp/>(bMidBufferDirty)<sp/></highlight></codeline>
<codeline lineno="477"><highlight class="comment"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="478"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>If<sp/>there<sp/>are<sp/>samples<sp/>in<sp/>pMidBuffer<sp/>waiting<sp/>for<sp/>overlapping,</highlight></codeline>
<codeline lineno="479"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>do<sp/>a<sp/>single<sp/>sliding<sp/>overlapping<sp/>with<sp/>them<sp/>in<sp/>order<sp/>to<sp/>prevent<sp/>a<sp/></highlight></codeline>
<codeline lineno="480"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>clicking<sp/>distortion<sp/>in<sp/>the<sp/>output<sp/>sound</highlight></codeline>
<codeline lineno="481"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>if<sp/>(inputBuffer.numSamples()<sp/>&lt;<sp/>overlapLength)<sp/></highlight></codeline>
<codeline lineno="482"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="483"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>wait<sp/>until<sp/>we&apos;ve<sp/>got<sp/>overlapLength<sp/>input<sp/>samples</highlight></codeline>
<codeline lineno="484"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return;</highlight></codeline>
<codeline lineno="485"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="486"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>Mix<sp/>the<sp/>samples<sp/>in<sp/>the<sp/>beginning<sp/>of<sp/>&apos;inputBuffer&apos;<sp/>with<sp/>the<sp/></highlight></codeline>
<codeline lineno="487"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>samples<sp/>in<sp/>&apos;midBuffer&apos;<sp/>using<sp/>sliding<sp/>overlapping<sp/></highlight></codeline>
<codeline lineno="488"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>overlap(outputBuffer.ptrEnd(overlapLength),<sp/>inputBuffer.ptrBegin(),<sp/>0);</highlight></codeline>
<codeline lineno="489"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>outputBuffer.putSamples(overlapLength);</highlight></codeline>
<codeline lineno="490"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>inputBuffer.receiveSamples(overlapLength);</highlight></codeline>
<codeline lineno="491"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>clearMidBuffer();</highlight></codeline>
<codeline lineno="492"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>now<sp/>we&apos;ve<sp/>caught<sp/>the<sp/>nominal<sp/>sample<sp/>flow<sp/>and<sp/>may<sp/>switch<sp/>to</highlight></codeline>
<codeline lineno="493"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>bypass<sp/>mode</highlight></codeline>
<codeline lineno="494"><highlight class="comment"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="495"><highlight class="comment"></highlight></codeline>
<codeline lineno="496"><highlight class="comment"><sp/><sp/><sp/><sp/>//<sp/>Simply<sp/>bypass<sp/>samples<sp/>from<sp/>input<sp/>to<sp/>output</highlight></codeline>
<codeline lineno="497"><highlight class="comment"><sp/><sp/><sp/><sp/>outputBuffer.moveSamples(inputBuffer);</highlight></codeline>
<codeline lineno="498"><highlight class="comment">}</highlight></codeline>
<codeline lineno="499"><highlight class="comment">*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"></highlight></codeline>
<codeline lineno="501"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdio.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Processes<sp/>as<sp/>many<sp/>processing<sp/>frames<sp/>of<sp/>the<sp/>samples<sp/>&apos;inputBuffer&apos;,<sp/>store</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="504"><highlight class="normal"></highlight><highlight class="comment">//<sp/>the<sp/>result<sp/>into<sp/>&apos;outputBuffer&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="505" refid="classsoundtouch_1_1_t_d_stretch_1aec10746c3fc5c6b0b41d1adddac0dbd1" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aec10746c3fc5c6b0b41d1adddac0dbd1" kindref="member">TDStretch::processSamples</ref>()</highlight></codeline>
<codeline lineno="506"><highlight class="normal">{</highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ovlSkip,<sp/><ref refid="layer12_8c_1a33d71f23ba2052d17f0b754dc35265b0" kindref="member">offset</ref>;</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>temp;</highlight></codeline>
<codeline lineno="509"><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Removed<sp/>this<sp/>small<sp/>optimization<sp/>-<sp/>can<sp/>introduce<sp/>a<sp/>click<sp/>to<sp/>sound<sp/>when<sp/>tempo<sp/>setting</highlight></codeline>
<codeline lineno="511"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>crosses<sp/>the<sp/>nominal<sp/>value</highlight></codeline>
<codeline lineno="512"><highlight class="comment"><sp/><sp/><sp/><sp/>if<sp/>(tempo<sp/>==<sp/>1.0f)<sp/></highlight></codeline>
<codeline lineno="513"><highlight class="comment"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="514"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>//<sp/>tempo<sp/>not<sp/>changed<sp/>from<sp/>the<sp/>original,<sp/>so<sp/>bypass<sp/>the<sp/>processing</highlight></codeline>
<codeline lineno="515"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>processNominalTempo();</highlight></codeline>
<codeline lineno="516"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return;</highlight></codeline>
<codeline lineno="517"><highlight class="comment"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="518"><highlight class="comment"><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Process<sp/>samples<sp/>as<sp/>long<sp/>as<sp/>there<sp/>are<sp/>enough<sp/>samples<sp/>in<sp/>&apos;inputBuffer&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>form<sp/>a<sp/>processing<sp/>frame.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>((</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<ref refid="classsoundtouch_1_1_t_d_stretch_1a97d5742c0d2f30248733168172d54d03" kindref="member">inputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1a6b6b914d52e4e5d952f160e9c3b54d66" kindref="member">numSamples</ref>()<sp/>&gt;=<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a2d7623288d40efe1381fc86ca8dee9cf" kindref="member">sampleReq</ref>)<sp/></highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>If<sp/>tempo<sp/>differs<sp/>from<sp/>the<sp/>normal<sp/>(&apos;SCALE&apos;),<sp/>scan<sp/>for<sp/>the<sp/>best<sp/>overlapping</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>position</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>offset<sp/>=<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ad6aaa267e49a550bf405a604e6817482" kindref="member">seekBestOverlapPosition</ref>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a97d5742c0d2f30248733168172d54d03" kindref="member">inputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1ac5342c9dbb7863c54500501d74c6a2d4" kindref="member">ptrBegin</ref>());</highlight></codeline>
<codeline lineno="527"><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Mix<sp/>the<sp/>samples<sp/>in<sp/>the<sp/>&apos;inputBuffer&apos;<sp/>at<sp/>position<sp/>of<sp/>&apos;offset&apos;<sp/>with<sp/>the<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>samples<sp/>in<sp/>&apos;midBuffer&apos;<sp/>using<sp/>sliding<sp/>overlapping</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>...<sp/>first<sp/>partially<sp/>overlap<sp/>with<sp/>the<sp/>end<sp/>of<sp/>the<sp/>previous<sp/>sequence</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>(that&apos;s<sp/>in<sp/>&apos;midBuffer&apos;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ac35cfcb4208903b14c946f6b24a74d75" kindref="member">overlap</ref>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a75c79d3ba073ae7ebd2a3a2ba9f6a5e5" kindref="member">outputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1a03d285e2148ec382caefd4d399ccb720" kindref="member">ptrEnd</ref>((<ref refid="_s_t_types_8h_1a91ad9478d81a7aaf2593e8d9c3d06a14" kindref="member">uint</ref>)<ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref>),<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a97d5742c0d2f30248733168172d54d03" kindref="member">inputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1ac5342c9dbb7863c54500501d74c6a2d4" kindref="member">ptrBegin</ref>(),<sp/>(<ref refid="_s_t_types_8h_1a91ad9478d81a7aaf2593e8d9c3d06a14" kindref="member">uint</ref>)offset);</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a75c79d3ba073ae7ebd2a3a2ba9f6a5e5" kindref="member">outputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1a94f2865cbc6f487b936dd69424410e97" kindref="member">putSamples</ref>((<ref refid="_s_t_types_8h_1a91ad9478d81a7aaf2593e8d9c3d06a14" kindref="member">uint</ref>)overlapLength);</highlight></codeline>
<codeline lineno="534"><highlight class="normal"></highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>...<sp/>then<sp/>copy<sp/>sequence<sp/>samples<sp/>from<sp/>&apos;inputBuffer&apos;<sp/>to<sp/>output:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="536"><highlight class="normal"></highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>length<sp/>of<sp/>sequence</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>temp<sp/>=<sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a760e50b9c59ab6ec44946bc186acf541" kindref="member">seekWindowLength</ref><sp/>-<sp/>2<sp/>*<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref>);</highlight></codeline>
<codeline lineno="539"><highlight class="normal"></highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>crosscheck<sp/>that<sp/>we<sp/>don&apos;t<sp/>have<sp/>buffer<sp/>overflow...</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<ref refid="classsoundtouch_1_1_t_d_stretch_1a97d5742c0d2f30248733168172d54d03" kindref="member">inputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1a6b6b914d52e4e5d952f160e9c3b54d66" kindref="member">numSamples</ref>()<sp/>&lt;<sp/>(offset<sp/>+<sp/>temp<sp/>+<sp/>overlapLength<sp/>*<sp/>2))</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>just<sp/>in<sp/>case,<sp/>shouldn&apos;t<sp/>really<sp/>happen</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="545"><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a75c79d3ba073ae7ebd2a3a2ba9f6a5e5" kindref="member">outputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1a94f2865cbc6f487b936dd69424410e97" kindref="member">putSamples</ref>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a97d5742c0d2f30248733168172d54d03" kindref="member">inputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1ac5342c9dbb7863c54500501d74c6a2d4" kindref="member">ptrBegin</ref>()<sp/>+<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8a19ab5d68efd8f21fe88e6d2fc9e2c8" kindref="member">channels</ref><sp/>*<sp/>(offset<sp/>+<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref>),<sp/>(<ref refid="_s_t_types_8h_1a91ad9478d81a7aaf2593e8d9c3d06a14" kindref="member">uint</ref>)temp);</highlight></codeline>
<codeline lineno="547"><highlight class="normal"></highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Copies<sp/>the<sp/>end<sp/>of<sp/>the<sp/>current<sp/>sequence<sp/>from<sp/>&apos;inputBuffer&apos;<sp/>to<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>&apos;midBuffer&apos;<sp/>for<sp/>being<sp/>mixed<sp/>with<sp/>the<sp/>beginning<sp/>of<sp/>the<sp/>next<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>processing<sp/>sequence<sp/>and<sp/>so<sp/>on</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="libid3tag_2global_8h_1af576bf8ffa22a44e53018c67095ffbf0" kindref="member">assert</ref>((offset<sp/>+<sp/>temp<sp/>+<sp/>overlapLength<sp/>*<sp/>2)<sp/>&lt;=<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<ref refid="classsoundtouch_1_1_t_d_stretch_1a97d5742c0d2f30248733168172d54d03" kindref="member">inputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1a6b6b914d52e4e5d952f160e9c3b54d66" kindref="member">numSamples</ref>());</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memcpy(<ref refid="classsoundtouch_1_1_t_d_stretch_1ae8ecce9c1a28ac0e281413ab2d1ffff8" kindref="member">pMidBuffer</ref>,<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a97d5742c0d2f30248733168172d54d03" kindref="member">inputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1ac5342c9dbb7863c54500501d74c6a2d4" kindref="member">ptrBegin</ref>()<sp/>+<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8a19ab5d68efd8f21fe88e6d2fc9e2c8" kindref="member">channels</ref><sp/>*<sp/>(offset<sp/>+<sp/>temp<sp/>+<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref>),<sp/></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8a19ab5d68efd8f21fe88e6d2fc9e2c8" kindref="member">channels</ref><sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref>)<sp/>*<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref>);</highlight></codeline>
<codeline lineno="554"><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Remove<sp/>the<sp/>processed<sp/>samples<sp/>from<sp/>the<sp/>input<sp/>buffer.<sp/>Update</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>difference<sp/>between<sp/>integer<sp/>&amp;<sp/>nominal<sp/>skip<sp/>step<sp/>to<sp/>&apos;skipFract&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>in<sp/>order<sp/>to<sp/>prevent<sp/>the<sp/>error<sp/>from<sp/>accumulating<sp/>over<sp/>time.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ac1e7943634556e4fa61224bb0d14a726" kindref="member">skipFract</ref><sp/>+=<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a53b938868679a0ce730946f53f843403" kindref="member">nominalSkip</ref>;<sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>real<sp/>skip<sp/>size</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ovlSkip<sp/>=<sp/>(<ref refid="lib_2expat_8h_1a14bb8924daea0b48c7803f281f66e390" kindref="member">int</ref>)skipFract;<sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>rounded<sp/>to<sp/>integer<sp/>skip</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>skipFract<sp/>-=<sp/>ovlSkip;<sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>maintain<sp/>the<sp/>fraction<sp/>part,<sp/>i.e.<sp/>real<sp/>vs.<sp/>integer<sp/>skip</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a97d5742c0d2f30248733168172d54d03" kindref="member">inputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1a9bec369673be4b4d328befe0afd9f137" kindref="member">receiveSamples</ref>((<ref refid="_s_t_types_8h_1a91ad9478d81a7aaf2593e8d9c3d06a14" kindref="member">uint</ref>)ovlSkip);</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="563"><highlight class="normal">}</highlight></codeline>
<codeline lineno="564"><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"></highlight></codeline>
<codeline lineno="566"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Adds<sp/>&apos;numsamples&apos;<sp/>pcs<sp/>of<sp/>samples<sp/>from<sp/>the<sp/>&apos;samples&apos;<sp/>memory<sp/>position<sp/>into</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="567"><highlight class="normal"></highlight><highlight class="comment">//<sp/>the<sp/>input<sp/>of<sp/>the<sp/>object.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="568" refid="classsoundtouch_1_1_t_d_stretch_1aa50296dfab0c762dab67ece6c2a142b9" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aa50296dfab0c762dab67ece6c2a142b9" kindref="member">TDStretch::putSamples</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref><sp/>*<ref refid="test__rw__echo_8c_1a39c8d1039645bc924aecc49d76f472a0" kindref="member">samples</ref>,<sp/><ref refid="_s_t_types_8h_1a91ad9478d81a7aaf2593e8d9c3d06a14" kindref="member">uint</ref><sp/>nSamples)</highlight></codeline>
<codeline lineno="569"><highlight class="normal">{</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Add<sp/>the<sp/>samples<sp/>into<sp/>the<sp/>input<sp/>buffer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a97d5742c0d2f30248733168172d54d03" kindref="member">inputBuffer</ref>.<ref refid="classsoundtouch_1_1_f_i_f_o_sample_buffer_1a94f2865cbc6f487b936dd69424410e97" kindref="member">putSamples</ref>(samples,<sp/>nSamples);</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Process<sp/>the<sp/>samples<sp/>in<sp/>input<sp/>buffer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aec10746c3fc5c6b0b41d1adddac0dbd1" kindref="member">processSamples</ref>();</highlight></codeline>
<codeline lineno="574"><highlight class="normal">}</highlight></codeline>
<codeline lineno="575"><highlight class="normal"></highlight></codeline>
<codeline lineno="576"><highlight class="normal"></highlight></codeline>
<codeline lineno="577"><highlight class="normal"></highlight></codeline>
<codeline lineno="579" refid="classsoundtouch_1_1_t_d_stretch_1a3affdc351ec41871258d62cc792a9ed6" refkind="member"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a3affdc351ec41871258d62cc792a9ed6" kindref="member">TDStretch::acceptNewOverlapLength</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newOverlapLength)</highlight></codeline>
<codeline lineno="580"><highlight class="normal">{</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>prevOvl;</highlight></codeline>
<codeline lineno="582"><highlight class="normal"></highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="libid3tag_2global_8h_1af576bf8ffa22a44e53018c67095ffbf0" kindref="member">assert</ref>(newOverlapLength<sp/>&gt;=<sp/>0);</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/>prevOvl<sp/>=<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref>;</highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref><sp/>=<sp/>newOverlapLength;</highlight></codeline>
<codeline lineno="586"><highlight class="normal"></highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref><sp/>&gt;<sp/>prevOvl)</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">delete</highlight><highlight class="normal">[]<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a761455426dae783dd29b1a863ff92e32" kindref="member">pMidBufferUnaligned</ref>;</highlight></codeline>
<codeline lineno="590"><highlight class="normal"></highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a761455426dae783dd29b1a863ff92e32" kindref="member">pMidBufferUnaligned</ref><sp/>=<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/><ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref>[<ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref><sp/>*<sp/>2<sp/>+<sp/>16<sp/>/<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref>)];</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ensure<sp/>that<sp/>&apos;pMidBuffer&apos;<sp/>is<sp/>aligned<sp/>to<sp/>16<sp/>byte<sp/>boundary<sp/>for<sp/>efficiency</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ae8ecce9c1a28ac0e281413ab2d1ffff8" kindref="member">pMidBuffer</ref><sp/>=<sp/>(<ref refid="namespacesoundtouch_1a97cfd29a7abb4d4b2a72f803d5b5850c" kindref="member">SAMPLETYPE</ref><sp/>*)<ref refid="_s_t_types_8h_1a0d55a6111a9ebb471a6e763827bdce2b" kindref="member">SOUNDTOUCH_ALIGN_POINTER_16</ref>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a761455426dae783dd29b1a863ff92e32" kindref="member">pMidBufferUnaligned</ref>);</highlight></codeline>
<codeline lineno="594"><highlight class="normal"></highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1afb63ac43d723ce6c8f27cbb5fa71917d" kindref="member">clearMidBuffer</ref>();</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="597"><highlight class="normal">}</highlight></codeline>
<codeline lineno="598"><highlight class="normal"></highlight></codeline>
<codeline lineno="599"><highlight class="normal"></highlight></codeline>
<codeline lineno="600"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Operator<sp/>&apos;new&apos;<sp/>is<sp/>overloaded<sp/>so<sp/>that<sp/>it<sp/>automatically<sp/>creates<sp/>a<sp/>suitable<sp/>instance<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="601"><highlight class="normal"></highlight><highlight class="comment">//<sp/>depending<sp/>on<sp/>if<sp/>we&apos;ve<sp/>a<sp/>MMX/SSE/etc-capable<sp/>CPU<sp/>available<sp/>or<sp/>not.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="602" refid="classsoundtouch_1_1_t_d_stretch_1ab708420e04e16718d68b30d2a5a5ca3b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*<sp/>TDStretch::operator<sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/><ref refid="lib_2expat_8h_1a755339d27872b13735c2cab829e47157" kindref="member">s</ref>)</highlight></codeline>
<codeline lineno="603"><highlight class="normal">{</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Notice!<sp/>don&apos;t<sp/>use<sp/>&quot;new<sp/>TDStretch&quot;<sp/>directly,<sp/>use<sp/>&quot;newInstance&quot;<sp/>to<sp/>create<sp/>a<sp/>new<sp/>instance<sp/>instead!</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_s_t_types_8h_1afa654bbb8cd596f823ab5ff898767363" kindref="member">ST_THROW_RT_ERROR</ref>(</highlight><highlight class="stringliteral">&quot;Error<sp/>in<sp/>TDStretch::new:<sp/>Don&apos;t<sp/>use<sp/>&apos;new<sp/>TDStretch&apos;<sp/>directly,<sp/>use<sp/>&apos;newInstance&apos;<sp/>member<sp/>instead!&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a2cf85415e2c0fa63f9d90457c6a15106" kindref="member">newInstance</ref>();</highlight></codeline>
<codeline lineno="607"><highlight class="normal">}</highlight></codeline>
<codeline lineno="608"><highlight class="normal"></highlight></codeline>
<codeline lineno="609"><highlight class="normal"></highlight></codeline>
<codeline lineno="610" refid="classsoundtouch_1_1_t_d_stretch_1a2cf85415e2c0fa63f9d90457c6a15106" refkind="member"><highlight class="normal"><ref refid="classsoundtouch_1_1_t_d_stretch" kindref="compound">TDStretch</ref><sp/>*<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a2cf85415e2c0fa63f9d90457c6a15106" kindref="member">TDStretch::newInstance</ref>()</highlight></codeline>
<codeline lineno="611"><highlight class="normal">{</highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="_s_t_types_8h_1a91ad9478d81a7aaf2593e8d9c3d06a14" kindref="member">uint</ref><sp/>uExtensions;</highlight></codeline>
<codeline lineno="613"><highlight class="normal"></highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/><sp/><sp/>uExtensions<sp/>=<sp/><ref refid="cpu__detect_8h_1aee61147b9bf0a52f630232321dd1377d" kindref="member">detectCPUextensions</ref>();</highlight></codeline>
<codeline lineno="615"><highlight class="normal"></highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Check<sp/>if<sp/>MMX/SSE<sp/>instruction<sp/>set<sp/>extensions<sp/>supported<sp/>by<sp/>CPU</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="617"><highlight class="normal"></highlight></codeline>
<codeline lineno="618"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>SOUNDTOUCH_ALLOW_MMX</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>MMX<sp/>routines<sp/>available<sp/>only<sp/>with<sp/>integer<sp/>sample<sp/>types</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(uExtensions<sp/>&amp;<sp/><ref refid="cpu__detect_8h_1a471bb7933cc22fa379a1858470097ddb" kindref="member">SUPPORT_MMX</ref>)</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>::new<sp/>TDStretchMMX;</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="625"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/>//<sp/>SOUNDTOUCH_ALLOW_MMX</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="626"><highlight class="normal"></highlight></codeline>
<codeline lineno="627"><highlight class="normal"></highlight></codeline>
<codeline lineno="628"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>SOUNDTOUCH_ALLOW_SSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(uExtensions<sp/>&amp;<sp/><ref refid="cpu__detect_8h_1ab212f6609dace96e23f99047bcf98011" kindref="member">SUPPORT_SSE</ref>)</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>SSE<sp/>support</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>::new<sp/>TDStretchSSE;</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="635"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/>//<sp/>SOUNDTOUCH_ALLOW_SSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="636"><highlight class="normal"></highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>ISA<sp/>optimizations<sp/>not<sp/>supported,<sp/>use<sp/>plain<sp/>C<sp/>version</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>return<sp/>::new<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a385b25e91ec29b1091092383268576b9" kindref="member">TDStretch</ref>;</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="641"><highlight class="normal">}</highlight></codeline>
<codeline lineno="642"><highlight class="normal"></highlight></codeline>
<codeline lineno="643"><highlight class="normal"></highlight></codeline>
<codeline lineno="645"><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="646"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Integer<sp/>arithmetics<sp/>specific<sp/>algorithm<sp/>implementations.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="647"><highlight class="normal"></highlight><highlight class="comment">//</highlight></codeline>
<codeline lineno="649"><highlight class="comment"></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="650"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>SOUNDTOUCH_INTEGER_SAMPLES</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="651"><highlight class="normal"></highlight></codeline>
<codeline lineno="652"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Overlaps<sp/>samples<sp/>in<sp/>&apos;midBuffer&apos;<sp/>with<sp/>the<sp/>samples<sp/>in<sp/>&apos;input&apos;.<sp/>The<sp/>&apos;Stereo&apos;<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="653"><highlight class="normal"></highlight><highlight class="comment">//<sp/>version<sp/>of<sp/>the<sp/>routine.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="654"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aba5ef0cb6619688ed4e8a7d1d8cd21dc" kindref="member">TDStretch::overlapStereo</ref>(</highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/>*poutput,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/>*input)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="655"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/>temp;</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>cnt2;</highlight></codeline>
<codeline lineno="659"><highlight class="normal"></highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref><sp/>;<sp/>i<sp/>++)<sp/></highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>temp<sp/>=<sp/>(short)(overlapLength<sp/>-<sp/>i);</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cnt2<sp/>=<sp/>2<sp/>*<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>poutput[cnt2]<sp/>=<sp/>(input[cnt2]<sp/>*<sp/>i<sp/>+<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ae8ecce9c1a28ac0e281413ab2d1ffff8" kindref="member">pMidBuffer</ref>[cnt2]<sp/>*<sp/>temp<sp/>)<sp/><sp/>/<sp/>overlapLength;</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>poutput[cnt2<sp/>+<sp/>1]<sp/>=<sp/>(input[cnt2<sp/>+<sp/>1]<sp/>*<sp/>i<sp/>+<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ae8ecce9c1a28ac0e281413ab2d1ffff8" kindref="member">pMidBuffer</ref>[cnt2<sp/>+<sp/>1]<sp/>*<sp/>temp<sp/>)<sp/>/<sp/>overlapLength;</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="667"><highlight class="normal">}</highlight></codeline>
<codeline lineno="668"><highlight class="normal"></highlight></codeline>
<codeline lineno="669"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Calculates<sp/>the<sp/>x<sp/>having<sp/>the<sp/>closest<sp/>2^x<sp/>value<sp/>for<sp/>the<sp/>given<sp/>value</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="670"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>_getClosest2Power(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="lib_2expat_8h_1a4a30a13b813682e68c5b689b45c65971" kindref="member">value</ref>)</highlight></codeline>
<codeline lineno="671"><highlight class="normal">{</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)(log(value)<sp/>/<sp/>log(2.0)<sp/>+<sp/>0.5);</highlight></codeline>
<codeline lineno="673"><highlight class="normal">}</highlight></codeline>
<codeline lineno="674"><highlight class="normal"></highlight></codeline>
<codeline lineno="675"><highlight class="normal"></highlight></codeline>
<codeline lineno="679"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a4de2124e704948f2aff33ca1ee41072e" kindref="member">TDStretch::calculateOverlapLength</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>aoverlapMs)</highlight></codeline>
<codeline lineno="680"><highlight class="normal">{</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newOvl;</highlight></codeline>
<codeline lineno="682"><highlight class="normal"></highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="libid3tag_2global_8h_1af576bf8ffa22a44e53018c67095ffbf0" kindref="member">assert</ref>(aoverlapMs<sp/>&gt;=<sp/>0);</highlight></codeline>
<codeline lineno="684"><highlight class="normal"></highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>calculate<sp/>overlap<sp/>length<sp/>so<sp/>that<sp/>it&apos;s<sp/>power<sp/>of<sp/>2<sp/>-<sp/>thus<sp/>it&apos;s<sp/>easy<sp/>to<sp/>do</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>integer<sp/>division<sp/>by<sp/>right-shifting.<sp/>Term<sp/>&quot;-1&quot;<sp/>at<sp/>end<sp/>is<sp/>to<sp/>account<sp/>for<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>extra<sp/>most<sp/>significatnt<sp/>bit<sp/>left<sp/>unused<sp/>in<sp/>result<sp/>by<sp/>signed<sp/>multiplication<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8ef9271ed0e9ed8b7f9bcd0e42585ac4" kindref="member">overlapDividerBits</ref><sp/>=<sp/>_getClosest2Power((<ref refid="classsoundtouch_1_1_t_d_stretch_1a475226e8ef3d04ebcbb83e13ff8e78e0" kindref="member">sampleRate</ref><sp/>*<sp/>aoverlapMs)<sp/>/<sp/>1000.0)<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a8ef9271ed0e9ed8b7f9bcd0e42585ac4" kindref="member">overlapDividerBits</ref><sp/>&gt;<sp/>9)<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8ef9271ed0e9ed8b7f9bcd0e42585ac4" kindref="member">overlapDividerBits</ref><sp/>=<sp/>9;</highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a8ef9271ed0e9ed8b7f9bcd0e42585ac4" kindref="member">overlapDividerBits</ref><sp/>&lt;<sp/>3)<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8ef9271ed0e9ed8b7f9bcd0e42585ac4" kindref="member">overlapDividerBits</ref><sp/>=<sp/>3;</highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/>newOvl<sp/>=<sp/>(<ref refid="lib_2expat_8h_1a14bb8924daea0b48c7803f281f66e390" kindref="member">int</ref>)pow(2.0,<sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<ref refid="classsoundtouch_1_1_t_d_stretch_1a8ef9271ed0e9ed8b7f9bcd0e42585ac4" kindref="member">overlapDividerBits</ref><sp/>+<sp/>1);<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>+1<sp/>=&gt;<sp/>account<sp/>for<sp/>-1<sp/>above</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="692"><highlight class="normal"></highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a3affdc351ec41871258d62cc792a9ed6" kindref="member">acceptNewOverlapLength</ref>(newOvl);</highlight></codeline>
<codeline lineno="694"><highlight class="normal"></highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>calculate<sp/>sloping<sp/>divider<sp/>so<sp/>that<sp/>crosscorrelation<sp/>operation<sp/>won&apos;t<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>overflow<sp/>32-bit<sp/>register.<sp/>Max.<sp/>sum<sp/>of<sp/>the<sp/>crosscorrelation<sp/>sum<sp/>without<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>divider<sp/>would<sp/>be<sp/>2^30*(N^3-N)/3,<sp/>where<sp/>N<sp/>=<sp/>overlap<sp/>length</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aae7b05e586c9c992e2ade01264f8676b" kindref="member">slopingDivider</ref><sp/>=<sp/>(newOvl<sp/>*<sp/>newOvl<sp/>-<sp/>1)<sp/>/<sp/>3;</highlight></codeline>
<codeline lineno="699"><highlight class="normal">}</highlight></codeline>
<codeline lineno="700"><highlight class="normal"></highlight></codeline>
<codeline lineno="701"><highlight class="normal"></highlight></codeline>
<codeline lineno="702"><highlight class="normal"></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a6971fa06b13399662485bc382d6d3aa1" kindref="member">TDStretch::calcCrossCorr</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/>*mixingPos,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/>*<ref refid="xlmath_8c_1aa15d8309d8d26181e4cd2abe9f06ab49" kindref="member">compare</ref>)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="703"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>corr;</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">long</highlight><highlight class="normal"><sp/>norm;</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="707"><highlight class="normal"></highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/>corr<sp/>=<sp/>norm<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Same<sp/>routine<sp/>for<sp/>stereo<sp/>and<sp/>mono.<sp/>For<sp/>stereo,<sp/>unroll<sp/>loop<sp/>for<sp/>better</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>efficiency<sp/>and<sp/>gives<sp/>slightly<sp/>better<sp/>resolution<sp/>against<sp/>rounding.<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>mono<sp/>it<sp/>same<sp/>routine,<sp/>just<sp/><sp/>unrolls<sp/>loop<sp/>by<sp/>factor<sp/>of<sp/>4</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8a19ab5d68efd8f21fe88e6d2fc9e2c8" kindref="member">channels</ref><sp/>*<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref>;<sp/>i<sp/>+=<sp/>4)<sp/></highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>corr<sp/>+=<sp/>(mixingPos[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>*<sp/>compare[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>+<sp/></highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mixingPos[i<sp/>+<sp/>1]<sp/>*<sp/>compare[i<sp/>+<sp/>1]<sp/>+</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mixingPos[i<sp/>+<sp/>2]<sp/>*<sp/>compare[i<sp/>+<sp/>2]<sp/>+<sp/></highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mixingPos[i<sp/>+<sp/>3]<sp/>*<sp/>compare[i<sp/>+<sp/>3])<sp/>&gt;&gt;<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8ef9271ed0e9ed8b7f9bcd0e42585ac4" kindref="member">overlapDividerBits</ref>;</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>norm<sp/>+=<sp/>(mixingPos[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>*<sp/>mixingPos[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>+<sp/></highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mixingPos[i<sp/>+<sp/>1]<sp/>*<sp/>mixingPos[i<sp/>+<sp/>1]<sp/>+</highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mixingPos[i<sp/>+<sp/>2]<sp/>*<sp/>mixingPos[i<sp/>+<sp/>2]<sp/>+<sp/></highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mixingPos[i<sp/>+<sp/>3]<sp/>*<sp/>mixingPos[i<sp/>+<sp/>3])<sp/>&gt;&gt;<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8ef9271ed0e9ed8b7f9bcd0e42585ac4" kindref="member">overlapDividerBits</ref>;</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="723"><highlight class="normal"></highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Normalize<sp/>result<sp/>by<sp/>dividing<sp/>by<sp/>sqrt(norm)<sp/>-<sp/>this<sp/>step<sp/>is<sp/>easiest<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>done<sp/>using<sp/>floating<sp/>point<sp/>operation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(norm<sp/>==<sp/>0)<sp/>norm<sp/>=<sp/>1;<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>avoid<sp/>div<sp/>by<sp/>zero</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)corr<sp/>/<sp/>sqrt((</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)norm);</highlight></codeline>
<codeline lineno="728"><highlight class="normal">}</highlight></codeline>
<codeline lineno="729"><highlight class="normal"></highlight></codeline>
<codeline lineno="730"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/>//<sp/>SOUNDTOUCH_INTEGER_SAMPLES</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="731"><highlight class="normal"></highlight></codeline>
<codeline lineno="733"><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="734"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Floating<sp/>point<sp/>arithmetics<sp/>specific<sp/>algorithm<sp/>implementations.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="735"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="736"><highlight class="normal"></highlight></codeline>
<codeline lineno="737"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>SOUNDTOUCH_FLOAT_SAMPLES</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="738"><highlight class="normal"></highlight></codeline>
<codeline lineno="739"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Overlaps<sp/>samples<sp/>in<sp/>&apos;midBuffer&apos;<sp/>with<sp/>the<sp/>samples<sp/>in<sp/>&apos;pInput&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="740"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1aba5ef0cb6619688ed4e8a7d1d8cd21dc" kindref="member">TDStretch::overlapStereo</ref>(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>*pOutput,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>*pInput)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="741"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>fScale;</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>f1;</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>f2;</highlight></codeline>
<codeline lineno="746"><highlight class="normal"></highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/>fScale<sp/>=<sp/>1.0f<sp/>/<sp/>(float)<ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref>;</highlight></codeline>
<codeline lineno="748"><highlight class="normal"></highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/>f1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/>f2<sp/>=<sp/>1.0f;</highlight></codeline>
<codeline lineno="751"><highlight class="normal"></highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>2<sp/>*<sp/>(<ref refid="lib_2expat_8h_1a14bb8924daea0b48c7803f281f66e390" kindref="member">int</ref>)<ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref><sp/>;<sp/>i<sp/>+=<sp/>2)<sp/></highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pOutput[i<sp/>+<sp/>0]<sp/>=<sp/>pInput[i<sp/>+<sp/>0]<sp/>*<sp/>f1<sp/>+<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ae8ecce9c1a28ac0e281413ab2d1ffff8" kindref="member">pMidBuffer</ref>[i<sp/>+<sp/>0]<sp/>*<sp/>f2;</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pOutput[i<sp/>+<sp/>1]<sp/>=<sp/>pInput[i<sp/>+<sp/>1]<sp/>*<sp/>f1<sp/>+<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1ae8ecce9c1a28ac0e281413ab2d1ffff8" kindref="member">pMidBuffer</ref>[i<sp/>+<sp/>1]<sp/>*<sp/>f2;</highlight></codeline>
<codeline lineno="756"><highlight class="normal"></highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f1<sp/>+=<sp/>fScale;</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f2<sp/>-=<sp/>fScale;</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="760"><highlight class="normal">}</highlight></codeline>
<codeline lineno="761"><highlight class="normal"></highlight></codeline>
<codeline lineno="762"><highlight class="normal"></highlight></codeline>
<codeline lineno="764"><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a4de2124e704948f2aff33ca1ee41072e" kindref="member">TDStretch::calculateOverlapLength</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>overlapInMsec)</highlight></codeline>
<codeline lineno="765"><highlight class="normal">{</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>newOvl;</highlight></codeline>
<codeline lineno="767"><highlight class="normal"></highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="libid3tag_2global_8h_1af576bf8ffa22a44e53018c67095ffbf0" kindref="member">assert</ref>(overlapInMsec<sp/>&gt;=<sp/>0);</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/>newOvl<sp/>=<sp/>(<ref refid="classsoundtouch_1_1_t_d_stretch_1a475226e8ef3d04ebcbb83e13ff8e78e0" kindref="member">sampleRate</ref><sp/>*<sp/>overlapInMsec)<sp/>/<sp/>1000;</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(newOvl<sp/>&lt;<sp/>16)<sp/>newOvl<sp/>=<sp/>16;</highlight></codeline>
<codeline lineno="771"><highlight class="normal"></highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>must<sp/>be<sp/>divisible<sp/>by<sp/>8</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/>newOvl<sp/>-=<sp/>newOvl<sp/>%<sp/>8;</highlight></codeline>
<codeline lineno="774"><highlight class="normal"></highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a3affdc351ec41871258d62cc792a9ed6" kindref="member">acceptNewOverlapLength</ref>(newOvl);</highlight></codeline>
<codeline lineno="776"><highlight class="normal">}</highlight></codeline>
<codeline lineno="777"><highlight class="normal"></highlight></codeline>
<codeline lineno="778"><highlight class="normal"></highlight></codeline>
<codeline lineno="779"><highlight class="normal"></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a6971fa06b13399662485bc382d6d3aa1" kindref="member">TDStretch::calcCrossCorr</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>*mixingPos,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>*<ref refid="xlmath_8c_1aa15d8309d8d26181e4cd2abe9f06ab49" kindref="member">compare</ref>)</highlight><highlight class="keyword"><sp/>const</highlight></codeline>
<codeline lineno="780"><highlight class="keyword"></highlight><highlight class="normal">{</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>corr;</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>norm;</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="784"><highlight class="normal"></highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/>corr<sp/>=<sp/>norm<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Same<sp/>routine<sp/>for<sp/>stereo<sp/>and<sp/>mono.<sp/>For<sp/>Stereo,<sp/>unroll<sp/>by<sp/>factor<sp/>of<sp/>2.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>For<sp/>mono<sp/>it&apos;s<sp/>same<sp/>routine<sp/>yet<sp/>unrollsd<sp/>by<sp/>factor<sp/>of<sp/>4.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a8a19ab5d68efd8f21fe88e6d2fc9e2c8" kindref="member">channels</ref><sp/>*<sp/><ref refid="classsoundtouch_1_1_t_d_stretch_1a39b7d3bf7c87bf00571766e84f889fd8" kindref="member">overlapLength</ref>;<sp/>i<sp/>+=<sp/>4)<sp/></highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>corr<sp/>+=<sp/>mixingPos[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>*<sp/>compare[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>+</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mixingPos[i<sp/>+<sp/>1]<sp/>*<sp/>compare[i<sp/>+<sp/>1];</highlight></codeline>
<codeline lineno="792"><highlight class="normal"></highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>norm<sp/>+=<sp/>mixingPos[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>*<sp/>mixingPos[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>+<sp/></highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mixingPos[i<sp/>+<sp/>1]<sp/>*<sp/>mixingPos[i<sp/>+<sp/>1];</highlight></codeline>
<codeline lineno="795"><highlight class="normal"></highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>unroll<sp/>the<sp/>loop<sp/>for<sp/>better<sp/>CPU<sp/>efficiency:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>corr<sp/>+=<sp/>mixingPos[i<sp/>+<sp/>2]<sp/>*<sp/>compare[i<sp/>+<sp/>2]<sp/>+</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mixingPos[i<sp/>+<sp/>3]<sp/>*<sp/>compare[i<sp/>+<sp/>3];</highlight></codeline>
<codeline lineno="799"><highlight class="normal"></highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>norm<sp/>+=<sp/>mixingPos[i<sp/>+<sp/>2]<sp/>*<sp/>mixingPos[i<sp/>+<sp/>2]<sp/>+</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mixingPos[i<sp/>+<sp/>3]<sp/>*<sp/>mixingPos[i<sp/>+<sp/>3];</highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="803"><highlight class="normal"></highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(norm<sp/>&lt;<sp/>1<ref refid="namespacelv2docgen_1a4405dc5a2509537b9ff3b4de10bc28d6" kindref="member">e</ref>-9)<sp/>norm<sp/>=<sp/>1.0;<sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>to<sp/>avoid<sp/>div<sp/>by<sp/>zero</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>corr<sp/>/<sp/>sqrt(norm);</highlight></codeline>
<codeline lineno="806"><highlight class="normal">}</highlight></codeline>
<codeline lineno="807"><highlight class="normal"></highlight></codeline>
<codeline lineno="808"><highlight class="normal"></highlight><highlight class="preprocessor">#endif<sp/>//<sp/>SOUNDTOUCH_FLOAT_SAMPLES</highlight></codeline>
    </programlisting>
    <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/soundtouch/source/SoundTouch/TDStretch.cpp"/>
  </compounddef>
</doxygen>
