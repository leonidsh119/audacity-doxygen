<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.11">
  <compounddef id="smartmsgmerge_8py" kind="file" language="Python">
    <compoundname>smartmsgmerge.py</compoundname>
    <innerclass refid="classsmartmsgmerge_1_1obj" prot="public">smartmsgmerge::obj</innerclass>
    <innernamespace refid="namespacesmartmsgmerge">smartmsgmerge</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespacesmartmsgmerge" refkind="compound"><highlight class="comment">#!/usr/bin/python</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="comment">#<sp/>smartmsgmerge.py</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Written<sp/>by<sp/>Dominic<sp/>Mazzoni,<sp/>2006</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="comment">#<sp/>GNU<sp/>General<sp/>Public<sp/>License<sp/>2.0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="comment">#<sp/>This<sp/>is<sp/>a<sp/>replacement<sp/>for<sp/>the<sp/>GNU<sp/>gettext<sp/>&quot;msgmerge&quot;<sp/>program,<sp/>which</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="comment">#<sp/>is<sp/>typically<sp/>used<sp/>to<sp/>update<sp/>a<sp/>.po<sp/>file<sp/>(def)<sp/>to<sp/>the<sp/>latest<sp/>.pot<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="comment">#<sp/>(ref).<sp/><sp/>This<sp/>program<sp/>is<sp/>not<sp/>command-line<sp/>compatible;<sp/>it<sp/>takes<sp/>no</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="comment">#<sp/>flags<sp/>but<sp/>simply<sp/>the<sp/>def,<sp/>ref,<sp/>and<sp/>output<sp/>file<sp/>names.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="comment">#<sp/>It<sp/>uses<sp/>a<sp/>much<sp/>faster<sp/>and<sp/>also<sp/>much<sp/>stricter<sp/>policy<sp/>for<sp/>finding<sp/>new</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="comment">#<sp/>fuzzy<sp/>matches:<sp/>the<sp/>edit-distance<sp/>must<sp/>be<sp/>no<sp/>more<sp/>than<sp/>4%,<sp/>or<sp/>for<sp/>very</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="comment">#<sp/>short<sp/>strings,<sp/>no<sp/>more<sp/>than<sp/>1<sp/>character.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="comment">#<sp/>This<sp/>makes<sp/>it<sp/>safe<sp/>for<sp/>you<sp/>to<sp/>enable<sp/>fuzzy<sp/>strings<sp/>in<sp/>your<sp/>.mo<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="comment">#<sp/>without<sp/>worrying<sp/>that<sp/>they&apos;ll<sp/>be<sp/>too<sp/>terrible.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="comment">#<sp/>It<sp/>also<sp/>fixes<sp/>translations<sp/>where<sp/>the<sp/>beginning<sp/>and<sp/>ending<sp/>newlines</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="comment">#<sp/>do<sp/>not<sp/>match<sp/>the<sp/>original<sp/>string.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="comment">#</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>sys,<sp/>os</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(sys.argv)<sp/>!=<sp/>4:</highlight></codeline>
<codeline lineno="27"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;Usage:<sp/>%s<sp/>def.po<sp/>ref.pot<sp/>out.po&quot;</highlight><highlight class="normal"><sp/>%<sp/>sys.argv[0]</highlight></codeline>
<codeline lineno="28"><highlight class="normal"><sp/><sp/>sys.exit()</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight></codeline>
<codeline lineno="30" refid="namespacesmartmsgmerge_1a26bbdb58483a0e4a0fd0b79fbbf04cc1" refkind="member"><highlight class="normal">def_filename<sp/>=<sp/>sys.argv[1]</highlight></codeline>
<codeline lineno="31" refid="namespacesmartmsgmerge_1a55eb929ba8ca04c449d464a49a3be6eb" refkind="member"><highlight class="normal">ref_filename<sp/>=<sp/>sys.argv[2]</highlight></codeline>
<codeline lineno="32" refid="namespacesmartmsgmerge_1aec8072bf6d17bfc67ac570315b42fc3b" refkind="member"><highlight class="normal">out_filename<sp/>=<sp/>sys.argv[3]</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Each<sp/>object<sp/>will<sp/>contain<sp/>the<sp/>comments,<sp/>msgid<sp/>(untranslated),</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="comment">#<sp/>msgstr<sp/>(translated),<sp/>and<sp/>a<sp/>fuzzy<sp/>flag.<sp/><sp/>For<sp/>simplicity<sp/>this<sp/>is</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="comment">#<sp/>not<sp/>a<sp/>typechecked<sp/>class,<sp/>just<sp/>a<sp/>dummy<sp/>dynamic<sp/>container<sp/>class.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37" refid="classsmartmsgmerge_1_1obj" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classsmartmsgmerge_1_1obj" kindref="compound">obj</ref>:</highlight></codeline>
<codeline lineno="38"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">pass</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Compute<sp/>the<sp/>edit-distance<sp/>between<sp/>str1<sp/>and<sp/>str2,<sp/>taking<sp/>a<sp/>couple</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="comment">#<sp/>of<sp/>shortcuts<sp/>such<sp/>that<sp/>it<sp/>returns<sp/>999<sp/>quickly<sp/>if<sp/>the<sp/>edit-distance</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="comment">#<sp/>is<sp/>clearly<sp/>not<sp/>going<sp/>to<sp/>be<sp/>less<sp/>than<sp/>10<sp/>percent.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43" refid="namespacesmartmsgmerge_1ad1a950cbf2bee6332a9e490bb726dd94" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacesmartmsgmerge_1ad1a950cbf2bee6332a9e490bb726dd94" kindref="member">edit_distance</ref>(str1,<sp/>str2):</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/>l1<sp/>=<sp/>len(str1)</highlight></codeline>
<codeline lineno="45"><highlight class="normal"><sp/><sp/>l2<sp/>=<sp/>len(str2)</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>Exit<sp/>if<sp/>the<sp/>difference<sp/>in<sp/>the<sp/>string<sp/>lenghts<sp/>is<sp/>10%<sp/>or<sp/>more</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>l1*1.0/l2<sp/>&lt;<sp/>0.9<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>l1*1.0/l2<sp/>&gt;<sp/>1.1:</highlight></codeline>
<codeline lineno="49"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>999</highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>Compute<sp/>a<sp/>beam<sp/>width<sp/>of<sp/>+/-<sp/>5%<sp/>-<sp/>the<sp/>path<sp/>through<sp/>the<sp/>matrix<sp/>cannot</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>go<sp/>outside<sp/>the<sp/>main<sp/>diagonal<sp/>+/-<sp/>the<sp/>beam.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/>beam<sp/>=<sp/><ref refid="lib_2expat_8h_1a14bb8924daea0b48c7803f281f66e390" kindref="member">int</ref>(0.5<sp/>+<sp/>0.1<sp/>*<sp/>((l1<sp/>+<sp/>l2)<sp/>/<sp/>2))</highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>Create<sp/>a<sp/>2D<sp/>array</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/>d<sp/>=<sp/>[</highlight><highlight class="keywordtype">None</highlight><highlight class="normal">]*(l1+1)</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>i<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>range(l1+1):</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/>d[i]<sp/>=<sp/>[999]*(l2+1)</highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>Initialize<sp/>the<sp/>first<sp/>row<sp/>and<sp/>column</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>i<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>range(l1+1):</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/>d[i][0]<sp/>=<sp/>i</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>j<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>range(l2+1):</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/>d[0][j]<sp/>=<sp/>j</highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>Dynamic<sp/>programming</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>i<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>range(1,<sp/>l1+1):</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Quick<sp/>short-circuit<sp/>after<sp/>30<sp/>rows;<sp/>stop<sp/>if<sp/>things<sp/>are</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>looking<sp/>really<sp/>bad</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>i==30<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>l2&gt;=30<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>d[29][29]<sp/>&gt;<sp/>20:</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>999</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>j<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>range(<ref refid="libflac_2src_2flac_2encode_8c_1ac39d9cef6a5e030ba8d9e11121054268" kindref="member">max</ref>(1,<sp/>i-beam),<sp/><ref refid="_compare_audio_command_8cpp_1abd8bbcfabb3ddef2ccaafb9928a37b95" kindref="member">min</ref>(l2+1,<sp/>i+beam+1)):</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>str1[i-1]<sp/>==<sp/>str2[j-1]:</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cost<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cost<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>d[i][j]<sp/>=<sp/><ref refid="_compare_audio_command_8cpp_1abd8bbcfabb3ddef2ccaafb9928a37b95" kindref="member">min</ref>(</highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>d[i-1][j]<sp/>+<sp/>1,<sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>deletion</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>d[i][j-1]<sp/>+<sp/>1,<sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>insertion</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>d[i-1][j-1]<sp/>+<sp/>cost<sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>substitution</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>)</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>d[l1][l2]</highlight></codeline>
<codeline lineno="83"><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Take<sp/>a<sp/>string<sp/>and<sp/>format<sp/>it<sp/>on<sp/>a<sp/>bunch<sp/>of<sp/>separate<sp/>lines<sp/>in<sp/>quotes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85" refid="namespacesmartmsgmerge_1a8ae4a9cc653616390fa5fee6e04eca33" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacesmartmsgmerge_1a8ae4a9cc653616390fa5fee6e04eca33" kindref="member">quote</ref>(str):</highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>str==</highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;\&quot;\&quot;\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/>q<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/>p<sp/>=<sp/>str.find(</highlight><highlight class="stringliteral">&quot;\\n&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>p<sp/>&gt;=<sp/>0:</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/>line<sp/>=<sp/>str[:p]</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/>str<sp/>=<sp/>str[p+2:]</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/>q<sp/>+=<sp/></highlight><highlight class="stringliteral">&quot;\&quot;%s\\n\&quot;\n&quot;</highlight><highlight class="normal"><sp/>%<sp/>line</highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/>p<sp/>=<sp/>str.find(</highlight><highlight class="stringliteral">&quot;\\n&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(str)<sp/>&gt;<sp/>0:</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/>q<sp/>+=<sp/></highlight><highlight class="stringliteral">&quot;\&quot;%s\&quot;\n&quot;</highlight><highlight class="normal"><sp/>%<sp/>str</highlight></codeline>
<codeline lineno="97"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>q</highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Take<sp/>a<sp/>bunch<sp/>of<sp/>separate<sp/>lines<sp/>in<sp/>quotes<sp/>and<sp/>turn<sp/>them<sp/>into<sp/>a<sp/>single<sp/>string</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100" refid="namespacesmartmsgmerge_1a5369bd324d0699cca3cce3ffdc0b46b4" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacesmartmsgmerge_1a5369bd324d0699cca3cce3ffdc0b46b4" kindref="member">unquote</ref>(str):</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/>u<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>line<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>str.split(</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/>line<sp/>=<sp/>line.strip()</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(line)&gt;=2:</highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>line[0]==</highlight><highlight class="stringliteral">&apos;&quot;&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>line[-1]==</highlight><highlight class="stringliteral">&apos;&quot;&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u<sp/>+=<sp/>line[1:-1]</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;Error<sp/>with:&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;**%s**&apos;</highlight><highlight class="normal"><sp/>%<sp/>line</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sys.exit()</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>u</highlight></codeline>
<codeline lineno="112"><highlight class="normal"></highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Parse<sp/>one<sp/>file<sp/>in<sp/>the<sp/>.po<sp/>/<sp/>.pot<sp/>format,<sp/>returning<sp/>a<sp/>hash<sp/>of<sp/>all</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="114"><highlight class="normal"></highlight><highlight class="comment">#<sp/>msgids<sp/>and<sp/>a<sp/>list<sp/>of<sp/>all<sp/>msgids<sp/>in<sp/>order.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="115" refid="namespacesmartmsgmerge_1a29421600d4fe00c8c5eb6cfaa0f5ca35" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacesmartmsgmerge_1a29421600d4fe00c8c5eb6cfaa0f5ca35" kindref="member">parse</ref>(fname):</highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/>h<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/>l<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/>msgid<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/>msgstr<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/>comments<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/>fuzzy<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/>first<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/>line_no<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="124"><highlight class="normal"></highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>Read<sp/>the<sp/>lines<sp/>of<sp/>the<sp/>file<sp/>and<sp/>make<sp/>sure<sp/>it<sp/>always<sp/>ends<sp/>in<sp/>a</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>blank<sp/>line</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/>lines<sp/>=<sp/>open(fname).readlines()</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/>lines.append(</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>line<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>(lines<sp/>+<sp/>[</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">]):</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Handle<sp/>DOS<sp/>line<sp/>endings</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(line)&gt;=2<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>line[-2]==</highlight><highlight class="stringliteral">&apos;\r&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>line[-1]==</highlight><highlight class="stringliteral">&apos;\n&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>line<sp/>=<sp/>line[:-2]+</highlight><highlight class="stringliteral">&apos;\n&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"></highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/>line_no<sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>line==</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(msgid)==0<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>first:</highlight></codeline>
<codeline lineno="138"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>We<sp/>found<sp/>a<sp/>blank<sp/>line<sp/>or<sp/>comments<sp/>in<sp/>the<sp/>middle<sp/>of<sp/>nowhere</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>comments<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fuzzy<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msgstr<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Otherwise,<sp/>a<sp/>blank<sp/>line<sp/>in<sp/>the<sp/>middle<sp/>of<sp/>the<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>signifies<sp/>the<sp/>end<sp/>of<sp/>a<sp/>translation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>msgid<sp/>=<sp/><ref refid="namespacesmartmsgmerge_1a5369bd324d0699cca3cce3ffdc0b46b4" kindref="member">unquote</ref>(msgid)</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>msgstr<sp/>=<sp/><ref refid="namespacesmartmsgmerge_1a5369bd324d0699cca3cce3ffdc0b46b4" kindref="member">unquote</ref>(msgstr)</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>msgid<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>h:</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;Duplicate<sp/>msgid<sp/>in<sp/>%s:&quot;</highlight><highlight class="normal"><sp/>%<sp/>(fname)</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/><ref refid="namespacesmartmsgmerge_1a8ae4a9cc653616390fa5fee6e04eca33" kindref="member">quote</ref>(msgid)</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;Found<sp/>on<sp/>line<sp/>%d,<sp/>previously<sp/>defined<sp/>on<sp/>line<sp/>%d&quot;</highlight><highlight class="normal"><sp/>%<sp/>\</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(line_no,<sp/>h[msgid].line_no)</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sys.exit()</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>o<sp/>=<sp/><ref refid="classsmartmsgmerge_1_1obj" kindref="compound">obj</ref>()</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>o.comments<sp/>=<sp/>comments</highlight></codeline>
<codeline lineno="155"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>o.msgid<sp/>=<sp/>msgid</highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>o.msgstr<sp/>=<sp/>msgstr</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>o.fuzzy<sp/>=<sp/>fuzzy</highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>o.line_no<sp/>=<sp/>line_no</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>h[msgid]<sp/>=<sp/>o</highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>l.append(msgid)</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comments<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>msgstr<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>msgid<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fuzzy<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>first<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>len(line)&gt;=8<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>line[:8]<sp/>==<sp/></highlight><highlight class="stringliteral">&quot;#,<sp/>fuzzy&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fuzzy<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comments<sp/>+=<sp/>line</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>line[0]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;#&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>comments<sp/>+=<sp/>line</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>len(line)&gt;6<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>line[:6]==</highlight><highlight class="stringliteral">&quot;msgid<sp/>&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>msgid<sp/>+=<sp/>line[6:]</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>len(line)&gt;7<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>line[:7]==</highlight><highlight class="stringliteral">&quot;msgstr<sp/>&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>msgstr<sp/>+=<sp/>line[7:]</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(msgstr):</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msgstr<sp/>+=<sp/>line</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>msgid<sp/>+=<sp/>line</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(h,<sp/>l)</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal">(def_h,<sp/>def_l)<sp/>=<sp/><ref refid="namespacesmartmsgmerge_1a29421600d4fe00c8c5eb6cfaa0f5ca35" kindref="member">parse</ref>(def_filename)</highlight></codeline>
<codeline lineno="183"><highlight class="normal">(ref_h,<sp/>ref_l)<sp/>=<sp/><ref refid="namespacesmartmsgmerge_1a29421600d4fe00c8c5eb6cfaa0f5ca35" kindref="member">parse</ref>(ref_filename)</highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Handle<sp/>the<sp/>exact<sp/>matches</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="186" refid="namespacesmartmsgmerge_1ad6017716215ed97b68d46470b8bb3b8b" refkind="member"><highlight class="normal">final_h<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="187"><highlight class="normal"></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>msgid<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ref_l:</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>msgid<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>def_h:</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/>final_h[msgid]<sp/>=<sp/>def_h[msgid]</highlight></codeline>
<codeline lineno="190"><highlight class="normal"></highlight></codeline>
<codeline lineno="191"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Try<sp/>for<sp/>fuzzy<sp/>matches</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="192"><highlight class="normal"></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>ref_msgid<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[x<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>x<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ref_l<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>x<sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>final_h]:</highlight></codeline>
<codeline lineno="193" refid="namespacesmartmsgmerge_1a8b0d2e9d5f279d2f36d5fca526d33b0b" refkind="member"><highlight class="normal"><sp/><sp/>min_ed<sp/>=<sp/>999</highlight></codeline>
<codeline lineno="194" refid="namespacesmartmsgmerge_1afa50b3b893ba3cfc50357dc19c5e6c4b" refkind="member"><highlight class="normal"><sp/><sp/>min_msgid<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>def_msgid<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[x<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>x<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>def_l<sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>x<sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>final_h]:</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(def_h[def_msgid].msgstr)<sp/>&lt;<sp/>3:</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="198" refid="namespacesmartmsgmerge_1a36d32c09e60cee8d8327542fda09faf3" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>ed<sp/>=<sp/><ref refid="namespacesmartmsgmerge_1ad1a950cbf2bee6332a9e490bb726dd94" kindref="member">edit_distance</ref>(ref_msgid,<sp/>def_msgid)</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ed<sp/>&lt;<sp/>min_ed:</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>min_ed<sp/>=<sp/>ed</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>min_msgid<sp/>=<sp/>def_msgid</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>min_msgid<sp/>!=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="203" refid="namespacesmartmsgmerge_1a0051391e6456ea14774d4516b9244d86" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/>pct<sp/>=<sp/>min_ed<sp/>*<sp/>100.0<sp/>/<sp/><ref refid="_compare_audio_command_8cpp_1abd8bbcfabb3ddef2ccaafb9928a37b95" kindref="member">min</ref>(len(ref_msgid),<sp/>len(min_msgid))</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>min_ed<sp/>==<sp/>1<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>pct<sp/>&lt;=<sp/>4.0:</highlight></codeline>
<codeline lineno="205" refid="namespacesmartmsgmerge_1a947966886a875c9716793981e78924f3" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>refstr<sp/>=<sp/>ref_msgid</highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(refstr)&gt;40:</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>refstr<sp/>=<sp/>refstr[:37]+</highlight><highlight class="stringliteral">&quot;...&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208" refid="namespacesmartmsgmerge_1a6e25c3f9695b423ab77089934b94b7cc" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>minstr<sp/>=<sp/>min_msgid</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(minstr)&gt;40:</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>minstr<sp/>=<sp/>minstr[:37]+</highlight><highlight class="stringliteral">&quot;...&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;Found<sp/>fuzzy<sp/>match:&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/>%s&quot;</highlight><highlight class="normal"><sp/>%<sp/>refstr</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/>%s&quot;</highlight><highlight class="normal"><sp/>%<sp/>minstr</highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/>def_len=%d,<sp/>ref_len=%d,<sp/>edit_distance=%d&quot;</highlight><highlight class="normal"><sp/>%<sp/>\</highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(len(min_msgid),<sp/>len(ref_msgid),<sp/>min_ed)</highlight></codeline>
<codeline lineno="216" refid="namespacesmartmsgmerge_1aba35baca6a2a8d4f665ba30724f4739a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>o<sp/>=<sp/><ref refid="classsmartmsgmerge_1_1obj" kindref="compound">obj</ref>()</highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>def_h[min_msgid]</highlight></codeline>
<codeline lineno="218" refid="namespacesmartmsgmerge_1a16869be066022ccc5e31e730a1a2eb5d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>o.msgid<sp/>=<sp/>ref_msgid</highlight></codeline>
<codeline lineno="219" refid="namespacesmartmsgmerge_1ad7479accab5feee183875ec44b1ffcad" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>o.comments<sp/>=<sp/>ref_h[ref_msgid].comments</highlight></codeline>
<codeline lineno="220" refid="namespacesmartmsgmerge_1a5cff4f721c780040fcb1fda07e48977e" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>o.msgstr<sp/>=<sp/>def_h[min_msgid].msgstr</highlight></codeline>
<codeline lineno="221" refid="namespacesmartmsgmerge_1ad2ebdcbec75bdcb77dfbd97ce47296f7" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>o.fuzzy<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>final_h[ref_msgid]<sp/>=<sp/>o</highlight></codeline>
<codeline lineno="223"><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Generate<sp/>output<sp/>file</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="225" refid="namespacesmartmsgmerge_1a29e7adb972fefe8640e8cb70d599a8e6" refkind="member"><highlight class="normal">translated<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="226"><highlight class="normal">fuzzy<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="227" refid="namespacesmartmsgmerge_1ac2680eb7fa9c45a71b644e17efafadd9" refkind="member"><highlight class="normal">empty<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="228" refid="namespacesmartmsgmerge_1a5646c202b8354546c4cc16999c200cd6" refkind="member"><highlight class="normal">out_fp<sp/>=<sp/>open(out_filename,<sp/></highlight><highlight class="stringliteral">&quot;w&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="229"><highlight class="normal"></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>msgid<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ref_l:</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>msgid<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>final_h:</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/>o<sp/>=<sp/>final_h[msgid]</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>o.fuzzy:</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>fuzzy<sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>msgid<sp/>!=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>translated<sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/>o<sp/>=<sp/>ref_h[msgid]</highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/>empty<sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="239"><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/>msgstr<sp/>=<sp/>o.msgstr</highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>Fix<sp/>leading<sp/>and<sp/>trailing<sp/>newlines</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(msgid)&gt;4<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>len(msgstr)&gt;4:</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Add<sp/>newline<sp/>if<sp/>missing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>msgid[:2]==</highlight><highlight class="stringliteral">&quot;\\n&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>msgstr[:2]!=</highlight><highlight class="stringliteral">&quot;\\n&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>msgstr<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;\\n&quot;</highlight><highlight class="normal"><sp/>+<sp/>msgstr</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>msgid[-2:]==</highlight><highlight class="stringliteral">&quot;\\n&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>msgstr[-2:]!=</highlight><highlight class="stringliteral">&quot;\\n&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>msgstr<sp/>=<sp/>msgstr<sp/>+<sp/></highlight><highlight class="stringliteral">&quot;\\n&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>newline<sp/>if<sp/>extraneous</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>msgid[:2]!=</highlight><highlight class="stringliteral">&quot;\\n&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>msgstr[:2]==</highlight><highlight class="stringliteral">&quot;\\n&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>msgstr<sp/>=<sp/>msgstr[2:]</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>msgid[-2:]!=</highlight><highlight class="stringliteral">&quot;\\n&quot;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>msgstr[-2:]==</highlight><highlight class="stringliteral">&quot;\\n&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>msgstr<sp/>=<sp/>msgstr[:-2]</highlight></codeline>
<codeline lineno="254"><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">#<sp/>Write<sp/>the<sp/>entry</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/>out_fp.write(o.comments)</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>o.fuzzy<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>o.comments.find(</highlight><highlight class="stringliteral">&quot;fuzzy&quot;</highlight><highlight class="normal">)==-1:</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/>out_fp.write(</highlight><highlight class="stringliteral">&quot;#,<sp/>fuzzy\n&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/>out_fp.write(</highlight><highlight class="stringliteral">&quot;msgid<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/><ref refid="namespacesmartmsgmerge_1a8ae4a9cc653616390fa5fee6e04eca33" kindref="member">quote</ref>(msgid))</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/>out_fp.write(</highlight><highlight class="stringliteral">&quot;msgstr<sp/>&quot;</highlight><highlight class="normal"><sp/>+<sp/><ref refid="namespacesmartmsgmerge_1a8ae4a9cc653616390fa5fee6e04eca33" kindref="member">quote</ref>(msgstr))</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/>out_fp.write(</highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight><highlight class="comment">#<sp/>Print<sp/>stats</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;Translated:<sp/>%d<sp/>Fuzzy:<sp/>%d<sp/>Empty:<sp/>%d&quot;</highlight><highlight class="normal"><sp/>%<sp/>(translated,<sp/>fuzzy,<sp/>empty)</highlight></codeline>
<codeline lineno="265"><highlight class="normal"></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;Wrote<sp/>output<sp/>to<sp/>%s&quot;</highlight><highlight class="normal"><sp/>%<sp/>out_filename</highlight></codeline>
    </programlisting>
    <location file="C:/_dev/OpenU/Audacity/audacity/locale/smartmsgmerge.py"/>
  </compounddef>
</doxygen>
