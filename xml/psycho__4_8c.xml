<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.11">
  <compounddef id="psycho__4_8c" kind="file" language="C++">
    <compoundname>psycho_4.c</compoundname>
    <includes local="no">stdio.h</includes>
    <includes local="no">stdlib.h</includes>
    <includes local="no">math.h</includes>
    <includes local="no">string.h</includes>
    <includes refid="twolame_8h" local="yes">twolame.h</includes>
    <includes refid="twolame_2libtwolame_2common_8h" local="yes">common.h</includes>
    <includes refid="twolame_2libtwolame_2mem_8h" local="yes">mem.h</includes>
    <includes refid="lib-src_2twolame_2libtwolame_2fft_8h" local="yes">fft.h</includes>
    <includes refid="ath_8h" local="yes">ath.h</includes>
    <includes refid="psycho__4_8h" local="yes">psycho_4.h</includes>
    <incdepgraph>
      <node id="32592">
        <label>stdlib.h</label>
      </node>
      <node id="32595">
        <label>twolame.h</label>
        <link refid="twolame_8h"/>
      </node>
      <node id="32600">
        <label>ath.h</label>
        <link refid="ath_8h"/>
      </node>
      <node id="32594">
        <label>string.h</label>
      </node>
      <node id="32599">
        <label>fft.h</label>
        <link refid="lib-src_2twolame_2libtwolame_2fft_8h"/>
      </node>
      <node id="32590">
        <label>C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c</label>
        <link refid="psycho_4.c"/>
        <childnode refid="32591" relation="include">
        </childnode>
        <childnode refid="32592" relation="include">
        </childnode>
        <childnode refid="32593" relation="include">
        </childnode>
        <childnode refid="32594" relation="include">
        </childnode>
        <childnode refid="32595" relation="include">
        </childnode>
        <childnode refid="32596" relation="include">
        </childnode>
        <childnode refid="32598" relation="include">
        </childnode>
        <childnode refid="32599" relation="include">
        </childnode>
        <childnode refid="32600" relation="include">
        </childnode>
        <childnode refid="32601" relation="include">
        </childnode>
      </node>
      <node id="32601">
        <label>psycho_4.h</label>
        <link refid="psycho__4_8h"/>
      </node>
      <node id="32593">
        <label>math.h</label>
      </node>
      <node id="32597">
        <label>config.h</label>
      </node>
      <node id="32591">
        <label>stdio.h</label>
      </node>
      <node id="32596">
        <label>common.h</label>
        <link refid="twolame_2libtwolame_2common_8h"/>
        <childnode refid="32597" relation="include">
        </childnode>
        <childnode refid="32595" relation="include">
        </childnode>
      </node>
      <node id="32598">
        <label>mem.h</label>
        <link refid="twolame_2libtwolame_2mem_8h"/>
        <childnode refid="32596" relation="include">
        </childnode>
      </node>
    </incdepgraph>
      <sectiondef kind="var">
      <memberdef kind="variable" id="psycho__4_8c_1a9f49169d621fd0bc4702e1a0f7e6beee" prot="public" static="yes" mutable="no">
        <type><ref refid="getopt1_8c_1a2c212835823e3c54a8ab6d95c652660e" kindref="member">const</ref> <ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref></type>
        <definition>const FLOAT NMT</definition>
        <argsstring></argsstring>
        <name>NMT</name>
        <initializer>= 5.5</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c" line="70" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c" bodystart="70" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="psycho__4_8c_1a306c34c8de1cb2d0414142af2feee176" prot="public" static="yes" mutable="no">
        <type><ref refid="getopt1_8c_1a2c212835823e3c54a8ab6d95c652660e" kindref="member">const</ref> <ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref></type>
        <definition>const FLOAT minval[27]</definition>
        <argsstring>[27]</argsstring>
        <name>minval</name>
        <initializer>= {
    0.0,                        
    20.0,                       
    20.0,                       
    20.0,                       
    20.0,                       
    20.0,                       
    17.0,                       
    15.0,                       
    10.0,                       
    7.0,                        
    4.4,                        
    4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5, 4.5,  
    3.5                         
}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c" line="74" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c" bodystart="74" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="psycho__4_8c_1af1075e757241dfca8ec9f2726708f031" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="sound_8c_1ae35f5844602719cf66324f4de2a658b3" kindref="member">void</ref></type>
        <definition>static void psycho_4_trigtable_init</definition>
        <argsstring>(psycho_4_mem *p4mem)</argsstring>
        <name>psycho_4_trigtable_init</name>
        <param>
          <type><ref refid="twolame_2libtwolame_2common_8h_1a381a1c9329f866f3b831860984eb6710" kindref="member">psycho_4_mem</ref> *</type>
          <declname>p4mem</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c" line="97" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c" bodystart="97" bodyend="104"/>
      </memberdef>
      <memberdef kind="function" id="psycho__4_8c_1a0e8f5af47642b163bfa6ba61ffdea069" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref></type>
        <definition>static FLOAT psycho_4_spreading_function</definition>
        <argsstring>(FLOAT bark)</argsstring>
        <name>psycho_4_spreading_function</name>
        <param>
          <type><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref></type>
          <declname>bark</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c" line="127" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c" bodystart="127" bodyend="162"/>
      </memberdef>
      <memberdef kind="function" id="psycho__4_8c_1af5527c949039acd36b6ad70e4d84896e" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="twolame_2libtwolame_2common_8h_1a381a1c9329f866f3b831860984eb6710" kindref="member">psycho_4_mem</ref> *</type>
        <definition>static psycho_4_mem* psycho_4_init</definition>
        <argsstring>(twolame_options *glopts, int sfreq)</argsstring>
        <name>psycho_4_init</name>
        <param>
          <type><ref refid="twolame_8h_1a429c5c35b47d5d7cc34a07e48a82866d" kindref="member">twolame_options</ref> *</type>
          <declname>glopts</declname>
        </param>
        <param>
          <type><ref refid="xmltok_8h_1a5a0d4a5641ce434f1d23533f2b2e6653" kindref="member">int</ref></type>
          <declname>sfreq</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c" line="167" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c" bodystart="167" bodyend="296"/>
      </memberdef>
      <memberdef kind="function" id="psycho__4_8c_1a052e4621e8b7c3dafd61426dce2782c6" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="sound_8c_1ae35f5844602719cf66324f4de2a658b3" kindref="member">void</ref></type>
        <definition>void psycho_4</definition>
        <argsstring>(twolame_options *glopts, short int buffer[2][1152], short int savebuf[2][1056], FLOAT smr[2][32])</argsstring>
        <name>psycho_4</name>
        <param>
          <type><ref refid="twolame_8h_1a429c5c35b47d5d7cc34a07e48a82866d" kindref="member">twolame_options</ref> *</type>
          <declname>glopts</declname>
        </param>
        <param>
          <type>short <ref refid="xmltok_8h_1a5a0d4a5641ce434f1d23533f2b2e6653" kindref="member">int</ref></type>
          <declname>buffer</declname>
          <array>[2][1152]</array>
        </param>
        <param>
          <type>short <ref refid="xmltok_8h_1a5a0d4a5641ce434f1d23533f2b2e6653" kindref="member">int</ref></type>
          <declname>savebuf</declname>
          <array>[2][1056]</array>
        </param>
        <param>
          <type><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref></type>
          <declname>smr</declname>
          <array>[2][32]</array>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c" line="299" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c" bodystart="299" bodyend="546"/>
      </memberdef>
      <memberdef kind="function" id="psycho__4_8c_1a76ec4a9b9cf0df39527f6da9b15e1a82" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="sound_8c_1ae35f5844602719cf66324f4de2a658b3" kindref="member">void</ref></type>
        <definition>void psycho_4_deinit</definition>
        <argsstring>(psycho_4_mem **mem)</argsstring>
        <name>psycho_4_deinit</name>
        <param>
          <type><ref refid="twolame_2libtwolame_2common_8h_1a381a1c9329f866f3b831860984eb6710" kindref="member">psycho_4_mem</ref> **</type>
          <declname>mem</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c" line="549" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c" bodystart="549" bodyend="562"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/><sp/>TwoLAME:<sp/>an<sp/>optimized<sp/>MPEG<sp/>Audio<sp/>Layer<sp/>Two<sp/>encoder</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*<sp/><sp/>Copyright<sp/>(C)<sp/>2001-2004<sp/>Michael<sp/>Cheng</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>*<sp/><sp/>Copyright<sp/>(C)<sp/>2004-2006<sp/>The<sp/>TwoLAME<sp/>Project</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>*<sp/><sp/>This<sp/>library<sp/>is<sp/>free<sp/>software;<sp/>you<sp/>can<sp/>redistribute<sp/>it<sp/>and/or</highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>*<sp/><sp/>modify<sp/>it<sp/>under<sp/>the<sp/>terms<sp/>of<sp/>the<sp/>GNU<sp/>Lesser<sp/>General<sp/>Public</highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*<sp/><sp/>License<sp/>as<sp/>published<sp/>by<sp/>the<sp/>Free<sp/>Software<sp/>Foundation;<sp/>either</highlight></codeline>
<codeline lineno="10"><highlight class="comment"><sp/>*<sp/><sp/>version<sp/>2.1<sp/>of<sp/>the<sp/>License,<sp/>or<sp/>(at<sp/>your<sp/>option)<sp/>any<sp/>later<sp/>version.</highlight></codeline>
<codeline lineno="11"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="12"><highlight class="comment"><sp/>*<sp/><sp/>This<sp/>library<sp/>is<sp/>distributed<sp/>in<sp/>the<sp/>hope<sp/>that<sp/>it<sp/>will<sp/>be<sp/>useful,</highlight></codeline>
<codeline lineno="13"><highlight class="comment"><sp/>*<sp/><sp/>but<sp/>WITHOUT<sp/>ANY<sp/>WARRANTY;<sp/>without<sp/>even<sp/>the<sp/>implied<sp/>warranty<sp/>of</highlight></codeline>
<codeline lineno="14"><highlight class="comment"><sp/>*<sp/><sp/>MERCHANTABILITY<sp/>or<sp/>FITNESS<sp/>FOR<sp/>A<sp/>PARTICULAR<sp/>PURPOSE.<sp/><sp/>See<sp/>the<sp/>GNU</highlight></codeline>
<codeline lineno="15"><highlight class="comment"><sp/>*<sp/><sp/>Lesser<sp/>General<sp/>Public<sp/>License<sp/>for<sp/>more<sp/>details.</highlight></codeline>
<codeline lineno="16"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="17"><highlight class="comment"><sp/>*<sp/><sp/>You<sp/>should<sp/>have<sp/>received<sp/>a<sp/>copy<sp/>of<sp/>the<sp/>GNU<sp/>Lesser<sp/>General<sp/>Public</highlight></codeline>
<codeline lineno="18"><highlight class="comment"><sp/>*<sp/><sp/>License<sp/>along<sp/>with<sp/>this<sp/>library;<sp/>if<sp/>not,<sp/>write<sp/>to<sp/>the<sp/>Free<sp/>Software</highlight></codeline>
<codeline lineno="19"><highlight class="comment"><sp/>*<sp/><sp/>Foundation,<sp/>Inc.,<sp/>59<sp/>Temple<sp/>Place,<sp/>Suite<sp/>330,<sp/>Boston,<sp/>MA<sp/><sp/>02111-1307<sp/><sp/>USA</highlight></codeline>
<codeline lineno="20"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="21"><highlight class="comment"><sp/>*<sp/><sp/>$Id$</highlight></codeline>
<codeline lineno="22"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="23"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdio.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdlib.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;math.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="twolame_8h" kindref="compound">twolame.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="twolame_2libtwolame_2common_8h" kindref="compound">common.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="twolame_2libtwolame_2mem_8h" kindref="compound">mem.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="lib-src_2twolame_2libtwolame_2fft_8h" kindref="compound">fft.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="ath_8h" kindref="compound">ath.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="psycho__4_8h" kindref="compound">psycho_4.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight><highlight class="comment">/****************************************************************</highlight></codeline>
<codeline lineno="38"><highlight class="comment">PSYCHO_4<sp/>by<sp/>MFC<sp/>Feb<sp/>2003</highlight></codeline>
<codeline lineno="39"><highlight class="comment"></highlight></codeline>
<codeline lineno="40"><highlight class="comment">This<sp/>is<sp/>a<sp/>cleaned<sp/>up<sp/>implementation<sp/>of<sp/>psy<sp/>model<sp/>2.</highlight></codeline>
<codeline lineno="41"><highlight class="comment">This<sp/>is<sp/>basically<sp/>because<sp/>I<sp/>was<sp/>sick<sp/>of<sp/>the<sp/>inconsistencies<sp/>between</highlight></codeline>
<codeline lineno="42"><highlight class="comment">the<sp/>notation<sp/>in<sp/>the<sp/>ISO<sp/>docs<sp/>and<sp/>in<sp/>the<sp/>sourcecode.</highlight></codeline>
<codeline lineno="43"><highlight class="comment"></highlight></codeline>
<codeline lineno="44"><highlight class="comment">I&apos;ve<sp/>nicked<sp/>a<sp/>bunch<sp/>of<sp/>stuff<sp/>from<sp/>LAME<sp/>to<sp/>make<sp/>this<sp/>a<sp/>bit<sp/>easier<sp/>to<sp/>grok</highlight></codeline>
<codeline lineno="45"><highlight class="comment">-<sp/>ATH<sp/>values<sp/>(this<sp/>also<sp/>overcomes<sp/>the<sp/>lack<sp/>of<sp/>mpeg-2<sp/>tables</highlight></codeline>
<codeline lineno="46"><highlight class="comment"><sp/><sp/>which<sp/>meant<sp/>that<sp/>LSF<sp/>never<sp/>had<sp/>proper<sp/>values)</highlight></codeline>
<codeline lineno="47"><highlight class="comment">-<sp/>ath_freq2bark()<sp/>to<sp/>convert<sp/>frequencies<sp/>directly<sp/>to<sp/>bark<sp/>values.</highlight></codeline>
<codeline lineno="48"><highlight class="comment">-<sp/>spreading_function()<sp/>isolated<sp/>the<sp/>calculation<sp/>of<sp/>the<sp/>spreading<sp/>function.</highlight></codeline>
<codeline lineno="49"><highlight class="comment"><sp/><sp/>Basically<sp/>the<sp/>same<sp/>code<sp/>as<sp/>before,<sp/>just<sp/>isolated<sp/>in<sp/>its<sp/>own<sp/>function.</highlight></codeline>
<codeline lineno="50"><highlight class="comment"><sp/><sp/>LAME<sp/>seem<sp/>to<sp/>does<sp/>some<sp/>extra<sp/>tweaks<sp/>to<sp/>the<sp/>ISO1117s<sp/>model.</highlight></codeline>
<codeline lineno="51"><highlight class="comment"><sp/><sp/>Not<sp/>really<sp/>sure<sp/>if<sp/>they<sp/>help<sp/>or<sp/>hinder,<sp/>so<sp/>I&apos;ve<sp/>commented<sp/>them<sp/>out<sp/>(#ifdef<sp/>LAME)</highlight></codeline>
<codeline lineno="52"><highlight class="comment"></highlight></codeline>
<codeline lineno="53"><highlight class="comment">NB:<sp/>Because<sp/>of<sp/>some<sp/>of<sp/>the<sp/>tweaks<sp/>to<sp/>bark<sp/>value<sp/>calculation<sp/>etc,<sp/>it<sp/>is<sp/>now<sp/>possible</highlight></codeline>
<codeline lineno="54"><highlight class="comment">to<sp/>have<sp/>64<sp/>CBANDS.<sp/>There&apos;s<sp/>no<sp/>real<sp/>limit<sp/>on<sp/>the<sp/>actual<sp/>number<sp/>of<sp/>paritions.<sp/></highlight></codeline>
<codeline lineno="55"><highlight class="comment">I<sp/>wonder<sp/>if<sp/>it&apos;s<sp/>worth<sp/>experimenting<sp/>with<sp/>really<sp/>higher<sp/>numbers?<sp/>Probably<sp/>won&apos;t<sp/>make</highlight></codeline>
<codeline lineno="56"><highlight class="comment">that<sp/>much<sp/>difference<sp/>to<sp/>the<sp/>final<sp/>SNR<sp/>values,<sp/>but<sp/>it&apos;s<sp/>something<sp/>worth<sp/>trying</highlight></codeline>
<codeline lineno="57"><highlight class="comment"><sp/><sp/><sp/><sp/>Maybe<sp/>CBANDS<sp/>should<sp/>be<sp/>a<sp/>dynamic<sp/>value,<sp/>calculated<sp/>by<sp/>the<sp/>psycho_init<sp/>function</highlight></codeline>
<codeline lineno="58"><highlight class="comment"><sp/><sp/><sp/><sp/>CBANDS<sp/>definition<sp/>has<sp/>been<sp/>changed<sp/>in<sp/>encoder.h<sp/>from<sp/>63<sp/>to<sp/>64</highlight></codeline>
<codeline lineno="59"><highlight class="comment"></highlight></codeline>
<codeline lineno="60"><highlight class="comment">****************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>The<sp/>static<sp/>variables<sp/>&quot;r&quot;,<sp/>&quot;phi_sav&quot;,<sp/>&quot;new&quot;,<sp/>&quot;old&quot;<sp/>and<sp/>&quot;oldest&quot;<sp/>have<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="64"><highlight class="comment"><sp/>to<sp/>be<sp/>remembered<sp/>for<sp/>the<sp/>unpredictability<sp/>measure.<sp/><sp/>For<sp/>&quot;r&quot;<sp/>and<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="65"><highlight class="comment"><sp/>&quot;phi_sav&quot;,<sp/>the<sp/>first<sp/>index<sp/>from<sp/>the<sp/>left<sp/>is<sp/>the<sp/>channel<sp/>select<sp/>and<sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="66"><highlight class="comment"><sp/>the<sp/>second<sp/>index<sp/>is<sp/>the<sp/>&quot;age&quot;<sp/>of<sp/>the<sp/>data.<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>NMT<sp/>is<sp/>a<sp/>constant<sp/>5.5dB.<sp/>ISO11172<sp/>Sec<sp/>D.2.4.h<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>NMT<sp/>=<sp/>5.5;</highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>The<sp/>index<sp/>into<sp/>this<sp/>array<sp/>is<sp/>a<sp/>bark<sp/>value<sp/></highlight></codeline>
<codeline lineno="73"><highlight class="comment"><sp/><sp/><sp/>This<sp/>array<sp/>gives<sp/>the<sp/>&apos;minval&apos;<sp/>values<sp/>from<sp/>ISO11172<sp/>Tables<sp/>D.3.x<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>minval[27]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/>0.0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>bark<sp/>=<sp/>0<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/>20.0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>1<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/>20.0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/>20.0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>3<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/>20.0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>4<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="80"><highlight class="normal"><sp/><sp/><sp/><sp/>20.0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>5<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/>17.0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>6<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/>15.0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>7<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/>10.0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>8<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/>7.0,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>9<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="85"><highlight class="normal"><sp/><sp/><sp/><sp/>4.4,<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>10<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/>4.5,<sp/>4.5,<sp/>4.5,<sp/>4.5,<sp/>4.5,<sp/>4.5,<sp/>4.5,<sp/>4.5,<sp/>4.5,<sp/>4.5,<sp/>4.5,<sp/>4.5,<sp/>4.5,<sp/>4.5,<sp/>4.5,<sp/><sp/></highlight><highlight class="comment">/*<sp/>11<sp/>-<sp/>25<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="87"><highlight class="normal"><sp/><sp/><sp/><sp/>3.5<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>26<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal">};</highlight></codeline>
<codeline lineno="89"><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Table<sp/>covers<sp/>angles<sp/>from<sp/><sp/>0<sp/>to<sp/>TRIGTABLESIZE/TRIGTABLESCALE<sp/>(3.142)<sp/>radians<sp/></highlight></codeline>
<codeline lineno="92"><highlight class="comment"><sp/><sp/><sp/>In<sp/>steps<sp/>of<sp/>1/TRIGTABLESCALE<sp/>(0.0005)<sp/>radians.<sp/></highlight></codeline>
<codeline lineno="93"><highlight class="comment"><sp/><sp/><sp/>Largest<sp/>absolute<sp/>error:<sp/>0.0005</highlight></codeline>
<codeline lineno="94"><highlight class="comment"><sp/><sp/><sp/>Only<sp/>create<sp/>a<sp/>table<sp/>for<sp/>cos,<sp/>and<sp/>then<sp/>use<sp/>trig<sp/>to<sp/>work<sp/>out<sp/>sin.</highlight></codeline>
<codeline lineno="95"><highlight class="comment"><sp/><sp/><sp/>sin(theta)<sp/>=<sp/>cos(PI/2<sp/>-<sp/>theta)</highlight></codeline>
<codeline lineno="96"><highlight class="comment"><sp/><sp/><sp/>MFC<sp/>March<sp/>2003<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>psycho_4_trigtable_init(<ref refid="structpsycho__4__mem__struct" kindref="compound">psycho_4_mem</ref><sp/>*<sp/>p4mem)</highlight></codeline>
<codeline lineno="98"><highlight class="normal">{</highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1adfa865ba6b0b06ecc2fc60460fdabef9" kindref="member">TRIGTABLESIZE</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p4mem-&gt;<ref refid="structpsycho__4__mem__struct_1a0f9893040c375b8037449ffadb17729d" kindref="member">cos_table</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/><ref refid="pffft_8c_1a57a66355e043ccefc17aca9338a2b748" kindref="member">cos</ref>((<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>i<sp/>/<sp/><ref refid="twolame_2libtwolame_2common_8h_1a3001eb8f5885b9d81de557bc1b8f1a2a" kindref="member">TRIGTABLESCALE</ref>);</highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="104"><highlight class="normal">}</highlight></codeline>
<codeline lineno="105"><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>NEWTAN</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>psycho_4_cos(<ref refid="structpsycho__4__mem__struct" kindref="compound">psycho_4_mem</ref><sp/>*<sp/>p4mem,<sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>phi)</highlight></codeline>
<codeline lineno="108"><highlight class="normal">{</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>index;</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>sign<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="111"><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/>index<sp/>=<sp/>(<ref refid="lib_2expat_8h_1a14bb8924daea0b48c7803f281f66e390" kindref="member">int</ref>)<sp/>(fabs(phi)<sp/>*<sp/><ref refid="twolame_2libtwolame_2common_8h_1a3001eb8f5885b9d81de557bc1b8f1a2a" kindref="member">TRIGTABLESCALE</ref>);</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(index<sp/>&gt;=<sp/>TRIGTABLESIZE)<sp/>{</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>If<sp/>we&apos;re<sp/>larger<sp/>than<sp/>PI,<sp/>then<sp/>subtract<sp/>PI<sp/>until<sp/>we<sp/>aren&apos;t<sp/>each<sp/>time<sp/>the<sp/>sign<sp/>will<sp/>flip<sp/>-<sp/></highlight></codeline>
<codeline lineno="115"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Year<sp/>11<sp/>trig<sp/>again.<sp/>MFC<sp/>March<sp/>2003<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>index<sp/>-=<sp/><ref refid="twolame_2libtwolame_2common_8h_1adfa865ba6b0b06ecc2fc60460fdabef9" kindref="member">TRIGTABLESIZE</ref>;</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sign<sp/>*=<sp/>-1;</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(sign<sp/>*<sp/>p4mem-&gt;<ref refid="structpsycho__4__mem__struct_1a0f9893040c375b8037449ffadb17729d" kindref="member">cos_table</ref>[index]);</highlight></codeline>
<codeline lineno="120"><highlight class="normal">}</highlight></codeline>
<codeline lineno="121"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>The<sp/>spreading<sp/>function.<sp/><sp/>Values<sp/>returned<sp/>in<sp/>units<sp/>of<sp/>energy</highlight></codeline>
<codeline lineno="124"><highlight class="comment"><sp/><sp/><sp/>Argument<sp/>&apos;bark&apos;<sp/>is<sp/>the<sp/>difference<sp/>in<sp/>bark<sp/>values<sp/>between<sp/>the</highlight></codeline>
<codeline lineno="125"><highlight class="comment"><sp/><sp/><sp/>centre<sp/>of<sp/>two<sp/>partitions.</highlight></codeline>
<codeline lineno="126"><highlight class="comment"><sp/><sp/><sp/>This<sp/>has<sp/>been<sp/>taken<sp/>from<sp/>LAME.<sp/>MFC<sp/>Feb<sp/>2003<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>psycho_4_spreading_function(<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>bark)</highlight></codeline>
<codeline lineno="128"><highlight class="normal">{</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>tempx,<sp/><ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>,<sp/>tempy,<sp/>temp;</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/>tempx<sp/>=<sp/>bark;</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>LAME</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>MP3<sp/>standard<sp/>actually<sp/>spreads<sp/>these<sp/>values<sp/>a<sp/>little<sp/>more<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tempx<sp/>&gt;=<sp/>0)</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tempx<sp/>*=<sp/>3;</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tempx<sp/>*=<sp/>1.5;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"></highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tempx<sp/>&gt;=<sp/>0.5<sp/>&amp;&amp;<sp/>tempx<sp/>&lt;=<sp/>2.5)<sp/>{</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>temp<sp/>=<sp/>tempx<sp/>-<sp/>0.5;</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x<sp/>=<sp/>8.0<sp/>*<sp/>(temp<sp/>*<sp/>temp<sp/>-<sp/>2.0<sp/>*<sp/>temp);</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/>tempx<sp/>+=<sp/>0.474;</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/>tempy<sp/>=<sp/>15.811389<sp/>+<sp/>7.5<sp/>*<sp/>tempx<sp/>-<sp/>17.5<sp/>*<sp/>sqrt(1.0<sp/>+<sp/>tempx<sp/>*<sp/>tempx);</highlight></codeline>
<codeline lineno="147"><highlight class="normal"></highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tempy<sp/>&lt;=<sp/>-60.0)</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0.0;</highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/>tempx<sp/>=<sp/>exp((x<sp/>+<sp/>tempy)<sp/>*<sp/><ref refid="twolame_2libtwolame_2common_8h_1a9af5476dc4c04040d76614151b1e59fa" kindref="member">LN_TO_LOG10</ref>);</highlight></codeline>
<codeline lineno="152"><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>LAME</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>I&apos;m<sp/>not<sp/>sure<sp/>where<sp/>the<sp/>magic<sp/>value<sp/>of<sp/>0.6609193<sp/>comes<sp/>from.<sp/>twolame<sp/>will<sp/>just<sp/>keep<sp/>using<sp/>the<sp/></highlight></codeline>
<codeline lineno="155"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rnorm<sp/>to<sp/>normalise<sp/>the<sp/>spreading<sp/>function<sp/>MFC<sp/>Feb<sp/>2003<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Normalization.<sp/><sp/>The<sp/>spreading<sp/>function<sp/>should<sp/>be<sp/>normalized<sp/>so<sp/>that:<sp/>+inf<sp/>/<sp/>|<sp/>s3<sp/>[<sp/>bark<sp/>]</highlight></codeline>
<codeline lineno="157"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>d(bark)<sp/>=<sp/>1<sp/>/<sp/>-inf<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="158"><highlight class="normal"><sp/><sp/><sp/><sp/>tempx<sp/>/=<sp/>.6609193;</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>tempx;</highlight></codeline>
<codeline lineno="161"><highlight class="normal"></highlight></codeline>
<codeline lineno="162"><highlight class="normal">}</highlight></codeline>
<codeline lineno="163"><highlight class="normal"></highlight></codeline>
<codeline lineno="164"><highlight class="normal"></highlight><highlight class="comment">/********************************</highlight></codeline>
<codeline lineno="165"><highlight class="comment"><sp/>*<sp/>init<sp/>psycho<sp/>model<sp/>2</highlight></codeline>
<codeline lineno="166"><highlight class="comment"><sp/>********************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="structpsycho__4__mem__struct" kindref="compound">psycho_4_mem</ref><sp/>*psycho_4_init(<ref refid="structtwolame__options__struct" kindref="compound">twolame_options</ref><sp/>*<sp/>glopts,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>sfreq)</highlight></codeline>
<codeline lineno="168"><highlight class="normal">{</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structpsycho__4__mem__struct" kindref="compound">psycho_4_mem</ref><sp/>*mem;</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>*cbval,<sp/>*rnorm;</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>*window;</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>bark[<ref refid="twolame_2libtwolame_2common_8h_1a47a92e637e9159058c2f71d7c3999504" kindref="member">HBLKSIZE</ref>],<sp/>*ath;</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*numlines;</highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*partition;</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1a3d9dc084b73bea99586a00cfaa72538b" kindref="member">FCB</ref><sp/>*<ref refid="lib_2expat_8h_1a755339d27872b13735c2cab829e47157" kindref="member">s</ref>;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>*tmn;</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>,<sp/>j;</highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mem<sp/>=<sp/>(<ref refid="structpsycho__4__mem__struct" kindref="compound">psycho_4_mem</ref><sp/>*)<sp/><ref refid="twolame_2libtwolame_2mem_8h_1a5c998cfb7ed77f0c7967b685235f8ba5" kindref="member">TWOLAME_MALLOC</ref>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="structpsycho__4__mem__struct" kindref="compound">psycho_4_mem</ref>));</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a1fc30790e9beec1cf1abb609e3829760" kindref="member">tmn</ref><sp/>=<sp/>(<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>*)<sp/><ref refid="twolame_2libtwolame_2mem_8h_1a5c998cfb7ed77f0c7967b685235f8ba5" kindref="member">TWOLAME_MALLOC</ref>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="twolame_2libtwolame_2common_8h_1abd0d6a3bb5d3083c9ba5a2b5e4e2cf2e" kindref="member">DCB</ref>));</highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1af40efc0e42b72a8e4d13485bce3dd689" kindref="member">s</ref><sp/>=<sp/>(<ref refid="twolame_2libtwolame_2common_8h_1a3d9dc084b73bea99586a00cfaa72538b" kindref="member">FCB</ref><sp/>*)<sp/><ref refid="twolame_2libtwolame_2mem_8h_1a5c998cfb7ed77f0c7967b685235f8ba5" kindref="member">TWOLAME_MALLOC</ref>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="twolame_2libtwolame_2common_8h_1a906e0e04ca0efba4451ec66ed180857a" kindref="member">FCBCB</ref>));</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a54e6e8825d804d8d1ee5fe57c4d50987" kindref="member">lthr</ref><sp/>=<sp/>(<ref refid="twolame_2libtwolame_2common_8h_1a9e3f271cb1464315bf91398cf881250b" kindref="member">FHBLK</ref><sp/>*)<sp/><ref refid="twolame_2libtwolame_2mem_8h_1a5c998cfb7ed77f0c7967b685235f8ba5" kindref="member">TWOLAME_MALLOC</ref>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="twolame_2libtwolame_2common_8h_1a49007511dde08cf2951047241f993616" kindref="member">F2HBLK</ref>));</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1ad985c21405eda4edbfb52d5c6e7635c6" kindref="member">r</ref><sp/>=<sp/>(<ref refid="twolame_2libtwolame_2common_8h_1a49007511dde08cf2951047241f993616" kindref="member">F2HBLK</ref><sp/>*)<sp/><ref refid="twolame_2libtwolame_2mem_8h_1a5c998cfb7ed77f0c7967b685235f8ba5" kindref="member">TWOLAME_MALLOC</ref>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="twolame_2libtwolame_2common_8h_1a53e50c531d025c63536c56f60c009fcf" kindref="member">F22HBLK</ref>));</highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1aa9f7126ea15c90ee98d33d2f6f7d4219" kindref="member">phi_sav</ref><sp/>=<sp/>(<ref refid="twolame_2libtwolame_2common_8h_1a49007511dde08cf2951047241f993616" kindref="member">F2HBLK</ref><sp/>*)<sp/><ref refid="twolame_2libtwolame_2mem_8h_1a5c998cfb7ed77f0c7967b685235f8ba5" kindref="member">TWOLAME_MALLOC</ref>(</highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="twolame_2libtwolame_2common_8h_1a53e50c531d025c63536c56f60c009fcf" kindref="member">F22HBLK</ref>));</highlight></codeline>
<codeline lineno="187"><highlight class="normal"></highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a2426debb5736e2849a2e10410a5b2836" kindref="member">new</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1aa418be00038817732da782b827154044" kindref="member">old</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a555b66decbf67bb6c62d4002c6cd9e54" kindref="member">oldest</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="192"><highlight class="normal"></highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cbval<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1ac1a5c37925f4dc4910003541bef8c7ec" kindref="member">cbval</ref>;</highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rnorm<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a7d24342cee04af462780992f896df9ce" kindref="member">rnorm</ref>;</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>window<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a206261544c47929c8ee055934b491d2d" kindref="member">window</ref>;</highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>bark<sp/>=<sp/>mem-&gt;bark;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ath<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a505d059dfef947375375adb9c667c57b" kindref="member">ath</ref>;</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numlines<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a17495ef0e7a3533e5c03f03ff6d39ff6" kindref="member">numlines</ref>;</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>partition<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1afb676fffd61570099fbefc1c21cec027" kindref="member">partition</ref>;</highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>s<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1af40efc0e42b72a8e4d13485bce3dd689" kindref="member">s</ref>;</highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tmn<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a1fc30790e9beec1cf1abb609e3829760" kindref="member">tmn</ref>;</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="204"><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Set<sp/>up<sp/>the<sp/>SIN/COS<sp/>tables<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/>psycho_4_trigtable_init(mem);</highlight></codeline>
<codeline lineno="208"><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>calculate<sp/>HANN<sp/>window<sp/>coefficients<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1ac4551bbc9efabf8378f35498f80b4679" kindref="member">BLKSIZE</ref>;<sp/>i++)</highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>window[i]<sp/>=<sp/>0.5<sp/>*<sp/>(1<sp/>-<sp/><ref refid="pffft_8c_1a57a66355e043ccefc17aca9338a2b748" kindref="member">cos</ref>(2.0<sp/>*<sp/><ref refid="fftr4_8c_1a598a3330b3c21701223ee0ca14316eca" kindref="member">PI</ref><sp/>*<sp/>(i<sp/>-<sp/>0.5)<sp/>/<sp/>BLKSIZE));</highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>For<sp/>each<sp/>FFT<sp/>line<sp/>from<sp/>0(DC)<sp/>to<sp/>512(Nyquist)<sp/>calculate<sp/>-<sp/>bark<sp/>:<sp/>the<sp/>bark<sp/>value<sp/>of<sp/>this<sp/>fft</highlight></codeline>
<codeline lineno="214"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>line<sp/>-<sp/>ath<sp/>:<sp/>the<sp/>absolute<sp/>threshold<sp/>of<sp/>hearing<sp/>for<sp/>this<sp/>line<sp/>[ATH]</highlight></codeline>
<codeline lineno="215"><highlight class="comment"></highlight></codeline>
<codeline lineno="216"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Since<sp/>it<sp/>is<sp/>a<sp/>1024<sp/>point<sp/>FFT,<sp/>each<sp/>line<sp/>in<sp/>the<sp/>fft<sp/>corresponds<sp/>to<sp/>1/1024<sp/>of<sp/>the<sp/>total</highlight></codeline>
<codeline lineno="217"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>frequency.<sp/>Line<sp/>0<sp/>should<sp/>correspond<sp/>to<sp/>DC<sp/>-<sp/>which<sp/>doesn&apos;t<sp/>really<sp/>have<sp/>a<sp/>ATH<sp/>afaik<sp/>Line<sp/>1</highlight></codeline>
<codeline lineno="218"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>should<sp/>be<sp/>1/1024th<sp/>of<sp/>the<sp/>Sampling<sp/>Freq<sp/>Line<sp/>512<sp/>should<sp/>be<sp/>the<sp/>nyquist<sp/>freq<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1a47a92e637e9159058c2f71d7c3999504" kindref="member">HBLKSIZE</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>freq<sp/>=<sp/>i<sp/>*<sp/>(<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>sfreq<sp/>/<sp/>(<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>BLKSIZE;</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bark[i]<sp/>=<sp/><ref refid="ath_8c_1a2c65476c7fea25d637fdb69baf11e7ff" kindref="member">ath_freq2bark</ref>(freq);</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>The<sp/>ath<sp/>tables<sp/>in<sp/>the<sp/>dist10<sp/>code<sp/>seem<sp/>to<sp/>be<sp/>a<sp/>little<sp/>out<sp/>of<sp/>kilter.<sp/>they<sp/>seem<sp/>to<sp/>start</highlight></codeline>
<codeline lineno="223"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>with<sp/>index<sp/>0<sp/>corresponding<sp/>to<sp/>(sampling<sp/>freq)/1024.<sp/>When<sp/>in<sp/>doubt,<sp/>i&apos;m<sp/>going<sp/>to<sp/>assume</highlight></codeline>
<codeline lineno="224"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>that<sp/>the<sp/>dist10<sp/>code<sp/>is<sp/>wrong.<sp/>MFC<sp/>Feb2003<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ath[i]<sp/>=<sp/><ref refid="ath_8c_1ad0b61a7dbbf4c4851cff4d8ef28b3320" kindref="member">ath_energy</ref>(freq,<sp/>glopts-&gt;athlevel);</highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>fprintf(stderr,&quot;%.2f<sp/>&quot;,ath[i]);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="228"><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Work<sp/>out<sp/>the<sp/>partitions<sp/>Starting<sp/>from<sp/>line<sp/>0,<sp/>all<sp/>lines<sp/>within<sp/>0.33<sp/>of<sp/>the<sp/>starting<sp/>bark<sp/>are<sp/></highlight></codeline>
<codeline lineno="231"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>added<sp/>to<sp/>the<sp/>same<sp/>partition.<sp/>When<sp/>a<sp/>line<sp/>is<sp/>greater<sp/>by<sp/>0.33<sp/>of<sp/>a<sp/>bark,<sp/>start<sp/>a<sp/>new</highlight></codeline>
<codeline lineno="232"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>partition.<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>partition_count<sp/>=<sp/>0;<sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>keep<sp/>a<sp/>count<sp/>of<sp/>the<sp/>partitions<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>cbase<sp/>=<sp/>0;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>current<sp/>base<sp/>index<sp/>for<sp/>the<sp/>bark<sp/>range<sp/>calculation<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1a47a92e637e9159058c2f71d7c3999504" kindref="member">HBLKSIZE</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="237"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((bark[i]<sp/>-<sp/>bark[cbase])<sp/>&gt;<sp/>0.33)<sp/>{<sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>1/3<sp/>critical<sp/>band?<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>this<sp/>frequency<sp/>line<sp/>is<sp/>too<sp/>different<sp/>from<sp/>the<sp/>starting<sp/>line,<sp/>(in<sp/>terms<sp/>of<sp/>the</highlight></codeline>
<codeline lineno="239"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bark<sp/>distance)<sp/>so<sp/>close<sp/>that<sp/>previous<sp/>partition,<sp/>and<sp/>make<sp/>this<sp/>line<sp/>the<sp/>first</highlight></codeline>
<codeline lineno="240"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>member<sp/>of<sp/>the<sp/>next<sp/>partition<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cbase<sp/>=<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;<sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Start<sp/>the<sp/>new<sp/>partition<sp/>from<sp/>this<sp/>frequency<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>partition_count++;</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>partition[i]<sp/>tells<sp/>us<sp/>which<sp/>partition<sp/>the<sp/>i&apos;th<sp/>frequency<sp/>line<sp/>is<sp/>in<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>partition[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/>partition_count;</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>keep<sp/>a<sp/>count<sp/>of<sp/>how<sp/>many<sp/>frequency<sp/>lines<sp/>are<sp/>in<sp/>each<sp/>partition<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numlines[partition_count]++;</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="250"><highlight class="normal"></highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>For<sp/>each<sp/>partition<sp/>within<sp/>the<sp/>frequency<sp/>space,<sp/>calculate<sp/>the<sp/>average<sp/>bark<sp/>value<sp/>-<sp/>cbval</highlight></codeline>
<codeline lineno="252"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[central<sp/>bark<sp/>value]<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1a47a92e637e9159058c2f71d7c3999504" kindref="member">HBLKSIZE</ref>;<sp/>i++)</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cbval[partition[i]]<sp/>+=<sp/>bark[i];<sp/></highlight><highlight class="comment">/*<sp/>sum<sp/>up<sp/>all<sp/>the<sp/>bark<sp/>values<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1aac671256f124a8c00bd22ac15a337d0d" kindref="member">CBANDS</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(numlines[i]<sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cbval[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>/=<sp/>numlines[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>];<sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>divide<sp/>by<sp/>the<sp/>number<sp/>of<sp/>values<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cbval[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/>0;<sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>this<sp/>isn&apos;t<sp/>a<sp/>partition<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Calculate<sp/>the<sp/>spreading<sp/>function.<sp/>ISO<sp/>11172<sp/>Section<sp/>D.2.3<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1aac671256f124a8c00bd22ac15a337d0d" kindref="member">CBANDS</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1aac671256f124a8c00bd22ac15a337d0d" kindref="member">CBANDS</ref>;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>s[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>][j]<sp/>=<sp/>psycho_4_spreading_function(1.05<sp/>*<sp/>(cbval[i]<sp/>-<sp/>cbval[j]));</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rnorm[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>+=<sp/>s[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>][j];<sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>sum<sp/>the<sp/>spreading<sp/>function<sp/>values<sp/>for<sp/>each<sp/>partition<sp/>so<sp/>that</highlight></codeline>
<codeline lineno="269"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>they<sp/>can<sp/>be<sp/>normalised<sp/>later<sp/>on<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="272"><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Calculate<sp/>Tone<sp/>Masking<sp/>Noise<sp/>values.<sp/>ISO<sp/>11172<sp/>Tables<sp/>D.3.x<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1aac671256f124a8c00bd22ac15a337d0d" kindref="member">CBANDS</ref>;<sp/>j++)</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tmn[j]<sp/>=<sp/><ref refid="libflac_2src_2lib_f_l_a_c_2include_2private_2macros_8h_1aacc3ee1a7f283f8ef65cea31f4436a95" kindref="member">MAX</ref>(15.5<sp/>+<sp/>cbval[j],<sp/>24.5);</highlight></codeline>
<codeline lineno="276"><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(glopts-&gt;<ref refid="structtwolame__options__struct_1a85004829f276bc6adf993ff2cb3f3fd2" kindref="member">verbosity</ref><sp/>&gt;<sp/>6)<sp/>{</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Dump<sp/>All<sp/>the<sp/>Values<sp/>to<sp/>STDERR<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>wlow,<sp/>whigh<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>ntot<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(<ref refid="namespacewaflib_1_1ansiterm_1a44bedfddf1392d636441272f5f3c95d4" kindref="member">stderr</ref>,<sp/></highlight><highlight class="stringliteral">&quot;psy<sp/>model<sp/>4<sp/>init\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(<ref refid="namespacewaflib_1_1ansiterm_1a44bedfddf1392d636441272f5f3c95d4" kindref="member">stderr</ref>,<sp/></highlight><highlight class="stringliteral">&quot;index<sp/>\tnlines<sp/>\twlow<sp/>\twhigh<sp/>\tbval<sp/>\tminval<sp/>\ttmn\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1aac671256f124a8c00bd22ac15a337d0d" kindref="member">CBANDS</ref>;<sp/>i++)</highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(numlines[i]<sp/>!=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wlow<sp/>=<sp/>whigh<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>whigh<sp/>=<sp/>wlow<sp/>+<sp/>numlines[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(<ref refid="namespacewaflib_1_1ansiterm_1a44bedfddf1392d636441272f5f3c95d4" kindref="member">stderr</ref>,<sp/></highlight><highlight class="stringliteral">&quot;%i<sp/>\t%i<sp/>\t%i<sp/>\t%i<sp/>\t%5.2f<sp/>\t%4.2f<sp/>\t%4.2f\n&quot;</highlight><highlight class="normal">,<sp/>i<sp/>+<sp/>1,<sp/>numlines[i],</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wlow,<sp/>whigh,<sp/>cbval[i],<sp/>minval[(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>cbval[i]],<sp/>tmn[i]);</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ntot<sp/>+=<sp/>numlines[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>];</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(<ref refid="namespacewaflib_1_1ansiterm_1a44bedfddf1392d636441272f5f3c95d4" kindref="member">stderr</ref>,<sp/></highlight><highlight class="stringliteral">&quot;total<sp/>lines<sp/>%i\n&quot;</highlight><highlight class="normal">,<sp/>ntot);</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="294"><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(mem);</highlight></codeline>
<codeline lineno="296"><highlight class="normal">}</highlight></codeline>
<codeline lineno="297"><highlight class="normal"></highlight></codeline>
<codeline lineno="298"><highlight class="normal"></highlight></codeline>
<codeline lineno="299" refid="psycho__4_8h_1a052e4621e8b7c3dafd61426dce2782c6" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="psycho__4_8c_1a052e4621e8b7c3dafd61426dce2782c6" kindref="member">psycho_4</ref>(<ref refid="structtwolame__options__struct" kindref="compound">twolame_options</ref><sp/>*<sp/>glopts,</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="structbuffer" kindref="compound">buffer</ref>[2][1152],<sp/></highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>savebuf[2][1056],<sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>smr[2][32])</highlight></codeline>
<codeline lineno="301"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>to<sp/>match<sp/>prototype<sp/>:<sp/>FLOAT<sp/>args<sp/>are<sp/>always<sp/>FLOAT<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal">{</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="structpsycho__4__mem__struct" kindref="compound">psycho_4_mem</ref><sp/>*mem;</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">unsigned</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="namespacewaflib_1_1_task_1a859c6336afe027ae782f84b9e49a4f0f" kindref="member">run</ref>,<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>,<sp/>j,<sp/><ref refid="rfft2d_test_m_l_8m_1adc468c70fb574ebd07287b38d0d0676d" kindref="member">k</ref>,<sp/>ch;</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>r_prime,<sp/>phi_prime;</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>npart,<sp/>epart;</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal">,<sp/><ref refid="namespacewaflib_1_1_utils_1ac5e167303eb0d1a7a20df3daf91a264c" kindref="member">old</ref>,<sp/>oldest;</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>*grouped_c,<sp/>*grouped_e;</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>*nb,<sp/>*cb,<sp/>*tb,<sp/>*ecb,<sp/>*bc;</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>*cbval,<sp/>*rnorm;</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>*wsamp_r,<sp/>*phi,<sp/>*energy,<sp/>*window;</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>*ath,<sp/>*thr,<sp/>*<ref refid="poly-fir_8h_1aafc737ea9ef91f59cf9acd287fb8d085" kindref="member">c</ref>;</highlight></codeline>
<codeline lineno="313"><highlight class="normal"></highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>*snrtmp[2];</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*numlines;</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*partition;</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>*tmn;</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1a3d9dc084b73bea99586a00cfaa72538b" kindref="member">FCB</ref><sp/>*<ref refid="lib_2expat_8h_1a755339d27872b13735c2cab829e47157" kindref="member">s</ref>;</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1a9e3f271cb1464315bf91398cf881250b" kindref="member">FHBLK</ref><sp/>*lthr;</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1a49007511dde08cf2951047241f993616" kindref="member">F2HBLK</ref><sp/>*r,<sp/>*phi_sav;</highlight></codeline>
<codeline lineno="321"><highlight class="normal"></highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nch<sp/>=<sp/>glopts-&gt;<ref refid="structtwolame__options__struct_1a5388d86ab861953b968b2ec81bda950f" kindref="member">num_channels_out</ref>;</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>sfreq<sp/>=<sp/>glopts-&gt;<ref refid="structtwolame__options__struct_1a6c0025d3edc48ae42a8f72fab21ce1a6" kindref="member">samplerate_out</ref>;</highlight></codeline>
<codeline lineno="324"><highlight class="normal"></highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!glopts-&gt;<ref refid="structtwolame__options__struct_1ae24effdce105e10aa58a549ae9f5f047" kindref="member">p4mem</ref>)<sp/>{</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>glopts-&gt;<ref refid="structtwolame__options__struct_1ae24effdce105e10aa58a549ae9f5f047" kindref="member">p4mem</ref><sp/>=<sp/>psycho_4_init(glopts,<sp/>sfreq);</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="328"><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/>mem<sp/>=<sp/>glopts-&gt;<ref refid="structtwolame__options__struct_1ae24effdce105e10aa58a549ae9f5f047" kindref="member">p4mem</ref>;</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>grouped_c<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a269e1259ce6539d93528320edb6e9682" kindref="member">grouped_c</ref>;</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>grouped_e<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1aec998268cf8863f5a8fcd48f2bf6e668" kindref="member">grouped_e</ref>;</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nb<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1adf524129f653a0c73be0fb13cb6ca861" kindref="member">nb</ref>;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cb<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a96fb801cb16f1fac801e2b8dd1ce9238" kindref="member">cb</ref>;</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tb<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1aa17ba0a8855521cd526a2e6f1ec300e1" kindref="member">tb</ref>;</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ecb<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1ad5938470bdfcb12c21b528c2d3ff3fd4" kindref="member">ecb</ref>;</highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bc<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1aac0b26e8bfd1a76562d5c6ac31fc3f40" kindref="member">bc</ref>;</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rnorm<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a7d24342cee04af462780992f896df9ce" kindref="member">rnorm</ref>;</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cbval<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1ac1a5c37925f4dc4910003541bef8c7ec" kindref="member">cbval</ref>;</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wsamp_r<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a10f952a4a983e440da46bce00197df8c" kindref="member">wsamp_r</ref>;</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>phi<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1ab7fe5c47f3a7a1dce15e971eec084a36" kindref="member">phi</ref>;</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>energy<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a63209fc562e8a0ce96032a3097b17f51" kindref="member">energy</ref>;</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>window<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a206261544c47929c8ee055934b491d2d" kindref="member">window</ref>;</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ath<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a505d059dfef947375375adb9c667c57b" kindref="member">ath</ref>;</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>thr<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1af85b244e64f5edcbbe2012b2c65ebfe2" kindref="member">thr</ref>;</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>c<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a0bfa1b466120ff56666908a4af2a903d" kindref="member">c</ref>;</highlight></codeline>
<codeline lineno="347"><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snrtmp[0]<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a13dea4787db56982acc3e64828304c75" kindref="member">snrtmp</ref>[0];</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snrtmp[1]<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a13dea4787db56982acc3e64828304c75" kindref="member">snrtmp</ref>[1];</highlight></codeline>
<codeline lineno="350"><highlight class="normal"></highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numlines<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a17495ef0e7a3533e5c03f03ff6d39ff6" kindref="member">numlines</ref>;</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>partition<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1afb676fffd61570099fbefc1c21cec027" kindref="member">partition</ref>;</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tmn<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a1fc30790e9beec1cf1abb609e3829760" kindref="member">tmn</ref>;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>s<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1af40efc0e42b72a8e4d13485bce3dd689" kindref="member">s</ref>;</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lthr<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a54e6e8825d804d8d1ee5fe57c4d50987" kindref="member">lthr</ref>;</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1ad985c21405eda4edbfb52d5c6e7635c6" kindref="member">r</ref>;</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>phi_sav<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1aa9f7126ea15c90ee98d33d2f6f7d4219" kindref="member">phi_sav</ref>;</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(ch<sp/>=<sp/>0;<sp/>ch<sp/>&lt;<sp/>nch;<sp/>ch++)<sp/>{</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(run<sp/>=<sp/>0;<sp/>run<sp/>&lt;<sp/>2;<sp/>run++)<sp/>{</highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Net<sp/>offset<sp/>is<sp/>480<sp/>samples<sp/>(1056-576)<sp/>for<sp/>layer<sp/>2;<sp/>this<sp/>is<sp/>because<sp/>one<sp/>must<sp/>stagger</highlight></codeline>
<codeline lineno="363"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>input<sp/>data<sp/>by<sp/>256<sp/>samples<sp/>to<sp/>synchronize<sp/>psychoacoustic<sp/>model<sp/>with<sp/>filter<sp/>bank</highlight></codeline>
<codeline lineno="364"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>outputs,<sp/>then<sp/>stagger<sp/>so<sp/>that<sp/>center<sp/>of<sp/>1024<sp/>FFT<sp/>window<sp/>lines<sp/>up<sp/>with<sp/>center<sp/>of<sp/>576</highlight></codeline>
<codeline lineno="365"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&quot;new&quot;<sp/>audio<sp/>samples.</highlight></codeline>
<codeline lineno="366"><highlight class="comment"></highlight></codeline>
<codeline lineno="367"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>flush<sp/>=<sp/>384*3.0/2.0;<sp/>=<sp/>576<sp/>syncsize<sp/>=<sp/>1056;<sp/>sync_flush<sp/>=<sp/>syncsize<sp/>-<sp/>flush;<sp/>480</highlight></codeline>
<codeline lineno="368"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BLKSIZE<sp/>=<sp/>1024<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>*bufferp<sp/>=<sp/>buffer[ch];</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>480;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>savebuf[ch][j]<sp/>=<sp/>savebuf[ch][j<sp/>+<sp/>576];</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wsamp_r[j]<sp/>=<sp/>window[j]<sp/>*<sp/>((<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>savebuf[ch][j]);</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(;<sp/>j<sp/>&lt;<sp/>1024;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>savebuf[ch][j]<sp/>=<sp/>*bufferp++;</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>wsamp_r[j]<sp/>=<sp/>window[j]<sp/>*<sp/>((<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>savebuf[ch][j]);</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(;<sp/>j<sp/>&lt;<sp/>1056;<sp/>j++)</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>savebuf[ch][j]<sp/>=<sp/>*bufferp++;</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="382"><highlight class="normal"></highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Compute<sp/>FFT<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2fft_8c_1a59e464a815b7db63532326cc15f4ae5b" kindref="member">psycho_2_fft</ref>(wsamp_r,<sp/>energy,<sp/>phi);</highlight></codeline>
<codeline lineno="385"><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>calculate<sp/>the<sp/>unpredictability<sp/>measure,<sp/>given<sp/>energy[f]<sp/>and<sp/>phi[f]<sp/>(the<sp/>age<sp/>pointers<sp/></highlight></codeline>
<codeline lineno="387"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[new/old/oldest]<sp/>are<sp/>reset<sp/>automatically<sp/>on<sp/>the<sp/>second<sp/>pass<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mem-&gt;<ref refid="structpsycho__4__mem__struct_1a2426debb5736e2849a2e10410a5b2836" kindref="member">new</ref><sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a2426debb5736e2849a2e10410a5b2836" kindref="member">new</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a555b66decbf67bb6c62d4002c6cd9e54" kindref="member">oldest</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="392"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a2426debb5736e2849a2e10410a5b2836" kindref="member">new</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a555b66decbf67bb6c62d4002c6cd9e54" kindref="member">oldest</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mem-&gt;<ref refid="structpsycho__4__mem__struct_1aa418be00038817732da782b827154044" kindref="member">old</ref><sp/>==<sp/>0)</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1aa418be00038817732da782b827154044" kindref="member">old</ref><sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="398"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="399"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1aa418be00038817732da782b827154044" kindref="member">old</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>old<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1aa418be00038817732da782b827154044" kindref="member">old</ref>;</highlight></codeline>
<codeline lineno="402"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">new</highlight><highlight class="normal"><sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a2426debb5736e2849a2e10410a5b2836" kindref="member">new</ref>;</highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>oldest<sp/>=<sp/>mem-&gt;<ref refid="structpsycho__4__mem__struct_1a555b66decbf67bb6c62d4002c6cd9e54" kindref="member">oldest</ref>;</highlight></codeline>
<codeline lineno="404"><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1a47a92e637e9159058c2f71d7c3999504" kindref="member">HBLKSIZE</ref>;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="407"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>NEWATAN</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>temp1,<sp/>temp2,<sp/>temp3;</highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r_prime<sp/>=<sp/>2.0<sp/>*<sp/>r[ch][<ref refid="namespacewaflib_1_1_utils_1ac5e167303eb0d1a7a20df3daf91a264c" kindref="member">old</ref>][j]<sp/>-<sp/>r[ch][oldest][j];</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>phi_prime<sp/>=<sp/>2.0<sp/>*<sp/>phi_sav[ch][<ref refid="namespacewaflib_1_1_utils_1ac5e167303eb0d1a7a20df3daf91a264c" kindref="member">old</ref>][j]<sp/>-<sp/>phi_sav[ch][oldest][j];</highlight></codeline>
<codeline lineno="411"><highlight class="normal"></highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r[ch][</highlight><highlight class="keyword">new</highlight><highlight class="normal">][j]<sp/>=<sp/>sqrt((<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>energy[j]);</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>phi_sav[ch][</highlight><highlight class="keyword">new</highlight><highlight class="normal">][j]<sp/>=<sp/>phi[j];</highlight></codeline>
<codeline lineno="414"><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>{</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>temp1<sp/>=</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r[ch][</highlight><highlight class="keyword">new</highlight><highlight class="normal">][j]<sp/>*<sp/>psycho_4_cos(mem,<sp/>phi[j])<sp/>-</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r_prime<sp/>*<sp/>psycho_4_cos(mem,<sp/>phi_prime);</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Remember<sp/>your<sp/>grade<sp/>11<sp/>trig?<sp/>sin(theta)<sp/>=<sp/>cos(PI/2<sp/>-<sp/>theta)<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>temp2<sp/>=</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r[ch][</highlight><highlight class="keyword">new</highlight><highlight class="normal">][j]<sp/>*<sp/>psycho_4_cos(mem,<sp/><ref refid="stdefs_8h_1a2750dfdda752269a036f487a4a34b849" kindref="member">PI2</ref><sp/>-<sp/>phi[j])<sp/>-</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r_prime<sp/>*<sp/>psycho_4_cos(mem,<sp/><ref refid="stdefs_8h_1a2750dfdda752269a036f487a4a34b849" kindref="member">PI2</ref><sp/>-<sp/>phi_prime);</highlight></codeline>
<codeline lineno="423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="424"><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>temp3<sp/>=<sp/>r[ch][</highlight><highlight class="keyword">new</highlight><highlight class="normal">][j]<sp/>+<sp/>fabs((<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>r_prime);</highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(temp3<sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>c[j]<sp/>=<sp/>sqrt(temp1<sp/>*<sp/>temp1<sp/>+<sp/>temp2<sp/>*<sp/>temp2)<sp/>/<sp/>temp3;</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>c[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="431"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>temp1,<sp/>temp2,<sp/>temp3;</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r_prime<sp/>=<sp/>2.0<sp/>*<sp/>r[ch][<ref refid="namespacewaflib_1_1_utils_1ac5e167303eb0d1a7a20df3daf91a264c" kindref="member">old</ref>][j]<sp/>-<sp/>r[ch][oldest][j];</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>phi_prime<sp/>=<sp/>2.0<sp/>*<sp/>phi_sav[ch][<ref refid="namespacewaflib_1_1_utils_1ac5e167303eb0d1a7a20df3daf91a264c" kindref="member">old</ref>][j]<sp/>-<sp/>phi_sav[ch][oldest][j];</highlight></codeline>
<codeline lineno="435"><highlight class="normal"></highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r[ch][</highlight><highlight class="keyword">new</highlight><highlight class="normal">][j]<sp/>=<sp/>sqrt((<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>energy[j]);</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>phi_sav[ch][</highlight><highlight class="keyword">new</highlight><highlight class="normal">][j]<sp/>=<sp/>phi[j];</highlight></codeline>
<codeline lineno="438"><highlight class="normal"></highlight></codeline>
<codeline lineno="439"><highlight class="normal"></highlight></codeline>
<codeline lineno="440"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>temp1<sp/>=<sp/>r[ch][</highlight><highlight class="keyword">new</highlight><highlight class="normal">][j]<sp/>*<sp/><ref refid="pffft_8c_1a57a66355e043ccefc17aca9338a2b748" kindref="member">cos</ref>((<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>phi[j])<sp/>-<sp/>r_prime<sp/>*<sp/><ref refid="pffft_8c_1a57a66355e043ccefc17aca9338a2b748" kindref="member">cos</ref>((<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>phi_prime);</highlight></codeline>
<codeline lineno="441"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>temp2<sp/>=<sp/>r[ch][</highlight><highlight class="keyword">new</highlight><highlight class="normal">][j]<sp/>*<sp/><ref refid="pffft_8c_1a28642ecbd9d1e77ab5a140a460f47d83" kindref="member">sin</ref>((<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>phi[j])<sp/>-<sp/>r_prime<sp/>*<sp/><ref refid="pffft_8c_1a28642ecbd9d1e77ab5a140a460f47d83" kindref="member">sin</ref>((<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>phi_prime);</highlight></codeline>
<codeline lineno="442"><highlight class="normal"></highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>temp3<sp/>=<sp/>r[ch][</highlight><highlight class="keyword">new</highlight><highlight class="normal">][j]<sp/>+<sp/>fabs((<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>r_prime);</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(temp3<sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>c[j]<sp/>=<sp/>sqrt(temp1<sp/>*<sp/>temp1<sp/>+<sp/>temp2<sp/>*<sp/>temp2)<sp/>/<sp/>temp3;</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>c[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="448"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="450"><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>For<sp/>each<sp/>partition,<sp/>sum<sp/>all<sp/>the<sp/>energy<sp/>in<sp/>that<sp/>partition<sp/>-<sp/>grouped_e<sp/>and<sp/>calculated</highlight></codeline>
<codeline lineno="452"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>the<sp/>energy-weighted<sp/>unpredictability<sp/>measure<sp/>-<sp/>grouped_c<sp/>ISO<sp/>11172<sp/>Section<sp/>D.2.4.e<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>1;<sp/>j<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1aac671256f124a8c00bd22ac15a337d0d" kindref="member">CBANDS</ref>;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>grouped_e[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>grouped_c[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>grouped_e[0]<sp/>=<sp/>energy[0];</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>grouped_c[0]<sp/>=<sp/>energy[0]<sp/>*<sp/>c[0];</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>1;<sp/>j<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1a47a92e637e9159058c2f71d7c3999504" kindref="member">HBLKSIZE</ref>;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>grouped_e[partition[j]]<sp/>+=<sp/>energy[j];</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>grouped_c[partition[j]]<sp/>+=<sp/>energy[j]<sp/>*<sp/>c[j];</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="463"><highlight class="normal"></highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>convolve<sp/>the<sp/>grouped<sp/>energy-weighted<sp/>unpredictability<sp/>measure<sp/>and<sp/>the<sp/>grouped<sp/>energy<sp/></highlight></codeline>
<codeline lineno="465"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>with<sp/>the<sp/>spreading<sp/>function<sp/>ISO<sp/>11172<sp/>D.2.4.f<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1aac671256f124a8c00bd22ac15a337d0d" kindref="member">CBANDS</ref>;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ecb[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cb[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1aac671256f124a8c00bd22ac15a337d0d" kindref="member">CBANDS</ref>;<sp/>k++)<sp/>{</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(s[j][k]<sp/>!=<sp/>0.0)<sp/>{</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ecb[j]<sp/>+=<sp/>s[j][<ref refid="rfft2d_test_m_l_8m_1adc468c70fb574ebd07287b38d0d0676d" kindref="member">k</ref>]<sp/>*<sp/>grouped_e[<ref refid="rfft2d_test_m_l_8m_1adc468c70fb574ebd07287b38d0d0676d" kindref="member">k</ref>];</highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cb[j]<sp/>+=<sp/>s[j][<ref refid="rfft2d_test_m_l_8m_1adc468c70fb574ebd07287b38d0d0676d" kindref="member">k</ref>]<sp/>*<sp/>grouped_c[<ref refid="rfft2d_test_m_l_8m_1adc468c70fb574ebd07287b38d0d0676d" kindref="member">k</ref>];</highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(ecb[j]<sp/>!=<sp/>0)</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cb[j]<sp/>=<sp/>cb[j]<sp/>/<sp/>ecb[j];</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cb[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="480"><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Convert<sp/>cb<sp/>to<sp/>tb<sp/>(the<sp/>tonality<sp/>index)<sp/>ISO11172<sp/>SecD.2.4.g<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1aac671256f124a8c00bd22ac15a337d0d" kindref="member">CBANDS</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cb[i]<sp/>&lt;<sp/>0.05)</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cb[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/>0.05;</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(cb[i]<sp/>&gt;<sp/>0.5)</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>cb[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/>0.5;</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tb[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/>-0.301029996<sp/>-<sp/>0.434294482<sp/>*<sp/>log((<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>cb[i]);</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="489"><highlight class="normal"></highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Calculate<sp/>the<sp/>required<sp/>SNR<sp/>for<sp/>each<sp/>of<sp/>the<sp/>frequency<sp/>partitions<sp/>ISO<sp/>11172<sp/>Sect</highlight></codeline>
<codeline lineno="492"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>D.2.4.h<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1aac671256f124a8c00bd22ac15a337d0d" kindref="member">CBANDS</ref>;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref><sp/>SNR,<sp/>SNRtemp;</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SNRtemp<sp/>=<sp/>tmn[j]<sp/>*<sp/>tb[j]<sp/>+<sp/>NMT<sp/>*<sp/>(1.0<sp/>-<sp/>tb[j]);</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SNR<sp/>=<sp/><ref refid="libflac_2src_2lib_f_l_a_c_2include_2private_2macros_8h_1aacc3ee1a7f283f8ef65cea31f4436a95" kindref="member">MAX</ref>(SNRtemp,<sp/>minval[(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal">)<sp/>cbval[j]]);</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bc[j]<sp/>=<sp/>exp((<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>-<sp/>SNR<sp/>*<sp/><ref refid="twolame_2libtwolame_2common_8h_1a9af5476dc4c04040d76614151b1e59fa" kindref="member">LN_TO_LOG10</ref>);</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="499"><highlight class="normal"></highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Calculate<sp/>the<sp/>permissible<sp/>noise<sp/>energy<sp/>level<sp/>in<sp/>each<sp/>of<sp/>the<sp/>frequency<sp/>partitions.</highlight></codeline>
<codeline lineno="501"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>This<sp/>section<sp/>used<sp/>to<sp/>have<sp/>pre-echo<sp/>control<sp/>but<sp/>only<sp/>for<sp/>LayerI<sp/>ISO<sp/>11172<sp/>Sec<sp/>D.2.4.k<sp/></highlight></codeline>
<codeline lineno="502"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Spread<sp/>the<sp/>threshold<sp/>energy<sp/>over<sp/>FFT<sp/>lines<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1aac671256f124a8c00bd22ac15a337d0d" kindref="member">CBANDS</ref>;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rnorm[j]<sp/>&amp;&amp;<sp/>numlines[j])</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nb[j]<sp/>=<sp/>ecb[j]<sp/>*<sp/>bc[j]<sp/>/<sp/>(rnorm[j]<sp/>*<sp/>numlines[j]);</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nb[j]<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="509"><highlight class="normal"></highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>ISO11172<sp/>Sec<sp/>D.2.4.l<sp/>-<sp/>thr[]<sp/>the<sp/>final<sp/>energy<sp/>threshold<sp/>of<sp/>audibility<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/><ref refid="twolame_2libtwolame_2common_8h_1a47a92e637e9159058c2f71d7c3999504" kindref="member">HBLKSIZE</ref>;<sp/>j++)</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>thr[j]<sp/>=<sp/><ref refid="libflac_2src_2lib_f_l_a_c_2include_2private_2macros_8h_1aacc3ee1a7f283f8ef65cea31f4436a95" kindref="member">MAX</ref>(nb[partition[j]],<sp/>ath[j]);</highlight></codeline>
<codeline lineno="513"><highlight class="normal"></highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Translate<sp/>the<sp/>512<sp/>threshold<sp/>values<sp/>to<sp/>the<sp/>32<sp/>filter<sp/>bands<sp/>of<sp/>the<sp/>coder<sp/>Using<sp/>ISO</highlight></codeline>
<codeline lineno="515"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>11172<sp/>Table<sp/>D.5<sp/>and<sp/>Section<sp/>D.2.4.n<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>193;<sp/>j<sp/>+=<sp/>16)<sp/>{</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>WIDTH<sp/>=<sp/>0<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>npart<sp/>=<sp/>60802371420160.0;</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>epart<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>17;<sp/>k++)<sp/>{</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(thr[j<sp/>+<sp/>k]<sp/>&lt;<sp/>npart)</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>npart<sp/>=<sp/>thr[j<sp/>+<sp/><ref refid="rfft2d_test_m_l_8m_1adc468c70fb574ebd07287b38d0d0676d" kindref="member">k</ref>];<sp/></highlight><highlight class="comment">/*<sp/>For<sp/>WIDTH==0,<sp/>find<sp/>the<sp/>minimum<sp/>noise,<sp/>and<sp/>later</highlight></codeline>
<codeline lineno="523"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>multiply<sp/>by<sp/>the<sp/>number<sp/>of<sp/>indexes<sp/>i.e.<sp/>17<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>epart<sp/>+=<sp/>energy[j<sp/>+<sp/><ref refid="rfft2d_test_m_l_8m_1adc468c70fb574ebd07287b38d0d0676d" kindref="member">k</ref>];</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snrtmp[<ref refid="namespacewaflib_1_1_task_1a859c6336afe027ae782f84b9e49a4f0f" kindref="member">run</ref>][j<sp/>/<sp/>16]<sp/>=<sp/>4.342944819<sp/>*<sp/>log((<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>(epart<sp/>/<sp/>(npart<sp/>*<sp/>17.0)));</highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>208;<sp/>j<sp/>&lt;<sp/>(HBLKSIZE<sp/>-<sp/>1);<sp/>j<sp/>+=<sp/>16)<sp/>{</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>WIDTH<sp/>=<sp/>1<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>npart<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>epart<sp/>=<sp/>0.0;</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(k<sp/>=<sp/>0;<sp/>k<sp/>&lt;<sp/>17;<sp/>k++)<sp/>{</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>npart<sp/>+=<sp/>thr[j<sp/>+<sp/><ref refid="rfft2d_test_m_l_8m_1adc468c70fb574ebd07287b38d0d0676d" kindref="member">k</ref>];<sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>For<sp/>WIDTH==1,<sp/>sum<sp/>the<sp/>noise<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>epart<sp/>+=<sp/>energy[j<sp/>+<sp/><ref refid="rfft2d_test_m_l_8m_1adc468c70fb574ebd07287b38d0d0676d" kindref="member">k</ref>];</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>snrtmp[<ref refid="namespacewaflib_1_1_task_1a859c6336afe027ae782f84b9e49a4f0f" kindref="member">run</ref>][j<sp/>/<sp/>16]<sp/>=<sp/>4.342944819<sp/>*<sp/>log((<ref refid="twolame_2libtwolame_2common_8h_1ae8690abbffa85934d64d545920e2b108" kindref="member">FLOAT</ref>)<sp/>(epart<sp/>/<sp/>npart));</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="539"><highlight class="normal"></highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Pick<sp/>the<sp/>maximum<sp/>value<sp/>of<sp/>the<sp/>two<sp/>runs<sp/>ISO<sp/>11172<sp/>Sect<sp/>D.2.1<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>32;<sp/>i++)</highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>smr[ch][i]<sp/>=<sp/><ref refid="libflac_2src_2lib_f_l_a_c_2include_2private_2macros_8h_1aacc3ee1a7f283f8ef65cea31f4436a95" kindref="member">MAX</ref>(snrtmp[0][i],<sp/>snrtmp[1][i]);</highlight></codeline>
<codeline lineno="543"><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>do<sp/>other<sp/>channel</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="545"><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal">}</highlight></codeline>
<codeline lineno="547"><highlight class="normal"></highlight></codeline>
<codeline lineno="548"><highlight class="normal"></highlight></codeline>
<codeline lineno="549" refid="psycho__4_8h_1a76ec4a9b9cf0df39527f6da9b15e1a82" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="psycho__4_8c_1a76ec4a9b9cf0df39527f6da9b15e1a82" kindref="member">psycho_4_deinit</ref>(<ref refid="structpsycho__4__mem__struct" kindref="compound">psycho_4_mem</ref><sp/>**<sp/>mem)</highlight></codeline>
<codeline lineno="550"><highlight class="normal">{</highlight></codeline>
<codeline lineno="551"><highlight class="normal"></highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(mem<sp/>==<sp/><ref refid="getopt1_8c_1a070d2ce7b6bb7e5c05602aa8c308d0c4" kindref="member">NULL</ref><sp/>||<sp/>*mem<sp/>==<sp/><ref refid="getopt1_8c_1a070d2ce7b6bb7e5c05602aa8c308d0c4" kindref="member">NULL</ref>)</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="554"><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2mem_8h_1a134e8e7ea99b1bb57e889e61705f1283" kindref="member">TWOLAME_FREE</ref>((*mem)-&gt;tmn);</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2mem_8h_1a134e8e7ea99b1bb57e889e61705f1283" kindref="member">TWOLAME_FREE</ref>((*mem)-&gt;s);</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2mem_8h_1a134e8e7ea99b1bb57e889e61705f1283" kindref="member">TWOLAME_FREE</ref>((*mem)-&gt;lthr);</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2mem_8h_1a134e8e7ea99b1bb57e889e61705f1283" kindref="member">TWOLAME_FREE</ref>((*mem)-&gt;r);</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2mem_8h_1a134e8e7ea99b1bb57e889e61705f1283" kindref="member">TWOLAME_FREE</ref>((*mem)-&gt;phi_sav);</highlight></codeline>
<codeline lineno="560"><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="twolame_2libtwolame_2mem_8h_1a134e8e7ea99b1bb57e889e61705f1283" kindref="member">TWOLAME_FREE</ref>((*mem));</highlight></codeline>
<codeline lineno="562"><highlight class="normal">}</highlight></codeline>
<codeline lineno="563"><highlight class="normal"></highlight></codeline>
<codeline lineno="564"><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"></highlight></codeline>
<codeline lineno="566"><highlight class="normal"></highlight><highlight class="comment">//<sp/>vim:ts=4:sw=4:nowrap:<sp/></highlight><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/twolame/libtwolame/psycho_4.c"/>
  </compounddef>
</doxygen>
