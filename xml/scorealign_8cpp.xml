<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.11">
  <compounddef id="scorealign_8cpp" kind="file" language="C++">
    <compoundname>scorealign.cpp</compoundname>
    <includes local="no">stdio.h</includes>
    <includes local="no">stdlib.h</includes>
    <includes local="no">string.h</includes>
    <includes local="no">ctype.h</includes>
    <includes local="no">math.h</includes>
    <includes local="no">malloc.h</includes>
    <includes local="no">fstream</includes>
    <includes refid="allegro_8h" local="yes">allegro.h</includes>
    <includes refid="audioreader_8h" local="yes">audioreader.h</includes>
    <includes refid="scorealign_8h" local="yes">scorealign.h</includes>
    <includes refid="gen__chroma_8h" local="yes">gen_chroma.h</includes>
    <includes refid="comp__chroma_8h" local="yes">comp_chroma.h</includes>
    <includes refid="curvefit_8h" local="yes">curvefit.h</includes>
    <includes local="yes">mfmidi.h</includes>
    <includes refid="regression_8h" local="yes">regression.h</includes>
    <includes refid="sautils_8h" local="yes">sautils.h</includes>
    <incdepgraph>
      <node id="19181">
        <label>C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp</label>
        <link refid="scorealign.cpp"/>
        <childnode refid="19182" relation="include">
        </childnode>
        <childnode refid="19183" relation="include">
        </childnode>
        <childnode refid="19184" relation="include">
        </childnode>
        <childnode refid="19185" relation="include">
        </childnode>
        <childnode refid="19186" relation="include">
        </childnode>
        <childnode refid="19187" relation="include">
        </childnode>
        <childnode refid="19188" relation="include">
        </childnode>
        <childnode refid="19189" relation="include">
        </childnode>
        <childnode refid="19193" relation="include">
        </childnode>
        <childnode refid="19194" relation="include">
        </childnode>
        <childnode refid="19195" relation="include">
        </childnode>
        <childnode refid="19196" relation="include">
        </childnode>
        <childnode refid="19197" relation="include">
        </childnode>
        <childnode refid="19198" relation="include">
        </childnode>
        <childnode refid="19199" relation="include">
        </childnode>
        <childnode refid="19200" relation="include">
        </childnode>
      </node>
      <node id="19189">
        <label>allegro.h</label>
        <link refid="allegro_8h"/>
        <childnode refid="19190" relation="include">
        </childnode>
        <childnode refid="19191" relation="include">
        </childnode>
        <childnode refid="19192" relation="include">
        </childnode>
      </node>
      <node id="19197">
        <label>curvefit.h</label>
        <link refid="curvefit_8h"/>
      </node>
      <node id="19195">
        <label>gen_chroma.h</label>
        <link refid="gen__chroma_8h"/>
      </node>
      <node id="19183">
        <label>stdlib.h</label>
      </node>
      <node id="19187">
        <label>malloc.h</label>
      </node>
      <node id="19194">
        <label>scorealign.h</label>
        <link refid="scorealign_8h"/>
      </node>
      <node id="19193">
        <label>audioreader.h</label>
        <link refid="audioreader_8h"/>
      </node>
      <node id="19198">
        <label>mfmidi.h</label>
      </node>
      <node id="19190">
        <label>assert.h</label>
        <link refid="assert_8h"/>
      </node>
      <node id="19188">
        <label>fstream</label>
      </node>
      <node id="19192">
        <label>ostream</label>
      </node>
      <node id="19184">
        <label>string.h</label>
      </node>
      <node id="19186">
        <label>math.h</label>
      </node>
      <node id="19185">
        <label>ctype.h</label>
      </node>
      <node id="19199">
        <label>regression.h</label>
        <link refid="regression_8h"/>
      </node>
      <node id="19200">
        <label>sautils.h</label>
        <link refid="sautils_8h"/>
      </node>
      <node id="19196">
        <label>comp_chroma.h</label>
        <link refid="comp__chroma_8h"/>
      </node>
      <node id="19182">
        <label>stdio.h</label>
      </node>
      <node id="19191">
        <label>istream</label>
      </node>
    </incdepgraph>
      <sectiondef kind="define">
      <memberdef kind="define" id="scorealign_8cpp_1a30df9f42a61dde8d0acc6d3a81ca0977" prot="public" static="no">
        <name>LOW_CUTOFF</name>
        <initializer>40</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" line="24" column="9" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" bodystart="24" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="scorealign_8cpp_1ae00436fbbc35556bf1b2a201df86679d" prot="public" static="no">
        <name>HIGH_CUTOFF</name>
        <initializer>2000</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" line="25" column="9" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" bodystart="25" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="scorealign_8cpp_1a8d0baede67fec569c56e8394694570b4" prot="public" static="no">
        <name>NEAR</name>
        <initializer>1.5</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" line="37" column="9" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" bodystart="37" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" prot="public" static="no">
        <name>PATH</name>
        <param><defname>i</defname></param>
        <param><defname>j</defname></param>
        <initializer>(path[(<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>) * file1_frames + (j)])</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" line="42" column="9" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" bodystart="42" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="scorealign_8cpp_1aa9be42ecbca6531ffa8b151f3291272d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="xmltok_8h_1a5a0d4a5641ce434f1d23533f2b2e6653" kindref="member">int</ref></type>
        <definition>int find_midi_duration</definition>
        <argsstring>(Alg_seq &amp;seq, float *dur)</argsstring>
        <name>find_midi_duration</name>
        <param>
          <type><ref refid="class_alg__seq" kindref="compound">Alg_seq</ref> &amp;</type>
          <declname>seq</declname>
        </param>
        <param>
          <type>float *</type>
          <declname>dur</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" line="107" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" bodystart="107" bodyend="127"/>
      </memberdef>
      <memberdef kind="function" id="scorealign_8cpp_1a5d0291684055264d2af8c63c6dc7cb91" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>double</type>
        <definition>double min3</definition>
        <argsstring>(double x, double y, double z)</argsstring>
        <name>min3</name>
        <param>
          <type>double</type>
          <declname>x</declname>
        </param>
        <param>
          <type>double</type>
          <declname>y</declname>
        </param>
        <param>
          <type>double</type>
          <declname>z</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" line="132" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" bodystart="132" bodyend="137"/>
      </memberdef>
      <memberdef kind="function" id="scorealign_8cpp_1abceff669483fb51103a0380c6bf3ea24" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="sound_8c_1ae35f5844602719cf66324f4de2a658b3" kindref="member">void</ref></type>
        <definition>void save_frames</definition>
        <argsstring>(char *name, int frames, float **chrom_energy)</argsstring>
        <name>save_frames</name>
        <param>
          <type>char *</type>
          <declname>name</declname>
        </param>
        <param>
          <type><ref refid="xmltok_8h_1a5a0d4a5641ce434f1d23533f2b2e6653" kindref="member">int</ref></type>
          <declname>frames</declname>
        </param>
        <param>
          <type>float **</type>
          <declname>chrom_energy</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" line="140" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" bodystart="140" bodyend="152"/>
      </memberdef>
      <memberdef kind="function" id="scorealign_8cpp_1ad60351599d3ceeb330ee321cb313fdca" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="mac_2config_2i386_2lib-src_2libsoxr_2soxr-config_8h_1abb452686968e48b67397da5f97445f5b" kindref="member">bool</ref></type>
        <definition>bool silent</definition>
        <argsstring>(int i, float *chrom_energy)</argsstring>
        <name>silent</name>
        <param>
          <type><ref refid="xmltok_8h_1a5a0d4a5641ce434f1d23533f2b2e6653" kindref="member">int</ref></type>
          <declname>i</declname>
        </param>
        <param>
          <type>float *</type>
          <declname>chrom_energy</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" line="189" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" bodystart="189" bodyend="196"/>
      </memberdef>
      <memberdef kind="function" id="scorealign_8cpp_1af96279253b0af3d897eab551c1ee0507" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="xmltok_8h_1a5a0d4a5641ce434f1d23533f2b2e6653" kindref="member">int</ref></type>
        <definition>int frames_of_init_silence</definition>
        <argsstring>(float *chrom_energy, int frame_count)</argsstring>
        <name>frames_of_init_silence</name>
        <param>
          <type>float *</type>
          <declname>chrom_energy</declname>
        </param>
        <param>
          <type><ref refid="xmltok_8h_1a5a0d4a5641ce434f1d23533f2b2e6653" kindref="member">int</ref></type>
          <declname>frame_count</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" line="218" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" bodystart="218" bodyend="225"/>
      </memberdef>
      <memberdef kind="function" id="scorealign_8cpp_1a3b9056e90fbbed2fc382b3692c2b782e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="xmltok_8h_1a5a0d4a5641ce434f1d23533f2b2e6653" kindref="member">int</ref></type>
        <definition>int last_non_silent_frame</definition>
        <argsstring>(float *chrom_energy, int frame_count)</argsstring>
        <name>last_non_silent_frame</name>
        <param>
          <type>float *</type>
          <declname>chrom_energy</declname>
        </param>
        <param>
          <type><ref refid="xmltok_8h_1a5a0d4a5641ce434f1d23533f2b2e6653" kindref="member">int</ref></type>
          <declname>frame_count</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" line="227" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" bodystart="227" bodyend="234"/>
      </memberdef>
      <memberdef kind="function" id="scorealign_8cpp_1a2b0e50fd298cfddd0f52ff7881b0490e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="mac_2config_2i386_2lib-src_2libsoxr_2soxr-config_8h_1abb452686968e48b67397da5f97445f5b" kindref="member">bool</ref></type>
        <definition>bool near_line</definition>
        <argsstring>(float x1, float y1, float x2, float y2, float x, float y)</argsstring>
        <name>near_line</name>
        <param>
          <type>float</type>
          <declname>x1</declname>
        </param>
        <param>
          <type>float</type>
          <declname>y1</declname>
        </param>
        <param>
          <type>float</type>
          <declname>x2</declname>
        </param>
        <param>
          <type>float</type>
          <declname>y2</declname>
        </param>
        <param>
          <type>float</type>
          <declname>x</declname>
        </param>
        <param>
          <type>float</type>
          <declname>y</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" line="440" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" bodystart="440" bodyend="451"/>
      </memberdef>
      <memberdef kind="function" id="scorealign_8cpp_1aba6569f691382afe5f8c958ea94c209b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>short *</type>
        <definition>short* path_copy</definition>
        <argsstring>(short *path, int len)</argsstring>
        <name>path_copy</name>
        <param>
          <type>short *</type>
          <declname>path</declname>
        </param>
        <param>
          <type><ref refid="xmltok_8h_1a5a0d4a5641ce434f1d23533f2b2e6653" kindref="member">int</ref></type>
          <declname>len</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" line="455" column="1" bodyfile="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp" bodystart="455" bodyend="460"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="preprocessor">#include<sp/>&lt;stdio.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;stdlib.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;string.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="4"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;ctype.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="5"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;math.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="6"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>__MACH__</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="7"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;malloc.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="8"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="9"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;fstream&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="allegro_8h" kindref="compound">allegro.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="audioreader_8h" kindref="compound">audioreader.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="scorealign_8h" kindref="compound">scorealign.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="gen__chroma_8h" kindref="compound">gen_chroma.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="comp__chroma_8h" kindref="compound">comp_chroma.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="curvefit_8h" kindref="compound">curvefit.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;mfmidi.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="regression_8h" kindref="compound">regression.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="sautils_8h" kindref="compound">sautils.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>(defined<sp/>(WIN32)<sp/>||<sp/>defined<sp/>(_WIN32))</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>snprintf<sp/><sp/><sp/><sp/>_snprintf</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight></codeline>
<codeline lineno="24" refid="scorealign_8cpp_1a30df9f42a61dde8d0acc6d3a81ca0977" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>LOW_CUTOFF<sp/><sp/>40</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25" refid="scorealign_8cpp_1ae00436fbbc35556bf1b2a201df86679d" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>HIGH_CUTOFF<sp/>2000</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Note:<sp/>There<sp/>is<sp/>a<sp/>&quot;verbose&quot;<sp/>flag<sp/>in<sp/>Score_align<sp/>objects<sp/>that</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="comment">//<sp/>enable<sp/>some<sp/>printing.<sp/>The<sp/>SA_VERBOSE<sp/>compiler<sp/>flag<sp/>causes<sp/>a</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="comment">//<sp/>lot<sp/>more<sp/>debugging<sp/>output,<sp/>so<sp/>it<sp/>could<sp/>be<sp/>called<sp/>VERY_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="comment">//<sp/>as<sp/>opposed<sp/>to<sp/>the<sp/>quieter<sp/>verbose<sp/>flags.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>SA_VERBOSE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="main_8h" kindref="compound">main.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="comment">//<sp/>for<sp/>presmoothing,<sp/>how<sp/>near<sp/>does<sp/>a<sp/>point<sp/>have<sp/>to<sp/>be<sp/>to<sp/>be<sp/>&quot;on<sp/>the<sp/>line&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37" refid="scorealign_8cpp_1a8d0baede67fec569c56e8394694570b4" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>NEAR<sp/>1.5</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight><highlight class="comment">//<sp/>path<sp/>is<sp/>file0_frames<sp/>by<sp/>file1_frames<sp/>array,<sp/>so<sp/>first<sp/>index</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="comment">//<sp/>(rows)<sp/>is<sp/>in<sp/>[0<sp/>..<sp/>file0_frames].<sp/>Array<sp/>is<sp/>sequence<sp/>of<sp/>rows.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="comment">//<sp/>columns<sp/>(j)<sp/>ranges<sp/>from<sp/>[0<sp/>..<sp/>file1_frames]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42" refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" refkind="member"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>PATH(i,j)<sp/>(path[(i)<sp/>*<sp/>file1_frames<sp/>+<sp/>(j)])</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight><highlight class="comment">/*===========================================================================*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>DEBUG_LOG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal">FILE<sp/>*dbf<sp/>=<sp/><ref refid="getopt1_8c_1a070d2ce7b6bb7e5c05602aa8c308d0c4" kindref="member">NULL</ref>;</highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight></codeline>
<codeline lineno="51" refid="class_scorealign_1a845c4301b432386ed597b1a4586d7621" refkind="member"><highlight class="normal"><ref refid="class_scorealign_1a845c4301b432386ed597b1a4586d7621" kindref="member">Scorealign::Scorealign</ref>()<sp/>{</highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a47f51125e3cb2018d1baa349be161be7" kindref="member">frame_period</ref><sp/>=<sp/><ref refid="scorealign_8h_1aa9bc916b3d914863ce26b5dc7e9f00d2" kindref="member">SA_DFT_FRAME_PERIOD</ref>;</highlight></codeline>
<codeline lineno="53"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a303f57cd6200fd229f7f92fb0bfa95bc" kindref="member">window_size</ref><sp/>=<sp/><ref refid="scorealign_8h_1a06fa9de269d9d89eaf25c5568fbcb179" kindref="member">SA_DFT_WINDOW_SIZE</ref>;</highlight></codeline>
<codeline lineno="54"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a46b492352566a6b58134515e77b61801" kindref="member">force_final_alignment</ref><sp/>=<sp/><ref refid="scorealign_8h_1a69d2bbb5a23c1bfc2cf57785883e4cff" kindref="member">SA_DFT_FORCE_FINAL_ALIGNMENT</ref>;</highlight></codeline>
<codeline lineno="55"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a604edf21b85319e10179bf5140d1e09b" kindref="member">ignore_silence</ref><sp/>=<sp/><ref refid="scorealign_8h_1a45eebfff289bb5e8dbadc822f4f425b8" kindref="member">SA_DFT_IGNORE_SILENCE</ref>;</highlight></codeline>
<codeline lineno="56"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1ac8da1d180b5d33a6f4bda884acaa2a23" kindref="member">silence_threshold</ref><sp/>=<sp/><ref refid="scorealign_8h_1a129f5387c9b0b03e6eb5dcbd11176c95" kindref="member">SA_DFT_SILENCE_THRESHOLD</ref>;</highlight></codeline>
<codeline lineno="57"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1abf993742219359f789e1695b546cda87" kindref="member">presmooth_time</ref><sp/>=<sp/><ref refid="scorealign_8h_1aa5a69790f354f245364b6684d1327b92" kindref="member">SA_DFT_PRESMOOTH_TIME</ref>;</highlight></codeline>
<codeline lineno="58"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a0e8480364897c190afc0c7fd432a78f7" kindref="member">line_time</ref><sp/>=<sp/><ref refid="scorealign_8h_1a2754ae0729f7da536a300a1182a5f638" kindref="member">SA_DFT_LINE_TIME</ref>;</highlight></codeline>
<codeline lineno="59"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1ab2421e375fa06931019107530ef0362d" kindref="member">smooth_time</ref><sp/>=<sp/><ref refid="scorealign_8h_1aec7efc78da664fbe1744451e2020631c" kindref="member">SA_DFT_SMOOTH_TIME</ref>;</highlight></codeline>
<codeline lineno="60"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3a22e20e8be472e87e0f43443c930316" kindref="member">pathlen</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="61"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1af09a47eb9bc5af4ef21bc85bd5959e96" kindref="member">path_count</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="62"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref><sp/>=<sp/><ref refid="getopt1_8c_1a070d2ce7b6bb7e5c05602aa8c308d0c4" kindref="member">NULL</ref>;</highlight></codeline>
<codeline lineno="63"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref><sp/>=<sp/><ref refid="getopt1_8c_1a070d2ce7b6bb7e5c05602aa8c308d0c4" kindref="member">NULL</ref>;</highlight></codeline>
<codeline lineno="64"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1af1e35fb2a5a516e2cb77c19b7344b8ff" kindref="member">verbose</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref><sp/>=<sp/><ref refid="getopt1_8c_1a070d2ce7b6bb7e5c05602aa8c308d0c4" kindref="member">NULL</ref>;</highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>DEBUG_LOG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/>dbf<sp/>=<sp/>fopen(</highlight><highlight class="stringliteral">&quot;debug-log.txt&quot;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&quot;w&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="libid3tag_2global_8h_1af576bf8ffa22a44e53018c67095ffbf0" kindref="member">assert</ref>(dbf);</highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal">}</highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight></codeline>
<codeline lineno="73" refid="class_scorealign_1a154311d8899664e1b8437ec9ff71ef6c" refkind="member"><highlight class="normal"><ref refid="class_scorealign_1a154311d8899664e1b8437ec9ff71ef6c" kindref="member">Scorealign::~Scorealign</ref>()<sp/>{</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>)<sp/>free(<ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>);</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>)<sp/>free(<ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>);</highlight></codeline>
<codeline lineno="76"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>DEBUG_LOG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="conv2dtest_8m_1ae93e9d524fd1ef618af3d5070a8126eb" kindref="member">fclose</ref>(dbf);</highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="79"><highlight class="normal">}</highlight></codeline>
<codeline lineno="80"><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"></highlight></codeline>
<codeline lineno="82"><highlight class="normal"></highlight><highlight class="comment">/*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>MAP_TIME<sp/><sp/></highlight></codeline>
<codeline lineno="83"><highlight class="comment"><sp/><sp/><sp/><sp/>lookup<sp/>time<sp/>of<sp/>file0<sp/>in<sp/>smooth_time_map<sp/>and<sp/>interpolate</highlight></codeline>
<codeline lineno="84"><highlight class="comment"><sp/><sp/><sp/><sp/>to<sp/>get<sp/>time<sp/>in<sp/>file1<sp/></highlight></codeline>
<codeline lineno="85"><highlight class="comment">*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight></codeline>
<codeline lineno="87" refid="class_scorealign_1aeebbba309cdbaa0a82de51906cfa243b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1aeebbba309cdbaa0a82de51906cfa243b" kindref="member">Scorealign::map_time</ref>(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>t1)</highlight></codeline>
<codeline lineno="88"><highlight class="normal">{</highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/>t1<sp/>/=<sp/>(float)<sp/><ref refid="class_scorealign_1afd2fe7e5977be513cf0255a8d3836678" kindref="member">actual_frame_period_0</ref>;<sp/></highlight><highlight class="comment">//<sp/>convert<sp/>from<sp/>seconds<sp/>to<sp/>frames</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref><sp/>=<sp/>(<ref refid="lib_2expat_8h_1a14bb8924daea0b48c7803f281f66e390" kindref="member">int</ref>)<sp/>t1;<sp/></highlight><highlight class="comment">//<sp/>round<sp/>down</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(i<sp/>&lt;<sp/>0)<sp/>i<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(i<sp/>&gt;=<sp/><ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref><sp/>-<sp/>1)<sp/>i<sp/>=<sp/><ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref><sp/>-<sp/>2;</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>interpolate<sp/>to<sp/>get<sp/>time</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="94"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>float(<ref refid="class_scorealign_1a446b2b9c38cc31932120ea4749b5eb9f" kindref="member">actual_frame_period_1</ref><sp/>*<sp/></highlight></codeline>
<codeline lineno="95"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="sautils_8cpp_1a48f11b8a738d58dba1909b65a19c808b" kindref="member">interpolate</ref>(i,<sp/><ref refid="class_scorealign_1ab207618c47378f693d84b72f36ac0eb8" kindref="member">smooth_time_map</ref>[i],<sp/>i+1,<sp/><ref refid="class_scorealign_1ab207618c47378f693d84b72f36ac0eb8" kindref="member">smooth_time_map</ref>[i+1],</highlight></codeline>
<codeline lineno="96"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>t1));</highlight></codeline>
<codeline lineno="97"><highlight class="normal">}</highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight><highlight class="comment">/*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FIND_MIDI_DURATION<sp/></highlight></codeline>
<codeline lineno="101"><highlight class="comment"><sp/><sp/><sp/><sp/>Finds<sp/>the<sp/>duration<sp/>of<sp/>a<sp/>midi<sp/>song<sp/>where<sp/>the<sp/>end</highlight></codeline>
<codeline lineno="102"><highlight class="comment"><sp/><sp/><sp/><sp/>is<sp/>defined<sp/>by<sp/>where<sp/>the<sp/>last<sp/>note<sp/>off<sp/>occurs.<sp/>Duration</highlight></codeline>
<codeline lineno="103"><highlight class="comment"><sp/><sp/><sp/><sp/>in<sp/>seconds<sp/>is<sp/>given<sp/>in<sp/>DUR,<sp/>and<sp/>returns<sp/>in<sp/>int<sp/>the<sp/>number</highlight></codeline>
<codeline lineno="104"><highlight class="comment"><sp/><sp/><sp/><sp/>of<sp/>notes<sp/>in<sp/>the<sp/>song</highlight></codeline>
<codeline lineno="105"><highlight class="comment">*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="106"><highlight class="normal"></highlight></codeline>
<codeline lineno="107" refid="scorealign_8h_1aa9be42ecbca6531ffa8b151f3291272d" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="scorealign_8cpp_1aa9be42ecbca6531ffa8b151f3291272d" kindref="member">find_midi_duration</ref>(<ref refid="class_alg__seq" kindref="compound">Alg_seq</ref><sp/>&amp;seq,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>*<ref refid="seqread_8c_1a3c79b5a9ee81c3835b8de9b0d900d2de" kindref="member">dur</ref>)<sp/></highlight></codeline>
<codeline lineno="108"><highlight class="normal">{</highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/>*dur<sp/>=<sp/>0.0F;</highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nnotes<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>,<sp/>j;</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/>seq.<ref refid="class_alg__seq_1adb0471cd38ff38433afd46f726efa5c2" kindref="member">convert_to_seconds</ref>();</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>0;<sp/>j<sp/>&lt;<sp/>seq.<ref refid="class_alg__seq_1a5e3339e77f1ef07f5af0fbfc0ba97bc9" kindref="member">track_list</ref>.<ref refid="class_alg__tracks_1ab0d2a685cb9d2a96778cc3d51e12679a" kindref="member">length</ref>();<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_alg__events" kindref="compound">Alg_events</ref><sp/>&amp;<ref refid="mm_8c_1a03f09e5a6d1f1cd816f8082ce05c2752" kindref="member">notes</ref><sp/>=<sp/>(seq.<ref refid="class_alg__seq_1a5e3339e77f1ef07f5af0fbfc0ba97bc9" kindref="member">track_list</ref>[j]);</highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>notes.<ref refid="class_alg__events_1a153f53aff30edb4b3cb1b02a8fa54c8f" kindref="member">length</ref>();<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="allegro_8h_1aeb8db009b4ffadef2e7ca0e4936f0307" kindref="member">Alg_event_ptr</ref><sp/><ref refid="namespacelv2docgen_1a4405dc5a2509537b9ff3b4de10bc28d6" kindref="member">e</ref><sp/>=<sp/>notes[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>];</highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(e-&gt;is_note())<sp/>{</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_alg__note" kindref="compound">Alg_note_ptr</ref><sp/>n<sp/>=<sp/>(<ref refid="allegro_8h_1a49bc03b187e4468a764d73df4c860206" kindref="member">Alg_note_ptr</ref>)<sp/>e;</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>note_end<sp/>=<sp/>float(n-&gt;<ref refid="class_alg__event_1a7d31289f03b355f25e0ddd4657783a13" kindref="member">time</ref><sp/>+<sp/>n-&gt;<ref refid="class_alg__note_1ae15463f6b0deca3ac1a179683dd8e6ee" kindref="member">dur</ref>);</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(note_end<sp/>&gt;<sp/>*dur)<sp/>*dur<sp/>=<sp/>note_end;</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nnotes++;</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>nnotes;<sp/></highlight></codeline>
<codeline lineno="127"><highlight class="normal">}</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="129"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="131"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>Returns<sp/>the<sp/>minimum<sp/>of<sp/>three<sp/>values<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="132" refid="scorealign_8cpp_1a5d0291684055264d2af8c63c6dc7cb91" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="scorealign_8cpp_1a5d0291684055264d2af8c63c6dc7cb91" kindref="member">min3</ref>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/><ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>,<sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>y,<sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>z)</highlight></codeline>
<codeline lineno="133"><highlight class="normal">{</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(x<sp/>&lt;<sp/>y<sp/>?</highlight></codeline>
<codeline lineno="135"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(x<sp/>&lt;<sp/>z<sp/>?<sp/>x<sp/>:<sp/>z)<sp/>:</highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(y<sp/>&lt;<sp/>z<sp/>?<sp/>y<sp/>:<sp/>z));</highlight></codeline>
<codeline lineno="137"><highlight class="normal">}</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"></highlight></codeline>
<codeline lineno="140" refid="scorealign_8cpp_1abceff669483fb51103a0380c6bf3ea24" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="scorealign_8cpp_1abceff669483fb51103a0380c6bf3ea24" kindref="member">save_frames</ref>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*<ref refid="lib_2expat_8h_1a1b49b495b59f9e73205b69ad1a2965b0" kindref="member">name</ref>,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>frames,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>**chrom_energy)</highlight></codeline>
<codeline lineno="141"><highlight class="normal">{</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/>FILE<sp/>*outf<sp/>=<sp/>fopen(name,<sp/></highlight><highlight class="stringliteral">&quot;w&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="143"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>,j;</highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j=0;<sp/>j<sp/>&lt;<sp/>frames;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>*chrom_energy_frame<sp/>=<sp/>chrom_energy[j];</highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/><sp/>i<sp/>&lt;=<sp/><ref refid="gen__chroma_8h_1a90c6cc0f5dead0329b02cc71e4291394" kindref="member">CHROMA_BIN_COUNT</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(outf,<sp/></highlight><highlight class="stringliteral">&quot;%g<sp/>&quot;</highlight><highlight class="normal">,<sp/>chrom_energy_frame[i]);</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(outf,<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="conv2dtest_8m_1ae93e9d524fd1ef618af3d5070a8126eb" kindref="member">fclose</ref>(outf);</highlight></codeline>
<codeline lineno="152"><highlight class="normal">}</highlight></codeline>
<codeline lineno="153"><highlight class="normal"></highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>steps<sp/>through<sp/>the<sp/>dynamic<sp/>programming<sp/>path</highlight></codeline>
<codeline lineno="156"><highlight class="comment">*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="157" refid="class_scorealign_1af49b7fa36c01f092d1c35d7b57c5b15f" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1af49b7fa36c01f092d1c35d7b57c5b15f" kindref="member">Scorealign::path_step</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j)</highlight></codeline>
<codeline lineno="158"><highlight class="normal">{</highlight></codeline>
<codeline lineno="159"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>DEBUG_LOG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(dbf,<sp/></highlight><highlight class="stringliteral">&quot;(%i,%i)<sp/>&quot;</highlight><highlight class="normal">,<sp/>i,<sp/>j);</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(++<ref refid="class_scorealign_1af09a47eb9bc5af4ef21bc85bd5959e96" kindref="member">path_count</ref><sp/>%<sp/>5<sp/>==<sp/>0<sp/>||</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(i<sp/>==<sp/><ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref><sp/>&amp;&amp;<sp/>j<sp/>==<sp/><ref refid="class_scorealign_1a9c7a049717992210177b363266a1bce5" kindref="member">first_y</ref>))<sp/></highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(dbf,<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="164"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[<ref refid="class_scorealign_1a3a22e20e8be472e87e0f43443c930316" kindref="member">pathlen</ref>]<sp/>=<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;<sp/></highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[<ref refid="class_scorealign_1a3a22e20e8be472e87e0f43443c930316" kindref="member">pathlen</ref>]<sp/>=<sp/>j;</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3a22e20e8be472e87e0f43443c930316" kindref="member">pathlen</ref>++;</highlight></codeline>
<codeline lineno="168"><highlight class="normal">}<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="169"><highlight class="normal"></highlight></codeline>
<codeline lineno="170"><highlight class="normal"></highlight></codeline>
<codeline lineno="171"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>path_reverse<sp/>--<sp/>path<sp/>is<sp/>computed<sp/>from<sp/>last<sp/>to<sp/>first,<sp/>flip<sp/>it<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="172"><highlight class="normal"></highlight></codeline>
<codeline lineno="173" refid="class_scorealign_1a20e1e85ebf0e4d8414d8db452fe0fbe6" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1a20e1e85ebf0e4d8414d8db452fe0fbe6" kindref="member">Scorealign::path_reverse</ref>()</highlight></codeline>
<codeline lineno="174"><highlight class="normal">{</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/><ref refid="class_scorealign_1a3a22e20e8be472e87e0f43443c930316" kindref="member">pathlen</ref><sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(i<sp/>&lt;<sp/>j)<sp/>{</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/>tempx<sp/>=<sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>];<sp/></highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/>tempy<sp/>=<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>];</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[j];<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[j];</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[j]<sp/>=<sp/>tempx;<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[j]<sp/>=<sp/>tempy;</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i++;<sp/>j--;</highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="183"><highlight class="normal">}</highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="185"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="186"><highlight class="comment"><sp/><sp/>Sees<sp/>if<sp/>the<sp/>chroma<sp/>energy<sp/>vector<sp/>is<sp/>silent<sp/>(indicated<sp/>by<sp/>the<sp/>12th<sp/>element<sp/>being<sp/>one)</highlight></codeline>
<codeline lineno="187"><highlight class="comment"><sp/><sp/>Returns<sp/>true<sp/>if<sp/>it<sp/>is<sp/>silent.<sp/><sp/>False<sp/>if<sp/>it<sp/>is<sp/>not<sp/>silent<sp/></highlight></codeline>
<codeline lineno="188"><highlight class="comment">*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="189" refid="scorealign_8cpp_1ad60351599d3ceeb330ee321cb313fdca" refkind="member"><highlight class="normal"><sp/></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="scorealign_8cpp_1ad60351599d3ceeb330ee321cb313fdca" kindref="member">silent</ref>(<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>*chrom_energy)</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="gen__chroma_8h_1aa24b5ea7f722ee34c89ecdc485193381" kindref="member">AREF2</ref>(chrom_energy,<sp/>i,<ref refid="gen__chroma_8h_1a90c6cc0f5dead0329b02cc71e4291394" kindref="member">CHROMA_BIN_COUNT</ref>)<sp/>==<sp/>1.0<ref refid="xlftab_8c_1a42257a545daf5b7933d6e8f96adc74f2" kindref="member">F</ref>)</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;<sp/></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="196"><highlight class="normal">}</highlight></codeline>
<codeline lineno="197"><highlight class="normal"></highlight></codeline>
<codeline lineno="198"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="199"><highlight class="comment">returns<sp/>the<sp/>first<sp/>index<sp/>in<sp/>pathy<sp/>where<sp/>the<sp/>element<sp/>is<sp/>bigger<sp/>than<sp/>sec<sp/></highlight></codeline>
<codeline lineno="200"><highlight class="comment">*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="201" refid="class_scorealign_1a47c81dfe558d21907a2467103d184f6f" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1a47c81dfe558d21907a2467103d184f6f" kindref="member">Scorealign::sec_to_pathy_index</ref>(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>sec)<sp/></highlight></codeline>
<codeline lineno="202"><highlight class="normal">{</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref><sp/>=<sp/>0<sp/>;<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref><sp/>&lt;<sp/>(<ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref><sp/>+<sp/><ref refid="class_scorealign_1ab0ea5cd44003743384ac8e39752155cb" kindref="member">file1_frames</ref>);<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>++)<sp/>{</highlight></codeline>
<codeline lineno="204"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1ab207618c47378f693d84b72f36ac0eb8" kindref="member">smooth_time_map</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>*<sp/><ref refid="class_scorealign_1a446b2b9c38cc31932120ea4749b5eb9f" kindref="member">actual_frame_period_1</ref><sp/>&gt;=<sp/>sec)<sp/>{</highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;<sp/></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//printf(&quot;%i\n&quot;<sp/>,pathy[i]);</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-1;<sp/></highlight></codeline>
<codeline lineno="210"><highlight class="normal">}</highlight></codeline>
<codeline lineno="211"><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"></highlight><highlight class="comment">/*<sp/><sp/></highlight></codeline>
<codeline lineno="214"><highlight class="comment">given<sp/>a<sp/>chrom_energy<sp/>vector,<sp/>sees<sp/>how<sp/>many<sp/></highlight></codeline>
<codeline lineno="215"><highlight class="comment">of<sp/>the<sp/>inital<sp/>frames<sp/>are<sp/>designated<sp/>as<sp/>silent<sp/></highlight></codeline>
<codeline lineno="216"><highlight class="comment">*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight></codeline>
<codeline lineno="218" refid="scorealign_8cpp_1af96279253b0af3d897eab551c1ee0507" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="scorealign_8cpp_1af96279253b0af3d897eab551c1ee0507" kindref="member">frames_of_init_silence</ref>(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>*chrom_energy,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>frame_count)</highlight></codeline>
<codeline lineno="219"><highlight class="normal">{</highlight></codeline>
<codeline lineno="220"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>frames;</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(frames<sp/>=<sp/>0;<sp/>frames<sp/>&lt;<sp/>frame_count;<sp/>frames++)<sp/>{</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="scorealign_8cpp_1ad60351599d3ceeb330ee321cb313fdca" kindref="member">silent</ref>(frames,<sp/>chrom_energy))<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>frames;<sp/></highlight></codeline>
<codeline lineno="225"><highlight class="normal">}</highlight></codeline>
<codeline lineno="226"><highlight class="normal"></highlight></codeline>
<codeline lineno="227" refid="scorealign_8cpp_1a3b9056e90fbbed2fc382b3692c2b782e" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="scorealign_8cpp_1a3b9056e90fbbed2fc382b3692c2b782e" kindref="member">last_non_silent_frame</ref>(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>*chrom_energy,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>frame_count)</highlight></codeline>
<codeline lineno="228"><highlight class="normal">{</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>frames;</highlight></codeline>
<codeline lineno="230"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(frames<sp/>=<sp/>frame_count<sp/>-<sp/>1;<sp/>frames<sp/>&gt;<sp/>0;<sp/>frames--)<sp/>{</highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="scorealign_8cpp_1ad60351599d3ceeb330ee321cb313fdca" kindref="member">silent</ref>(frames,<sp/>chrom_energy))<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>frames;<sp/></highlight></codeline>
<codeline lineno="234"><highlight class="normal">}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"></highlight></codeline>
<codeline lineno="237"><highlight class="normal"></highlight><highlight class="comment">/*<sp/><sp/><sp/><sp/><sp/><sp/>COMPARE_CHROMA</highlight></codeline>
<codeline lineno="238"><highlight class="comment">Perform<sp/>Dynamic<sp/>Programming<sp/>to<sp/>find<sp/>optimal<sp/>alignment</highlight></codeline>
<codeline lineno="239"><highlight class="comment">*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240" refid="class_scorealign_1a53aeb04a4368f66f94c9559c13bb98b5" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1a53aeb04a4368f66f94c9559c13bb98b5" kindref="member">Scorealign::compare_chroma</ref>()</highlight></codeline>
<codeline lineno="241"><highlight class="normal">{</highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>*<ref refid="namespacelv2docgen_1ae75d75173fc2ea012acad7d886aa2f9d" kindref="member">path</ref>;</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Allocate<sp/>the<sp/>distance<sp/>matrix<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/>path<sp/>=<sp/>(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>*)<sp/>calloc(<ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref><sp/>*<sp/><ref refid="class_scorealign_1ab0ea5cd44003743384ac8e39752155cb" kindref="member">file1_frames</ref>,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>skip<sp/>over<sp/>initial<sp/>silence<sp/>in<sp/>signals<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a604edf21b85319e10179bf5140d1e09b" kindref="member">ignore_silence</ref>)<sp/>{</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref><sp/>=<sp/><ref refid="scorealign_8cpp_1af96279253b0af3d897eab551c1ee0507" kindref="member">frames_of_init_silence</ref>(<ref refid="class_scorealign_1a65e1070af091985304c02797ce210170" kindref="member">chrom_energy0</ref>,<sp/><ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref>);</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref><sp/>=<sp/><ref refid="scorealign_8cpp_1a3b9056e90fbbed2fc382b3692c2b782e" kindref="member">last_non_silent_frame</ref>(<ref refid="class_scorealign_1a65e1070af091985304c02797ce210170" kindref="member">chrom_energy0</ref>,<sp/><ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref>);</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9c7a049717992210177b363266a1bce5" kindref="member">first_y</ref><sp/>=<sp/><ref refid="scorealign_8cpp_1af96279253b0af3d897eab551c1ee0507" kindref="member">frames_of_init_silence</ref>(<ref refid="class_scorealign_1ac094f1c6ed01fb8f9988bec933208bde" kindref="member">chrom_energy1</ref>,<sp/>file1_frames);</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a2302f07302de5e9791320d7ae610ea71" kindref="member">last_y</ref><sp/>=<sp/><ref refid="scorealign_8cpp_1a3b9056e90fbbed2fc382b3692c2b782e" kindref="member">last_non_silent_frame</ref>(<ref refid="class_scorealign_1ac094f1c6ed01fb8f9988bec933208bde" kindref="member">chrom_energy1</ref>,<sp/>file1_frames);</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref><sp/>=<sp/><ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref><sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9c7a049717992210177b363266a1bce5" kindref="member">first_y</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a2302f07302de5e9791320d7ae610ea71" kindref="member">last_y</ref><sp/>=<sp/>file1_frames<sp/>-<sp/>1;</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="259"><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref><sp/>-<sp/><ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref><sp/>&lt;=<sp/>0<sp/>||<sp/><ref refid="class_scorealign_1a2302f07302de5e9791320d7ae610ea71" kindref="member">last_y</ref><sp/>-<sp/><ref refid="class_scorealign_1a9c7a049717992210177b363266a1bce5" kindref="member">first_y</ref><sp/>&lt;=<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="scorealign_8h_1a0ac0b7994a7d738aa77d2c1cfe8d6d13a2477d3ea1f496a8b4a29b663942a0534" kindref="member">SA_TOOSHORT</ref>;</highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Initialize<sp/>first<sp/>row<sp/>and<sp/>column<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1af1e35fb2a5a516e2cb77c19b7344b8ff" kindref="member">verbose</ref>)<sp/><ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;Performing<sp/>DP\n&quot;</highlight><highlight class="normal">);<sp/></highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(<ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref>,<sp/><ref refid="class_scorealign_1a9c7a049717992210177b363266a1bce5" kindref="member">first_y</ref>)<sp/>=<sp/><ref refid="class_scorealign_1a626ed8876bafc5bbf5c86db23864c942" kindref="member">gen_dist</ref>(<ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref>,<sp/><ref refid="class_scorealign_1a9c7a049717992210177b363266a1bce5" kindref="member">first_y</ref>);</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref><sp/>=<sp/><ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref><sp/>+<sp/>1;<sp/><ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref><sp/>&lt;=<sp/><ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref>;<sp/><ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>++)</highlight></codeline>
<codeline lineno="268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(<ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>,<sp/><ref refid="class_scorealign_1a9c7a049717992210177b363266a1bce5" kindref="member">first_y</ref>)<sp/>=<sp/><ref refid="class_scorealign_1a626ed8876bafc5bbf5c86db23864c942" kindref="member">gen_dist</ref>(<ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>,<sp/><ref refid="class_scorealign_1a9c7a049717992210177b363266a1bce5" kindref="member">first_y</ref>)<sp/>+<sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(<ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref><sp/>-<sp/>1,<sp/><ref refid="class_scorealign_1a9c7a049717992210177b363266a1bce5" kindref="member">first_y</ref>);</highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>y<sp/>=<sp/>1;<sp/>y<sp/>&lt;=<sp/><ref refid="class_scorealign_1a2302f07302de5e9791320d7ae610ea71" kindref="member">last_y</ref>;<sp/>y++)</highlight></codeline>
<codeline lineno="270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(<ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref>,<sp/>y)<sp/>=<sp/><ref refid="class_scorealign_1a626ed8876bafc5bbf5c86db23864c942" kindref="member">gen_dist</ref>(<ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref>,<sp/>y)<sp/>+<sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(<ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref>,<sp/>y<sp/>-<sp/>1);</highlight></codeline>
<codeline lineno="271"><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>DEBUG_LOG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="273"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(dbf,<sp/></highlight><highlight class="stringliteral">&quot;DISTANCE<sp/>MATRIX<sp/>***************************\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="274"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Perform<sp/>DP<sp/>for<sp/>the<sp/>rest<sp/>of<sp/>the<sp/>matrix<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref><sp/>=<sp/><ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref><sp/>+<sp/>1;<sp/><ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref><sp/>&lt;=<sp/><ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref>;<sp/><ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>++)<sp/>{</highlight></codeline>
<codeline lineno="277"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>y<sp/>=<sp/><ref refid="class_scorealign_1a9c7a049717992210177b363266a1bce5" kindref="member">first_y</ref><sp/>+<sp/>1;<sp/>y<sp/>&lt;=<sp/><ref refid="class_scorealign_1a2302f07302de5e9791320d7ae610ea71" kindref="member">last_y</ref>;<sp/>y++)<sp/>{</highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(<ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>,<sp/>y)<sp/>=<sp/><ref refid="class_scorealign_1a626ed8876bafc5bbf5c86db23864c942" kindref="member">gen_dist</ref>(<ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>,<sp/>y)<sp/>+</highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>float(<ref refid="scorealign_8cpp_1a5d0291684055264d2af8c63c6dc7cb91" kindref="member">min3</ref>(<ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(<ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>-1,<sp/>y-1),<sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(<ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>-1,<sp/>y),<sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(<ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>,<sp/>y-1)));<sp/></highlight></codeline>
<codeline lineno="280"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>DEBUG_LOG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(dbf,<sp/></highlight><highlight class="stringliteral">&quot;(%d<sp/>%d<sp/>%g)<sp/>&quot;</highlight><highlight class="normal">,<sp/><ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>,<sp/>y,<sp/><ref refid="class_scorealign_1a626ed8876bafc5bbf5c86db23864c942" kindref="member">gen_dist</ref>(<ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>,<sp/>y),<sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(<ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>,<sp/>y));</highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="284"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>DEBUG_LOG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(dbf,<sp/></highlight><highlight class="stringliteral">&quot;\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="286"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>report<sp/>progress<sp/>for<sp/>each<sp/>file0_frame<sp/>(column)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>This<sp/>is<sp/>not<sp/>quite<sp/>right<sp/>if<sp/>we<sp/>are<sp/>ignoring<sp/>silence<sp/>because</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>then<sp/>only<sp/>a<sp/>sub-matrix<sp/>is<sp/>computed.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref><sp/>&amp;&amp;<sp/>!<ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ae68de2b2270ffb2c16d33df598042184" kindref="member">set_matrix_progress</ref>(file1_frames))<sp/></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="scorealign_8h_1a0ac0b7994a7d738aa77d2c1cfe8d6d13a40b6989d0cf88caeeebc1a5e38399a78" kindref="member">SA_CANCEL</ref>;</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="293"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>DEBUG_LOG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(dbf,<sp/></highlight><highlight class="stringliteral">&quot;END<sp/>OF<sp/>DISTANCE<sp/>MATRIX<sp/>********************\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="295"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="296"><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1af1e35fb2a5a516e2cb77c19b7344b8ff" kindref="member">verbose</ref>)<sp/><ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;Completed<sp/>Dynamic<sp/>Programming.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//x<sp/>and<sp/>y<sp/>are<sp/>the<sp/>ending<sp/>points,<sp/>it<sp/>can<sp/>end<sp/>at<sp/>either<sp/>the<sp/>end<sp/>of<sp/>midi,<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>or<sp/>end<sp/>of<sp/>audio<sp/>or<sp/>both</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref><sp/>=<sp/><ref refid="sautils_8h_1ade0072e12dad159bbf06858a91e47a8c" kindref="member">ALLOC</ref>(</highlight><highlight class="keywordtype">short</highlight><highlight class="normal">,<sp/>(<ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref><sp/>+<sp/>file1_frames));</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref><sp/>=<sp/><ref refid="sautils_8h_1ade0072e12dad159bbf06858a91e47a8c" kindref="member">ALLOC</ref>(</highlight><highlight class="keywordtype">short</highlight><highlight class="normal">,<sp/>(<ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref><sp/>+<sp/>file1_frames));</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="libid3tag_2global_8h_1af576bf8ffa22a44e53018c67095ffbf0" kindref="member">assert</ref>(<ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref><sp/>!=<sp/><ref refid="getopt1_8c_1a070d2ce7b6bb7e5c05602aa8c308d0c4" kindref="member">NULL</ref>);</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="libid3tag_2global_8h_1af576bf8ffa22a44e53018c67095ffbf0" kindref="member">assert</ref>(<ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref><sp/>!=<sp/><ref refid="getopt1_8c_1a070d2ce7b6bb7e5c05602aa8c308d0c4" kindref="member">NULL</ref>);</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>map<sp/>from<sp/>file0<sp/>time<sp/>to<sp/>file1<sp/>time</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9970a288920ebf2706f309a53b3ee362" kindref="member">time_map</ref><sp/>=<sp/><ref refid="sautils_8h_1ade0072e12dad159bbf06858a91e47a8c" kindref="member">ALLOC</ref>(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal">,<sp/><ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref>);</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1ab207618c47378f693d84b72f36ac0eb8" kindref="member">smooth_time_map</ref><sp/>=<sp/><ref refid="sautils_8h_1ade0072e12dad159bbf06858a91e47a8c" kindref="member">ALLOC</ref>(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal">,<sp/><ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref>);</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref><sp/>=<sp/><ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref>;</highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>y<sp/>=<sp/><ref refid="class_scorealign_1a2302f07302de5e9791320d7ae610ea71" kindref="member">last_y</ref>;</highlight></codeline>
<codeline lineno="314"><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!<ref refid="class_scorealign_1a46b492352566a6b58134515e77b61801" kindref="member">force_final_alignment</ref>)<sp/>{</highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>DEBUG_LOG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(dbf,<sp/></highlight><highlight class="stringliteral">&quot;\nOptimal<sp/>Path:<sp/>&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="318"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>find<sp/>end<sp/>point,<sp/>the<sp/>lowest<sp/>cost<sp/>matrix<sp/>value<sp/>at<sp/>one<sp/>of<sp/>the</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>sequence<sp/>endings</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>min_cost<sp/>=<sp/>1.0E10;</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref><sp/>=<sp/><ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref>;<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref><sp/>&lt;=<sp/><ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref>;<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>++)<sp/>{</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>,<sp/><ref refid="class_scorealign_1a2302f07302de5e9791320d7ae610ea71" kindref="member">last_y</ref>)<sp/>&lt;=<sp/>min_cost)<sp/>{</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>min_cost<sp/>=<sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>,<sp/><ref refid="class_scorealign_1a2302f07302de5e9791320d7ae610ea71" kindref="member">last_y</ref>);</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x<sp/>=<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>y<sp/>=<sp/><ref refid="class_scorealign_1a2302f07302de5e9791320d7ae610ea71" kindref="member">last_y</ref>;</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j<sp/>=<sp/><ref refid="class_scorealign_1a9c7a049717992210177b363266a1bce5" kindref="member">first_y</ref>;<sp/>j<sp/>&lt;=<sp/><ref refid="class_scorealign_1a2302f07302de5e9791320d7ae610ea71" kindref="member">last_y</ref>;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(<ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref>,<sp/>j)<sp/>&lt;=<sp/>min_cost)<sp/>{</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>min_cost<sp/>=<sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(<ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref>,<sp/>j);</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x<sp/>=<sp/><ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref>;</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>y<sp/>=<sp/>j;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="336"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>DEBUG_LOG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(dbf,<sp/></highlight><highlight class="stringliteral">&quot;Min<sp/>cost<sp/>at<sp/>%d<sp/>%d\n\nPATH:\n&quot;</highlight><highlight class="normal">,<sp/>x,<sp/>y);</highlight></codeline>
<codeline lineno="338"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="340"><highlight class="normal"></highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>((x<sp/>!=<sp/><ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref>)<sp/>||<sp/>(y<sp/>!=<sp/><ref refid="class_scorealign_1a9c7a049717992210177b363266a1bce5" kindref="member">first_y</ref>))<sp/>{</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1af49b7fa36c01f092d1c35d7b57c5b15f" kindref="member">path_step</ref>(x,<sp/>y);</highlight></codeline>
<codeline lineno="343"><highlight class="normal"></highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Check<sp/>for<sp/>the<sp/>optimal<sp/>path<sp/>backwards*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(x<sp/>&gt;<sp/><ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref><sp/>&amp;&amp;<sp/>y<sp/>&gt;<sp/><ref refid="class_scorealign_1a9c7a049717992210177b363266a1bce5" kindref="member">first_y</ref><sp/>&amp;&amp;<sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(x-1,<sp/>y-1)<sp/>&lt;=<sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(x-1,<sp/>y)<sp/>&amp;&amp;</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(x-1,<sp/>y-1)<sp/>&lt;=<sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(x,<sp/>y-1))<sp/>{</highlight></codeline>
<codeline lineno="347"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x--;</highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>y--;</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(x<sp/>&gt;<sp/><ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref><sp/>&amp;&amp;<sp/>y<sp/>&gt;<sp/><ref refid="class_scorealign_1a9c7a049717992210177b363266a1bce5" kindref="member">first_y</ref><sp/>&amp;&amp;<sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(x-1,<sp/>y)<sp/>&lt;=<sp/><ref refid="scorealign_8cpp_1a749be4f9a1414470ffa4bbc0a10a1e3e" kindref="member">PATH</ref>(x,<sp/>y-1))<sp/>{</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x--;</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(y<sp/>&gt;<sp/><ref refid="class_scorealign_1a9c7a049717992210177b363266a1bce5" kindref="member">first_y</ref>)<sp/>{</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>y--;</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(x<sp/>&gt;<sp/><ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref>)<sp/>{</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x--;</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1af49b7fa36c01f092d1c35d7b57c5b15f" kindref="member">path_step</ref>(x,<sp/>y);</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a20e1e85ebf0e4d8414d8db452fe0fbe6" kindref="member">path_reverse</ref>();</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/>free(path);</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="scorealign_8h_1a0ac0b7994a7d738aa77d2c1cfe8d6d13a12d062c880df80216d51b92e1bf09632" kindref="member">SA_SUCCESS</ref>;<sp/></highlight><highlight class="comment">//<sp/>success</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal">}</highlight></codeline>
<codeline lineno="362"><highlight class="normal"></highlight></codeline>
<codeline lineno="363"><highlight class="normal"></highlight></codeline>
<codeline lineno="364" refid="class_scorealign_1abe1d65b29fe00e4d80b23dbdff649083" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1abe1d65b29fe00e4d80b23dbdff649083" kindref="member">Scorealign::linear_regression</ref>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>width,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>&amp;<ref refid="poly-fir_8h_1a8d3c3518d793541417a4845125da1ae1" kindref="member">a</ref>,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>&amp;<ref refid="poly-fir_8h_1ab2d05693952610f937e5acb3c4a8fa1b" kindref="member">b</ref>)</highlight></codeline>
<codeline lineno="365"><highlight class="normal">{</highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>hw<sp/>=<sp/>(width<sp/>-<sp/>1)<sp/>/<sp/>2;<sp/></highlight><highlight class="comment">//<sp/>a<sp/>more<sp/>convenient<sp/>form:<sp/>1/2<sp/>width</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>compute<sp/>average<sp/>of<sp/>x<sp/>=<sp/>avg<sp/>of<sp/>time_map[i]</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>xsum<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>ysum<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="370"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>xavg,<sp/>yavg;</highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>n<sp/>-<sp/>hw;<sp/>i<sp/>&lt;=<sp/>n<sp/>+<sp/>hw;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>xsum<sp/>+=<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ysum<sp/>+=<sp/><ref refid="class_scorealign_1a9970a288920ebf2706f309a53b3ee362" kindref="member">time_map</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>];</highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/>xavg<sp/>=<sp/>xsum<sp/>/<sp/>width;</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/>yavg<sp/>=<sp/>ysum<sp/>/<sp/>width;</highlight></codeline>
<codeline lineno="378"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>num<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>den<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="380"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>n<sp/>-<sp/>hw;<sp/>i<sp/>&lt;=<sp/>n<sp/>+<sp/>hw;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="381"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>num<sp/>+=<sp/>(i<sp/>-<sp/>xavg)<sp/>*<sp/>(<ref refid="class_scorealign_1a9970a288920ebf2706f309a53b3ee362" kindref="member">time_map</ref>[i]<sp/>-<sp/>yavg);</highlight></codeline>
<codeline lineno="382"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>den<sp/>+=<sp/>(i<sp/>-<sp/>xavg)<sp/>*<sp/>(i<sp/>-<sp/>xavg);</highlight></codeline>
<codeline lineno="383"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="384"><highlight class="normal"><sp/><sp/><sp/><sp/>b<sp/>=<sp/>num<sp/>/<sp/>den;</highlight></codeline>
<codeline lineno="385"><highlight class="normal"><sp/><sp/><sp/><sp/>a<sp/>=<sp/>yavg<sp/>-<sp/>b<sp/>*<sp/>xavg;</highlight></codeline>
<codeline lineno="386"><highlight class="normal">}</highlight></codeline>
<codeline lineno="387"><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"></highlight></codeline>
<codeline lineno="389"><highlight class="normal"></highlight><highlight class="comment">/*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>COMPUTE_SMOOTH_TIME_MAP<sp/></highlight></codeline>
<codeline lineno="390"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>compute<sp/>regression<sp/>line<sp/>and<sp/>estimate<sp/>point<sp/>at<sp/>i</highlight></codeline>
<codeline lineno="391"><highlight class="comment"><sp/></highlight></codeline>
<codeline lineno="392"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>Number<sp/>of<sp/>points<sp/>in<sp/>regression<sp/>is<sp/>smooth<sp/>(an<sp/>odd<sp/>number).<sp/>First</highlight></codeline>
<codeline lineno="393"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>index<sp/>to<sp/>compute<sp/>is<sp/>(smooth-1)/2.<sp/>Use<sp/>that<sp/>line<sp/>for<sp/>the<sp/>first</highlight></codeline>
<codeline lineno="394"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>(smooth+1)/2<sp/>points.<sp/>The<sp/>last<sp/>index<sp/>to<sp/>compute<sp/>is<sp/></highlight></codeline>
<codeline lineno="395"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>(file0_frames<sp/>-<sp/>(smooth+1)/2).<sp/>Use<sp/>that<sp/>line<sp/>for<sp/>the<sp/>last<sp/></highlight></codeline>
<codeline lineno="396"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>(smooth+1)/2<sp/>points.</highlight></codeline>
<codeline lineno="397"><highlight class="comment">*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="398" refid="class_scorealign_1a04923958d7e9da553d4d6ece755a3701" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1a04923958d7e9da553d4d6ece755a3701" kindref="member">Scorealign::compute_smooth_time_map</ref>()</highlight></codeline>
<codeline lineno="399"><highlight class="normal">{</highlight></codeline>
<codeline lineno="400"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="401"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>hw<sp/>=<sp/>(<ref refid="class_scorealign_1ad049e8da9635fa284dadb6d17cd82bf2" kindref="member">smooth</ref><sp/>-<sp/>1)<sp/>/<sp/>2;<sp/></highlight><highlight class="comment">//<sp/>half<sp/>width<sp/>of<sp/>smoothing<sp/>window</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="402"><highlight class="normal"></highlight></codeline>
<codeline lineno="403"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>find<sp/>the<sp/>first<sp/>point</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="404"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="class_scorealign_1ade0b85e4931d63e777ba81efc2cc44a8" kindref="member">first_x</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="405"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1ab207618c47378f693d84b72f36ac0eb8" kindref="member">smooth_time_map</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/><ref refid="scorealign_8h_1a01b46de5b215ad4c37deb1ae2f5f9b01" kindref="member">NOT_MAPPED</ref>;</highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="407"><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>do<sp/>the<sp/>first<sp/>points:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="409"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/><ref refid="poly-fir_8h_1a8d3c3518d793541417a4845125da1ae1" kindref="member">a</ref>,<sp/><ref refid="poly-fir_8h_1ab2d05693952610f937e5acb3c4a8fa1b" kindref="member">b</ref>;</highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1abe1d65b29fe00e4d80b23dbdff649083" kindref="member">linear_regression</ref>(first_x<sp/>+<sp/>hw,<sp/><ref refid="class_scorealign_1ad049e8da9635fa284dadb6d17cd82bf2" kindref="member">smooth</ref>,<sp/>a,<sp/>b);</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>first_x;<sp/>i<sp/>&lt;=<sp/>first_x<sp/>+<sp/>hw;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1ab207618c47378f693d84b72f36ac0eb8" kindref="member">smooth_time_map</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/>a<sp/>+<sp/>b<sp/>*<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>do<sp/>the<sp/>middle<sp/>points:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>first_x<sp/>+<sp/>hw<sp/>+<sp/>1;<sp/>i<sp/>&lt;<sp/><ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref><sp/>-<sp/>hw;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1abe1d65b29fe00e4d80b23dbdff649083" kindref="member">linear_regression</ref>(i,<sp/><ref refid="class_scorealign_1ad049e8da9635fa284dadb6d17cd82bf2" kindref="member">smooth</ref>,<sp/>a,<sp/>b);</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1ab207618c47378f693d84b72f36ac0eb8" kindref="member">smooth_time_map</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/>a<sp/>+<sp/>b<sp/>*<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="420"><highlight class="normal"></highlight><highlight class="preprocessor">#if<sp/>DEBUG_LOG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(dbf,<sp/></highlight><highlight class="stringliteral">&quot;time_map[%d]<sp/>=<sp/>%g,<sp/>smooth_time_map[%d]<sp/>=<sp/>%g\n&quot;</highlight><highlight class="normal">,<sp/></highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i,<sp/><ref refid="class_scorealign_1a9970a288920ebf2706f309a53b3ee362" kindref="member">time_map</ref>[i],<sp/>i,<sp/>a<sp/>+<sp/>b*i);</highlight></codeline>
<codeline lineno="423"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="424"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="425"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="426"><highlight class="normal"></highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>do<sp/>the<sp/>last<sp/>points</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1abe1d65b29fe00e4d80b23dbdff649083" kindref="member">linear_regression</ref>(<ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref><sp/>-<sp/>hw,<sp/><ref refid="class_scorealign_1ad049e8da9635fa284dadb6d17cd82bf2" kindref="member">smooth</ref>,<sp/>a,<sp/>b);</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/><ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref><sp/>-<sp/>hw;<sp/>i<sp/>&lt;=<sp/><ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1ab207618c47378f693d84b72f36ac0eb8" kindref="member">smooth_time_map</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/>a<sp/>+<sp/>b<sp/>*<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>finally,<sp/>fill<sp/>with<sp/>NOT_MAPPED</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/><ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref><sp/>+<sp/>1;<sp/>i<sp/>&lt;<sp/><ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref>;<sp/>i++)<sp/></highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1ab207618c47378f693d84b72f36ac0eb8" kindref="member">smooth_time_map</ref>[i]<sp/>=<sp/><ref refid="scorealign_8h_1a01b46de5b215ad4c37deb1ae2f5f9b01" kindref="member">NOT_MAPPED</ref>;</highlight></codeline>
<codeline lineno="435"><highlight class="normal">}</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="437"><highlight class="normal"></highlight></codeline>
<codeline lineno="438"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>near_line<sp/>--<sp/>see<sp/>if<sp/>point<sp/>is<sp/>near<sp/>line<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="439"><highlight class="normal"></highlight></codeline>
<codeline lineno="440" refid="scorealign_8cpp_1a2b0e50fd298cfddd0f52ff7881b0490e" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="scorealign_8cpp_1a2b0e50fd298cfddd0f52ff7881b0490e" kindref="member">near_line</ref>(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>x1,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>y1,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>x2,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>y2,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/><ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>y)</highlight></codeline>
<codeline lineno="441"><highlight class="normal">{</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>exact_y;</highlight></codeline>
<codeline lineno="443"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(x1<sp/>==<sp/>x)<sp/>{</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exact_y<sp/>=<sp/>y1;</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="446"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="libid3tag_2global_8h_1af576bf8ffa22a44e53018c67095ffbf0" kindref="member">assert</ref>(x1<sp/>!=<sp/>x2);</highlight></codeline>
<codeline lineno="447"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>exact_y<sp/>=<sp/>y1<sp/>+<sp/>(y2<sp/>-<sp/>y1)<sp/>*<sp/>((x<sp/>-<sp/>x1)<sp/>/<sp/>(x2<sp/>-<sp/>x1));</highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/><sp/><sp/>y<sp/>=<sp/>y<sp/>-<sp/>exact_y;</highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>y<sp/>&lt;<sp/>NEAR<sp/>&amp;&amp;<sp/>y<sp/>&gt;<sp/>-<ref refid="scorealign_8cpp_1a8d0baede67fec569c56e8394694570b4" kindref="member">NEAR</ref>;</highlight></codeline>
<codeline lineno="451"><highlight class="normal">}</highlight></codeline>
<codeline lineno="452"><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"></highlight></codeline>
<codeline lineno="454"><highlight class="normal"></highlight><highlight class="comment">//<sp/>path_copy<sp/>--<sp/>copy<sp/>a<sp/>path<sp/>for<sp/>debugging</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="455" refid="scorealign_8cpp_1aba6569f691382afe5f8c958ea94c209b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/>*<ref refid="scorealign_8cpp_1aba6569f691382afe5f8c958ea94c209b" kindref="member">path_copy</ref>(</highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/>*<ref refid="namespacelv2docgen_1ae75d75173fc2ea012acad7d886aa2f9d" kindref="member">path</ref>,<sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="lib_2expat_8h_1af86d325fecfc8f47b61fbf5a5146f582" kindref="member">len</ref>)</highlight></codeline>
<codeline lineno="456"><highlight class="normal">{</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/>*new_path<sp/>=<sp/><ref refid="sautils_8h_1ade0072e12dad159bbf06858a91e47a8c" kindref="member">ALLOC</ref>(</highlight><highlight class="keywordtype">short</highlight><highlight class="normal">,<sp/>len);</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/>memcpy(new_path,<sp/>path,<sp/>len<sp/>*<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(path[0]));</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>new_path;</highlight></codeline>
<codeline lineno="460"><highlight class="normal">}</highlight></codeline>
<codeline lineno="461"><highlight class="normal"></highlight></codeline>
<codeline lineno="462"><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"></highlight><highlight class="comment">/*<sp/>presmooth<sp/>--<sp/>try<sp/>to<sp/>remove<sp/>typical<sp/>dynamic<sp/>programming<sp/>errors</highlight></codeline>
<codeline lineno="464"><highlight class="comment"><sp/>*<sp/></highlight></codeline>
<codeline lineno="465"><highlight class="comment"><sp/>*<sp/>A<sp/>common<sp/>problem<sp/>is<sp/>that<sp/>the<sp/>best<sp/>path<sp/>wanders<sp/>off<sp/>track<sp/>a<sp/>ways</highlight></codeline>
<codeline lineno="466"><highlight class="comment"><sp/>*<sp/>and<sp/>then<sp/>comes<sp/>back.<sp/>The<sp/>idea<sp/>of<sp/>presmoothing<sp/>is<sp/>to<sp/>see<sp/>if<sp/>the</highlight></codeline>
<codeline lineno="467"><highlight class="comment"><sp/>*<sp/>path<sp/>is<sp/>mostly<sp/>a<sp/>straight<sp/>line.<sp/>If<sp/>so,<sp/>adjust<sp/>the<sp/>points<sp/>off<sp/>of</highlight></codeline>
<codeline lineno="468"><highlight class="comment"><sp/>*<sp/>the<sp/>line<sp/>to<sp/>fall<sp/>along<sp/>the<sp/>line.<sp/>The<sp/>variable<sp/>presmooth_time<sp/>is</highlight></codeline>
<codeline lineno="469"><highlight class="comment"><sp/>*<sp/>the<sp/>duration<sp/>of<sp/>the<sp/>line.<sp/>It<sp/>is<sp/>drawn<sp/>between<sp/>every<sp/>pair<sp/>of<sp/></highlight></codeline>
<codeline lineno="470"><highlight class="comment"><sp/>*<sp/>points<sp/>presmooth_time<sp/>apart.<sp/>If<sp/>25%<sp/>of<sp/>the<sp/>first<sp/>half<sp/>of<sp/>the<sp/>line</highlight></codeline>
<codeline lineno="471"><highlight class="comment"><sp/>*<sp/>falls<sp/>within<sp/>one<sp/>frame<sp/>of<sp/>the<sp/>path,<sp/>and<sp/>25%<sp/>of<sp/>the<sp/>second<sp/>half<sp/>of</highlight></codeline>
<codeline lineno="472"><highlight class="comment"><sp/>*<sp/>the<sp/>line<sp/>falls<sp/>within<sp/>one<sp/>frame<sp/>of<sp/>the<sp/>path,<sp/>then<sp/>find<sp/>the<sp/>best</highlight></codeline>
<codeline lineno="473"><highlight class="comment"><sp/>*<sp/>fit<sp/>of<sp/>the<sp/>line<sp/>to<sp/>the<sp/>points<sp/>within<sp/>1<sp/>frame.<sp/>Then<sp/>adjust<sp/>the<sp/>middle</highlight></codeline>
<codeline lineno="474"><highlight class="comment"><sp/>*<sp/>part<sp/>of<sp/>the<sp/>line<sp/>(from<sp/>25%<sp/>to<sp/>75%)<sp/>to<sp/>fall<sp/>along<sp/>the<sp/>line.</highlight></codeline>
<codeline lineno="475"><highlight class="comment"><sp/>*<sp/>Note<sp/>that<sp/>all<sp/>this<sp/>curve<sp/>fitting<sp/>is<sp/>done<sp/>on<sp/>integer<sp/>coordinates.</highlight></codeline>
<codeline lineno="476"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="477" refid="class_scorealign_1a9f7597489507454bd2b704dbe7dd3eb2" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1a9f7597489507454bd2b704dbe7dd3eb2" kindref="member">Scorealign::presmooth</ref>()</highlight></codeline>
<codeline lineno="478"><highlight class="normal">{</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>n<sp/>=<sp/><ref refid="cext_8h_1acd66e8cacf954c3bc3bba81d09425a12" kindref="member">ROUND</ref>(<ref refid="class_scorealign_1abf993742219359f789e1695b546cda87" kindref="member">presmooth_time</ref><sp/>/<sp/><ref refid="class_scorealign_1a446b2b9c38cc31932120ea4749b5eb9f" kindref="member">actual_frame_period_1</ref>);</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/>n<sp/>=<sp/>(n<sp/>+<sp/>3)<sp/>&amp;<sp/>~3;<sp/></highlight><highlight class="comment">//<sp/>round<sp/>up<sp/>to<sp/>multiple<sp/>of<sp/>4</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(n<sp/>&lt;<sp/>4)<sp/>{</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;presmooth<sp/>time<sp/>%g<sp/>rounded<sp/>to<sp/>zero<sp/>%gs<sp/>frame<sp/>periods.\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1abf993742219359f789e1695b546cda87" kindref="member">presmooth_time</ref>,<sp/><ref refid="class_scorealign_1a446b2b9c38cc31932120ea4749b5eb9f" kindref="member">actual_frame_period_1</ref>););</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(i<sp/>&lt;<sp/><ref refid="class_scorealign_1a3a22e20e8be472e87e0f43443c930316" kindref="member">pathlen</ref><sp/>-<sp/>n<sp/>&amp;&amp;<sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[i]<sp/>+<sp/>n<sp/>&lt;=<sp/><ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref>)<sp/>{</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>line<sp/>goes<sp/>from<sp/>i<sp/>to<sp/>i+n-1<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>x1<sp/>=<sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>];</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>xmid<sp/>=<sp/>x1<sp/>+<sp/>n/2;</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>x2<sp/>=<sp/>x1<sp/>+<sp/>n;</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>y1<sp/>=<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>];</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>y2<sp/>=<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[i<sp/>+<sp/>1];<sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>it<sp/>has<sp/>a<sp/>value.<sp/>y2<sp/>should<sp/>be</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="494"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>set<sp/>in<sp/>the<sp/>loop<sp/>below.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>j;</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>search<sp/>for<sp/>y2<sp/>=<sp/>pathy[j]<sp/>s.t.<sp/>pathx[j]<sp/>==<sp/>x2<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(j<sp/>=<sp/>i<sp/>+<sp/>n;<sp/>j<sp/>&lt;<sp/><ref refid="class_scorealign_1a3a22e20e8be472e87e0f43443c930316" kindref="member">pathlen</ref>;<sp/>j++)<sp/>{</highlight></codeline>
<codeline lineno="498"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[j]<sp/>==<sp/>x2)<sp/>{</highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>y2<sp/>=<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[j];</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>should<sp/>not<sp/>happen,<sp/>but<sp/>this<sp/>guarantees<sp/>that<sp/>we<sp/>found</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>y2<sp/>and<sp/>it<sp/>is<sp/>within<sp/>the<sp/>path:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(j<sp/>&gt;=<sp/>pathlen)<sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="506"><highlight class="normal"></highlight></codeline>
<codeline lineno="507"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_regression" kindref="compound">Regression</ref><sp/>regr;</highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>see<sp/>if<sp/>line<sp/>fits<sp/>the<sp/>data<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="rfft2d_test_m_l_8m_1adc468c70fb574ebd07287b38d0d0676d" kindref="member">k</ref><sp/>=<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="cascade_8c_1afea6e77db19a2f8c91419904fe665a3a" kindref="member">count</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[k]<sp/>&lt;<sp/>xmid)<sp/>{<sp/></highlight><highlight class="comment">//<sp/>search<sp/>first<sp/>half</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="scorealign_8cpp_1a2b0e50fd298cfddd0f52ff7881b0490e" kindref="member">near_line</ref>(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal">(x1),<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal">(y1),<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal">(x2),<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal">(y2),<sp/></highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[k],<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[k]))<sp/>{</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>count++;</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>regr.<ref refid="class_regression_1ac593b402bf82ecd47cc20db43195f410" kindref="member">point</ref>(<ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[k],<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[k]);</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>k++;</highlight></codeline>
<codeline lineno="518"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>see<sp/>if<sp/>points<sp/>were<sp/>close<sp/>to<sp/>line<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count<sp/>&lt;<sp/>n/4)<sp/>{</highlight></codeline>
<codeline lineno="521"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i++;</highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>see<sp/>if<sp/>line<sp/>fits<sp/>top<sp/>half<sp/>of<sp/>the<sp/>data<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[k]<sp/>&lt;<sp/>x2)<sp/>{</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="scorealign_8cpp_1a2b0e50fd298cfddd0f52ff7881b0490e" kindref="member">near_line</ref>(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal">(x1),<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal">(y1),<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal">(x2),<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal">(y2),<sp/></highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[k],<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[k]))<sp/>{</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>count++;</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>regr.<ref refid="class_regression_1ac593b402bf82ecd47cc20db43195f410" kindref="member">point</ref>(<ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[k],<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[k]);</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>k++;</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>see<sp/>if<sp/>points<sp/>were<sp/>close<sp/>to<sp/>line<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(count<sp/>&lt;<sp/>n/4)<sp/>{</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i++;</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>debug:<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="539"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;presmoothing<sp/>path<sp/>from<sp/>%d<sp/>to<sp/>%d:\n&quot;</highlight><highlight class="normal">,<sp/>i,<sp/>j);)</highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="lib-src_2libscorealign_2main_8cpp_1af8df65564a341b00b420df5d6c970a61" kindref="member">print_path_range</ref>(<ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>,<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>,<sp/>i,<sp/>j);)</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>fit<sp/>line<sp/>to<sp/>nearby<sp/>points<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>regr.<ref refid="class_regression_1a02c6c8413888038b07365f67ecbdc08c" kindref="member">regress</ref>();</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>adjust<sp/>points<sp/>to<sp/>fall<sp/>along<sp/>line<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>basically<sp/>reconstruct<sp/>pathx<sp/>and<sp/>pathy<sp/>from<sp/>i<sp/>to<sp/>j</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/><ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref><sp/>=<sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>];</highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">short</highlight><highlight class="normal"><sp/>y<sp/>=<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>];</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>k<sp/>=<sp/>i<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;start<sp/>loop:<sp/>j<sp/>%d,<sp/>pathx<sp/>%d,<sp/>pathy<sp/>%d\n&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>j,<sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[j],<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[j]);)</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(x<sp/>&lt;<sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[j]<sp/>||<sp/>y<sp/>&lt;<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[j])<sp/>{</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;top<sp/>of<sp/>loop:<sp/>x<sp/>%d,<sp/>y<sp/>%d\n&quot;</highlight><highlight class="normal">,<sp/>x,<sp/>y);)</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>iteratively<sp/>make<sp/>an<sp/>optional<sp/>move<sp/>in<sp/>the<sp/>+y<sp/>direction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>then<sp/>make<sp/>a<sp/>move<sp/>in<sp/>the<sp/>x<sp/>direction</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>check<sp/>y<sp/>direction:<sp/>want<sp/>to<sp/>move<sp/>to<sp/>y+1<sp/>if<sp/>either<sp/>we<sp/>are<sp/>below</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>desired<sp/>y<sp/>coordinate<sp/>or<sp/>we<sp/>are<sp/>below<sp/>the<sp/>maximum<sp/>slope</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>line<sp/>(if<sp/>y<sp/>is<sp/>too<sp/>low,<sp/>we&apos;ll<sp/>have<sp/>to<sp/>go<sp/>at<sp/>sharper<sp/>than<sp/>2:1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>slope<sp/>to<sp/>get<sp/>to<sp/>pathx[j],<sp/>pathy[j],<sp/>which<sp/>is<sp/>bad</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>target_y<sp/>=<sp/><ref refid="cext_8h_1acd66e8cacf954c3bc3bba81d09425a12" kindref="member">ROUND</ref>(regr.<ref refid="class_regression_1a6b39bd2896a580c21f8ceb184ac9e300" kindref="member">f</ref>(x));</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;target_y@%d<sp/>%d,<sp/>r<sp/>%g,<sp/>&quot;</highlight><highlight class="normal">,<sp/>x,<sp/>target_y,<sp/>regr.<ref refid="class_regression_1a6b39bd2896a580c21f8ceb184ac9e300" kindref="member">f</ref>(x));)</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>but<sp/>what<sp/>if<sp/>the<sp/>line<sp/>goes<sp/>way<sp/>below<sp/>the<sp/>last<sp/>point?</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>we<sp/>don&apos;t<sp/>want<sp/>to<sp/>go<sp/>below<sp/>a<sp/>diagonal<sp/>through<sp/>the<sp/>last<sp/>point</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>dist_to_last_point<sp/>=<sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[j]<sp/>-<sp/>x;</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>minimum_y<sp/>=<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[j]<sp/>-<sp/>2<sp/>*<sp/>dist_to_last_point;</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(target_y<sp/>&lt;<sp/>minimum_y)<sp/>{</highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>target_y<sp/>=<sp/>minimum_y;</highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;minimum_y<sp/>%d,<sp/>&quot;</highlight><highlight class="normal">,<sp/>minimum_y);)</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>alternatively,<sp/>if<sp/>line<sp/>goes<sp/>too<sp/>high:</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>maximum_y<sp/>=<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[j]<sp/>-<sp/>dist_to_last_point<sp/>/<sp/>2;</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(target_y<sp/>&gt;<sp/>maximum_y)<sp/>{</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>target_y<sp/>=<sp/>maximum_y;</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;maximum<sp/>y<sp/>%d,<sp/>&quot;</highlight><highlight class="normal">,<sp/>maximum_y);)</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>advance<sp/>to<sp/>target_y</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(target_y<sp/>&gt;<sp/>y)<sp/>{</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[<ref refid="rfft2d_test_m_l_8m_1adc468c70fb574ebd07287b38d0d0676d" kindref="member">k</ref>]<sp/>=<sp/><ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[<ref refid="rfft2d_test_m_l_8m_1adc468c70fb574ebd07287b38d0d0676d" kindref="member">k</ref>]<sp/>=<sp/>y<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;up:<sp/>pathx[%d]<sp/>%d,<sp/>pathy[%d]<sp/>%d\n&quot;</highlight><highlight class="normal">,<sp/></highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>k,<sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[k],<sp/>k,<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[k]);)</highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>k++;</highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>y++;</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(x<sp/>&lt;<sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[j])<sp/>{</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>advance<sp/>x</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>x++;</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>y<sp/>can<sp/>either<sp/>go<sp/>horizontal<sp/>or<sp/>diagonal,<sp/>i.e.<sp/>y<sp/>either</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>stays<sp/>the<sp/>same<sp/>or<sp/>increments<sp/>by<sp/>one</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>target_y<sp/>=<sp/><ref refid="cext_8h_1acd66e8cacf954c3bc3bba81d09425a12" kindref="member">ROUND</ref>(regr.<ref refid="class_regression_1a6b39bd2896a580c21f8ceb184ac9e300" kindref="member">f</ref>(x));</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;target_y@%d<sp/>%d,<sp/>r<sp/>%g,<sp/>&quot;</highlight><highlight class="normal">,<sp/>x,<sp/>target_y,<sp/>regr.<ref refid="class_regression_1a6b39bd2896a580c21f8ceb184ac9e300" kindref="member">f</ref>(x));)</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(target_y<sp/>&gt;<sp/>y)<sp/>y++;</highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[<ref refid="rfft2d_test_m_l_8m_1adc468c70fb574ebd07287b38d0d0676d" kindref="member">k</ref>]<sp/>=<sp/><ref refid="namespacewaflib_1_1_utils_1a15fc4f04cecad81fba9772c4e43d40f7" kindref="member">x</ref>;</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[<ref refid="rfft2d_test_m_l_8m_1adc468c70fb574ebd07287b38d0d0676d" kindref="member">k</ref>]<sp/>=<sp/>y;</highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;pathx[%d]<sp/>%d,<sp/>pathy[%d]<sp/>%d\n&quot;</highlight><highlight class="normal">,<sp/></highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>k,<sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[k],<sp/>k,<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[k]);)</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>k++;</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>make<sp/>sure<sp/>new<sp/>path<sp/>is<sp/>no<sp/>longer<sp/>than<sp/>original<sp/>path</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>last<sp/>point<sp/>we<sp/>wrote<sp/>was<sp/>k<sp/>-<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>k<sp/>=<sp/>k<sp/>-<sp/>1;<sp/></highlight><highlight class="comment">//<sp/>the<sp/>last<sp/>point<sp/>we<sp/>wrote<sp/>is<sp/>now<sp/>k</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="libid3tag_2global_8h_1af576bf8ffa22a44e53018c67095ffbf0" kindref="member">assert</ref>(k<sp/>&lt;=<sp/>j);</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>if<sp/>new<sp/>path<sp/>is<sp/>shorter<sp/>than<sp/>original,<sp/>then<sp/>fix<sp/>up<sp/>path</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(k<sp/>&lt;<sp/>j)<sp/>{</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memmove(&amp;<ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[k],<sp/>&amp;<ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[j],<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[0])<sp/>*<sp/>(pathlen<sp/>-<sp/>j));</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>memmove(&amp;<ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[k],<sp/>&amp;<ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[j],<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(<ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[0])<sp/>*<sp/>(pathlen<sp/>-<sp/>j));</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pathlen<sp/>-=<sp/>(j<sp/>-<sp/><ref refid="rfft2d_test_m_l_8m_1adc468c70fb574ebd07287b38d0d0676d" kindref="member">k</ref>);</highlight></codeline>
<codeline lineno="607"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>debug<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;after<sp/>presmoothing:\n&quot;</highlight><highlight class="normal">);)</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="lib-src_2libscorealign_2main_8cpp_1af8df65564a341b00b420df5d6c970a61" kindref="member">print_path_range</ref>(<ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>,<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>,<sp/>i,<sp/>k);)</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>since<sp/>we<sp/>adjusted<sp/>the<sp/>path,<sp/>skip<sp/>by<sp/>3/4<sp/>of<sp/>n<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="612"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i<sp/>=<sp/>i<sp/>+<sp/>3<sp/>*<sp/>n/4;</highlight></codeline>
<codeline lineno="613"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="614"><highlight class="normal">}</highlight></codeline>
<codeline lineno="615"><highlight class="normal"></highlight></codeline>
<codeline lineno="616"><highlight class="normal"></highlight></codeline>
<codeline lineno="617"><highlight class="normal"></highlight><highlight class="comment">/*<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>COMPUTE_REGRESSION_LINES</highlight></codeline>
<codeline lineno="618"><highlight class="comment"><sp/><sp/><sp/><sp/>computes<sp/>the<sp/>smooth<sp/>time<sp/>map<sp/>from<sp/>the<sp/>path<sp/>computed</highlight></codeline>
<codeline lineno="619"><highlight class="comment"><sp/><sp/><sp/><sp/>by<sp/>dynamic<sp/>programming</highlight></codeline>
<codeline lineno="620"><highlight class="comment"></highlight></codeline>
<codeline lineno="621"><highlight class="comment">*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="622" refid="class_scorealign_1a9b26d82f2360916c0be5f3dc8d5f5497" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1a9b26d82f2360916c0be5f3dc8d5f5497" kindref="member">Scorealign::compute_regression_lines</ref>()</highlight></codeline>
<codeline lineno="623"><highlight class="normal">{</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>fill<sp/>in<sp/>time_map<sp/>with<sp/>NOT_MAPPED<sp/>until<sp/>the<sp/>first<sp/>point<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>of<sp/>the<sp/>path</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/><ref refid="class_scorealign_1a9aa670b061ce18988086803992d7d1c5" kindref="member">pathx</ref>[0];<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9970a288920ebf2706f309a53b3ee362" kindref="member">time_map</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/><ref refid="scorealign_8h_1a01b46de5b215ad4c37deb1ae2f5f9b01" kindref="member">NOT_MAPPED</ref>;</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>now,<sp/>compute<sp/>the<sp/>y<sp/>value<sp/>of<sp/>the<sp/>path<sp/>at</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>each<sp/>x<sp/>value.<sp/>If<sp/>the<sp/>path<sp/>has<sp/>multiple<sp/>values</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>on<sp/>x,<sp/>take<sp/>the<sp/>average.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="xmltok_8h_1a94b60f3beb36ae85555d36dc9816769c" kindref="member">p</ref><sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>upper,<sp/>lower;</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>pathx[0];<sp/>p<sp/>&lt;<sp/><ref refid="class_scorealign_1a3a22e20e8be472e87e0f43443c930316" kindref="member">pathlen</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>lower<sp/>=<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[<ref refid="xmltok_8h_1a94b60f3beb36ae85555d36dc9816769c" kindref="member">p</ref>];</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(p<sp/>&lt;<sp/>pathlen<sp/>&amp;&amp;<sp/>pathx[p]<sp/>==<sp/>i)<sp/>{</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>upper<sp/>=<sp/><ref refid="class_scorealign_1a6c09342db2cad202c698da99c4ae0e98" kindref="member">pathy</ref>[<ref refid="xmltok_8h_1a94b60f3beb36ae85555d36dc9816769c" kindref="member">p</ref>];</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>p<sp/>=<sp/>p<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9970a288920ebf2706f309a53b3ee362" kindref="member">time_map</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/>(lower<sp/>+<sp/>upper)<sp/>*<sp/>0.5<ref refid="xlftab_8c_1a42257a545daf5b7933d6e8f96adc74f2" kindref="member">F</ref>;</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>fill<sp/>in<sp/>rest<sp/>of<sp/>time_map<sp/>with<sp/>NOT_MAPPED</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>pathx[pathlen<sp/>-<sp/>1]<sp/>+<sp/>1;<sp/>i<sp/>&lt;=<sp/><ref refid="class_scorealign_1a0b75402da0086bbdce6c20862c4f655f" kindref="member">last_x</ref>;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9970a288920ebf2706f309a53b3ee362" kindref="member">time_map</ref>[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>]<sp/>=<sp/><ref refid="scorealign_8h_1a01b46de5b215ad4c37deb1ae2f5f9b01" kindref="member">NOT_MAPPED</ref>;</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>now<sp/>fit<sp/>a<sp/>line<sp/>to<sp/>the<sp/>nearest<sp/>WINDOW<sp/>points<sp/>and<sp/>record<sp/>the<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>line&apos;s<sp/>y<sp/>value<sp/>for<sp/>each<sp/>x.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a04923958d7e9da553d4d6ece755a3701" kindref="member">compute_smooth_time_map</ref>();</highlight></codeline>
<codeline lineno="650"><highlight class="normal">}</highlight></codeline>
<codeline lineno="651"><highlight class="normal"></highlight></codeline>
<codeline lineno="652"><highlight class="normal"></highlight></codeline>
<codeline lineno="653" refid="class_scorealign_1a1b7f13d3e4cd822b05f54e56eb644b1b" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1a1b7f13d3e4cd822b05f54e56eb644b1b" kindref="member">Scorealign::midi_tempo_align</ref>(<ref refid="class_alg__seq" kindref="compound">Alg_seq</ref><sp/>&amp;seq)</highlight></codeline>
<codeline lineno="654"><highlight class="normal">{</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>We<sp/>create<sp/>a<sp/>new<sp/>time<sp/>map<sp/>out<sp/>of<sp/>the<sp/>alignment,<sp/>and<sp/>replace</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>original<sp/>time<sp/>map<sp/>in<sp/>the<sp/>Alg_seq<sp/>sequence</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_alg__seq" kindref="compound">Alg_seq</ref><sp/>new_time_map_seq;</highlight></codeline>
<codeline lineno="658"><highlight class="normal"></highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>totalbeats<sp/>=<sp/>lastbeat<sp/>+<sp/>1<sp/>and<sp/>round<sp/>up<sp/>the<sp/>beat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>totalbeats<sp/>=<sp/>(<ref refid="lib_2expat_8h_1a14bb8924daea0b48c7803f281f66e390" kindref="member">int</ref>)<sp/>seq.<ref refid="class_alg__event__list_1a496becb17280d4fc40a4f922e3f2764f" kindref="member">get_beat_dur</ref>()<sp/>+<sp/>2;</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1af1e35fb2a5a516e2cb77c19b7344b8ff" kindref="member">verbose</ref>)<sp/>{</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>dur_in_sec<sp/>=<sp/>seq.<ref refid="class_alg__event__list_1ad37edb787e09cd6bf2b8e00d20fd15e6" kindref="member">get_real_dur</ref>();<sp/></highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;midi<sp/>duration<sp/>=<sp/>%f,<sp/>totalbeats=%i<sp/>\n&quot;</highlight><highlight class="normal">,<sp/>dur_in_sec,<sp/>totalbeats);<sp/><sp/><sp/></highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="666"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DEBUG_LOG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(dbf,<sp/></highlight><highlight class="stringliteral">&quot;*****************<sp/>CONSTRUCTING<sp/>TIME<sp/>MAP<sp/>***************\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="668"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>turn<sp/>off<sp/>last<sp/>tempo<sp/>flag<sp/>so<sp/>last<sp/>tempo<sp/>will<sp/>extrapolate</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/>new_time_map_seq.<ref refid="class_alg__track_1ae8e1634bcf46d3cce796ed82b76e8b82" kindref="member">get_time_map</ref>()-&gt;<ref refid="class_alg__time__map_1a2b5a61fef806c24c7243801c6ba031b4" kindref="member">last_tempo_flag</ref><sp/>=<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>first_beat<sp/>=<sp/>-1;</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref><sp/>=<sp/>0;<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref><sp/>&lt;<sp/>totalbeats;<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>++)<sp/>{</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>newtime<sp/>=<sp/><ref refid="class_scorealign_1aeebbba309cdbaa0a82de51906cfa243b" kindref="member">map_time</ref>(</highlight><highlight class="keywordtype">float</highlight><highlight class="normal">(seq.<ref refid="class_alg__track_1ae8e1634bcf46d3cce796ed82b76e8b82" kindref="member">get_time_map</ref>()-&gt;<ref refid="class_alg__time__map_1a5ccd6dafb60bf532667ac449fe75e3a3" kindref="member">beat_to_time</ref>(<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>)));</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(newtime<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_time_map_seq.<ref refid="class_alg__seq_1aaa5aab5733a9675ed6ae398420b4575c" kindref="member">insert_beat</ref>(newtime,<sp/>(</highlight><highlight class="keywordtype">double</highlight><highlight class="normal">)<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>);</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>remember<sp/>where<sp/>the<sp/>new<sp/>time<sp/>map<sp/>begins</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(first_beat<sp/>&lt;<sp/>0)<sp/>first_beat<sp/>=<sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>;</highlight></codeline>
<codeline lineno="678"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DEBUG_LOG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fprintf(dbf,<sp/></highlight><highlight class="stringliteral">&quot;map<sp/>beat<sp/>%d<sp/>to<sp/>time<sp/>%g\n&quot;</highlight><highlight class="normal">,<sp/>i,<sp/>newtime);</highlight></codeline>
<codeline lineno="680"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/>seq.<ref refid="class_alg__seq_1ad484e33b62b7a0445f4f78a013a34c8d" kindref="member">convert_to_beats</ref>();</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>end_beat<sp/>=<sp/>seq.<ref refid="class_alg__track_1ae75c10dd3cf2cb2b82d5506449fae4e7" kindref="member">get_dur</ref>();</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="allegro_8h_1a1a64b329a53ae040ef015de7ffd640dd" kindref="member">Alg_time_map_ptr</ref><sp/><ref refid="structmap" kindref="compound">map</ref><sp/>=<sp/>new_time_map_seq.<ref refid="class_alg__track_1ae8e1634bcf46d3cce796ed82b76e8b82" kindref="member">get_time_map</ref>();</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/>seq.<ref refid="class_alg__seq_1a8246038097682b990db6d97eecc032a1" kindref="member">set_time_map</ref>(map);</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>the<sp/>new<sp/>time<sp/>map<sp/>begins<sp/>where<sp/>the<sp/>alignment<sp/>began,<sp/>but<sp/>due<sp/>to</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>smoothing<sp/>and<sp/>rounding,<sp/>there<sp/>may<sp/>be<sp/>some<sp/>edge<sp/>effects.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Try<sp/>to<sp/>set<sp/>the<sp/>tempo<sp/>before<sp/>the<sp/>first_beat<sp/>to<sp/>match<sp/>the<sp/>tempo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>at<sp/>the<sp/>first<sp/>beat<sp/>by<sp/>introducing<sp/>another<sp/>time<sp/>map<sp/>point<sp/>at<sp/>least</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>one<sp/>beat<sp/>before<sp/>the<sp/>first_beat.<sp/>To<sp/>do<sp/>this,<sp/>we<sp/>need<sp/>at<sp/>least</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>2<sp/>beats<sp/>before<sp/>first_beat<sp/>and<sp/>at<sp/>least<sp/>2<sp/>beats<sp/>in<sp/>the<sp/>time<sp/>map<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>(needed<sp/>to<sp/>compute<sp/>initial<sp/>tempo).<sp/>Furthermore,<sp/>the<sp/>tempo<sp/>at<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>first_beat<sp/>could<sp/>be<sp/>so<sp/>slow<sp/>that<sp/>we<sp/>do<sp/>not<sp/>have<sp/>enough<sp/>time<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>before<sp/>first_beat<sp/>to<sp/>anticipate<sp/>the<sp/>tempo.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(first_beat<sp/>&gt;=<sp/>2<sp/>&amp;&amp;<sp/>totalbeats<sp/>&gt;<sp/>first_beat<sp/>+<sp/>1)<sp/>{</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>new_beat<sp/>=<sp/>first_beat<sp/>/<sp/>2;</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>compute<sp/>initial<sp/>tempo<sp/>from<sp/>first_beat<sp/>and<sp/>first_beat<sp/>+<sp/>1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref><sp/>=<sp/>map-&gt;locate_beat(first_beat);</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>t1<sp/>=<sp/>map-&gt;beats[<ref refid="checksum_8c_1ab80e330a3bc9e38c1297fe17381e92b4" kindref="member">i</ref>].time;</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>t2<sp/>=<sp/>map-&gt;beats[i<sp/>+<sp/>1].time;</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>spb<sp/>=<sp/>(t2<sp/>-<sp/>t1);<sp/></highlight><highlight class="comment">//<sp/>seconds<sp/>per<sp/>beat,<sp/>beat<sp/>period</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">double</highlight><highlight class="normal"><sp/>new_time<sp/>=<sp/>t1<sp/>-<sp/>(first_beat<sp/>-<sp/>new_beat)<sp/>*<sp/>spb;</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(new_time<sp/>&lt;=<sp/>0.2)<sp/>{</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>not<sp/>enough<sp/>time<sp/>to<sp/>start<sp/>at<sp/>new_time,<sp/>new_beat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>let&apos;s<sp/>try<sp/>using<sp/>half<sp/>the<sp/>time<sp/>rather<sp/>than<sp/>half<sp/>the<sp/>beats</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_time<sp/>=<sp/>t1<sp/>/<sp/>2.0;</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>this<sp/>will<sp/>round<sp/>down,<sp/>so<sp/>new_beat<sp/>&lt;<sp/>first_beat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_beat<sp/>=<sp/><ref refid="lib_2expat_8h_1a14bb8924daea0b48c7803f281f66e390" kindref="member">int</ref>(first_beat<sp/>-<sp/>(t1<sp/>/<sp/>2)<sp/>/<sp/>spb);</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_time<sp/>=<sp/>t1<sp/>-<sp/>(first_beat<sp/>-<sp/>new_beat)<sp/>*<sp/>spb;</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>need<sp/>to<sp/>check<sp/>again<sp/>if<sp/>new_beat<sp/>would<sp/>be<sp/>too<sp/>early</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(new_time<sp/>&gt;<sp/>0.2)<sp/>{</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>map-&gt;insert_beat(new_time,<sp/>new_beat);</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Note:<sp/>final<sp/>tempo<sp/>is<sp/>extrapolated,<sp/>so<sp/>no<sp/>need<sp/>to<sp/>insert<sp/>new</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>time<sp/>map<sp/>points<sp/>beyond<sp/>the<sp/>last<sp/>one</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/>seq.<ref refid="class_alg__track_1ac1c85f55f171236cd6fcebf5d621efb2" kindref="member">set_dur</ref>(end_beat);</highlight></codeline>
<codeline lineno="720"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>DEBUG_LOG</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/>fprintf(dbf,<sp/></highlight><highlight class="stringliteral">&quot;\nend_beat<sp/>%g<sp/>end<sp/>time<sp/>%g\n&quot;</highlight><highlight class="normal">,<sp/></highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>seq.<ref refid="class_alg__event__list_1a496becb17280d4fc40a4f922e3f2764f" kindref="member">get_beat_dur</ref>(),<sp/>seq.<ref refid="class_alg__event__list_1ad37edb787e09cd6bf2b8e00d20fd15e6" kindref="member">get_real_dur</ref>());</highlight></codeline>
<codeline lineno="723"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="724"><highlight class="normal">}</highlight></codeline>
<codeline lineno="725"><highlight class="normal"></highlight></codeline>
<codeline lineno="726"><highlight class="normal"></highlight></codeline>
<codeline lineno="727"><highlight class="normal"></highlight><highlight class="comment">//<sp/>this<sp/>routine<sp/>performs<sp/>an<sp/>alignment<sp/>by<sp/>adjusting<sp/>midi<sp/>to<sp/>match<sp/>audio</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="728"><highlight class="normal"></highlight><highlight class="comment">//</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="729" refid="class_scorealign_1aa6a81c58ac35cb4910946072402ef1b9" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1aa6a81c58ac35cb4910946072402ef1b9" kindref="member">Scorealign::align_midi_to_audio</ref>(<ref refid="class_alg__seq" kindref="compound">Alg_seq</ref><sp/>&amp;seq,<sp/><ref refid="class_audio__reader" kindref="compound">Audio_reader</ref><sp/>&amp;reader)</highlight></codeline>
<codeline lineno="730"><highlight class="normal">{</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/><ref refid="seqread_8c_1a3c79b5a9ee81c3835b8de9b0d900d2de" kindref="member">dur</ref><sp/>=<sp/>0.0F;</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nnotes<sp/>=<sp/><ref refid="scorealign_8cpp_1aa9be42ecbca6531ffa8b151f3291272d" kindref="member">find_midi_duration</ref>(seq,<sp/>&amp;dur);</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>)<sp/>{</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1aa4665d7efb28713004b4ac0bd16f1628" kindref="member">set_frame_period</ref>(<ref refid="class_scorealign_1a47f51125e3cb2018d1baa349be161be7" kindref="member">frame_period</ref>);</highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ad44ef2f6eb642d6d6f37519a112e2834" kindref="member">set_smoothing</ref>(<ref refid="class_scorealign_1a0e8480364897c190afc0c7fd432a78f7" kindref="member">line_time</ref><sp/>&gt;<sp/>0.0);</highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ae6a92d8858b245e7836956ae598ce4fa" kindref="member">set_duration</ref>(0,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">,<sp/>dur);</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ae6a92d8858b245e7836956ae598ce4fa" kindref="member">set_duration</ref>(1,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal">(reader.<ref refid="class_audio__reader_1a18f336bca2ab2d688bfe313a8fcdbb40" kindref="member">actual_frame_period</ref><sp/>*<sp/></highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reader.<ref refid="class_audio__reader_1a611b81d8b494d5a1e9779bb9d8cbc018" kindref="member">frame_count</ref>));</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ab9551ace06ed5ba0688c14b5e7bc58b8" kindref="member">set_phase</ref>(0);</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Generate<sp/>the<sp/>chroma<sp/>for<sp/>file<sp/>0<sp/></highlight></codeline>
<codeline lineno="742"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*<sp/>This<sp/>will<sp/>always<sp/>be<sp/>the<sp/>MIDI<sp/>File<sp/>when<sp/>aligning<sp/>midi<sp/>with<sp/>audio.</highlight></codeline>
<codeline lineno="743"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref><sp/>=<sp/><ref refid="class_scorealign_1a3e123c40feefe620c0e830ef9380baa1" kindref="member">gen_chroma_midi</ref>(seq,<sp/>dur,<sp/>nnotes,<sp/><ref refid="scorealign_8cpp_1ae00436fbbc35556bf1b2a201df86679d" kindref="member">HIGH_CUTOFF</ref>,<sp/><ref refid="scorealign_8cpp_1a30df9f42a61dde8d0acc6d3a81ca0977" kindref="member">LOW_CUTOFF</ref>,<sp/></highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="class_scorealign_1a65e1070af091985304c02797ce210170" kindref="member">chrom_energy0</ref>,<sp/>&amp;<ref refid="class_scorealign_1afd2fe7e5977be513cf0255a8d3836678" kindref="member">actual_frame_period_0</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="746"><highlight class="normal"></highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Generate<sp/>the<sp/>chroma<sp/>for<sp/>file<sp/>1<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>)<sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ab9551ace06ed5ba0688c14b5e7bc58b8" kindref="member">set_phase</ref>(1);</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1ab0ea5cd44003743384ac8e39752155cb" kindref="member">file1_frames</ref><sp/>=<sp/><ref refid="class_scorealign_1a321aa0e85c1b8d97158ad1eebe0f29d0" kindref="member">gen_chroma_audio</ref>(reader,<sp/><ref refid="scorealign_8cpp_1ae00436fbbc35556bf1b2a201df86679d" kindref="member">HIGH_CUTOFF</ref>,<sp/><ref refid="scorealign_8cpp_1a30df9f42a61dde8d0acc6d3a81ca0977" kindref="member">LOW_CUTOFF</ref>,<sp/></highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="class_scorealign_1ac094f1c6ed01fb8f9988bec933208bde" kindref="member">chrom_energy1</ref>,<sp/>&amp;<ref refid="class_scorealign_1a446b2b9c38cc31932120ea4749b5eb9f" kindref="member">actual_frame_period_1</ref>,<sp/>1);</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1a7ea9b49c78bd880dad488a68cdee5aab" kindref="member">align_chromagrams</ref>();</highlight></codeline>
<codeline lineno="752"><highlight class="normal">}</highlight></codeline>
<codeline lineno="753"><highlight class="normal"></highlight></codeline>
<codeline lineno="754" refid="class_scorealign_1a541fb5fafb2c6043bebb229c3cd7afff" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1a541fb5fafb2c6043bebb229c3cd7afff" kindref="member">Scorealign::align_audio_to_audio</ref>(<ref refid="class_audio__reader" kindref="compound">Audio_reader</ref><sp/>&amp;reader0,</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_audio__reader" kindref="compound">Audio_reader</ref><sp/>&amp;reader1)</highlight></codeline>
<codeline lineno="756"><highlight class="normal">{</highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>)<sp/>{</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1aa4665d7efb28713004b4ac0bd16f1628" kindref="member">set_frame_period</ref>(<ref refid="class_scorealign_1a47f51125e3cb2018d1baa349be161be7" kindref="member">frame_period</ref>);</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ae6a92d8858b245e7836956ae598ce4fa" kindref="member">set_duration</ref>(0,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal">(reader0.<ref refid="class_audio__reader_1a18f336bca2ab2d688bfe313a8fcdbb40" kindref="member">actual_frame_period</ref><sp/>*<sp/></highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reader0.<ref refid="class_audio__reader_1a611b81d8b494d5a1e9779bb9d8cbc018" kindref="member">frame_count</ref>));</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ae6a92d8858b245e7836956ae598ce4fa" kindref="member">set_duration</ref>(1,<sp/></highlight><highlight class="keyword">true</highlight><highlight class="normal">,<sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal">(reader1.<ref refid="class_audio__reader_1a18f336bca2ab2d688bfe313a8fcdbb40" kindref="member">actual_frame_period</ref><sp/>*<sp/></highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reader1.<ref refid="class_audio__reader_1a611b81d8b494d5a1e9779bb9d8cbc018" kindref="member">frame_count</ref>));</highlight></codeline>
<codeline lineno="763"><highlight class="normal"></highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ab9551ace06ed5ba0688c14b5e7bc58b8" kindref="member">set_phase</ref>(0);</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ad44ef2f6eb642d6d6f37519a112e2834" kindref="member">set_smoothing</ref>(<ref refid="class_scorealign_1a0e8480364897c190afc0c7fd432a78f7" kindref="member">line_time</ref><sp/>&gt;<sp/>0.0);</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref><sp/>=<sp/><ref refid="class_scorealign_1a321aa0e85c1b8d97158ad1eebe0f29d0" kindref="member">gen_chroma_audio</ref>(reader0,<sp/><ref refid="scorealign_8cpp_1ae00436fbbc35556bf1b2a201df86679d" kindref="member">HIGH_CUTOFF</ref>,<sp/><ref refid="scorealign_8cpp_1a30df9f42a61dde8d0acc6d3a81ca0977" kindref="member">LOW_CUTOFF</ref>,<sp/></highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="class_scorealign_1a65e1070af091985304c02797ce210170" kindref="member">chrom_energy0</ref>,<sp/>&amp;<ref refid="class_scorealign_1afd2fe7e5977be513cf0255a8d3836678" kindref="member">actual_frame_period_0</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="769"><highlight class="normal"></highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>)<sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ab9551ace06ed5ba0688c14b5e7bc58b8" kindref="member">set_phase</ref>(1);</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1ab0ea5cd44003743384ac8e39752155cb" kindref="member">file1_frames</ref><sp/>=<sp/><ref refid="class_scorealign_1a321aa0e85c1b8d97158ad1eebe0f29d0" kindref="member">gen_chroma_audio</ref>(reader1,<sp/><ref refid="scorealign_8cpp_1ae00436fbbc35556bf1b2a201df86679d" kindref="member">HIGH_CUTOFF</ref>,<sp/><ref refid="scorealign_8cpp_1a30df9f42a61dde8d0acc6d3a81ca0977" kindref="member">LOW_CUTOFF</ref>,<sp/></highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="class_scorealign_1ac094f1c6ed01fb8f9988bec933208bde" kindref="member">chrom_energy1</ref>,<sp/>&amp;<ref refid="class_scorealign_1a446b2b9c38cc31932120ea4749b5eb9f" kindref="member">actual_frame_period_1</ref>,<sp/>1);</highlight></codeline>
<codeline lineno="773"><highlight class="normal"></highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1a7ea9b49c78bd880dad488a68cdee5aab" kindref="member">align_chromagrams</ref>();</highlight></codeline>
<codeline lineno="775"><highlight class="normal">}</highlight></codeline>
<codeline lineno="776"><highlight class="normal"></highlight></codeline>
<codeline lineno="777"><highlight class="normal"></highlight></codeline>
<codeline lineno="778" refid="class_scorealign_1a791e1a30a36f443da8c28efdc62f0bf6" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1a791e1a30a36f443da8c28efdc62f0bf6" kindref="member">Scorealign::align_midi_to_midi</ref>(<ref refid="class_alg__seq" kindref="compound">Alg_seq</ref><sp/>&amp;seq0,<sp/><ref refid="class_alg__seq" kindref="compound">Alg_seq</ref><sp/>&amp;seq1)</highlight></codeline>
<codeline lineno="779"><highlight class="normal">{</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>dur0<sp/>=<sp/>0.0F;</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nnotes0<sp/>=<sp/><ref refid="scorealign_8cpp_1aa9be42ecbca6531ffa8b151f3291272d" kindref="member">find_midi_duration</ref>(seq0,<sp/>&amp;dur0);</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">float</highlight><highlight class="normal"><sp/>dur1<sp/>=<sp/>0.0F;</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>nnotes1<sp/>=<sp/><ref refid="scorealign_8cpp_1aa9be42ecbca6531ffa8b151f3291272d" kindref="member">find_midi_duration</ref>(seq1,<sp/>&amp;dur1);</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>)<sp/>{</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1aa4665d7efb28713004b4ac0bd16f1628" kindref="member">set_frame_period</ref>(<ref refid="class_scorealign_1a47f51125e3cb2018d1baa349be161be7" kindref="member">frame_period</ref>);</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ad44ef2f6eb642d6d6f37519a112e2834" kindref="member">set_smoothing</ref>(<ref refid="class_scorealign_1a0e8480364897c190afc0c7fd432a78f7" kindref="member">line_time</ref><sp/>&gt;<sp/>0.0);</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ae6a92d8858b245e7836956ae598ce4fa" kindref="member">set_duration</ref>(0,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">,<sp/>dur0);</highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ae6a92d8858b245e7836956ae598ce4fa" kindref="member">set_duration</ref>(1,<sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">,<sp/>dur1);</highlight></codeline>
<codeline lineno="789"><highlight class="normal"></highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ab9551ace06ed5ba0688c14b5e7bc58b8" kindref="member">set_phase</ref>(0);</highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref><sp/>=<sp/><ref refid="class_scorealign_1a3e123c40feefe620c0e830ef9380baa1" kindref="member">gen_chroma_midi</ref>(seq0,<sp/>dur0,<sp/>nnotes0,<sp/></highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8cpp_1ae00436fbbc35556bf1b2a201df86679d" kindref="member">HIGH_CUTOFF</ref>,<sp/><ref refid="scorealign_8cpp_1a30df9f42a61dde8d0acc6d3a81ca0977" kindref="member">LOW_CUTOFF</ref>,<sp/></highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="class_scorealign_1a65e1070af091985304c02797ce210170" kindref="member">chrom_energy0</ref>,<sp/>&amp;<ref refid="class_scorealign_1afd2fe7e5977be513cf0255a8d3836678" kindref="member">actual_frame_period_0</ref>,<sp/>0);</highlight></codeline>
<codeline lineno="795"><highlight class="normal"></highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>)<sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ab9551ace06ed5ba0688c14b5e7bc58b8" kindref="member">set_phase</ref>(1);</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1ab0ea5cd44003743384ac8e39752155cb" kindref="member">file1_frames</ref><sp/>=<sp/><ref refid="class_scorealign_1a3e123c40feefe620c0e830ef9380baa1" kindref="member">gen_chroma_midi</ref>(seq1,<sp/>dur1,<sp/>nnotes1,<sp/></highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="scorealign_8cpp_1ae00436fbbc35556bf1b2a201df86679d" kindref="member">HIGH_CUTOFF</ref>,<sp/><ref refid="scorealign_8cpp_1a30df9f42a61dde8d0acc6d3a81ca0977" kindref="member">LOW_CUTOFF</ref>,<sp/></highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;<ref refid="class_scorealign_1ac094f1c6ed01fb8f9988bec933208bde" kindref="member">chrom_energy1</ref>,<sp/>&amp;<ref refid="class_scorealign_1a446b2b9c38cc31932120ea4749b5eb9f" kindref="member">actual_frame_period_1</ref>,<sp/>1);</highlight></codeline>
<codeline lineno="800"><highlight class="normal"></highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1a7ea9b49c78bd880dad488a68cdee5aab" kindref="member">align_chromagrams</ref>();</highlight></codeline>
<codeline lineno="802"><highlight class="normal">}</highlight></codeline>
<codeline lineno="803"><highlight class="normal"></highlight></codeline>
<codeline lineno="804" refid="class_scorealign_1a7ea9b49c78bd880dad488a68cdee5aab" refkind="member"><highlight class="normal"></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/><ref refid="class_scorealign_1a7ea9b49c78bd880dad488a68cdee5aab" kindref="member">Scorealign::align_chromagrams</ref>()</highlight></codeline>
<codeline lineno="805"><highlight class="normal">{</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>)<sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ab9551ace06ed5ba0688c14b5e7bc58b8" kindref="member">set_phase</ref>(2);</highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1af1e35fb2a5a516e2cb77c19b7344b8ff" kindref="member">verbose</ref>)</highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;\nGenerated<sp/>Chroma.\n&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>now<sp/>that<sp/>we<sp/>have<sp/>actual_frame_period_1,<sp/>we<sp/>can<sp/>compute<sp/>smooth<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>smooth<sp/>is<sp/>an<sp/>odd<sp/>number<sp/>of<sp/>frames<sp/>that<sp/>spans<sp/>about<sp/>smooth_time</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1ad049e8da9635fa284dadb6d17cd82bf2" kindref="member">smooth</ref><sp/>=<sp/><ref refid="cext_8h_1acd66e8cacf954c3bc3bba81d09425a12" kindref="member">ROUND</ref>(<ref refid="class_scorealign_1ab2421e375fa06931019107530ef0362d" kindref="member">smooth_time</ref><sp/>/<sp/><ref refid="class_scorealign_1a446b2b9c38cc31932120ea4749b5eb9f" kindref="member">actual_frame_period_1</ref>);</highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1ad049e8da9635fa284dadb6d17cd82bf2" kindref="member">smooth</ref><sp/>&lt;<sp/>3)<sp/><ref refid="class_scorealign_1ad049e8da9635fa284dadb6d17cd82bf2" kindref="member">smooth</ref><sp/>=<sp/>3;</highlight></codeline>
<codeline lineno="813"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!(<ref refid="class_scorealign_1ad049e8da9635fa284dadb6d17cd82bf2" kindref="member">smooth</ref><sp/>&amp;<sp/>1))<sp/><ref refid="class_scorealign_1ad049e8da9635fa284dadb6d17cd82bf2" kindref="member">smooth</ref>++;<sp/></highlight><highlight class="comment">//<sp/>must<sp/>be<sp/>odd</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1af1e35fb2a5a516e2cb77c19b7344b8ff" kindref="member">verbose</ref>)<sp/>{</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;smoothing<sp/>time<sp/>is<sp/>%g\n&quot;</highlight><highlight class="normal">,<sp/><ref refid="class_scorealign_1ab2421e375fa06931019107530ef0362d" kindref="member">smooth_time</ref>);</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;smooth<sp/>count<sp/>is<sp/>%d\n&quot;</highlight><highlight class="normal">,<sp/><ref refid="class_scorealign_1ad049e8da9635fa284dadb6d17cd82bf2" kindref="member">smooth</ref>);</highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="818"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;Chromagram<sp/>data<sp/>for<sp/>file<sp/>0:\n&quot;</highlight><highlight class="normal">);)</highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="lib-src_2libscorealign_2main_8cpp_1a4c70cd48d529ccaad182022ec8ac262e" kindref="member">print_chroma_table</ref>(<ref refid="class_scorealign_1a65e1070af091985304c02797ce210170" kindref="member">chrom_energy0</ref>,<sp/><ref refid="class_scorealign_1a43bab7477ee687ed17d676a81c3e9ced" kindref="member">file0_frames</ref>);)</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="octave__test_8m_1ac6d0e62c65e5715b13a5fcb381118888" kindref="member">printf</ref>(</highlight><highlight class="stringliteral">&quot;Chromagram<sp/>data<sp/>for<sp/>file<sp/>1:\n&quot;</highlight><highlight class="normal">);)</highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="scorealign_8h_1a61fdb24fabaa450f0d682a4025495730" kindref="member">SA_V</ref>(<ref refid="lib-src_2libscorealign_2main_8cpp_1a4c70cd48d529ccaad182022ec8ac262e" kindref="member">print_chroma_table</ref>(<ref refid="class_scorealign_1ac094f1c6ed01fb8f9988bec933208bde" kindref="member">chrom_energy1</ref>,<sp/><ref refid="class_scorealign_1ab0ea5cd44003743384ac8e39752155cb" kindref="member">file1_frames</ref>);)</highlight></codeline>
<codeline lineno="822"><highlight class="normal"></highlight></codeline>
<codeline lineno="823"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Compare<sp/>the<sp/>chroma<sp/>frames<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="824"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>result<sp/>=<sp/><ref refid="class_scorealign_1a53aeb04a4368f66f94c9559c13bb98b5" kindref="member">compare_chroma</ref>();</highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(result<sp/>!=<sp/><ref refid="scorealign_8h_1a0ac0b7994a7d738aa77d2c1cfe8d6d13a12d062c880df80216d51b92e1bf09632" kindref="member">SA_SUCCESS</ref>)<sp/>{</highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="827"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>)<sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ab9551ace06ed5ba0688c14b5e7bc58b8" kindref="member">set_phase</ref>(3);</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Compute<sp/>the<sp/>smooth<sp/>time<sp/>map<sp/>now<sp/>for<sp/>use<sp/>by<sp/>curve-fitting<sp/>*/</highlight><highlight class="normal"><sp/><sp/></highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9b26d82f2360916c0be5f3dc8d5f5497" kindref="member">compute_regression_lines</ref>();</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>if<sp/>presmooth_time<sp/>is<sp/>set,<sp/>do<sp/>presmoothing<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1abf993742219359f789e1695b546cda87" kindref="member">presmooth_time</ref><sp/>&gt;<sp/>0.0)<sp/>{</highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9f7597489507454bd2b704dbe7dd3eb2" kindref="member">presmooth</ref>();</highlight></codeline>
<codeline lineno="834"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Redo<sp/>the<sp/>smooth<sp/>time<sp/>map<sp/>after<sp/>curve<sp/>fitting<sp/>or<sp/>smoothing<sp/>*/</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9b26d82f2360916c0be5f3dc8d5f5497" kindref="member">compute_regression_lines</ref>();</highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>if<sp/>line_time<sp/>is<sp/>set,<sp/>do<sp/>curve-fitting<sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a0e8480364897c190afc0c7fd432a78f7" kindref="member">line_time</ref><sp/>&gt;<sp/>0.0)<sp/>{</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="curvefit_8cpp_1a2e68c02d8cc3d3a48a1867a3a8c05254" kindref="member">curve_fitting</ref>(</highlight><highlight class="keyword">this</highlight><highlight class="normal">,<sp/><ref refid="class_scorealign_1af1e35fb2a5a516e2cb77c19b7344b8ff" kindref="member">verbose</ref>);</highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/>Redo<sp/>the<sp/>smooth<sp/>time<sp/>map<sp/>after<sp/>curve<sp/>fitting<sp/>or<sp/>smoothing<sp/>*/</highlight><highlight class="normal"><sp/></highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="class_scorealign_1a9b26d82f2360916c0be5f3dc8d5f5497" kindref="member">compute_regression_lines</ref>();</highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>)<sp/><ref refid="class_scorealign_1a3fa5103411223026f9785f896c8f9572" kindref="member">progress</ref>-&gt;<ref refid="class_s_a_progress_1ab9551ace06ed5ba0688c14b5e7bc58b8" kindref="member">set_phase</ref>(4);</highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="scorealign_8h_1a0ac0b7994a7d738aa77d2c1cfe8d6d13a12d062c880df80216d51b92e1bf09632" kindref="member">SA_SUCCESS</ref>;</highlight></codeline>
<codeline lineno="845"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="C:/_dev/OpenU/Audacity/audacity/lib-src/libscorealign/scorealign.cpp"/>
  </compounddef>
</doxygen>
