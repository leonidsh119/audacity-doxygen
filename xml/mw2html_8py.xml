<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.11">
  <compounddef id="mw2html_8py" kind="file" language="Python">
    <compoundname>mw2html.py</compoundname>
    <innerclass refid="classmw2html_1_1_config" prot="public">mw2html::Config</innerclass>
    <innernamespace refid="namespacemw2html">mw2html</innernamespace>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1" refid="namespacemw2html" refkind="compound"><highlight class="comment">#!<sp/>/usr/bin/env<sp/>python</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="2"><highlight class="normal"></highlight></codeline>
<codeline lineno="3"><highlight class="normal"></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="4"><highlight class="stringliteral">mw2html<sp/>-<sp/>Mediawiki<sp/>to<sp/>static<sp/>HTML</highlight></codeline>
<codeline lineno="5"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="6"><highlight class="stringliteral">I<sp/>use<sp/>this<sp/>to<sp/>create<sp/>a<sp/>personal<sp/>website<sp/>from<sp/>a<sp/>local<sp/>mediawiki</highlight></codeline>
<codeline lineno="7"><highlight class="stringliteral">installation.<sp/><sp/>No<sp/>search<sp/>functionality.<sp/><sp/>Hacks<sp/>the<sp/>Monobook<sp/>skin<sp/>and</highlight></codeline>
<codeline lineno="8"><highlight class="stringliteral">the<sp/>produced<sp/>HTML.</highlight></codeline>
<codeline lineno="9"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="10"><highlight class="stringliteral">Connelly<sp/>Barnes<sp/>2005.<sp/><sp/>Public<sp/>domain.</highlight></codeline>
<codeline lineno="11"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="12"><highlight class="stringliteral">Reworked<sp/>by<sp/>Andre<sp/>Pinto<sp/>2009.</highlight></codeline>
<codeline lineno="13"><highlight class="stringliteral">Improved<sp/>performance.</highlight></codeline>
<codeline lineno="14"><highlight class="stringliteral">Improved<sp/>filtering.</highlight></codeline>
<codeline lineno="15"><highlight class="stringliteral">Improved<sp/>usability.</highlight></codeline>
<codeline lineno="16"><highlight class="stringliteral">Customized<sp/>for<sp/>Audacity&apos;s<sp/>manual<sp/>wiki.</highlight></codeline>
<codeline lineno="17"><highlight class="stringliteral">Minor<sp/>tweaks<sp/>(for<sp/>Audacity)<sp/>By<sp/>James<sp/>Crook,<sp/>Nov<sp/>2009.</highlight></codeline>
<codeline lineno="18"><highlight class="stringliteral">...</highlight></codeline>
<codeline lineno="19"><highlight class="stringliteral">&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal">__version__<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;0.1.0.0&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>re</highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>sys</highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>getopt</highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>random</highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>urllib</highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>textwrap</highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>urlparse</highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>os,<sp/>os.path</highlight></codeline>
<codeline lineno="31"><highlight class="normal"></highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>errno</highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>hashlib</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>httplib</highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight><highlight class="comment">#import<sp/>pdb</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>time<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>strftime</highlight></codeline>
<codeline lineno="37"><highlight class="normal"></highlight></codeline>
<codeline lineno="38"><highlight class="normal"></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="39"><highlight class="normal"><sp/><sp/><sp/><sp/>set</highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="keywordflow">except</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="41"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">from</highlight><highlight class="normal"><sp/>sets<sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>Set<sp/></highlight><highlight class="keyword">as</highlight><highlight class="normal"><sp/>set</highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="44"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">import</highlight><highlight class="normal"><sp/>htmldata</highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="keywordflow">except</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="46"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;Requires<sp/>Python<sp/>htmldata<sp/>module:&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;<sp/><sp/>http://www.connellybarnes.com/code/htmldata/&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"><sp/><sp/><sp/><sp/>sys.exit()</highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight></codeline>
<codeline lineno="50" refid="namespacemw2html_1a2313c67e4bb7b195ff9b5101bac8977b" refkind="member"><highlight class="normal">config<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51" refid="namespacemw2html_1a3e4055cf6a1070956dccf42a6ed72682" refkind="member"><highlight class="normal">MOVE_HREF<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;movehref&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52" refid="namespacemw2html_1af867388bb30ff9e3ab0a3cc2bf2159b5" refkind="member"><highlight class="normal">MADE_BY_COMMENT<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&lt;!--<sp/>Content<sp/>generated<sp/>by<sp/>Mediawiki<sp/>and<sp/>mw2html<sp/>--&gt;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53" refid="namespacemw2html_1a1172eca7f1e8a94d3f3e37d91d3bfa22" refkind="member"><highlight class="normal">INDEX_HTML<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;index.html&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54" refid="namespacemw2html_1a9751c2e63a93046633dc33af625ceb32" refkind="member"><highlight class="normal">QHELP_HTML<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;quick_help.html&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55" refid="namespacemw2html_1aad7750e105e67d26e3cb87d62d78cb0b" refkind="member"><highlight class="normal">url_filename_cache<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="56" refid="namespacemw2html_1ac19c25d8c5f0e9ce859a9358615724eb" refkind="member"><highlight class="normal">redir_cache<sp/>=<sp/>{}</highlight></codeline>
<codeline lineno="57" refid="namespacemw2html_1ab2a6ee1e9196f93318d9e9819b0084e6" refkind="member"><highlight class="normal">wrote_file_set<sp/>=<sp/>set()</highlight></codeline>
<codeline lineno="58" refid="namespacemw2html_1ab1100d5e32fc3ee7258fe49d72805377" refkind="member"><highlight class="normal">sidebar_html<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59" refid="namespacemw2html_1a826a5658c74f288f0efba19ab6b5e9d5" refkind="member"><highlight class="normal">footer_text<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="60" refid="namespacemw2html_1a1883350fdf7ae46dbc49d9efc4dace3b" refkind="member"><highlight class="normal">counter<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="61" refid="namespacemw2html_1a528858fd08982d70557f6c370383c876" refkind="member"><highlight class="normal">errors<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="62" refid="namespacemw2html_1a97cceba50a9da89b1bab3ff979d41a2b" refkind="member"><highlight class="normal">conn<sp/>=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63" refid="namespacemw2html_1a673cf42debbef44a18944c885b0e2f31" refkind="member"><highlight class="normal">domain<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight></codeline>
<codeline lineno="65" refid="namespacemw2html_1a0f008e4b1e0268f9ef3546e5a4cafc9b" refkind="member"><highlight class="normal">MONOBOOK_SKIN<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;monobook&apos;</highlight><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Constant<sp/>identifier<sp/>for<sp/>Monobook.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight></codeline>
<codeline lineno="67" refid="classmw2html_1_1_config" refkind="compound"><highlight class="normal"></highlight><highlight class="keyword">class<sp/></highlight><highlight class="normal"><ref refid="classmw2html_1_1_config" kindref="compound">Config</ref>:</highlight></codeline>
<codeline lineno="68"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="69"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Instances<sp/>contain<sp/>all<sp/>options<sp/>passed<sp/>at<sp/>the<sp/>command<sp/>line.</highlight></codeline>
<codeline lineno="70"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="classmw2html_1_1_config_1a1609bd276313ad49de96c458077682eb" kindref="member">__init__</ref>(self,<sp/>rooturl,<sp/>outdir,</highlight></codeline>
<codeline lineno="72"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>flatten=</highlight><highlight class="keyword">True</highlight><highlight class="normal">,<sp/>index=</highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/>clean=</highlight><highlight class="keyword">True</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sidebar=</highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,<sp/>hack_skin=</highlight><highlight class="keyword">True</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>made_by=</highlight><highlight class="keyword">True</highlight><highlight class="normal">,<sp/>overwrite=</highlight><highlight class="keyword">False</highlight><highlight class="normal">,<sp/>footer=</highlight><highlight class="keywordtype">None</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="75"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>skin=MONOBOOK_SKIN,<sp/>move_href=</highlight><highlight class="keyword">True</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>remove_png=</highlight><highlight class="keyword">True</highlight><highlight class="normal">,<sp/>remove_history=</highlight><highlight class="keyword">True</highlight><highlight class="normal">,<sp/>limit_parent=</highlight><highlight class="keyword">False</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="77" refid="classmw2html_1_1_config_1a1609bd276313ad49de96c458077682eb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>special_mode=</highlight><highlight class="keyword">False</highlight><highlight class="normal">,<sp/>debug=</highlight><highlight class="keyword">False</highlight><highlight class="normal">,<sp/>no_images=</highlight><highlight class="keyword">False</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="78" refid="classmw2html_1_1_config_1aeb12a940f1165d5abf67ba33dae59d28" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1aeb12a940f1165d5abf67ba33dae59d28" kindref="member">rooturl</ref><sp/>=<sp/>rooturl</highlight></codeline>
<codeline lineno="79" refid="classmw2html_1_1_config_1ab1b06f551981590e3602ef342c9ec426" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1ab1b06f551981590e3602ef342c9ec426" kindref="member">outdir</ref><sp/>=<sp/>os.path.abspath(outdir)</highlight></codeline>
<codeline lineno="80" refid="classmw2html_1_1_config_1a68f835fe25e82cb83acfa34d24ea5423" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1a68f835fe25e82cb83acfa34d24ea5423" kindref="member">flatten</ref><sp/>=<sp/>flatten</highlight></codeline>
<codeline lineno="81" refid="classmw2html_1_1_config_1a75776ea894bdbc698210723b6f8517fb" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1a75776ea894bdbc698210723b6f8517fb" kindref="member">index</ref><sp/>=<sp/>index</highlight></codeline>
<codeline lineno="82" refid="classmw2html_1_1_config_1ad74110e6433292bc02ca070147951816" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1ad74110e6433292bc02ca070147951816" kindref="member">clean</ref><sp/>=<sp/>clean</highlight></codeline>
<codeline lineno="83" refid="classmw2html_1_1_config_1a070def28f1e3b7098a17cd0ce75f92e0" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1a070def28f1e3b7098a17cd0ce75f92e0" kindref="member">sidebar</ref><sp/>=<sp/>sidebar</highlight></codeline>
<codeline lineno="84" refid="classmw2html_1_1_config_1ab8bf3cd002fbe3ea5ae9f2125726f298" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1ab8bf3cd002fbe3ea5ae9f2125726f298" kindref="member">hack_skin</ref><sp/>=<sp/>hack_skin</highlight></codeline>
<codeline lineno="85" refid="classmw2html_1_1_config_1a3058302a27e24f9c802abed872d87205" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1a3058302a27e24f9c802abed872d87205" kindref="member">made_by</ref><sp/>=<sp/>made_by</highlight></codeline>
<codeline lineno="86" refid="classmw2html_1_1_config_1a43b87fc86f4db7b2a678aa9d4edcc487" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1a43b87fc86f4db7b2a678aa9d4edcc487" kindref="member">overwrite</ref><sp/>=<sp/>overwrite</highlight></codeline>
<codeline lineno="87" refid="classmw2html_1_1_config_1ab13184eb1c700ebb989fa355221beb2d" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1ab13184eb1c700ebb989fa355221beb2d" kindref="member">footer</ref><sp/>=<sp/>footer</highlight></codeline>
<codeline lineno="88" refid="classmw2html_1_1_config_1a2f8db9afd3422531379dbb9795c595be" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1a2f8db9afd3422531379dbb9795c595be" kindref="member">skin</ref><sp/>=<sp/>skin</highlight></codeline>
<codeline lineno="89" refid="classmw2html_1_1_config_1ab99ad91cedaf94fb441d15ab539dee61" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1ab99ad91cedaf94fb441d15ab539dee61" kindref="member">move_href</ref><sp/>=<sp/>move_href</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classmw2html_1_1_config_1a070def28f1e3b7098a17cd0ce75f92e0" kindref="member">sidebar</ref><sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="91"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1a070def28f1e3b7098a17cd0ce75f92e0" kindref="member">sidebar</ref><sp/>=<sp/>os.path.abspath(self.<ref refid="classmw2html_1_1_config_1a070def28f1e3b7098a17cd0ce75f92e0" kindref="member">sidebar</ref>)</highlight></codeline>
<codeline lineno="92"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>self.<ref refid="classmw2html_1_1_config_1ab13184eb1c700ebb989fa355221beb2d" kindref="member">footer</ref><sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="93"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1ab13184eb1c700ebb989fa355221beb2d" kindref="member">footer</ref><sp/>=<sp/>os.path.abspath(self.<ref refid="classmw2html_1_1_config_1ab13184eb1c700ebb989fa355221beb2d" kindref="member">footer</ref>)</highlight></codeline>
<codeline lineno="94" refid="classmw2html_1_1_config_1acdd599198ca8204d5e5054bb8195882a" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1acdd599198ca8204d5e5054bb8195882a" kindref="member">remove_png</ref><sp/>=<sp/>remove_png</highlight></codeline>
<codeline lineno="95" refid="classmw2html_1_1_config_1a98d73e496d59f4e522045095cf2e0f23" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1a98d73e496d59f4e522045095cf2e0f23" kindref="member">remove_history</ref><sp/>=<sp/>remove_history</highlight></codeline>
<codeline lineno="96" refid="classmw2html_1_1_config_1a8fba2588992ef27b68cecd8b5aa9ee34" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1a8fba2588992ef27b68cecd8b5aa9ee34" kindref="member">limit_parent</ref><sp/>=<sp/>limit_parent</highlight></codeline>
<codeline lineno="97" refid="classmw2html_1_1_config_1a873d1381c06bf818051740e91347054b" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1a873d1381c06bf818051740e91347054b" kindref="member">special_mode</ref><sp/>=<sp/>special_mode</highlight></codeline>
<codeline lineno="98" refid="classmw2html_1_1_config_1a52d34b7b74e4216fdedb0db8d01b1ca2" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1a52d34b7b74e4216fdedb0db8d01b1ca2" kindref="member">debug</ref><sp/>=<sp/>debug</highlight></codeline>
<codeline lineno="99" refid="classmw2html_1_1_config_1a6965153fa13b111d48005ebea9e5db40" refkind="member"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>self.<ref refid="classmw2html_1_1_config_1a6965153fa13b111d48005ebea9e5db40" kindref="member">no_images</ref><sp/>=<sp/>no_images</highlight></codeline>
<codeline lineno="100"><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"></highlight></codeline>
<codeline lineno="102"><highlight class="normal"></highlight></codeline>
<codeline lineno="103" refid="namespacemw2html_1a2d36f68588408049a6dee260b90e4a00" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a2d36f68588408049a6dee260b90e4a00" kindref="member">get_domain</ref>(u):</highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="105"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Get<sp/>domain<sp/>of<sp/>URL.</highlight></codeline>
<codeline lineno="106"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/>url<sp/>=<sp/><ref refid="namespacemw2html_1a961d7236f041373024cd63627b0b5ff1" kindref="member">normalize_url</ref>(u)</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#ParseResult(scheme=&apos;http&apos;,<sp/>netloc=&apos;www.cwi.nl:80&apos;,<sp/>path=&apos;/%7Eguido/Python.html&apos;,<sp/>params=&apos;&apos;,<sp/>query=&apos;&apos;,<sp/>fragment=&apos;&apos;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/>L<sp/>=<sp/>list(urlparse.urlparse(url))</highlight></codeline>
<codeline lineno="111"><highlight class="normal"></highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>L[1]</highlight></codeline>
<codeline lineno="113"><highlight class="normal"></highlight></codeline>
<codeline lineno="114" refid="namespacemw2html_1a961d7236f041373024cd63627b0b5ff1" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a961d7236f041373024cd63627b0b5ff1" kindref="member">normalize_url</ref>(url,<sp/>lower=True):</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight><highlight class="comment">#<sp/>url<sp/>normalization<sp/>-<sp/>only<sp/>for<sp/>local<sp/>comparison<sp/>operations,<sp/>use<sp/>original<sp/>url<sp/>for<sp/>online<sp/>requests</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/>url<sp/>=<sp/><ref refid="namespacemw2html_1ac9cc6e591941431200a8a6144f6c07ae" kindref="member">split_section</ref>(url)[0]</highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>lower:</highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>url<sp/>=<sp/>url.lower()</highlight></codeline>
<codeline lineno="120"><highlight class="normal"></highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>url.startswith(</highlight><highlight class="stringliteral">&apos;http://&apos;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="122"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>url<sp/>=<sp/>url[len(</highlight><highlight class="stringliteral">&apos;http://&apos;</highlight><highlight class="normal">):]</highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>url.startswith(</highlight><highlight class="stringliteral">&apos;www.&apos;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>url<sp/>=<sp/>url[len(</highlight><highlight class="stringliteral">&apos;www.&apos;</highlight><highlight class="normal">):]</highlight></codeline>
<codeline lineno="125"><highlight class="normal"></highlight></codeline>
<codeline lineno="126"><highlight class="normal"><sp/><sp/><sp/><sp/>url<sp/>=<sp/>url.strip(</highlight><highlight class="stringliteral">&apos;/&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="127"><highlight class="normal"></highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/>url<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;http://&apos;</highlight><highlight class="normal"><sp/>+<sp/>url</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/>urlparse.urljoin(config.rooturl,<sp/>url)</highlight></codeline>
<codeline lineno="131"><highlight class="normal"></highlight></codeline>
<codeline lineno="132"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>url</highlight></codeline>
<codeline lineno="133"><highlight class="normal"></highlight></codeline>
<codeline lineno="134" refid="namespacemw2html_1af9b0857d6e1c908ff25375c30c83b7e9" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1af9b0857d6e1c908ff25375c30c83b7e9" kindref="member">find_tag_limits</ref>(doc,<sp/>filter_string,<sp/>end_tag,<sp/>start_tag,<sp/>start_point=0):</highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight><highlight class="comment">#<sp/>find<sp/>tag<sp/>limits<sp/>-<sp/>start_string<sp/>must<sp/>be<sp/>an<sp/>unique<sp/>identifier<sp/>within<sp/>doc</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"></highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/>i1<sp/>=<sp/>doc.find(filter_string,<sp/>start_point)</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>i1<sp/>==<sp/>-1:</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(-1,<sp/>-1)</highlight></codeline>
<codeline lineno="141"><highlight class="normal"></highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/>aux<sp/>=<sp/>doc.rfind(start_tag,<sp/>start_point,<sp/>i1<sp/>+<sp/>len(filter_string))</highlight></codeline>
<codeline lineno="143"><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>we&apos;ve<sp/>found<sp/>the<sp/>filter_string<sp/>but<sp/>it<sp/>has<sp/>not<sp/>the<sp/>start_tag,<sp/>so<sp/>we<sp/>return<sp/>a<sp/>different<sp/>value</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>telling<sp/>the<sp/>script<sp/>to<sp/>keep<sp/>searching<sp/>starting<sp/>on<sp/>the<sp/>end<sp/>of<sp/>the<sp/>filter_string<sp/>found</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>aux<sp/>==<sp/>-1:</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(-2,<sp/>i1<sp/>+<sp/>len(filter_string))</highlight></codeline>
<codeline lineno="148"><highlight class="normal"></highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/>i1<sp/>=<sp/>aux</highlight></codeline>
<codeline lineno="150"><highlight class="normal"><sp/><sp/><sp/><sp/>sdiv<sp/>=<sp/>i1</highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/>ediv<sp/>=<sp/>i1<sp/>+<sp/>len(start_tag)</highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/>while(sdiv<sp/>&lt;<sp/>ediv<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>sdiv<sp/>!=<sp/>-1):</highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sdiv<sp/>=<sp/>doc.find(start_tag,<sp/>sdiv<sp/>+<sp/>len(start_tag))</highlight></codeline>
<codeline lineno="154"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ediv<sp/>=<sp/>doc.find(end_tag<sp/><sp/>,<sp/>ediv<sp/>+<sp/>len(end_tag))</highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(i1,<sp/>ediv)</highlight></codeline>
<codeline lineno="157"><highlight class="normal"></highlight></codeline>
<codeline lineno="158" refid="namespacemw2html_1a11c9115ac32ff8e16d49134b7357e513" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a11c9115ac32ff8e16d49134b7357e513" kindref="member">clean_tag</ref>(doc,<sp/>filter_string,<sp/>end_tag,<sp/>start_tag):</highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#clean<sp/>tagged<sp/>text<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/>start_point<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="161"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="162"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(start1,<sp/>start2)<sp/>=<sp/><ref refid="namespacemw2html_1af9b0857d6e1c908ff25375c30c83b7e9" kindref="member">find_tag_limits</ref>(doc,<sp/>filter_string,<sp/>end_tag,<sp/>start_tag,<sp/>start_point)</highlight></codeline>
<codeline lineno="163"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>start1<sp/>==<sp/>-1<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>start2<sp/>==<sp/>-1:</highlight></codeline>
<codeline lineno="164"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>doc</highlight></codeline>
<codeline lineno="165"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>start1<sp/>==<sp/>-2:</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>start_point<sp/>=<sp/>start2</highlight></codeline>
<codeline lineno="167"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end1<sp/>=<sp/>doc.find(</highlight><highlight class="stringliteral">&apos;&gt;&apos;</highlight><highlight class="normal">,<sp/>start1)<sp/>+<sp/>1;</highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>end2<sp/>=<sp/>start2<sp/>+<sp/>len(end_tag);</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>doc[:start1]<sp/>+<sp/>doc[end1:start2]<sp/>+<sp/>doc[end2:]</highlight></codeline>
<codeline lineno="171"><highlight class="normal"></highlight></codeline>
<codeline lineno="172" refid="namespacemw2html_1ae86437c788ea1c078dcfc2e1c51bd6b7" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1ae86437c788ea1c078dcfc2e1c51bd6b7" kindref="member">remove_tag</ref>(doc,<sp/>start_string,<sp/>end_tag,<sp/>start_tag):</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#remove<sp/>tagged<sp/>text<sp/>function</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(i1,<sp/>i2)<sp/>=<sp/><ref refid="namespacemw2html_1af9b0857d6e1c908ff25375c30c83b7e9" kindref="member">find_tag_limits</ref>(doc,<sp/>start_string,<sp/>end_tag,<sp/>start_tag)</highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>i1<sp/>==<sp/>-1<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>i2<sp/>==<sp/>-1:</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>doc</highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>doc[:i1]<sp/>+<sp/>doc[i2<sp/>+<sp/>len(end_tag):]</highlight></codeline>
<codeline lineno="179"><highlight class="normal"></highlight></codeline>
<codeline lineno="180" refid="namespacemw2html_1aa3fb13486d9fcbbc797c6d9e529720e1" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1aa3fb13486d9fcbbc797c6d9e529720e1" kindref="member">monobook_fix_html</ref>(doc,<sp/>page_url):</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="182"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Sets<sp/>sidebar<sp/>for<sp/>Mediawiki<sp/>1.4beta6<sp/>Monobook<sp/>HTML<sp/>output.</highlight></codeline>
<codeline lineno="183"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">global</highlight><highlight class="normal"><sp/>config</highlight></codeline>
<codeline lineno="185"><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.made_by:</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>doc.replace(</highlight><highlight class="stringliteral">&apos;&lt;html<sp/>xmlns=&apos;</highlight><highlight class="normal">,<sp/>MADE_BY_COMMENT<sp/>+<sp/></highlight><highlight class="stringliteral">&apos;\n&lt;html<sp/>xmlns=&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="188"><highlight class="normal"></highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1ae86437c788ea1c078dcfc2e1c51bd6b7" kindref="member">remove_tag</ref>(doc,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>class=&quot;portlet&quot;<sp/>id=&quot;p-personal&quot;&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1ae86437c788ea1c078dcfc2e1c51bd6b7" kindref="member">remove_tag</ref>(doc,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;p-search&quot;<sp/>class=&quot;portlet&quot;&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1ae86437c788ea1c078dcfc2e1c51bd6b7" kindref="member">remove_tag</ref>(doc,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>class=&quot;portlet&quot;<sp/>id=&quot;p-editors&quot;&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1ae86437c788ea1c078dcfc2e1c51bd6b7" kindref="member">remove_tag</ref>(doc,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=\&apos;catlinks\&apos;<sp/>class=\&apos;catlinks<sp/>catlinks-allhidden\&apos;&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div&apos;</highlight><highlight class="normal">)<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#James<sp/>also<sp/>remove<sp/>the<sp/>page/discussion/source/history/<sp/>div.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="194"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1ae86437c788ea1c078dcfc2e1c51bd6b7" kindref="member">remove_tag</ref>(doc,<sp/></highlight><highlight class="stringliteral">&apos;&lt;li<sp/>id=&quot;ca-&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;/li&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;li&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="195"><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#andre<sp/>special<sp/>mode</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.special_mode:</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>ul<sp/>list</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1ae86437c788ea1c078dcfc2e1c51bd6b7" kindref="member">remove_tag</ref>(doc,<sp/></highlight><highlight class="stringliteral">&apos;&lt;ul<sp/>id=&quot;f-list&quot;&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;/ul&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;ul&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="200"><highlight class="normal"></highlight></codeline>
<codeline lineno="201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>link<sp/>rel<sp/>alternate<sp/>and<sp/>edit</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;&lt;link<sp/>rel=&quot;alternate&quot;[\s\S]+?/&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">r&apos;&apos;</highlight><highlight class="normal">,<sp/>doc)</highlight></codeline>
<codeline lineno="203"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;&lt;link<sp/>rel=&quot;edit&quot;[\s\S]+?/&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">r&apos;&apos;</highlight><highlight class="normal">,<sp/>doc)</highlight></codeline>
<codeline lineno="204"><highlight class="normal"></highlight></codeline>
<codeline lineno="205"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>print<sp/>footer</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;&lt;div<sp/>class=&quot;printfooter&quot;&gt;[\s\S]+?&lt;/div&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">r&apos;&apos;</highlight><highlight class="normal">,<sp/>doc)</highlight></codeline>
<codeline lineno="207"><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>noexport</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1ae86437c788ea1c078dcfc2e1c51bd6b7" kindref="member">remove_tag</ref>(doc,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>class=&quot;noexport&quot;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1ae86437c788ea1c078dcfc2e1c51bd6b7" kindref="member">remove_tag</ref>(doc,<sp/></highlight><highlight class="stringliteral">&apos;&lt;span<sp/>class=&quot;noexport&quot;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;/span&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;span&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="211"><highlight class="normal"></highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>editornote</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1ae86437c788ea1c078dcfc2e1c51bd6b7" kindref="member">remove_tag</ref>(doc,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>class=&quot;editornote&quot;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="214"><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="216"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>powered<sp/>by<sp/>MediaWiki<sp/>logo</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>re.sub(</highlight></codeline>
<codeline lineno="218"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">r&apos;&lt;div<sp/>id=&quot;f-poweredbyico&quot;&gt;[\s\S]+?(&lt;ul<sp/>id=&quot;f-list&quot;&gt;)&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="219"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">r&apos;\1&apos;</highlight><highlight class="normal">,<sp/>doc)</highlight></codeline>
<codeline lineno="220"><highlight class="normal"></highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>page<sp/>has<sp/>been<sp/>accessed<sp/>X<sp/>times<sp/>list<sp/>item.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;&lt;li<sp/>id=&quot;f-viewcount&quot;&gt;[\s\S]+?&lt;/li&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">r&apos;&apos;</highlight><highlight class="normal">,<sp/>doc)</highlight></codeline>
<codeline lineno="223"><highlight class="normal"></highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>disclaimers<sp/>list<sp/>item.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;&lt;li<sp/>id=&quot;f-disclaimer&quot;&gt;[\s\S]+?&lt;/li&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">r&apos;&apos;</highlight><highlight class="normal">,<sp/>doc)</highlight></codeline>
<codeline lineno="226"><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>edit<sp/>links</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1ae86437c788ea1c078dcfc2e1c51bd6b7" kindref="member">remove_tag</ref>(doc,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>class=&quot;editsection&quot;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1ae86437c788ea1c078dcfc2e1c51bd6b7" kindref="member">remove_tag</ref>(doc,<sp/></highlight><highlight class="stringliteral">&apos;&lt;span<sp/>class=&quot;editsection&quot;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;/span&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;span&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>doc</highlight></codeline>
<codeline lineno="232"><highlight class="normal"></highlight></codeline>
<codeline lineno="233" refid="namespacemw2html_1abb39f2d776dedabfd5ea74688dd1c4e0" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1abb39f2d776dedabfd5ea74688dd1c4e0" kindref="member">pre_html_transform</ref>(doc,<sp/>url):</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="235"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>User-customizable<sp/>HTML<sp/>transform.</highlight></codeline>
<codeline lineno="236"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="237"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Given<sp/>an<sp/>HTML<sp/>document<sp/>(with<sp/>URLs<sp/>already<sp/>rewritten),<sp/>returns</highlight></codeline>
<codeline lineno="238"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>modified<sp/>HTML<sp/>document.</highlight></codeline>
<codeline lineno="239"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">global</highlight><highlight class="normal"><sp/>config</highlight></codeline>
<codeline lineno="241"><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.hack_skin:</highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.skin<sp/>==<sp/>MONOBOOK_SKIN:</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1aa3fb13486d9fcbbc797c6d9e529720e1" kindref="member">monobook_fix_html</ref>(doc,<sp/>url)</highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>config.special_mode:</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1abab77dedc32b0b58b90fa08f41d43013" kindref="member">monobook_hack_skin_html</ref>(doc)</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&apos;unknown<sp/>skin&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="249"><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.move_href:</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1a13bb26a656d1399bc7151257b069ab1a" kindref="member">fix_move_href_tags</ref>(doc)</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.remove_history:</highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1af7f9204ba52f0f0be1f8fd1b509a1ea5" kindref="member">html_remove_image_history</ref>(doc)</highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1a6fe34b8a32ad33ed42e43b701d7bee44" kindref="member">html_remove_translation_links</ref>(doc)</highlight></codeline>
<codeline lineno="256"><highlight class="normal"></highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>doc</highlight></codeline>
<codeline lineno="258"><highlight class="normal"></highlight></codeline>
<codeline lineno="259" refid="namespacemw2html_1a35b3bd3a1d2b7fd9ee2eba67e2439b34" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a35b3bd3a1d2b7fd9ee2eba67e2439b34" kindref="member">pos_html_transform</ref>(doc,<sp/>url):</highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">global</highlight><highlight class="normal"><sp/>footer_text,<sp/>config,<sp/>sidebar_html</highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/>url<sp/>=<sp/><ref refid="namespacemw2html_1a961d7236f041373024cd63627b0b5ff1" kindref="member">normalize_url</ref>(url,<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="262"><highlight class="normal"></highlight></codeline>
<codeline lineno="263"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Add<sp/>sidebar.html</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.sidebar<sp/>!=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>sidebar_html<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="265"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f<sp/>=<sp/>open(config.sidebar,<sp/></highlight><highlight class="stringliteral">&apos;rU&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sidebar_html<sp/>=<sp/>f.read()</highlight></codeline>
<codeline lineno="267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f.close()</highlight></codeline>
<codeline lineno="268"><highlight class="normal"></highlight></codeline>
<codeline lineno="269"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;(&lt;!--<sp/>end<sp/>of<sp/>the<sp/>left<sp/>\(by<sp/>default<sp/>at<sp/>least\)<sp/>column<sp/>--&gt;)&apos;</highlight><highlight class="normal">,<sp/>sidebar_html<sp/>+<sp/></highlight><highlight class="stringliteral">r&apos;\1&apos;</highlight><highlight class="normal">,<sp/>doc)</highlight></codeline>
<codeline lineno="270"><highlight class="normal"></highlight></codeline>
<codeline lineno="271"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>empty<sp/>links</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="272"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1a11c9115ac32ff8e16d49134b7357e513" kindref="member">clean_tag</ref>(doc,<sp/></highlight><highlight class="stringliteral">&apos;href=&quot;&quot;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;/a&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;a<sp/>&apos;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="273"><highlight class="normal"></highlight></codeline>
<codeline lineno="274"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.special_mode:</highlight></codeline>
<codeline lineno="275"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>external<sp/>link<sp/>rel<sp/>stylesheet</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="276"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;&lt;link<sp/>rel=&quot;stylesheet&quot;<sp/>href=&quot;http://[\s\S]+?/&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">r&apos;&apos;</highlight><highlight class="normal">,<sp/>doc)</highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>external<sp/>javascript</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="279"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;&lt;script<sp/>type=&quot;text/javascript&quot;<sp/>src=&quot;http://[\s\S]+?&lt;/script&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">r&apos;&apos;</highlight><highlight class="normal">,<sp/>doc)</highlight></codeline>
<codeline lineno="280"><highlight class="normal"></highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Replace<sp/>remaining<sp/>text<sp/>with<sp/>footer,<sp/>if<sp/>available<sp/>(this<sp/>needs<sp/>to<sp/>be<sp/>done<sp/>after<sp/>parse_html<sp/>to<sp/>avoid<sp/>rewriting<sp/>of<sp/>urls</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.footer<sp/></highlight><highlight class="keywordflow">is</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>s1<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;footer&quot;&gt;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="284"><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>match<sp/>correct<sp/>divs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/>(i1,<sp/>i2)<sp/>=<sp/><ref refid="namespacemw2html_1af9b0857d6e1c908ff25375c30c83b7e9" kindref="member">find_tag_limits</ref>(doc,<sp/>s1,<sp/></highlight><highlight class="stringliteral">&apos;&lt;/div&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="287"><highlight class="normal"></highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(i1<sp/>==<sp/>-1):</highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>doc</highlight></codeline>
<codeline lineno="290"><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>footer_text<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f<sp/>=<sp/>open(config.footer,<sp/></highlight><highlight class="stringliteral">&apos;rU&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="293"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>footer_text<sp/>=<sp/>f.read()</highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f.close()</highlight></codeline>
<codeline lineno="295"><highlight class="normal"></highlight></codeline>
<codeline lineno="296"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>add<sp/>static<sp/>dump<sp/>time</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/><sp/><sp/>footer_html<sp/>=<sp/>footer_text.replace(</highlight><highlight class="stringliteral">&apos;%DATE%&apos;</highlight><highlight class="normal">,<sp/>strftime(</highlight><highlight class="stringliteral">&quot;%Y-%m-%d&quot;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="298"><highlight class="normal"></highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>add<sp/>online<sp/>url</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/>footer_html<sp/>=<sp/>footer_html.replace(</highlight><highlight class="stringliteral">&apos;%ONLINEURL%&apos;</highlight><highlight class="normal">,<sp/>url)</highlight></codeline>
<codeline lineno="301"><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.special_mode:</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>keep<sp/>MediaWiki<sp/>credits</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>doc[:i2]<sp/>+<sp/>footer_html<sp/>+<sp/>doc[i2:]</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>doc[:i1<sp/>+<sp/>len(s1)]<sp/>+<sp/>footer_html<sp/>+<sp/>doc[i2:]</highlight></codeline>
<codeline lineno="307"><highlight class="normal"></highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>doc</highlight></codeline>
<codeline lineno="309"><highlight class="normal"></highlight></codeline>
<codeline lineno="310" refid="namespacemw2html_1a13bb26a656d1399bc7151257b069ab1a" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a13bb26a656d1399bc7151257b069ab1a" kindref="member">fix_move_href_tags</ref>(doc):</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="312"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Return<sp/>copy<sp/>of<sp/>doc<sp/>with<sp/>all<sp/>MOVE_HREF<sp/>tags<sp/>removed.</highlight></codeline>
<codeline lineno="313"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="314"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;&lt;&apos;</highlight><highlight class="normal"><sp/>+<sp/>MOVE_HREF<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>doc:</highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i1<sp/>=<sp/>doc.index(</highlight><highlight class="stringliteral">&apos;&lt;&apos;</highlight><highlight class="normal"><sp/>+<sp/>MOVE_HREF)</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i2<sp/>=<sp/>doc.index(</highlight><highlight class="stringliteral">&apos;&lt;/&apos;</highlight><highlight class="normal"><sp/>+<sp/>MOVE_HREF,<sp/>i1<sp/>+<sp/>1)</highlight></codeline>
<codeline lineno="317"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i3<sp/>=<sp/>doc.index(</highlight><highlight class="stringliteral">&apos;&gt;&apos;</highlight><highlight class="normal">,<sp/>i2<sp/>+<sp/>1)</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(start,<sp/>end)<sp/>=<sp/>(i1,<sp/>i3<sp/>+<sp/>1)</highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tags<sp/>=<sp/><ref refid="namespacehtmldata_1a3d5a0fd3ca07d74ca1fcd1d825102307" kindref="member">htmldata.tagextract</ref>(doc[start:end])</highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>tags[0][0]<sp/>==<sp/>MOVE_HREF</highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>tags[-1][0]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;/&apos;</highlight><highlight class="normal"><sp/>+<sp/>MOVE_HREF</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>href<sp/>=<sp/>tags[0][1].get(</highlight><highlight class="stringliteral">&apos;href&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="323"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_tags<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>tag<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>tags[1:-1]:</highlight></codeline>
<codeline lineno="325"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>len(tag)<sp/>==<sp/>2:</highlight></codeline>
<codeline lineno="326"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;href&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>tag[1]:</highlight></codeline>
<codeline lineno="327"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>href<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="328"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="329"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tag[1][</highlight><highlight class="stringliteral">&apos;href&apos;</highlight><highlight class="normal">]<sp/>=<sp/>href</highlight></codeline>
<codeline lineno="330"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_tags<sp/>+=<sp/>[tag]</highlight></codeline>
<codeline lineno="331"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>doc[:start]<sp/>+<sp/><ref refid="namespacehtmldata_1abea91d7c71df2f825ea2fd1ab11387cd" kindref="member">htmldata.tagjoin</ref>(new_tags)<sp/>+<sp/>doc[end:]</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>doc</highlight></codeline>
<codeline lineno="333"><highlight class="normal"></highlight></codeline>
<codeline lineno="334" refid="namespacemw2html_1af7f9204ba52f0f0be1f8fd1b509a1ea5" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1af7f9204ba52f0f0be1f8fd1b509a1ea5" kindref="member">html_remove_image_history</ref>(doc):</highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="336"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Remove<sp/>image<sp/>history<sp/>and<sp/>links<sp/>to<sp/>information.</highlight></codeline>
<codeline lineno="337"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;&lt;h2&gt;Image<sp/>history&lt;/h2&gt;[\s\S]+?&lt;/ul&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">r&apos;&apos;</highlight><highlight class="normal">,<sp/>doc)</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;&lt;h2&gt;Image<sp/>links&lt;/h2&gt;[\s\S]+?&lt;/ul&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">r&apos;&apos;</highlight><highlight class="normal">,<sp/>doc)</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>doc</highlight></codeline>
<codeline lineno="341"><highlight class="normal"></highlight></codeline>
<codeline lineno="342" refid="namespacemw2html_1a6fe34b8a32ad33ed42e43b701d7bee44" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a6fe34b8a32ad33ed42e43b701d7bee44" kindref="member">html_remove_translation_links</ref>(doc):</highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="344"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Remove<sp/>translation<sp/>links<sp/>(the<sp/>international<sp/>flags).</highlight></codeline>
<codeline lineno="345"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>We<sp/>identify<sp/>them<sp/>by<sp/>the<sp/>pattern<sp/>for<sp/>a<sp/>2<sp/>letter<sp/>language<sp/>code,<sp/>/[\s\S][\s\S][/&quot;]</highlight></codeline>
<codeline lineno="346"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>in<sp/>the<sp/>URL.</highlight></codeline>
<codeline lineno="347"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;&lt;a<sp/>href=&quot;[^&quot;]+/[\s\S][\s\S][/&quot;][\s\S]+?&lt;/a&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">r&apos;&lt;!--Removed<sp/>Translation<sp/>Flag--&gt;&apos;</highlight><highlight class="normal">,<sp/>doc)</highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;&lt;a<sp/>href=&quot;[^&quot;]+/[\s\S][\s\S]_[\s\S][\s\S][/&quot;][\s\S]+?&lt;/a&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">r&apos;&lt;!--Removed<sp/>Translation<sp/>Flag2--&gt;&apos;</highlight><highlight class="normal">,<sp/>doc)</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>doc</highlight></codeline>
<codeline lineno="351"><highlight class="normal"></highlight></codeline>
<codeline lineno="352" refid="namespacemw2html_1abab77dedc32b0b58b90fa08f41d43013" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1abab77dedc32b0b58b90fa08f41d43013" kindref="member">monobook_hack_skin_html</ref>(doc):</highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="354"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Hacks<sp/>Monobook<sp/>HTML<sp/>output:<sp/>use<sp/>CSS<sp/>ids<sp/>for<sp/>hacked<sp/>skin.</highlight></codeline>
<codeline lineno="355"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="356"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>See<sp/>monobook_hack_skin_css.</highlight></codeline>
<codeline lineno="357"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>doc.replace(</highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;globalWrapper&quot;&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;globalWrapperHacked&quot;&gt;&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>doc.replace(</highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;footer&quot;&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;div<sp/>id=&quot;footerHacked&quot;&gt;&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="360"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>doc.replace(</highlight><highlight class="stringliteral">&apos;&lt;/body&gt;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&lt;br&gt;&lt;/body&gt;&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>doc</highlight></codeline>
<codeline lineno="362"><highlight class="normal"></highlight></codeline>
<codeline lineno="363" refid="namespacemw2html_1a700ccd260707cb87c849f16b965de8e1" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a700ccd260707cb87c849f16b965de8e1" kindref="member">monobook_hack_skin_css</ref>(doc,<sp/>url):</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="365"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Hacks<sp/>Mediawiki<sp/>1.4beta6<sp/>Monobook<sp/>main<sp/>CSS<sp/>file<sp/>for<sp/>better<sp/>looks.</highlight></codeline>
<codeline lineno="366"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="367"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Removes<sp/>flower<sp/>background.<sp/><sp/>Defines<sp/>*Hacked<sp/>CSS<sp/>ids,<sp/>so<sp/>we<sp/>can<sp/>add</highlight></codeline>
<codeline lineno="368"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>an<sp/>orange<sp/>bar<sp/>at<sp/>the<sp/>top,<sp/>and<sp/>clear<sp/>the<sp/>orange<sp/>bar<sp/>right<sp/>above<sp/>the</highlight></codeline>
<codeline lineno="369"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>footer.</highlight></codeline>
<codeline lineno="370"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">global</highlight><highlight class="normal"><sp/>config</highlight></codeline>
<codeline lineno="372"><highlight class="normal"></highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>url.endswith(</highlight><highlight class="stringliteral">&apos;monobook/main.css&apos;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="374"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>doc</highlight></codeline>
<codeline lineno="375"><highlight class="normal"></highlight></codeline>
<codeline lineno="376"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;/*<sp/>Monobook<sp/>skin<sp/>automatically<sp/>modified<sp/>by<sp/>mw2html.<sp/>*/&quot;</highlight><highlight class="normal"><sp/>+<sp/>doc</highlight></codeline>
<codeline lineno="377"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>doc.replace(</highlight><highlight class="stringliteral">&apos;url(&quot;headbg.jpg&quot;)&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="378"><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>+=<sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="380"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>/*<sp/>Begin<sp/>hacks<sp/>by<sp/>mw2html<sp/>*/</highlight></codeline>
<codeline lineno="381"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="382"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>#globalWrapperHacked<sp/>{</highlight></codeline>
<codeline lineno="383"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>font-size:127%;</highlight></codeline>
<codeline lineno="384"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>width:<sp/>100%;</highlight></codeline>
<codeline lineno="385"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>background-color:<sp/>White;</highlight></codeline>
<codeline lineno="386"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>border-top:<sp/>1px<sp/>solid<sp/>#fabd23;</highlight></codeline>
<codeline lineno="387"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>border-bottom:<sp/>1px<sp/>solid<sp/>#fabd23;</highlight></codeline>
<codeline lineno="388"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>margin:<sp/>0.6em<sp/>0em<sp/>1em<sp/>0em;</highlight></codeline>
<codeline lineno="389"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>padding:<sp/>0em<sp/>0em<sp/>1.2em<sp/>0em;</highlight></codeline>
<codeline lineno="390"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="391"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="392"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>#footerHacked<sp/>{</highlight></codeline>
<codeline lineno="393"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>background-color:<sp/>White;</highlight></codeline>
<codeline lineno="394"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>margin:<sp/>0.6em<sp/>0em<sp/>0em<sp/>0em;</highlight></codeline>
<codeline lineno="395"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>padding:<sp/>0.4em<sp/>0em<sp/>0em<sp/>0em;</highlight></codeline>
<codeline lineno="396"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>text-align:<sp/>center;</highlight></codeline>
<codeline lineno="397"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>font-size:<sp/>90%;</highlight></codeline>
<codeline lineno="398"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="399"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="400"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>#footerHacked<sp/>li<sp/>{</highlight></codeline>
<codeline lineno="401"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>display:<sp/>inline;</highlight></codeline>
<codeline lineno="402"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>margin:<sp/>0<sp/>1.3em;</highlight></codeline>
<codeline lineno="403"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="404"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="405"><highlight class="normal"></highlight></codeline>
<codeline lineno="406"><highlight class="normal"><sp/><sp/><sp/><sp/>c1<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;#column-one<sp/>{<sp/>padding-top:<sp/>160px;<sp/>}&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="407"><highlight class="normal"><sp/><sp/><sp/><sp/>c2<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;#column-one<sp/>{<sp/>padding-top:<sp/>3.0em;<sp/>}&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="408"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">assert</highlight><highlight class="normal"><sp/>c1<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>doc</highlight></codeline>
<codeline lineno="409"><highlight class="normal"></highlight></codeline>
<codeline lineno="410"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>doc.replace(c1,<sp/></highlight><highlight class="stringliteral">&apos;/*<sp/>edit<sp/>by<sp/>mw2html<sp/>*/\n&apos;</highlight><highlight class="normal"><sp/>+<sp/>c2<sp/>+</highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;\n/*<sp/>end<sp/>edit<sp/>by<sp/>mw2html<sp/>*/\n&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="412"><highlight class="normal"></highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Remove<sp/>external<sp/>link<sp/>icons.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.remove_png:</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;#bodyContent<sp/>a\[href<sp/>\^=&quot;http://&quot;\][\s\S]+?\}&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">r&apos;&apos;</highlight><highlight class="normal">,<sp/>doc)</highlight></codeline>
<codeline lineno="416"><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>doc</highlight></codeline>
<codeline lineno="418"><highlight class="normal"></highlight></codeline>
<codeline lineno="419" refid="namespacemw2html_1a357e206b4fe4d7dde01ee0f85fbf7f65" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a357e206b4fe4d7dde01ee0f85fbf7f65" kindref="member">post_css_transform</ref>(doc,<sp/>url):</highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="421"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>User-customizable<sp/>CSS<sp/>transform.</highlight></codeline>
<codeline lineno="422"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="423"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Given<sp/>a<sp/>CSS<sp/>document<sp/>(with<sp/>URLs<sp/>already<sp/>rewritten),<sp/>returns</highlight></codeline>
<codeline lineno="424"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>modified<sp/>CSS<sp/>document.</highlight></codeline>
<codeline lineno="425"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">global</highlight><highlight class="normal"><sp/>config</highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.hack_skin<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>config.special_mode:</highlight></codeline>
<codeline lineno="429"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.skin<sp/>==<sp/>MONOBOOK_SKIN:</highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1a700ccd260707cb87c849f16b965de8e1" kindref="member">monobook_hack_skin_css</ref>(doc,<sp/>url)</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>ValueError(</highlight><highlight class="stringliteral">&apos;unknown<sp/>skin&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="433"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>doc</highlight></codeline>
<codeline lineno="434"><highlight class="normal"></highlight></codeline>
<codeline lineno="435" refid="namespacemw2html_1a7f5904e66838ab9fb740ac24705a8dbd" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a7f5904e66838ab9fb740ac24705a8dbd" kindref="member">move_to_index_if_needed</ref>(ans):</highlight></codeline>
<codeline lineno="436"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">global</highlight><highlight class="normal"><sp/>config</highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ans.endswith(config.index):</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ans<sp/>=<sp/>ans[:len(ans)<sp/>-<sp/>len(config.index)]<sp/>+<sp/>INDEX_HTML</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ans</highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight></codeline>
<codeline lineno="441" refid="namespacemw2html_1a67cbfd20f0c99193357508e9af8b8568" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a67cbfd20f0c99193357508e9af8b8568" kindref="member">file_exists_in_written_set</ref>(filename):</highlight></codeline>
<codeline lineno="442"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>os.path.normcase(os.path.normpath(filename))<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>wrote_file_set</highlight></codeline>
<codeline lineno="443"><highlight class="normal"></highlight></codeline>
<codeline lineno="444" refid="namespacemw2html_1adab857f7ebaddc5342d43d7f10acb153" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1adab857f7ebaddc5342d43d7f10acb153" kindref="member">find_unused_filename</ref>(filename,<sp/>exists=os.path.exists):</highlight></codeline>
<codeline lineno="445"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="446"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Return<sp/>&apos;file&apos;<sp/>if<sp/>&apos;file&apos;<sp/>doesn&apos;t<sp/>exist,<sp/>otherwise<sp/>&apos;file1&apos;,<sp/>&apos;file2&apos;,<sp/>etc.</highlight></codeline>
<codeline lineno="447"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="448"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Existance<sp/>is<sp/>determined<sp/>by<sp/>the<sp/>callable<sp/>exists(),<sp/>which<sp/>takes</highlight></codeline>
<codeline lineno="449"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>a<sp/>filename<sp/>and<sp/>returns<sp/>a<sp/>boolean.</highlight></codeline>
<codeline lineno="450"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>exists(filename):</highlight></codeline>
<codeline lineno="452"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>filename</highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/>(head,<sp/>tail)<sp/>=<sp/>os.path.split(filename)</highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/>i<sp/>=<sp/>1</highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>numbered<sp/>=<sp/>(os.path.splitext(tail)[0]<sp/>+<sp/><ref refid="sndfile__save_8m_1a4b99ff73a8a869319570237b5c57ab03" kindref="member">str</ref>(i)<sp/>+</highlight></codeline>
<codeline lineno="457"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>os.path.splitext(tail)[1])</highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>fullname<sp/>=<sp/>os.path.join(head,<sp/>numbered)</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>exists(fullname):</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>fullname</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i<sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="462"><highlight class="normal"></highlight></codeline>
<codeline lineno="463" refid="namespacemw2html_1a1944832471b18b21842ada6439cebac2" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a1944832471b18b21842ada6439cebac2" kindref="member">clean_filename</ref>(url,<sp/>ans):</highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Split<sp/>outdir<sp/>and<sp/>our<sp/>file/dir<sp/>under<sp/>outdir</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>(Note:<sp/>ans<sp/>may<sp/>not<sp/>be<sp/>a<sp/>valid<sp/>filename)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">global</highlight><highlight class="normal"><sp/>config</highlight></codeline>
<codeline lineno="467"><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/>(par,<sp/>ans)<sp/>=<sp/>(ans[:len(config.outdir)],<sp/>ans[len(config.outdir):])</highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>ans.startswith(os.sep):</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ans<sp/>=<sp/>ans[1:]</highlight></codeline>
<codeline lineno="471"><highlight class="normal"></highlight></codeline>
<codeline lineno="472"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Replace<sp/>%<sp/>escape<sp/>codes<sp/>with<sp/>underscores,<sp/>dashes<sp/>with<sp/>underscores.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;%%&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ans:</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ans<sp/>=<sp/>ans[:ans.index(</highlight><highlight class="stringliteral">&apos;%%&apos;</highlight><highlight class="normal">)]<sp/>+<sp/></highlight><highlight class="stringliteral">&apos;_&apos;</highlight><highlight class="normal"><sp/>+<sp/>ans[ans.index(</highlight><highlight class="stringliteral">&apos;%%&apos;</highlight><highlight class="normal">)<sp/>+<sp/>2:]</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;%25&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ans:</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ans<sp/>=<sp/>ans[:ans.index(</highlight><highlight class="stringliteral">&apos;%25&apos;</highlight><highlight class="normal">)]<sp/>+<sp/></highlight><highlight class="stringliteral">&apos;_&apos;</highlight><highlight class="normal"><sp/>+<sp/>ans[ans.index(</highlight><highlight class="stringliteral">&apos;%25&apos;</highlight><highlight class="normal">)<sp/>+<sp/>5:]</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;%&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ans:</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ans<sp/>=<sp/>ans[:ans.index(</highlight><highlight class="stringliteral">&apos;%&apos;</highlight><highlight class="normal">)]<sp/>+<sp/></highlight><highlight class="stringliteral">&apos;_&apos;</highlight><highlight class="normal"><sp/>+<sp/>ans[ans.index(</highlight><highlight class="stringliteral">&apos;%&apos;</highlight><highlight class="normal">)<sp/>+<sp/>3:]</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/>ans<sp/>=<sp/>ans.replace(</highlight><highlight class="stringliteral">&apos;-&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;_&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;__&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ans:</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ans<sp/>=<sp/>ans.replace(</highlight><highlight class="stringliteral">&apos;__&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;_&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;_.&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>ans:</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ans<sp/>=<sp/>ans.replace(</highlight><highlight class="stringliteral">&apos;_.&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;.&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="484"><highlight class="normal"></highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Rename<sp/>math<sp/>thumbnails</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;/math/&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>url:</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tail<sp/>=<sp/>os.path.split(ans)[1]</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>os.path.splitext(tail)[1]<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;.png&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tail<sp/>=<sp/>os.path.splitext(tail)[0]</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>set(tail)<sp/>&lt;=<sp/>set(</highlight><highlight class="stringliteral">&apos;0123456789abcdef&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>len(tail)<sp/>==<sp/>32:</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ans<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;math_&apos;</highlight><highlight class="normal"><sp/>+<sp/>hashlib.md5(tail).hexdigest()[:4]<sp/>+<sp/></highlight><highlight class="stringliteral">&apos;.png&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>os.path.join(par,<sp/>ans)</highlight></codeline>
<codeline lineno="493"><highlight class="normal"></highlight></codeline>
<codeline lineno="494" refid="namespacemw2html_1a48599fa7135b5a613fa08526fb4f106c" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a48599fa7135b5a613fa08526fb4f106c" kindref="member">flatten_filename</ref>(url,<sp/>filename):</highlight></codeline>
<codeline lineno="495"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">global</highlight><highlight class="normal"><sp/>config</highlight></codeline>
<codeline lineno="496"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal">get_fullname(relname):</highlight></codeline>
<codeline lineno="497"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>os.path.join(config.outdir,<sp/>relname)</highlight></codeline>
<codeline lineno="498"><highlight class="normal"></highlight></codeline>
<codeline lineno="499"><highlight class="normal"><sp/><sp/><sp/><sp/>orig_ext<sp/>=<sp/>os.path.splitext(filename)[1]</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/>(head,<sp/>tail)<sp/>=<sp/>os.path.split(filename)</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>tail<sp/>==<sp/>INDEX_HTML:</highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(head,<sp/>tail)<sp/>=<sp/>os.path.split(head)</highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/><sp/><sp/>ans<sp/>=<sp/>tail</highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>os.path.splitext(ans)[1]<sp/>!=<sp/>orig_ext:</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ans<sp/>=<sp/>os.path.splitext(ans)[0]<sp/>+<sp/>orig_ext</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>os.path.join(config.outdir,<sp/>ans)</highlight></codeline>
<codeline lineno="507"><highlight class="normal"></highlight></codeline>
<codeline lineno="508" refid="namespacemw2html_1ac9cc6e591941431200a8a6144f6c07ae" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1ac9cc6e591941431200a8a6144f6c07ae" kindref="member">split_section</ref>(url):</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="510"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Splits<sp/>into<sp/>(head,<sp/>tail),<sp/>where<sp/>head<sp/>contains<sp/>no<sp/>&apos;#&apos;<sp/>and<sp/>is<sp/>max<sp/>length.</highlight></codeline>
<codeline lineno="511"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;#&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>url:</highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i<sp/>=<sp/>url.index(</highlight><highlight class="stringliteral">&apos;#&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(url[:i],<sp/>url[i:])</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(url,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="517"><highlight class="normal"></highlight></codeline>
<codeline lineno="518" refid="namespacemw2html_1afba16453097ddfddc93c62262a92b6b1" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1afba16453097ddfddc93c62262a92b6b1" kindref="member">url_open</ref>(url):</highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>download<sp/>a<sp/>file<sp/>and<sp/>retrieve<sp/>its<sp/>content<sp/>and<sp/>mimetype</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">global</highlight><highlight class="normal"><sp/>conn,<sp/>domain,<sp/>counter,<sp/>redir_cache,<sp/>errors</highlight></codeline>
<codeline lineno="521"><highlight class="normal"></highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/>l_redir<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/>redirect<sp/>=<sp/>url</highlight></codeline>
<codeline lineno="524"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>redirect<sp/>!=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>l_redir<sp/>+=<sp/>[url]</highlight></codeline>
<codeline lineno="526"><highlight class="normal"></highlight></codeline>
<codeline lineno="527"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>L<sp/>=<sp/>urlparse.urlparse(url)</highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>L[1]<sp/>!=<sp/>domain:</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn.close()</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;connection<sp/>to&quot;</highlight><highlight class="normal">,<sp/>domain,<sp/></highlight><highlight class="stringliteral">&quot;closed.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn<sp/>=<sp/>httplib.HTTPConnection(L[1])</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>domain<sp/>=<sp/>L[1]</highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;connection<sp/>to&quot;</highlight><highlight class="normal">,<sp/>domain,<sp/></highlight><highlight class="stringliteral">&quot;opened.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="534"><highlight class="normal"></highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rel_url<sp/>=<sp/>url</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pos<sp/>=<sp/>url.find(domain)</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>pos<sp/>!=<sp/>-1:</highlight></codeline>
<codeline lineno="538"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>rel_url<sp/>=<sp/>url[pos<sp/>+<sp/>len(domain):]</highlight></codeline>
<codeline lineno="539"><highlight class="normal"></highlight></codeline>
<codeline lineno="540"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attempts<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="541"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#number<sp/>of<sp/>attempts</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="542"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>total_attempts<sp/>=<sp/>3</highlight></codeline>
<codeline lineno="543"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>recovered<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="544"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>success<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="545"><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>success<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>attempts<sp/>&lt;<sp/>total_attempts:</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#increment<sp/>httplib<sp/>requests<sp/>counter</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>counter<sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="549"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="550"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn.request(</highlight><highlight class="stringliteral">&quot;GET&quot;</highlight><highlight class="normal">,<sp/>rel_url)</highlight></codeline>
<codeline lineno="551"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>r<sp/>=<sp/>conn.getresponse()</highlight></codeline>
<codeline lineno="552"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;Status&apos;</highlight><highlight class="normal">,<sp/>r.status,<sp/>r.reason,<sp/></highlight><highlight class="stringliteral">&apos;accessing&apos;</highlight><highlight class="normal">,<sp/>rel_url</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>r.status<sp/>==<sp/>404:</highlight></codeline>
<codeline lineno="554"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/>it&apos;s<sp/>not<sp/>possible<sp/>to<sp/>recover<sp/>this<sp/>error.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="555"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errors<sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="556"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="557"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>r.status<sp/>==<sp/>500:</highlight></codeline>
<codeline lineno="558"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/>eventually<sp/>this<sp/>error<sp/>might<sp/>be<sp/>recovered.<sp/>let&apos;s<sp/>try<sp/>again.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;<sp/><sp/><sp/>reconnecting...&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn<sp/>=<sp/>httplib.HTTPConnection(domain)</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attempts<sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>r.status<sp/>==<sp/>403:</highlight></codeline>
<codeline lineno="564"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/>that<sp/>shouldn&apos;t<sp/>happen,<sp/>but<sp/>let&apos;s<sp/>try<sp/>again<sp/>anyway.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;<sp/><sp/><sp/>reconnecting...&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn<sp/>=<sp/>httplib.HTTPConnection(domain)</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attempts<sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>attempts<sp/>!=<sp/>0:</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>recovered<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>r.status<sp/>!=<sp/>200:</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;<sp/><sp/><sp/><sp/><sp/><sp/>Status<sp/>other<sp/>than<sp/>200,<sp/>404,<sp/>500,<sp/>403.<sp/>It<sp/>is:<sp/>&quot;</highlight><highlight class="normal">,<sp/>r.status</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>success<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="574"><highlight class="normal"></highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>httplib.HTTPException,<sp/>e:</highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;ERROR&apos;</highlight><highlight class="normal">,<sp/>e.__class__.__name__,<sp/></highlight><highlight class="stringliteral">&apos;while<sp/>retrieving&apos;</highlight><highlight class="normal">,<sp/>url</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn.close</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>e.__class__.__name__<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;BadStatusLine&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ImproperConnectionState&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;NotConnected&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;IncompleteRead&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;ResponseNotReady&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;eventually<sp/>this<sp/>error<sp/>might<sp/>be<sp/>recovered.<sp/>let&apos;s<sp/>try<sp/>again.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="580"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;reconnecting...&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>conn<sp/>=<sp/>httplib.HTTPConnection(domain)</highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>attempts<sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="583"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="584"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;it&apos;s<sp/>not<sp/>possible<sp/>to<sp/>recover<sp/>this<sp/>error.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="585"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errors<sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="587"><highlight class="normal"></highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>recovered:</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;error<sp/>recovered&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal"></highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>success:</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;it<sp/>was<sp/>not<sp/>possible<sp/>to<sp/>recover<sp/>this<sp/>error.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>errors<sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(</highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="595"><highlight class="normal"></highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>redirect<sp/>=<sp/>r.getheader(</highlight><highlight class="stringliteral">&apos;Location&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">).split(</highlight><highlight class="stringliteral">&apos;;&apos;</highlight><highlight class="normal">)[0]</highlight></codeline>
<codeline lineno="597"><highlight class="normal"></highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>redirect<sp/>!=<sp/></highlight><highlight class="stringliteral">&quot;&quot;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>url<sp/>=<sp/>redirect</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>r.read()</highlight></codeline>
<codeline lineno="602"><highlight class="normal"></highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>item<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>l_redir:</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>redir_cache[<ref refid="namespacemw2html_1a961d7236f041373024cd63627b0b5ff1" kindref="member">normalize_url</ref>(item)]<sp/>=<sp/><ref refid="namespacemw2html_1a961d7236f041373024cd63627b0b5ff1" kindref="member">normalize_url</ref>(url)</highlight></codeline>
<codeline lineno="605"><highlight class="normal"></highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/><sp/><sp/>mimetype<sp/>=<sp/>r.getheader(</highlight><highlight class="stringliteral">&apos;Content-Type&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">).split(</highlight><highlight class="stringliteral">&apos;;&apos;</highlight><highlight class="normal">)[0].lower()</highlight></codeline>
<codeline lineno="607"><highlight class="normal"></highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(doc,<sp/>mimetype)</highlight></codeline>
<codeline lineno="609"><highlight class="normal"></highlight></codeline>
<codeline lineno="610" refid="namespacemw2html_1a01c99b6991283b01ed52497eeea077a4" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a01c99b6991283b01ed52497eeea077a4" kindref="member">url_to_filename</ref>(url):</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="612"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Translate<sp/>a<sp/>full<sp/>url<sp/>to<sp/>a<sp/>full<sp/>filename<sp/>(in<sp/>local<sp/>OS<sp/>format)<sp/>under<sp/>outdir.</highlight></codeline>
<codeline lineno="613"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Transforms<sp/>web<sp/>url<sp/>into<sp/>local<sp/>url<sp/>and<sp/>caches<sp/>it.</highlight></codeline>
<codeline lineno="614"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Downloads<sp/>the<sp/>file<sp/>to<sp/>disk<sp/>and<sp/>works<sp/>with<sp/>it<sp/>there<sp/>instead<sp/>of<sp/>download<sp/>the<sp/>same<sp/>file<sp/>two<sp/>times<sp/>(Performance<sp/>Improvement).</highlight></codeline>
<codeline lineno="615"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">global</highlight><highlight class="normal"><sp/>config</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/>nurl<sp/>=<sp/><ref refid="namespacemw2html_1a961d7236f041373024cd63627b0b5ff1" kindref="member">normalize_url</ref>(url)</highlight></codeline>
<codeline lineno="618"><highlight class="normal"></highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>nurl<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>url_filename_cache:</highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>url_filename_cache[nurl]</highlight></codeline>
<codeline lineno="621"><highlight class="normal"></highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#ParseResult(scheme=&apos;http&apos;,<sp/>netloc=&apos;www.cwi.nl:80&apos;,<sp/>path=&apos;/%7Eguido/Python.html&apos;,<sp/>params=&apos;&apos;,<sp/>query=&apos;&apos;,<sp/>fragment=&apos;&apos;)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/>turl<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;m/index.php\?title=&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">r&apos;man/&apos;</highlight><highlight class="normal">,<sp/>nurl)</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/>turl<sp/>=<sp/>re.sub(</highlight><highlight class="stringliteral">r&apos;.css&amp;[\S\s]+&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">r&apos;.css&apos;</highlight><highlight class="normal">,<sp/>turl)</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/>L<sp/>=<sp/>list(urlparse.urlparse(turl))</highlight></codeline>
<codeline lineno="626"><highlight class="normal"></highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#this<sp/>way<sp/>the<sp/>url<sp/>will<sp/>not<sp/>create<sp/>a<sp/>folder<sp/>outside<sp/>of<sp/>the<sp/>maindomain</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/><sp/><sp/>droot<sp/>=<sp/><ref refid="namespacemw2html_1a2d36f68588408049a6dee260b90e4a00" kindref="member">get_domain</ref>(config.rooturl)</highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(L[1]<sp/>!=<sp/>droot):</highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>L[1]<sp/>=<sp/>droot</highlight></codeline>
<codeline lineno="631"><highlight class="normal"></highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/>L[2]<sp/>=<sp/>L[2].strip(</highlight><highlight class="stringliteral">&apos;/&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/>lpath<sp/>=<sp/>L[2].split(</highlight><highlight class="stringliteral">&apos;/&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;.&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>lpath[-1]:</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>url<sp/>ends<sp/>with<sp/>a<sp/>directory<sp/>name.<sp/><sp/>Store<sp/>it<sp/>under<sp/>index.html.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>L[2]<sp/>+=<sp/>&apos;/&apos;<sp/>+<sp/>INDEX_HTML</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>L[2]=L[2]</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="639"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>&apos;title=&apos;<sp/>parsing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>L[4].startswith(</highlight><highlight class="stringliteral">&apos;title=&apos;</highlight><highlight class="normal">)<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>L[2].endswith(</highlight><highlight class="stringliteral">&apos;index.php&apos;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>L[4]<sp/>=<sp/>L[4][len(</highlight><highlight class="stringliteral">&apos;title=&apos;</highlight><highlight class="normal">):]</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>L[2]<sp/>=<sp/>L[2][:-len(</highlight><highlight class="stringliteral">&apos;index.php&apos;</highlight><highlight class="normal">)]</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="644"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>lpath[-1]==</highlight><highlight class="stringliteral">&apos;man&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>L[2]<sp/>=<sp/>INDEX_HTML</highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>lpath[-1].lower().startswith(<sp/></highlight><highlight class="stringliteral">&apos;quick_help&apos;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>L[2]<sp/>=<sp/>QHELP_HTML</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>L[3]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="651"><highlight class="normal"></highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/>L[2]<sp/>=<sp/>L[2].strip(</highlight><highlight class="stringliteral">&apos;/&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="653"><highlight class="normal"></highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#don&apos;t<sp/>sanitize<sp/>/<sp/>for<sp/>path</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/>L[0]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/>L[2]<sp/>=<sp/>urllib.quote_plus(L[2],<sp/></highlight><highlight class="stringliteral">&apos;/&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/>L[3]<sp/>=<sp/>urllib.quote_plus(L[3])</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/>L[4]<sp/>=<sp/>urllib.quote_plus(L[4])</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/>L[5]<sp/>=<sp/>urllib.quote_plus(L[5])</highlight></codeline>
<codeline lineno="660"><highlight class="normal"></highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Local<sp/>filename<sp/>relative<sp/>to<sp/>outdir</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>os.sep<sp/>-<sp/>O.S.<sp/>directory<sp/>separator</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>(More<sp/>transformations<sp/>are<sp/>made<sp/>to<sp/>this<sp/>below...).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/>FL<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="665"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>i<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>L:</highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>i<sp/>!=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FL<sp/>+=<sp/>[i]</highlight></codeline>
<codeline lineno="668"><highlight class="normal"></highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/>subfile<sp/>=<sp/>os.sep.join(FL)</highlight></codeline>
<codeline lineno="670"><highlight class="normal"></highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/>(doc,<sp/>mimetype)<sp/>=<sp/><ref refid="namespacemw2html_1afba16453097ddfddc93c62262a92b6b1" kindref="member">url_open</ref>(url)</highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>doc<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>mimetype<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>url_filename_cache[nurl]<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="675"><highlight class="normal"></highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Fix<sp/>up<sp/>extension<sp/>based<sp/>on<sp/>mime<sp/>type.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Maps<sp/>mimetype<sp/>to<sp/>file<sp/>extension</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/><sp/><sp/>MIME_MAP<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;image/jpeg&apos;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&apos;jpg&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;image/png&apos;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&apos;png&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;image/gif&apos;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&apos;gif&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;image/tiff&apos;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&apos;tiff&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;text/plain&apos;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&apos;txt&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;text/html&apos;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&apos;html&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;text/rtf&apos;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&apos;rtf&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;text/css&apos;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&apos;css&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;text/sgml&apos;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&apos;sgml&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;text/xml&apos;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&apos;xml&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;application/zip&apos;</highlight><highlight class="normal">:<sp/></highlight><highlight class="stringliteral">&apos;zip&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="684"><highlight class="normal"></highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>mimetype<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>MIME_MAP:</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(root,<sp/>ext)<sp/>=<sp/>os.path.splitext(subfile)</highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ext<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;.&apos;</highlight><highlight class="normal"><sp/>+<sp/>MIME_MAP[mimetype]</highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>subfile<sp/>=<sp/>root<sp/>+<sp/>ext</highlight></codeline>
<codeline lineno="689"><highlight class="normal"></highlight></codeline>
<codeline lineno="690"><highlight class="normal"><sp/><sp/><sp/><sp/>subfile<sp/>=<sp/>subfile.lower()</highlight></codeline>
<codeline lineno="691"><highlight class="normal"></highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/>ans<sp/>=<sp/>os.path.join(config.outdir,<sp/>subfile)</highlight></codeline>
<codeline lineno="693"><highlight class="normal"></highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.flatten:</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ans<sp/>=<sp/><ref refid="namespacemw2html_1a48599fa7135b5a613fa08526fb4f106c" kindref="member">flatten_filename</ref>(nurl,<sp/>ans)</highlight></codeline>
<codeline lineno="696"><highlight class="normal"></highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.clean:</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ans<sp/>=<sp/><ref refid="namespacemw2html_1a1944832471b18b21842ada6439cebac2" kindref="member">clean_filename</ref>(nurl,<sp/>ans)</highlight></codeline>
<codeline lineno="699"><highlight class="normal"></highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.index<sp/>!=<sp/></highlight><highlight class="keywordtype">None</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ans<sp/>=<sp/><ref refid="namespacemw2html_1a7f5904e66838ab9fb740ac24705a8dbd" kindref="member">move_to_index_if_needed</ref>(ans)</highlight></codeline>
<codeline lineno="702"><highlight class="normal"></highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/>ans<sp/>=<sp/><ref refid="namespacemw2html_1adab857f7ebaddc5342d43d7f10acb153" kindref="member">find_unused_filename</ref>(ans,<sp/>file_exists_in_written_set)</highlight></codeline>
<codeline lineno="704"><highlight class="normal"></highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Cache<sp/>and<sp/>return<sp/>answer.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/>wrote_file_set.add(os.path.normcase(os.path.normpath(ans)))</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/>url_filename_cache[nurl]<sp/>=<sp/>ans</highlight></codeline>
<codeline lineno="708"><highlight class="normal"></highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/>mode<sp/>=<sp/>[</highlight><highlight class="stringliteral">&apos;wb&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;w&apos;</highlight><highlight class="normal">][mimetype.startswith(</highlight><highlight class="stringliteral">&apos;text&apos;</highlight><highlight class="normal">)]</highlight></codeline>
<codeline lineno="710"><highlight class="normal"></highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Make<sp/>parent<sp/>directory<sp/>if<sp/>it<sp/>doesn&apos;t<sp/>exist.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>os.makedirs(os.path.split(ans)[0])</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>OSError,<sp/>e:</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>e.errno<sp/>!=<sp/>errno.EEXIST:</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="717"><highlight class="normal"></highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Not<sp/>really<sp/>needed<sp/>since<sp/>we<sp/>checked<sp/>that<sp/>the<sp/>directory</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>outdir<sp/>didn&apos;t<sp/>exist<sp/>at<sp/>the<sp/>top<sp/>of<sp/>run(),<sp/>but<sp/>let&apos;s<sp/>double<sp/>check.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>os.path.exists(ans)<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>config.overwrite:</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out.write(</highlight><highlight class="stringliteral">&apos;File<sp/>already<sp/>exists:<sp/>&apos;</highlight><highlight class="normal"><sp/>+<sp/><ref refid="sndfile__save_8m_1a4b99ff73a8a869319570237b5c57ab03" kindref="member">str</ref>(ans))<sp/></highlight><highlight class="comment">#@UndefinedVariable</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sys.exit(1)</highlight></codeline>
<codeline lineno="723"><highlight class="normal"></highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/>f<sp/>=<sp/>open(ans,<sp/>mode)</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/>f.write(doc)</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/>f.close()</highlight></codeline>
<codeline lineno="727"><highlight class="normal"></highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ans</highlight></codeline>
<codeline lineno="729"><highlight class="normal"></highlight></codeline>
<codeline lineno="730" refid="namespacemw2html_1aa9df5a585f89ff62d0804b2d3da56f2d" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1aa9df5a585f89ff62d0804b2d3da56f2d" kindref="member">url_to_relative</ref>(url,<sp/>cururl):</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="732"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Translate<sp/>a<sp/>full<sp/>url<sp/>to<sp/>a<sp/>filename<sp/>(in<sp/>URL<sp/>format)<sp/>relative<sp/>to<sp/>cururl.</highlight></codeline>
<codeline lineno="733"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Relative<sp/>url<sp/>from<sp/>curul<sp/>to<sp/>url.</highlight></codeline>
<codeline lineno="734"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="735"><highlight class="normal"></highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/><sp/><sp/>cururl<sp/>=<sp/><ref refid="namespacemw2html_1ac9cc6e591941431200a8a6144f6c07ae" kindref="member">split_section</ref>(cururl)[0]</highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/>(url,<sp/>section)<sp/>=<sp/><ref refid="namespacemw2html_1ac9cc6e591941431200a8a6144f6c07ae" kindref="member">split_section</ref>(url)</highlight></codeline>
<codeline lineno="738"><highlight class="normal"></highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/>L1<sp/>=<sp/><ref refid="namespacemw2html_1a01c99b6991283b01ed52497eeea077a4" kindref="member">url_to_filename</ref>(url).<ref refid="namespacewaflib_1_1_tools_1_1errcheck_1a3c373d095646ee41f81dd43ade9e0b63" kindref="member">replace</ref>(os.sep,<sp/></highlight><highlight class="stringliteral">&apos;/&apos;</highlight><highlight class="normal">).strip(</highlight><highlight class="stringliteral">&apos;/&apos;</highlight><highlight class="normal">).split(</highlight><highlight class="stringliteral">&apos;/&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>L1<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="742"><highlight class="normal"></highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/>L2<sp/>=<sp/><ref refid="namespacemw2html_1a01c99b6991283b01ed52497eeea077a4" kindref="member">url_to_filename</ref>(cururl).<ref refid="namespacewaflib_1_1_tools_1_1errcheck_1a3c373d095646ee41f81dd43ade9e0b63" kindref="member">replace</ref>(os.sep,<sp/></highlight><highlight class="stringliteral">&apos;/&apos;</highlight><highlight class="normal">).strip(</highlight><highlight class="stringliteral">&apos;/&apos;</highlight><highlight class="normal">).split(</highlight><highlight class="stringliteral">&apos;/&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="744"><highlight class="normal"></highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>L1<sp/>!=<sp/>[]<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>L2<sp/>!=<sp/>[]<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>L1[0]<sp/>==<sp/>L2[0]:</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>L1<sp/>=<sp/>L1[1:]</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>L2<sp/>=<sp/>L2[1:]</highlight></codeline>
<codeline lineno="748"><highlight class="normal"></highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/>rel_url<sp/>=<sp/>urllib.quote(</highlight><highlight class="stringliteral">&apos;../&apos;</highlight><highlight class="normal"><sp/>*<sp/>(len(L2)<sp/>-<sp/>1)<sp/>+<sp/></highlight><highlight class="stringliteral">&apos;/&apos;</highlight><highlight class="normal">.join(L1))<sp/>+<sp/>section</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>rel_url<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;#&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>rel_url</highlight></codeline>
<codeline lineno="754"><highlight class="normal"></highlight></codeline>
<codeline lineno="755" refid="namespacemw2html_1add2343a149c4f3bc33e714e0de40f1e1" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1add2343a149c4f3bc33e714e0de40f1e1" kindref="member">parse_css</ref>(doc,<sp/>url):</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="757"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Returns<sp/>(modified_doc,<sp/>new_urls),<sp/>where<sp/>new_urls<sp/>are<sp/>absolute<sp/>URLs<sp/>for</highlight></codeline>
<codeline lineno="758"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>all<sp/>links<sp/>found<sp/>in<sp/>the<sp/>CSS.</highlight></codeline>
<codeline lineno="759"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">global</highlight><highlight class="normal"><sp/>config</highlight></codeline>
<codeline lineno="761"><highlight class="normal"></highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/>new_urls<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="763"><highlight class="normal"></highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/>L<sp/>=<sp/><ref refid="namespacehtmldata_1a849b6b90a5518672e5494c58e7bee65c" kindref="member">htmldata.urlextract</ref>(doc,<sp/>url,<sp/></highlight><highlight class="stringliteral">&apos;text/css&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>item<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>L:</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Store<sp/>url<sp/>locally.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u<sp/>=<sp/>item.url</highlight></codeline>
<codeline lineno="768"><highlight class="normal"></highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.no_images<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>any(u.strip().lower().endswith(suffix)<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>suffix<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>(</highlight><highlight class="stringliteral">&apos;.jpg&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;.gif&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;.png&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;.ico&apos;</highlight><highlight class="normal">)):</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>item.url<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="772"><highlight class="normal"></highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_urls<sp/>+=<sp/>[u]</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>item.url<sp/>=<sp/><ref refid="namespacemw2html_1aa9df5a585f89ff62d0804b2d3da56f2d" kindref="member">url_to_relative</ref>(u,<sp/>url)</highlight></codeline>
<codeline lineno="775"><highlight class="normal"></highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/>newdoc<sp/>=<sp/><ref refid="namespacehtmldata_1a281fd13bfba54efd22dfe1e901181648" kindref="member">htmldata.urljoin</ref>(doc,<sp/>L)</highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/>newdoc<sp/>=<sp/><ref refid="namespacemw2html_1a357e206b4fe4d7dde01ee0f85fbf7f65" kindref="member">post_css_transform</ref>(newdoc,<sp/>url)</highlight></codeline>
<codeline lineno="778"><highlight class="normal"></highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(newdoc,<sp/>new_urls)</highlight></codeline>
<codeline lineno="780"><highlight class="normal"></highlight></codeline>
<codeline lineno="781" refid="namespacemw2html_1ad1e85572c7c472fb58dd71c1183e00b5" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1ad1e85572c7c472fb58dd71c1183e00b5" kindref="member">should_follow</ref>(url):</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="783"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Returns<sp/>a<sp/>boolean<sp/>for<sp/>whether<sp/>url<sp/>should<sp/>be<sp/>spidered</highlight></codeline>
<codeline lineno="784"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="785"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Given<sp/>that<sp/>&apos;url&apos;<sp/>was<sp/>linked<sp/>to<sp/>from<sp/>site,<sp/>return<sp/>whether</highlight></codeline>
<codeline lineno="786"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&apos;url&apos;<sp/>should<sp/>be<sp/>spidered<sp/>as<sp/>well.</highlight></codeline>
<codeline lineno="787"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">global</highlight><highlight class="normal"><sp/>config</highlight></codeline>
<codeline lineno="789"><highlight class="normal"></highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>we<sp/>don&apos;t<sp/>have<sp/>search<sp/>on<sp/>the<sp/>local<sp/>version</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(url.endswith(</highlight><highlight class="stringliteral">&apos;#searchInput&apos;</highlight><highlight class="normal">)):</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="793"><highlight class="normal"></highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>False<sp/>if<sp/>different<sp/>domains.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/><sp/><sp/>nurl<sp/>=<sp/><ref refid="namespacemw2html_1a961d7236f041373024cd63627b0b5ff1" kindref="member">normalize_url</ref>(url)</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/>droot<sp/>=<sp/><ref refid="namespacemw2html_1a2d36f68588408049a6dee260b90e4a00" kindref="member">get_domain</ref>(config.rooturl)</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/>dn<sp/>=<sp/><ref refid="namespacemw2html_1a2d36f68588408049a6dee260b90e4a00" kindref="member">get_domain</ref>(nurl)</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>droot<sp/>!=<sp/>dn<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>(dn.endswith(droot)<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>droot.endswith(dn)):</highlight></codeline>
<codeline lineno="799"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.debug:</highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/>url,<sp/></highlight><highlight class="stringliteral">&apos;not<sp/>in<sp/>the<sp/>same<sp/>domain&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="802"><highlight class="normal"></highlight></codeline>
<codeline lineno="803"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>False<sp/>if<sp/>multiple<sp/>query<sp/>fields<sp/>or<sp/>parameters<sp/>found</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(url.count(</highlight><highlight class="stringliteral">&apos;&amp;&apos;</highlight><highlight class="normal">)<sp/>&gt;=<sp/>1<sp/></highlight><highlight class="keywordflow">or</highlight><highlight class="normal"><sp/>url.count(</highlight><highlight class="stringliteral">&apos;;&apos;</highlight><highlight class="normal">)<sp/>&gt;<sp/>0)<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>any(x<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>url<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>x<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>(</highlight><highlight class="stringliteral">&apos;.css&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;gen=css&apos;</highlight><highlight class="normal">)):</highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.debug:</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/>url,<sp/></highlight><highlight class="stringliteral">&apos;with<sp/>multiple<sp/>query<sp/>fields&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="808"><highlight class="normal"></highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>any(x<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>url<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>x<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>(</highlight><highlight class="stringliteral">&apos;Special:&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Image:&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Talk:&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;User:&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;Help:&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;User_talk:&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;MediaWiki_talk:&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;File:&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;action=edit&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;title=-&apos;</highlight><highlight class="normal">)):</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.debug:</highlight></codeline>
<codeline lineno="811"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/>url,<sp/></highlight><highlight class="stringliteral">&apos;is<sp/>a<sp/>forbidden<sp/>wiki<sp/>page&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="813"><highlight class="normal"></highlight></codeline>
<codeline lineno="814"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.no_images<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>any(url.strip().lower().endswith(suffix)<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>suffix<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>(</highlight><highlight class="stringliteral">&apos;.jpg&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;.gif&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;.png&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;.ico&apos;</highlight><highlight class="normal">)):</highlight></codeline>
<codeline lineno="815"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.debug:</highlight></codeline>
<codeline lineno="816"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/>url,<sp/></highlight><highlight class="stringliteral">&apos;is<sp/>a<sp/>image<sp/>and<sp/>you<sp/>are<sp/>in<sp/>no-images<sp/>mode&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="817"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="818"><highlight class="normal"></highlight></codeline>
<codeline lineno="819"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>any(url.strip().lower().endswith(suffix)<sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>suffix<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>(</highlight><highlight class="stringliteral">&apos;.zip&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;.7z&apos;</highlight><highlight class="normal">)):</highlight></codeline>
<codeline lineno="820"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.debug:</highlight></codeline>
<codeline lineno="821"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/>url,<sp/></highlight><highlight class="stringliteral">&apos;is<sp/>a<sp/>compressed<sp/>file&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="822"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="823"><highlight class="normal"></highlight></codeline>
<codeline lineno="824"><highlight class="normal"></highlight></codeline>
<codeline lineno="825"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>limit_parent<sp/>support</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="826"><highlight class="normal"><sp/><sp/><sp/><sp/>ncurl<sp/>=<sp/><ref refid="namespacemw2html_1a961d7236f041373024cd63627b0b5ff1" kindref="member">normalize_url</ref>(config.rooturl)</highlight></codeline>
<codeline lineno="827"><highlight class="normal"></highlight></codeline>
<codeline lineno="828"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.limit_parent<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>nurl.startswith(ncurl):</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>L<sp/>=<sp/>nurl.split(</highlight><highlight class="stringliteral">&apos;/&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(</highlight><highlight class="stringliteral">&apos;.&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>L[-1]):</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.debug:</highlight></codeline>
<codeline lineno="832"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/>url,<sp/></highlight><highlight class="stringliteral">&apos;is<sp/>a<sp/>file<sp/>outside<sp/>of<sp/>scope<sp/>with<sp/>unknown<sp/>extension&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="834"><highlight class="normal"></highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>JKC:<sp/>we<sp/>do<sp/>allow<sp/>css<sp/>from<sp/>&apos;strange&apos;<sp/>places.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;.css&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>L[-1]:</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>forbidden_parents<sp/>=<sp/>[</highlight><highlight class="stringliteral">&apos;.php&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;.html&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;.htm&apos;</highlight><highlight class="normal">]</highlight></codeline>
<codeline lineno="840"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>fp<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>forbidden_parents:</highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>fp<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>L[-1]:</highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.debug:</highlight></codeline>
<codeline lineno="843"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/>url,<sp/></highlight><highlight class="stringliteral">&apos;is<sp/>a<sp/>page<sp/>outside<sp/>of<sp/>scope&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="844"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="845"><highlight class="normal"></highlight></codeline>
<codeline lineno="846"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="847"><highlight class="normal"></highlight></codeline>
<codeline lineno="848" refid="namespacemw2html_1a46560afd89d32a4311c16a3d64741063" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a46560afd89d32a4311c16a3d64741063" kindref="member">parse_html</ref>(doc,<sp/>url):</highlight></codeline>
<codeline lineno="849"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="850"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Returns<sp/>(modified_doc,<sp/>new_urls),<sp/>where<sp/>new_urls<sp/>are<sp/>absolute<sp/>URLs<sp/>for</highlight></codeline>
<codeline lineno="851"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>all<sp/>links<sp/>we<sp/>want<sp/>to<sp/>spider<sp/>in<sp/>the<sp/>HTML.</highlight></codeline>
<codeline lineno="852"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="853"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">global</highlight><highlight class="normal"><sp/>config</highlight></codeline>
<codeline lineno="854"><highlight class="normal"></highlight></codeline>
<codeline lineno="855"><highlight class="normal"><sp/><sp/><sp/><sp/>BEGIN_COMMENT_REPLACE<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&lt;BEGINCOMMENT-&apos;</highlight><highlight class="normal"><sp/>+<sp/><ref refid="sndfile__save_8m_1a4b99ff73a8a869319570237b5c57ab03" kindref="member">str</ref>(random.random())<sp/>+<sp/></highlight><highlight class="stringliteral">&apos;&gt;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="856"><highlight class="normal"><sp/><sp/><sp/><sp/>END_COMMENT_REPLACE<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&lt;ENDCOMMENT-&apos;</highlight><highlight class="normal"><sp/>+<sp/><ref refid="sndfile__save_8m_1a4b99ff73a8a869319570237b5c57ab03" kindref="member">str</ref>(random.random())<sp/>+<sp/></highlight><highlight class="stringliteral">&apos;&gt;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="857"><highlight class="normal"></highlight></codeline>
<codeline lineno="858"><highlight class="normal"><sp/><sp/><sp/><sp/>new_urls<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="859"><highlight class="normal"></highlight></codeline>
<codeline lineno="860"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/><ref refid="namespacemw2html_1abb39f2d776dedabfd5ea74688dd1c4e0" kindref="member">pre_html_transform</ref>(doc,<sp/>url)</highlight></codeline>
<codeline lineno="861"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Temporarily<sp/>&quot;get<sp/>rid&quot;<sp/>of<sp/>comments<sp/>so<sp/>htmldata<sp/>will<sp/>find<sp/>the<sp/>URLs</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="862"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>in<sp/>the<sp/>funky<sp/>&quot;&lt;!--[if&quot;<sp/>HTML<sp/>hackery<sp/>for<sp/>IE.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="863"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>doc.replace(</highlight><highlight class="stringliteral">&apos;&lt;!--&apos;</highlight><highlight class="normal">,<sp/>BEGIN_COMMENT_REPLACE)</highlight></codeline>
<codeline lineno="864"><highlight class="normal"><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>doc.replace(</highlight><highlight class="stringliteral">&apos;--&gt;&apos;</highlight><highlight class="normal">,<sp/>END_COMMENT_REPLACE)</highlight></codeline>
<codeline lineno="865"><highlight class="normal"></highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/>L<sp/>=<sp/><ref refid="namespacehtmldata_1a849b6b90a5518672e5494c58e7bee65c" kindref="member">htmldata.urlextract</ref>(doc,<sp/>url,<sp/></highlight><highlight class="stringliteral">&apos;text/html&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>in<sp/>this<sp/>code<sp/>we<sp/>change<sp/>each<sp/>absolute<sp/>url<sp/>in<sp/>L</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>into<sp/>a<sp/>relative<sp/>one.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>we<sp/>also<sp/>kick-off<sp/>zillions<sp/>of<sp/>subthreads<sp/>to<sp/>collect<sp/></highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>more<sp/>pages.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>item<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>L:</highlight></codeline>
<codeline lineno="873"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u<sp/>=<sp/>item.url</highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>follow<sp/>=<sp/><ref refid="namespacemw2html_1ad1e85572c7c472fb58dd71c1183e00b5" kindref="member">should_follow</ref>(u)</highlight></codeline>
<codeline lineno="875"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>follow:</highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.debug:</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;ACCEPTED<sp/><sp/><sp/>-<sp/>&apos;</highlight><highlight class="normal">,<sp/>u</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Store<sp/>url<sp/>locally.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_urls<sp/>+=<sp/>[u]</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>item.url<sp/>=<sp/><ref refid="namespacemw2html_1aa9df5a585f89ff62d0804b2d3da56f2d" kindref="member">url_to_relative</ref>(u,<sp/>url)</highlight></codeline>
<codeline lineno="881"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="882"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>James,<sp/>let&apos;s<sp/>keep<sp/>everything<sp/>by<sp/>default<sp/>(but<sp/>not<sp/>follow<sp/>it).</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="883"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>if<sp/>not<sp/>any(<sp/>license<sp/>in<sp/>u<sp/>for<sp/>license<sp/>in<sp/>(&apos;creativecommons.org&apos;,<sp/>&apos;wxwidgets.org&apos;,<sp/>&apos;gnu.org&apos;,<sp/>&apos;mediawiki.org&apos;)<sp/>):</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="884"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/><sp/>item.url<sp/>=<sp/>&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="885"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.debug:</highlight></codeline>
<codeline lineno="886"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;NOT<sp/>INCLUDED<sp/><sp/><sp/><sp/><sp/>-<sp/>&apos;</highlight><highlight class="normal">,<sp/>u</highlight></codeline>
<codeline lineno="887"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="888"><highlight class="normal"><sp/><sp/><sp/><sp/>newdoc<sp/>=<sp/><ref refid="namespacehtmldata_1a281fd13bfba54efd22dfe1e901181648" kindref="member">htmldata.urljoin</ref>(doc,<sp/>L)</highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/><sp/><sp/>newdoc<sp/>=<sp/>newdoc.replace(BEGIN_COMMENT_REPLACE,<sp/></highlight><highlight class="stringliteral">&apos;&lt;!--&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/><sp/><sp/>newdoc<sp/>=<sp/>newdoc.replace(END_COMMENT_REPLACE,<sp/></highlight><highlight class="stringliteral">&apos;--&gt;&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="891"><highlight class="normal"></highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/><sp/><sp/>newdoc<sp/>=<sp/><ref refid="namespacemw2html_1a35b3bd3a1d2b7fd9ee2eba67e2439b34" kindref="member">pos_html_transform</ref>(newdoc,<sp/>url)</highlight></codeline>
<codeline lineno="893"><highlight class="normal"></highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(newdoc,<sp/>new_urls)</highlight></codeline>
<codeline lineno="895"><highlight class="normal"></highlight></codeline>
<codeline lineno="896"><highlight class="normal"></highlight></codeline>
<codeline lineno="897" refid="namespacemw2html_1ab3aff4cd0096159010c6fc6b2338e8a6" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1ab3aff4cd0096159010c6fc6b2338e8a6" kindref="member">run</ref>(out=sys.stdout):</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="899"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Code<sp/>interface.</highlight></codeline>
<codeline lineno="900"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">global</highlight><highlight class="normal"><sp/>conn,<sp/>domain,<sp/>counter,<sp/>redir_cache,<sp/>config</highlight></codeline>
<codeline lineno="902"><highlight class="normal"></highlight></codeline>
<codeline lineno="903"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>urlparse.urlparse(config.rooturl)[1].lower().endswith(</highlight><highlight class="stringliteral">&apos;wikipedia.org&apos;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="904"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out.write(</highlight><highlight class="stringliteral">&apos;Please<sp/>do<sp/>not<sp/>use<sp/>robots<sp/>with<sp/>the<sp/>Wikipedia<sp/>site.\n&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="905"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out.write(</highlight><highlight class="stringliteral">&apos;Instead,<sp/>install<sp/>the<sp/>Wikipedia<sp/>database<sp/>locally<sp/>and<sp/>use<sp/>mw2html<sp/>on\n&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="906"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out.write(</highlight><highlight class="stringliteral">&apos;your<sp/>local<sp/>installation.<sp/><sp/>See<sp/>the<sp/>Mediawiki<sp/>site<sp/>for<sp/>more<sp/>information.\n&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="907"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sys.exit(1)</highlight></codeline>
<codeline lineno="908"><highlight class="normal"></highlight></codeline>
<codeline lineno="909"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Number<sp/>of<sp/>files<sp/>saved</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/><sp/><sp/>n<sp/>=<sp/>0</highlight></codeline>
<codeline lineno="911"><highlight class="normal"></highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>config.overwrite<sp/></highlight><highlight class="keywordflow">and</highlight><highlight class="normal"><sp/>os.path.exists(config.outdir):</highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out.write(</highlight><highlight class="stringliteral">&apos;Error:<sp/>Directory<sp/>exists:<sp/>&apos;</highlight><highlight class="normal"><sp/>+<sp/><ref refid="sndfile__save_8m_1a4b99ff73a8a869319570237b5c57ab03" kindref="member">str</ref>(config.outdir))</highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>sys.exit(1)</highlight></codeline>
<codeline lineno="915"><highlight class="normal"></highlight></codeline>
<codeline lineno="916"><highlight class="normal"><sp/><sp/><sp/><sp/>domain<sp/>=<sp/><ref refid="namespacemw2html_1a2d36f68588408049a6dee260b90e4a00" kindref="member">get_domain</ref>(config.rooturl)</highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/><sp/><sp/>conn<sp/>=<sp/>httplib.HTTPConnection(domain)</highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;connection<sp/>established<sp/>to:&apos;</highlight><highlight class="normal">,<sp/>domain</highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/><sp/><sp/>complete<sp/>=<sp/>set()</highlight></codeline>
<codeline lineno="920"><highlight class="normal"><sp/><sp/><sp/><sp/>pending<sp/>=<sp/>set([config.rooturl])</highlight></codeline>
<codeline lineno="921"><highlight class="normal"></highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/><sp/><sp/>start<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>len(pending)<sp/>&gt;<sp/>0:</highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>url<sp/>=<sp/>pending.pop()</highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nurl<sp/>=<sp/><ref refid="namespacemw2html_1a961d7236f041373024cd63627b0b5ff1" kindref="member">normalize_url</ref>(url)</highlight></codeline>
<codeline lineno="926"><highlight class="normal"></highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>nurl<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>redir_cache:</highlight></codeline>
<codeline lineno="928"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nurl<sp/>=<sp/>redir_cache[nurl]</highlight></codeline>
<codeline lineno="929"><highlight class="normal"></highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>nurl<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>complete:</highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.debug:</highlight></codeline>
<codeline lineno="932"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/>url,<sp/></highlight><highlight class="stringliteral">&apos;already<sp/>processed&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="934"><highlight class="normal"></highlight></codeline>
<codeline lineno="935"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>complete.add(nurl)</highlight></codeline>
<codeline lineno="936"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>filename<sp/>=<sp/><ref refid="namespacemw2html_1a01c99b6991283b01ed52497eeea077a4" kindref="member">url_to_filename</ref>(url)</highlight></codeline>
<codeline lineno="937"><highlight class="normal"></highlight></codeline>
<codeline lineno="938"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#this<sp/>is<sp/>needed<sp/>for<sp/>the<sp/>first<sp/>path<sp/>as<sp/>it<sp/>doesn&apos;t<sp/>know<sp/>if<sp/>it<sp/>is<sp/>a<sp/>redirect<sp/>or<sp/>not<sp/>in<sp/>the<sp/>begining</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="939"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#at<sp/>this<sp/>point<sp/>all<sp/>the<sp/>content<sp/>of<sp/>redir_cache<sp/>is<sp/>relative<sp/>to<sp/>the<sp/>start<sp/>path</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="940"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>start:</highlight></codeline>
<codeline lineno="941"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>start<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="942"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>aux_url<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="943"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>redir<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>redir_cache.iterkeys():</highlight></codeline>
<codeline lineno="944"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>aux_url<sp/>=<sp/><ref refid="namespacemw2html_1a961d7236f041373024cd63627b0b5ff1" kindref="member">normalize_url</ref>(redir)</highlight></codeline>
<codeline lineno="945"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>url_filename_cache[aux_url]<sp/>=<sp/>filename</highlight></codeline>
<codeline lineno="946"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>aux_url<sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>complete:</highlight></codeline>
<codeline lineno="947"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>complete.add(aux_url)</highlight></codeline>
<codeline lineno="948"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>aux_url<sp/>!=<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="949"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nurl<sp/>=<sp/><ref refid="namespacemw2html_1a961d7236f041373024cd63627b0b5ff1" kindref="member">normalize_url</ref>(redir_cache[nurl])</highlight></codeline>
<codeline lineno="950"><highlight class="normal"></highlight></codeline>
<codeline lineno="951"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>filename<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="952"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="953"><highlight class="normal"></highlight></codeline>
<codeline lineno="954"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/>os.path.exists(filename):</highlight></codeline>
<codeline lineno="955"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;ERROR:<sp/>&quot;</highlight><highlight class="normal">,<sp/>url,<sp/></highlight><highlight class="stringliteral">&apos;\n&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="956"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">continue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="957"><highlight class="normal"></highlight></codeline>
<codeline lineno="958"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f<sp/>=<sp/>open(filename,<sp/></highlight><highlight class="stringliteral">&apos;r&apos;)</highlight></codeline>
<codeline lineno="959"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>doc<sp/>=<sp/>f.read()</highlight></codeline>
<codeline lineno="960"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f.close()</highlight></codeline>
<codeline lineno="961"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>new_urls<sp/>=<sp/>[]</highlight></codeline>
<codeline lineno="962"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="963"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>filename.endswith(</highlight><highlight class="stringliteral">&apos;.html&apos;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(doc,<sp/>new_urls)<sp/>=<sp/><ref refid="namespacemw2html_1a46560afd89d32a4311c16a3d64741063" kindref="member">parse_html</ref>(doc,<sp/>url)</highlight></codeline>
<codeline lineno="965"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">elif</highlight><highlight class="normal"><sp/>filename.endswith(</highlight><highlight class="stringliteral">&apos;.css&apos;</highlight><highlight class="normal">):</highlight></codeline>
<codeline lineno="966"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(doc,<sp/>new_urls)<sp/>=<sp/><ref refid="namespacemw2html_1add2343a149c4f3bc33e714e0de40f1e1" kindref="member">parse_css</ref>(doc,<sp/>url)</highlight></codeline>
<codeline lineno="967"><highlight class="normal"></highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Save<sp/>document<sp/>changes<sp/>to<sp/>disk</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>The<sp/>unmodified<sp/>file<sp/>already<sp/>exists<sp/>on<sp/>disk.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>update<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="971"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>text_ext<sp/>=<sp/>(</highlight><highlight class="stringliteral">&apos;txt&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;html&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;rtf&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;css&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;sgml&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;xml&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>ext<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>text_ext:</highlight></codeline>
<codeline lineno="973"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>filename.endswith(ext):</highlight></codeline>
<codeline lineno="974"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>update<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="975"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="976"><highlight class="normal"></highlight></codeline>
<codeline lineno="977"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>update:</highlight></codeline>
<codeline lineno="978"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f<sp/>=<sp/>open(filename,<sp/></highlight><highlight class="stringliteral">&apos;w&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="979"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f.write(doc)</highlight></codeline>
<codeline lineno="980"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>f.close()</highlight></codeline>
<codeline lineno="981"><highlight class="normal"></highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>config.debug:</highlight></codeline>
<codeline lineno="983"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>out.write(url<sp/>+<sp/></highlight><highlight class="stringliteral">&apos;\n<sp/>=&gt;<sp/>&apos;</highlight><highlight class="normal"><sp/>+<sp/>filename<sp/>+<sp/></highlight><highlight class="stringliteral">&apos;\n\n&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>n<sp/>+=<sp/>1</highlight></codeline>
<codeline lineno="985"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="986"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Enqueue<sp/>URLs<sp/>that<sp/>we<sp/>haven&apos;t<sp/>yet<sp/>spidered.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="987"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>u<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>new_urls:</highlight></codeline>
<codeline lineno="988"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/><ref refid="namespacemw2html_1a961d7236f041373024cd63627b0b5ff1" kindref="member">normalize_url</ref>(u)<sp/></highlight><highlight class="keywordflow">not</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>complete:</highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Strip<sp/>off<sp/>any<sp/>#section<sp/>link.</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="990"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&apos;#&apos;</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>u:</highlight></codeline>
<codeline lineno="991"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>u<sp/>=<sp/>u[:u.index(</highlight><highlight class="stringliteral">&apos;#&apos;</highlight><highlight class="normal">)]</highlight></codeline>
<codeline lineno="992"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pending.add(u)<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="993"><highlight class="normal"></highlight></codeline>
<codeline lineno="994"><highlight class="normal"><sp/><sp/><sp/><sp/>conn.close()</highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/></highlight><highlight class="stringliteral">&quot;connection<sp/>to&quot;</highlight><highlight class="normal">,<sp/>domain,<sp/></highlight><highlight class="stringliteral">&quot;closed.&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="996"><highlight class="normal"><sp/><sp/><sp/><sp/>out.write(<ref refid="sndfile__save_8m_1a4b99ff73a8a869319570237b5c57ab03" kindref="member">str</ref>(n)<sp/>+<sp/></highlight><highlight class="stringliteral">&apos;<sp/>files<sp/>saved\n&apos;</highlight><highlight class="normal">)</highlight></codeline>
<codeline lineno="997"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/>counter,<sp/></highlight><highlight class="stringliteral">&quot;httplib<sp/>requests<sp/>done&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="998"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/>errors,<sp/></highlight><highlight class="stringliteral">&quot;errors<sp/>not<sp/>recovered&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="999"><highlight class="normal"></highlight></codeline>
<codeline lineno="1000"><highlight class="normal"></highlight></codeline>
<codeline lineno="1001" refid="namespacemw2html_1a8fc8d9b04bc7f0fbdf70c59d0cddfd3f" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a8fc8d9b04bc7f0fbdf70c59d0cddfd3f" kindref="member">usage</ref>():</highlight></codeline>
<codeline lineno="1002"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="1003"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Print<sp/>command<sp/>line<sp/>options.</highlight></codeline>
<codeline lineno="1004"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/><sp/><sp/>usage_str<sp/>=<sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="1006"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>mw2html<sp/>url<sp/>outdir<sp/>[options]</highlight></codeline>
<codeline lineno="1007"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1008"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>MW2HTML<sp/>Audacity<sp/>version</highlight></codeline>
<codeline lineno="1009"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Converts<sp/>an<sp/>entire<sp/>Mediawiki<sp/>site<sp/>into<sp/>static<sp/>HTML.</highlight></codeline>
<codeline lineno="1010"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>WARNING:<sp/>This<sp/>is<sp/>a<sp/>recursive<sp/>robot<sp/>that<sp/>ignores<sp/>robots.txt.<sp/><sp/>Use<sp/>with<sp/>care.</highlight></codeline>
<codeline lineno="1011"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1012"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>url<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>URL<sp/>of<sp/>mediawiki<sp/>page<sp/>to<sp/>convert<sp/>to<sp/>static<sp/>HTML.</highlight></codeline>
<codeline lineno="1013"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>outdir<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Output<sp/>directory.</highlight></codeline>
<codeline lineno="1014"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1015"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>-f,<sp/>--force<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Overwrite<sp/>existing<sp/>files<sp/>in<sp/>outdir.</highlight></codeline>
<codeline lineno="1016"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>-d,<sp/>--debug<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Debug<sp/>mode.</highlight></codeline>
<codeline lineno="1017"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>-s,<sp/>--special-mode<sp/><sp/><sp/>-<sp/>-f<sp/>--no-flatten<sp/>--limit-parent<sp/>-l<sp/>sidebar.html</highlight></codeline>
<codeline lineno="1018"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-b<sp/>footer.html,<sp/>keeps<sp/>MediaWiki<sp/>icon<sp/>and<sp/>more</highlight></codeline>
<codeline lineno="1019"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>design<sp/>changes.</highlight></codeline>
<codeline lineno="1020"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>--no-flatten<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Do<sp/>not<sp/>flatten<sp/>directory<sp/>structure.</highlight></codeline>
<codeline lineno="1021"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>--no-clean<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Do<sp/>not<sp/>clean<sp/>up<sp/>filenames<sp/>(clean<sp/>replaces</highlight></codeline>
<codeline lineno="1022"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>non-alphanumeric<sp/>chars<sp/>with<sp/>_,<sp/>renames<sp/>math<sp/>thumbs).</highlight></codeline>
<codeline lineno="1023"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>--no-hack-skin<sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Do<sp/>not<sp/>modify<sp/>skin<sp/>CSS<sp/>and<sp/>HTML<sp/>for<sp/>looks.</highlight></codeline>
<codeline lineno="1024"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>--no-made-by<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Suppress<sp/>&quot;generated<sp/>by&quot;<sp/>comment<sp/>in<sp/>HTML<sp/>source.</highlight></codeline>
<codeline lineno="1025"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>--no-move-href<sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Disable<sp/>&lt;movehref&gt;<sp/>tag.<sp/>[1]</highlight></codeline>
<codeline lineno="1026"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>--no-remove-png<sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Retain<sp/>external<sp/>link<sp/>PNG<sp/>icons.</highlight></codeline>
<codeline lineno="1027"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>--no-remove-history<sp/><sp/>-<sp/>Retain<sp/>image<sp/>history<sp/>and<sp/>links<sp/>to<sp/>information.</highlight></codeline>
<codeline lineno="1028"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>--no-images<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Discard<sp/>images</highlight></codeline>
<codeline lineno="1029"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>--limit-parent<sp/><sp/><sp/><sp/><sp/><sp/><sp/>-<sp/>Do<sp/>not<sp/>explore<sp/>.php<sp/>pages<sp/>outside<sp/>the<sp/>url<sp/>path</highlight></codeline>
<codeline lineno="1030"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(outside<sp/>css,<sp/>images<sp/>and<sp/>other<sp/>files<sp/>aren&apos;t<sp/>affected)</highlight></codeline>
<codeline lineno="1031"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>-l,<sp/>--left=a.html<sp/><sp/><sp/><sp/>-<sp/>Paste<sp/>HTML<sp/>fragment<sp/>file<sp/>into<sp/>left<sp/>sidebar.</highlight></codeline>
<codeline lineno="1032"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>-t,<sp/>--top=a.html<sp/><sp/><sp/><sp/><sp/>-<sp/>Paste<sp/>HTML<sp/>fragment<sp/>file<sp/>into<sp/>top<sp/>horiz<sp/>bar.</highlight></codeline>
<codeline lineno="1033"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>-b,<sp/>--bottom=a.html<sp/><sp/>-<sp/>Paste<sp/>HTML<sp/>fragment<sp/>file<sp/>into<sp/>footer<sp/>horiz<sp/>bar.</highlight></codeline>
<codeline lineno="1034"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>-i,<sp/>--index=filename<sp/>-<sp/>Move<sp/>given<sp/>filename<sp/>in<sp/>outdir<sp/>to<sp/>index.html.</highlight></codeline>
<codeline lineno="1035"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1036"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Example<sp/>Usage:</highlight></codeline>
<codeline lineno="1037"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>mw2html<sp/>http://127.0.0.1/mywiki/<sp/>out<sp/>-f<sp/>-i<sp/>main_page.html<sp/>-l<sp/>sidebar.html</highlight></codeline>
<codeline lineno="1038"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1039"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>Freezes<sp/>wiki<sp/>into<sp/>&apos;out&apos;<sp/>directory,<sp/>moves<sp/>main_page.html<sp/>=&gt;<sp/>index.html,</highlight></codeline>
<codeline lineno="1040"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/>assumes<sp/>sidebar.html<sp/>is<sp/>defined<sp/>in<sp/>the<sp/>current<sp/>directory.</highlight></codeline>
<codeline lineno="1041"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1042"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>[1].<sp/>The<sp/>&lt;movehref&gt;<sp/>tag.</highlight></codeline>
<codeline lineno="1043"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Wiki<sp/>syntax:<sp/>&lt;html&gt;&lt;movehref<sp/>href=&quot;a&quot;&gt;&lt;/html&gt;...&lt;html&gt;&lt;/movehref&gt;&lt;/html&gt;.</highlight></codeline>
<codeline lineno="1044"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>When<sp/>enabled,<sp/>this<sp/>tag<sp/>will<sp/>cause<sp/>all<sp/>href=<sp/>attributes<sp/>inside<sp/>of<sp/>it<sp/>to<sp/>be</highlight></codeline>
<codeline lineno="1045"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>set<sp/>to<sp/>the<sp/>given<sp/>location.<sp/><sp/>This<sp/>is<sp/>useful<sp/>for<sp/>linking<sp/>images.</highlight></codeline>
<codeline lineno="1046"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>In<sp/>MediaWiki,<sp/>for<sp/>the<sp/>&lt;html&gt;<sp/>tag<sp/>to<sp/>work,<sp/>one<sp/>needs<sp/>to<sp/>enable<sp/>$wgRawHtml</highlight></codeline>
<codeline lineno="1047"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>and<sp/>$wgWhitelistEdit<sp/>in<sp/>LocalSettings.php.<sp/><sp/>A<sp/>&lt;movehref&gt;<sp/>tag<sp/>with<sp/>no<sp/>href</highlight></codeline>
<codeline lineno="1048"><highlight class="stringliteral"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>field<sp/>will<sp/>remove<sp/>all<sp/>links<sp/>inside<sp/>it.</highlight></codeline>
<codeline lineno="1049"><highlight class="stringliteral"></highlight></codeline>
<codeline lineno="1050"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1051"><highlight class="normal"></highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">print</highlight><highlight class="normal"><sp/>textwrap.dedent(usage_str.strip(</highlight><highlight class="stringliteral">&apos;\n&apos;</highlight><highlight class="normal">))</highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><sp/><sp/>sys.exit(1)</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"></highlight></codeline>
<codeline lineno="1055"><highlight class="normal"></highlight></codeline>
<codeline lineno="1056" refid="namespacemw2html_1a6af985057064513ae654f38bae83a83b" refkind="member"><highlight class="normal"></highlight><highlight class="keyword">def<sp/></highlight><highlight class="normal"><ref refid="namespacemw2html_1a6af985057064513ae654f38bae83a83b" kindref="member">main</ref>():</highlight></codeline>
<codeline lineno="1057"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;&quot;&quot;</highlight></codeline>
<codeline lineno="1058"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>Command<sp/>line<sp/>interface.</highlight></codeline>
<codeline lineno="1059"><highlight class="stringliteral"><sp/><sp/><sp/><sp/>&quot;&quot;&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">global</highlight><highlight class="normal"><sp/>config</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1062"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(opts,<sp/>args)<sp/>=<sp/>getopt.gnu_getopt(sys.argv[1:],<sp/></highlight><highlight class="stringliteral">&apos;fsdl:t:b:i:&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>[</highlight><highlight class="stringliteral">&apos;force&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;no-flatten&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;no-clean&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1064"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;no-hack-skin&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;no-made-by&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;left=&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1065"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;top=&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;bottom=&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;index=&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;no-move-href&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1066"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;no-remove-png&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;no-remove-history&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;limit-parent&apos;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="1067"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&apos;special-mode&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;debug&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;no-images&apos;</highlight><highlight class="normal">])</highlight></codeline>
<codeline lineno="1068"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>getopt.GetoptError:</highlight></codeline>
<codeline lineno="1069"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespacemw2html_1a8fc8d9b04bc7f0fbdf70c59d0cddfd3f" kindref="member">usage</ref>()</highlight></codeline>
<codeline lineno="1070"><highlight class="normal"></highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Parse<sp/>non-option<sp/>arguments</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">try</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>(rooturl,<sp/>outdir)<sp/>=<sp/>args</highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">except</highlight><highlight class="normal"><sp/>ValueError:</highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespacemw2html_1a8fc8d9b04bc7f0fbdf70c59d0cddfd3f" kindref="member">usage</ref>()</highlight></codeline>
<codeline lineno="1076"><highlight class="normal"><sp/><sp/><sp/><sp/>config<sp/>=<sp/><ref refid="classmw2html_1_1_config" kindref="compound">Config</ref>(rooturl=rooturl,<sp/>outdir=outdir)</highlight></codeline>
<codeline lineno="1077"><highlight class="normal"></highlight></codeline>
<codeline lineno="1078"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Parse<sp/>option<sp/>arguments</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1079"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(opt,<sp/>arg)<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>opts:</highlight></codeline>
<codeline lineno="1080"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;-f&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;--force&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;-s&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;-special-mode&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1081"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.overwrite<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;--no-flatten&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;-s&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;-special-mode&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1083"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.flatten<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;--no-clean&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.clean<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1086"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;--no-hack-skin&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1087"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.hack_skin<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1088"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;--no-made-by&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1089"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.made_by<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1090"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;--no-move-href&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1091"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.move_href<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1092"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;--no-remove-png&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1093"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.remove_png<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1094"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;--no-remove-history&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1095"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.remove_history<sp/>=<sp/></highlight><highlight class="keyword">False</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1096"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;--no-images&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.no_images<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1098"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;--limit-parent&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;-s&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;-special-mode&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1099"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.limit_parent<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;-s&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;-special-mode&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.special_mode<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1102"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.sidebar<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;sidebar.html&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.footer<sp/>=<sp/></highlight><highlight class="stringliteral">&apos;footer.html&apos;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;-d&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;--debug&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.debug<sp/>=<sp/></highlight><highlight class="keyword">True</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;-l&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;--left&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.sidebar<sp/>=<sp/>os.path.abspath(arg)</highlight></codeline>
<codeline lineno="1108"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;-t&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;--top&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">raise</highlight><highlight class="normal"><sp/>NotImplementedError</highlight></codeline>
<codeline lineno="1110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.header<sp/>=<sp/>os.path.abspath(arg)</highlight></codeline>
<codeline lineno="1111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;-b&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;--bottom&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.footer<sp/>=<sp/>os.path.abspath(arg)</highlight></codeline>
<codeline lineno="1113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>opt<sp/></highlight><highlight class="keywordflow">in</highlight><highlight class="normal"><sp/>[</highlight><highlight class="stringliteral">&apos;-i&apos;</highlight><highlight class="normal">,<sp/></highlight><highlight class="stringliteral">&apos;--index&apos;</highlight><highlight class="normal">]:</highlight></codeline>
<codeline lineno="1114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>config.index<sp/>=<sp/>arg</highlight></codeline>
<codeline lineno="1115"><highlight class="normal"></highlight></codeline>
<codeline lineno="1116"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">#<sp/>Run<sp/>program</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1117"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespacemw2html_1ab3aff4cd0096159010c6fc6b2338e8a6" kindref="member">run</ref>()</highlight></codeline>
<codeline lineno="1118"><highlight class="normal"></highlight></codeline>
<codeline lineno="1119"><highlight class="normal"></highlight></codeline>
<codeline lineno="1120"><highlight class="normal"></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>__name__<sp/>==<sp/></highlight><highlight class="stringliteral">&apos;__main__&apos;</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="1121"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespacemw2html_1a6af985057064513ae654f38bae83a83b" kindref="member">main</ref>()</highlight></codeline>
    </programlisting>
    <location file="C:/_dev/OpenU/Audacity/audacity/scripts/mw2html_audacity/mw2html.py"/>
  </compounddef>
</doxygen>
